import{q as Ee,r as l,ad as F,ae as H,af as V,g as fe,j as s,T as n,J as D,aG as Ce,d7 as Be,aH as Re,ao as Pe,a8 as x,d$ as m,f as y}from"./index-e8217573.js";import{B as Q}from"./ButtonBox-9e46519a.js";import{D as G}from"./Dialog-adadaf64.js";import{E as _e}from"./ErrorDialog-d5eef4d7.js";import{I as k,B as Y}from"./IconButton-36693dd9.js";import{I as qe}from"./InputTextArea-b90aad1d.js";import{R as Le}from"./ReadOnlyTable-86accb69.js";import{S as Me}from"./SimpleOverlayPanel-f23b2f6a.js";import{T as Ue}from"./TextButton-41b4a67e.js";import{T as $e}from"./Toast-ae99ea5b.js";import{c as Fe,M as He,C as Ve}from"./MainMessageBody-e15b4437.js";import{C as u}from"./column.esm-938bad7d.js";import{C as J}from"./CreditQueryService-75543be7.js";import"./kebab-menu-8835ad2e.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./withAuth-6de36ebf.js";import"./No_data-1720c54e.js";import"./SimpleDropDown-061a3470.js";import"./virtualscroller.esm-9939945c.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./loader-5f2cfb31.js";import"./TransitionGroup-c8afe0ce.js";import"./Skeleton-7e12d019.js";import"./InputBox-b9e88f52.js";import"./StageService-c1c03c89.js";const De={uid:"",stage:"",query:"",raisedOn:"",raisedBy:"",updatedOn:"",updatedBy:"",status:"",reply:"",action:""},Qe={IN_PRINCIPAL_APPROVAL:"In Principal Approval",FINANCIAL_APPROVAL:"Financial Approval",FINAL_APPROVAL:"Final Approval"},N={IN_PROGRESS:"In Progress",CLOSED:"Closed"},W={IN_PROGRESS:"IN_PROGRESS",CLOSED:"CLOSED"},hs=()=>{var _;const c=Ee(),[i,v]=l.useState(De),[z,h]=l.useState(!1),[S,O]=l.useState(""),[E,K]=l.useState(!1),[T,f]=l.useState(""),[X,C]=l.useState(!1),[j,B]=l.useState(!1),[Z,I]=l.useState(!1),[,g]=l.useState(!1),r=l.useRef(new F({validators:{...H()},...V(),autoForceUpdate:{forceUpdate:()=>g(e=>!e)}})),p=l.useRef(null),o=l.useRef(null),A=l.useRef(null);l.useEffect(()=>{c.loanUid&&w()},[c.loanUid]),l.useEffect(()=>{i.uid&&h(!0)},[i]),l.useEffect(()=>{console.log(j,"message ");const e=fe("VITE_MESSAGE_CONVERSATION_TIMING"),t=async()=>{try{const d=await Ve.checkNewMessageAvailability((c==null?void 0:c.stageUid)??"");I(d==null?void 0:d.data)}catch(d){console.log(d)}};t();const a=setInterval(t,e);return()=>{clearInterval(a)}},[]),l.useEffect(()=>{var e;o!=null&&o.current&&S!==""&&((e=o==null?void 0:o.current)==null||e.showFunction(),O(""))},[S,E]),l.useEffect(()=>{T&&C(!0)},[T]);const w=async()=>{var e;(e=p==null?void 0:p.current)==null||e.search()},ee=e=>{var a;const t={uid:(e==null?void 0:e.uid)??null,stage:((a=e==null?void 0:e.stage)==null?void 0:a.stageName)??"",query:(e==null?void 0:e.queryMessage)??"",raisedOn:y(e==null?void 0:e.createdAtSystemDate)??"-",raisedBy:(e==null?void 0:e.createdByUserName)??"",updatedOn:y(e==null?void 0:e.updatedAtSystemDate)??"-",updatedBy:(e==null?void 0:e.updatedByUserName)??"",status:N[`${e==null?void 0:e.status}`]??"",reply:(e==null?void 0:e.queryResponse)??"",action:""};v(t)},se=e=>{var a,d,q,L,M,U,$;const t=localStorage.getItem("stageDetail");Ae({assignedTo:((d=(a=JSON.parse(t))==null?void 0:a.assignee)==null?void 0:d.name)??"NA",delegateTo:((L=(q=JSON.parse(t))==null?void 0:q.delegate)==null?void 0:L.name)??"NA",initiation:((M=JSON.parse(t))==null?void 0:M.createdAtSystemDate)??"NA",status:((U=JSON.parse(t))==null?void 0:U.status)??"NA"}),A.current&&(($=A.current)==null||$.toggle(e))},te=e=>{var a;const t={uid:(e==null?void 0:e.uid)??null,stage:((a=e==null?void 0:e.stage)==null?void 0:a.stageName)??"",query:(e==null?void 0:e.queryMessage)??"",raisedOn:y(e==null?void 0:e.createdAtSystemDate)??new Date().toISOString(),raisedBy:(e==null?void 0:e.createdByUserName)??"",updatedOn:(e==null?void 0:e.updatedAt)??new Date().toISOString(),updatedBy:(e==null?void 0:e.updatedByUserName)??"",status:N[`${e==null?void 0:e.status}`]??"",reply:"",action:""};t.status==="In Progress"&&(t.updatedOn="-",t.updatedBy="-"),v(t)},ae=()=>{h(!1),P()},R=e=>{B(!j)},le=async()=>{var t;if(!de())return;const e={uid:i.uid,status:W.CLOSED,queryResponse:i.reply};try{const a=await J.updateQueryResponse(e);Be(a)&&((t=p==null?void 0:p.current)==null||t.search(),O(Re.SAVED),K(!E),h(!1))}catch(a){console.log(a),h(!1),P(),f(Pe(a))}},re=e=>{v(t=>({...t,reply:e.target.value}))},ie=e=>{var t,a;(a=r==null?void 0:r.current)==null||a.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},de=()=>{var t,a;let e=!1;return e=(t=r==null?void 0:r.current)==null?void 0:t.allValid(),e||(g(d=>!d),(a=r==null?void 0:r.current)==null||a.showMessages(),g(d=>!d),!1)},P=()=>{var e;r.current=new F({validators:{...H()},...V(),autoForceUpdate:{forceUpdate:()=>g(t=>!t)}}),(e=r==null?void 0:r.current)==null||e.hideMessages()},ce=()=>s.jsx("div",{className:"flex",children:s.jsx(x,{label:`${m.t("label.cq.stage")}`,className:"mr-1"})}),ne=e=>{var t;return s.jsx("div",{className:"text-primary-ptext-1000 text-xs text-left w-30",children:Qe[`${(t=e==null?void 0:e.stage)==null?void 0:t.stageName}`]??""})},xe=()=>s.jsx("div",{className:"flex",children:s.jsx(x,{label:`${m.t("label.cq.query")}`,className:"mr-1"})}),me=e=>s.jsx("div",{dangerouslySetInnerHTML:{__html:e.queryMessage},className:"text-primary-ptext-1000 text-xs text-left w-30 truncate"}),ue=()=>s.jsx("div",{className:"flex",children:s.jsx(x,{label:`${m.t("label.cq.raisedOn")}`,className:"mr-1"})}),pe=e=>s.jsx("div",{className:"text-primary-ptext-1000 text-xs text-left w-30",children:y((e==null?void 0:e.createdAtSystemDate)??"-")}),oe=()=>s.jsx("div",{className:"flex",children:s.jsx(x,{label:`${m.t("label.cq.raisedBy")}`,className:"mr-1"})}),ye=e=>s.jsx("div",{className:"text-primary-ptext-1000 text-xs text-left w-30",children:(e==null?void 0:e.createdByUserName)??""}),Ne=()=>s.jsx("div",{className:"flex",children:s.jsx(x,{label:`${m.t("label.cq.respondedOn")}`,className:"mr-1"})}),he=e=>s.jsx("div",{className:"text-primary-ptext-1000 text-xs text-left w-30",children:e.status=="CLOSED"?y(e==null?void 0:e.updatedAtSystemDate):"-"}),je=()=>s.jsx("div",{className:"flex",children:s.jsx(x,{label:`${m.t("label.cq.respondedBy")}`,className:"mr-1"})}),ge=e=>(console.log(e.updatedByUsername),s.jsx("div",{className:"text-primary-ptext-1000  text-xs text-left w-30",children:e.status==="CLOSED"?e==null?void 0:e.updatedByUserName:"-"})),be=()=>s.jsx("div",{children:s.jsx(x,{label:`${m.t("label.cq.status")}`,className:"mr-1"})}),ve=e=>s.jsx("div",{className:"text-primary-ptext-1000 text-xs text-left",children:N[`${e==null?void 0:e.status}`]??""}),Se=()=>s.jsx("div",{children:s.jsx(x,{label:`${m.t("label.cq.action")}`,className:"mr-1"})}),Te=e=>s.jsx("div",{className:"flex justify-center items-center text-primary-ptext-1000 text-xs cursor-pointer",children:e.status===W.CLOSED?s.jsx(k,{className:"select-none",buttonType:Y.VIEW,onClick:()=>{ee(e)}}):s.jsx(k,{className:"select-none",buttonType:Y.REPLY,onClick:()=>te(e)})}),[b,Ae]=l.useState({assignedTo:"",delegateTo:"",initiation:"",status:""}),Oe=()=>s.jsxs("div",{className:"flex flex-col gap-4 p-5 ",children:[s.jsxs("div",{className:"flex flex-row justify-between items-center",children:[s.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Status :"}),s.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:b.status})]}),s.jsxs("div",{className:"flex flex-row justify-between items-center",children:[s.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Assigned to :"}),s.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:b.assignedTo})]}),s.jsxs("div",{className:"flex flex-row justify-between items-center",children:[s.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Delegated to :"}),s.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:b.delegateTo})]}),s.jsxs("div",{className:"flex flex-row justify-between items-center",children:[s.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Date of Initiation :"}),s.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:y(b.initiation)})]})]});return s.jsxs("div",{className:"h-screen flex flex-col gap-8",children:[s.jsxs("div",{className:"flex gap-3 items-center",children:[s.jsx("div",{className:"text-primary-ptext-1000 font-bold",children:s.jsx(n,{label:"header.cq.creditQuery"})}),s.jsx(Ue,{className:"underline text-xs  !text-black  ",label:"View Details",onClick:se}),s.jsxs("button",{onClick:R,className:" relative",children:[s.jsx("img",{src:Fe,alt:"ChatIcon",className:""})," ",Z?s.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"}):s.jsx(s.Fragment,{})]})]}),s.jsxs("div",{className:"h-full bg-white rounded-xl pt-6 px-7 pb-7",children:[s.jsx("div",{className:"mb-4 flex",children:s.jsx(n,{className:"text-xl font-bold text-primary-ptext-1000",label:"label.cq.queryListing"})}),c.loanUid&&s.jsx("div",{children:s.jsxs(Le,{ref:p,standardDataFormatPromise:J.getAll,search:`&loan.uid=${c.loanUid}&isActive=${!0}`,dataKey:"uid",style:{width:"100%"},children:[s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:ce,body:ne}),s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:xe,body:me}),s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:ue,body:pe}),s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:oe,body:ye}),s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:Ne,body:he}),s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:je,body:ge}),s.jsx(u,{className:"text-primary-ptext-1000 text-left text-xs h-12 px-4",header:be,body:ve}),s.jsx(u,{className:"text-primary-ptext-1000 text-xs h-12 pr-4",header:Se,body:Te})]})})]}),s.jsx(G,{className:"min-w-[780px] !p-0",visible:z,closable:!1,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:" flex justify-between",children:[s.jsx("div",{className:"flex flex-col gap-2.5",children:s.jsx("div",{className:"text-base font-bold text-primary-primaryTextColor",children:s.jsx(n,{label:"label.cq.responseToQuery"})})}),s.jsxs("div",{className:"self-start flex items-center gap-5 text-xs text-primary-ptext-1000",children:[s.jsx("div",{children:s.jsx(Q,{className:"",buttonType:D.CANCEL_OUTLINE,onClick:ae,customLabel:i.status!==N.IN_PROGRESS?"Close":void 0})}),i.status===N.IN_PROGRESS&&s.jsx("div",{children:s.jsx(Q,{className:"",buttonType:D.SUBMIT_OUTLINE,onClickWithLoader:le})})]})]}),s.jsxs("div",{className:"flex flex-col ",children:[s.jsx(n,{label:"Query",className:"text-xs text-primary-labelColor"}),s.jsx("div",{className:"h-[117px] bg-secondary-disabledBGColor rounded-md",dangerouslySetInnerHTML:{__html:i.query}}),s.jsxs("div",{className:"  flex items-center gap-2 text-xs ",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:s.jsx(n,{label:"label.cq.raisedOn"})}),s.jsx("span",{className:"ml-2",children:i.raisedOn})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:s.jsx(n,{label:"label.cq.raisedBy"})}),s.jsx("span",{className:"ml-2",children:i.raisedBy})]})]}),s.jsx("div",{className:"h-40 mt-2",children:s.jsx(qe,{name:"reply",label:"label.cq.reply",onBlur:ie,validation:(_=r==null?void 0:r.current)==null?void 0:_.message("reply",i.reply,"mandatory"),value:i.reply,hideMaxCount:!0,onChange:re,autoResize:!0,disabled:i.status===N.CLOSED})}),s.jsxs("div",{className:"mb-3 -mt-4 flex items-center gap-2 text-xs",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:s.jsx(n,{label:"label.cq.respondedOn"})}),s.jsx("span",{className:"ml-2",children:i.updatedOn})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:s.jsx(n,{label:"label.cq.respondedBy"})}),s.jsx("span",{className:"ml-2",children:i.updatedBy})]})]})]})]})}),j?s.jsx(G,{visible:j,closable:!1,model:"false",onHide:()=>B(!1),className:"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162  !h-162",children:s.jsx(He,{params:c,handleCloseOverLay:R})}):null,s.jsx($e,{position:"bottom-right",ref:o,toastText:S,variant:Ce.PRIMARY}),s.jsx(Me,{className:"rounded-lg shadow-lg !w-80 p-1.5 ",ref:A,content:Oe()}),s.jsx(_e,{onHide:()=>{C(!1),f("")},visible:X,errorMessage:T})]})};export{hs as default};
//# sourceMappingURL=CreditQuery-7340eddc.js.map
