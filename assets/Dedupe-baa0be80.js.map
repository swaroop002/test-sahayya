{"version":3,"file":"Dedupe-baa0be80.js","sources":["../../src/views/transaction/PageDDE/Dedupe/Dedupe.tsx"],"sourcesContent":["import { updateLoanDetail } from \"actions/LoanDetailActions\";\nimport ButtonBox from \"components/ButtonBox\";\nimport ErrorDialog from \"components/ErrorDialog\";\nimport Loader from \"components/Loader\";\nimport Text from \"components/Text\";\nimport ToastCustom from \"components/Toast\";\nimport { ToastPositionType } from \"primereact/toast\";\nimport { Suspense, useEffect, useRef, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { NavLink, Outlet, Route, Routes, useParams } from \"react-router-dom\";\nimport { linkAuthRoute, linkBasePath } from \"routes\";\nimport DedupeService from \"services/transaction/DedupeService\";\nimport LoanService from \"services/transaction/LoanService\";\nimport chatIcon from \"assets/chatSvg/chatIcon.svg\";\nimport ChatServices from \"services/ChatServices\";\nimport {\n  getEnvVariableValue,\n  getLocalStorage,\n  parseStandardAPIErrorMessage,\n  validatePutAPIResponse,\n} from \"utils/CommonUtil\";\nimport { BUTTON_TYPE, LOAN_STAGE_STATUS, LOCAL_STORAGE, TOAST_STYLE_TYPE } from \"utils/Constant\";\nimport {\n  LINK_DDE_STAGE_AND_STATUS,\n  LINK_DEDUPE,\n  LINK_DEDUPE_ADDRESS_DEDUPE,\n  LINK_DEDUPE_CUSTOMER_DEDUPE,\n  LINK_DEDUPE_CUSTOMER_LOAN,\n  LINK_DEDUPE_PROPERTY_LOAN,\n  LINK_LOAN_DETAIL,\n  dedupeRoutes,\n} from \"../../../../transactionRoutes\";\n\nimport MainMessageBody from \"components/ChatComponents/MainMessageBody\";\nimport DialogBox from \"components/Dialog/Dialog\";\nimport ACLService from \"services/ACLService\";\nconst DEDUPE_MENU = [\n  {\n    id: 1,\n    name: \"Customer Dedupe\",\n    path: LINK_DEDUPE_CUSTOMER_DEDUPE,\n  },\n  {\n    id: 2,\n    name: \"Address Dedupe\",\n    path: LINK_DEDUPE_ADDRESS_DEDUPE,\n  },\n  {\n    id: 3,\n    name: \"Property Loan Linking\",\n    path: LINK_DEDUPE_PROPERTY_LOAN,\n  },\n  {\n    id: 4,\n    name: \"Customer Loan Linking\",\n    path: LINK_DEDUPE_CUSTOMER_LOAN,\n  },\n];\n\ninterface IButtonDisabled {\n  stageComplete: boolean;\n}\n\nconst initialButtonDisabled: IButtonDisabled = {\n  stageComplete: false,\n};\n\nconst Dedupe = () => {\n  const params: { loanUid?: string; stageUid?: string } = useParams();\n  const dispatch = useDispatch();\n\n  const [showDialogAPIError, setShowDialogAPIError] = useState(false);\n  const [errorMessage, setErrorMessage] = useState<any>(\"\");\n  const [position] = useState<ToastPositionType | undefined>(\"bottom-right\");\n  const [buttonDisabled, setButtonDisabled] = useState({\n    ...initialButtonDisabled,\n  });\n  const [isMessageDialogVisible, setIsMessageDialogVisible] = useState(false);\n  const [isNewMessageAvailable, setIsNewMessageAvailable] = useState(false);\n\n  const [toastMessage, setToastMessage] = useState(\"\");\n  const [toastMessageVariant, setToastMessageVariant] = useState(TOAST_STYLE_TYPE.PRIMARY);\n  const [triggerToast, setTriggerToast] = useState(false);\n\n  const toastMessageRef = useRef(null);\n\n  useEffect(() => {\n    getLoanDetail();\n  }, []);\n\n  useEffect(() => {\n    console.log(isMessageDialogVisible, \"message \");\n    const pollingTimingForConversation = getEnvVariableValue(\"VITE_MESSAGE_CONVERSATION_TIMING\");\n    const callAPI = async () => {\n      try {\n        const res = await ChatServices.checkNewMessageAvailability(params?.stageUid ?? \"\");\n        setIsNewMessageAvailable(res?.data);\n      } catch (error) {\n        console.log(error);\n      }\n    };\n    callAPI();\n    const intervalId = setInterval(callAPI, pollingTimingForConversation);\n    return () => {\n      clearInterval(intervalId);\n    };\n  }, []);\n  useEffect(() => {\n    if (params?.stageUid) {\n      const stageDetail = JSON.parse(getLocalStorage(LOCAL_STORAGE.STAGE_DETAIL));\n      if (\n        stageDetail?.status === LOAN_STAGE_STATUS.COMPLETED ||\n        stageDetail?.status === LOAN_STAGE_STATUS.CANCELLED\n      ) {\n        setButtonDisabled((prevState) => ({ ...prevState, stageComplete: true }));\n      } else if (stageDetail?.status === LOAN_STAGE_STATUS.IN_REVIEW) {\n        setButtonDisabled((prevState) => ({ ...prevState, stageComplete: false }));\n      } else {\n        setButtonDisabled((prevState) => ({ ...prevState, stageComplete: false }));\n      }\n    }\n  }, [params?.stageUid]);\n\n  useEffect(() => {\n    if (toastMessageRef?.current && toastMessage !== \"\") {\n      // @ts-ignore: will be fixed in future\n      toastMessageRef?.current?.showFunction();\n    }\n  }, [toastMessage, toastMessageVariant, triggerToast]);\n\n  useEffect(() => {\n    if (errorMessage) {\n      setShowDialogAPIError(true);\n    }\n  }, [errorMessage]);\n\n  const getLoanDetail = () => {\n    const uid = params.loanUid;\n    const search = `&uid=${uid}`;\n    LoanService.getAll(0, 1, search)\n      .then((res) => {\n        const results = res.data.results[0];\n        dispatch(updateLoanDetail(results));\n      })\n      .catch((err) => {\n        console.log(err);\n        setErrorMessage(parseStandardAPIErrorMessage(err));\n      });\n  };\n  const onToggleMessage = (e: any) => {\n    setIsMessageDialogVisible(!isMessageDialogVisible);\n  };\n  const onStageComplete = async () => {\n    try {\n      const res = await DedupeService.stageComplete(params?.stageUid ?? \"\", {});\n\n      if (validatePutAPIResponse(res)) {\n        setToastMessage(\"Stage completed successfully\");\n        setToastMessageVariant(TOAST_STYLE_TYPE.PRIMARY);\n        setTriggerToast(!triggerToast);\n        if (ACLService.isRouteHasAccess(LINK_DDE_STAGE_AND_STATUS)) {\n          const URL = `${linkBasePath}${linkAuthRoute}${LINK_LOAN_DETAIL}${LINK_DDE_STAGE_AND_STATUS}/${params.loanUid}/`;\n          window.location.href = URL;\n        }\n      }\n    } catch (err) {\n      console.log(err);\n      setShowDialogAPIError(true);\n      setErrorMessage(parseStandardAPIErrorMessage(err));\n    }\n  };\n\n  const getClassMenu = ({ isActive }: any) => {\n    const className = `tab text-sm px-2.5 py-1 min-w-fit ${\n      isActive\n        ? \"bg-secondary-steelBlue-900 rounded-sm text-white font-medium shadow-activeBtn \"\n        : \"text-primary-500\"\n    }`;\n    return className;\n  };\n\n  return (\n    <div>\n      <div className=\"flex flex-col gap-5 \">\n        <div className=\"flex items-center justify-between gap-5 w-full\">\n          <div className=\"flex items-center gap-5 w-11/12\">\n            <div className=\"border-r flex items-center border-secondary-stext-600 px-5 py-2 gap-2  \">\n              <Text className=\"text-primary-ptext-1000 font-bold\" label={\"heading.dedupe\"}></Text>\n              <button onClick={onToggleMessage} className=\" relative\">\n                <img src={chatIcon} alt=\"ChatIcon\" className=\"\" />{\" \"}\n                {isNewMessageAvailable ? (\n                  <div className=\"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full\"></div>\n                ) : (\n                  <></>\n                )}\n              </button>\n            </div>\n\n            <div className=\"w-3/4\">\n              {DEDUPE_MENU.map((menu) => (\n                <NavLink\n                  key={menu.path}\n                  className={getClassMenu}\n                  to={`${linkAuthRoute}${LINK_LOAN_DETAIL}${LINK_DEDUPE}/${params?.loanUid}/${params?.stageUid}${menu.path}`}\n                >\n                  {menu.name}\n                </NavLink>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"w-1/4 flex justify-end\">\n            <ButtonBox\n              buttonType={BUTTON_TYPE.STAGE_COMPLETE}\n              onClickWithLoader={onStageComplete}\n              size=\"LOAN_DATA\"\n              disabled={buttonDisabled.stageComplete}\n            />\n          </div>\n        </div>\n\n        <div className=\"dedupe-layout-body-content\">\n          <Suspense fallback={<Loader />}>\n            <Routes>\n              {dedupeRoutes.map((route, index) => {\n                return <Route key={index} path={route.path} element={<route.component />} />;\n              })}\n            </Routes>\n          </Suspense>\n          <Outlet />\n        </div>\n\n        <ErrorDialog\n          onHide={() => {\n            setShowDialogAPIError(false);\n            setErrorMessage(\"\");\n          }}\n          visible={showDialogAPIError}\n          errorMessage={errorMessage}\n        />\n\n        {isMessageDialogVisible ? (\n          <DialogBox\n            visible={isMessageDialogVisible}\n            closable={false}\n            model={\"false\"}\n            onHide={() => setIsMessageDialogVisible(false)}\n            className=\"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162 \"\n          >\n            <MainMessageBody params={params} handleCloseOverLay={onToggleMessage} />\n          </DialogBox>\n        ) : null}\n\n        <ToastCustom\n          position={position}\n          ref={toastMessageRef}\n          toastText={toastMessage}\n          variant={toastMessageVariant}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Dedupe;\n"],"names":["DEDUPE_MENU","LINK_DEDUPE_CUSTOMER_DEDUPE","LINK_DEDUPE_ADDRESS_DEDUPE","LINK_DEDUPE_PROPERTY_LOAN","LINK_DEDUPE_CUSTOMER_LOAN","initialButtonDisabled","Dedupe","params","useParams","dispatch","useDispatch","showDialogAPIError","setShowDialogAPIError","useState","errorMessage","setErrorMessage","position","buttonDisabled","setButtonDisabled","isMessageDialogVisible","setIsMessageDialogVisible","isNewMessageAvailable","setIsNewMessageAvailable","toastMessage","setToastMessage","toastMessageVariant","setToastMessageVariant","TOAST_STYLE_TYPE","triggerToast","setTriggerToast","toastMessageRef","useRef","useEffect","getLoanDetail","pollingTimingForConversation","getEnvVariableValue","callAPI","res","ChatServices","error","intervalId","stageDetail","getLocalStorage","LOCAL_STORAGE","LOAN_STAGE_STATUS","prevState","_a","search","LoanService","results","updateLoanDetail","err","parseStandardAPIErrorMessage","onToggleMessage","onStageComplete","DedupeService","validatePutAPIResponse","ACLService","LINK_DDE_STAGE_AND_STATUS","URL","linkBasePath","linkAuthRoute","LINK_LOAN_DETAIL","getClassMenu","isActive","jsx","jsxs","Text","chatIcon","Fragment","menu","NavLink","LINK_DEDUPE","ButtonBox","BUTTON_TYPE","Suspense","Loader","Routes","dedupeRoutes","route","index","Route","Outlet","ErrorDialog","DialogBox","MainMessageBody","ToastCustom"],"mappings":"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"}