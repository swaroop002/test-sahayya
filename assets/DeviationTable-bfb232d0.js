import{r as o,ao as te,cj as P,er as le,j as n,R as ne}from"./index-e8217573.js";import{D as de}from"./datatable.esm-f474a654.js";const E={CREATE:"CREATE",UPDATE:"UPDATE"},re=o.forwardRef((d,U)=>{var N,y,O,S,C;const{standardDataFormatPromise:p,search:I,advanceSearch:ie,isIgnoreInitialLoad:L,onUpdateCallback:v,uniqueKey:l,className:M,...j}=d,[s,a]=o.useState({limit:((N=d.tableObj)==null?void 0:N.limit)??10,loading:((y=d.tableObj)==null?void 0:y.loading)??!0,totalRecords:((O=d.tableObj)==null?void 0:O.totalRecords)??0,start:((S=d.tableObj)==null?void 0:S.start)??0,records:[],search:d.search??"",page:((C=d.tableObj)==null?void 0:C.page)??0,errorMessage:""}),[_,F]=o.useState(!0),[u,f]=o.useState([]),[g,x]=o.useState([]),[m,h]=o.useState([]);o.useEffect(()=>{p&&!L&&E.UPDATE===d.mode?(A(),F(!0)):a({...s,loading:!1})},[]),o.useEffect(()=>{v&&v()},[s]),o.useImperativeHandle(U,()=>({search:T,getCurrentRecords:H,getUpdatedRecords:V,getAddedRecords:Y,getDeletedRecords:$,getTotalRecordsCount:Q,addRow:K,reportDataChange:B,deleteRow:q,loadingState:s.loading,tableStatus:s,clearAll:z,getLoadingState:k}));const k=()=>s.loading,T=e=>{_&&d.mode===E.UPDATE&&A()},A=e=>{if(p)return a({...s,records:[],loading:!0}),d.standardDataFormatPromise(I).then(r=>{r.data&&a({...s,loading:!1,records:G(r.data),errorMessage:""})}).catch(r=>{a({...s,loading:!1,records:[],errorMessage:te(r)})})},B=e=>{let r=[];r=s.records.map(i=>i[l]===e[l]?{...e,isUpdated:!0}:i),a({...s,records:r});const c=u.find(i=>i[l]===e[l]);f(c?u.map(i=>i[l]===e[l]?{...e,isUpdated:!0}:i):[...u,e])},K=e=>{const r=new P({length:5}),c={...e,uid:r(),temp:!0};x([...g,c]),a({...s,loading:!1,records:[c,...s.records],totalRecords:s.totalRecords+1})},q=e=>{if(console.log("deleteRow",e),Object.hasOwnProperty.call(e,"temp")){x(g.filter(t=>t[l]!==e[l])),f(u.filter(t=>t[l]!==e[l])),a({...s,records:s.records.filter(t=>t[l]!==e[l])});return}let c=[];if(c=s.records.map(t=>t[l]===e[l]?{...t,isActive:!e.isActive,isDeleted:!e.isDeleted}:t),a({...s,records:c}),!m.find(t=>t[l]===e[l]))h([...m,{...e,isActive:!1,isDeleted:!0}]);else{const t=m.filter(R=>R[l]!==e[l]);h([...t])}},z=()=>{f([]),x([]),h([])},H=()=>s.records,V=()=>u.filter(e=>!e.temp).map(e=>e),Y=()=>u.filter(e=>e.temp===!0).map(e=>{const{uid:r,temp:c,...i}=e;return i}),$=()=>m,G=e=>{const r=new P({length:5});return e.map(t=>!t.uid&&t.smDeviationType===le.TYPE_OF_DEVIATION_AUTOMATIC?{...t,temp:!0,autoDeviationRow:!0,uid:r()}:t).map(t=>{const R=u.find(se=>se[l]===t[l]);return R||t})},J=()=>{const{errorMessage:e}=s;return n.jsx("div",{className:"absolute left-0 top-0 flex flex-col w-full h-full bg-white justify-center items-center",children:n.jsx("div",{className:"text-sm text-inputBorderColour pt-3 font-medium",children:e?n.jsx("div",{className:"flex justify-center mt-7 ml-4",children:e}):d.emptyMessage??n.jsx(n.Fragment,{children:"No Data"})})})},Q=()=>s.totalRecords,W=e=>e!=null&&e.isDeleted||e!=null&&e.isActive&&!(e!=null&&e.isActive)?" !bg-semantic-crimson-100":e!=null&&e.temp||e!=null&&e.autoDeviationRow?" !bg-semantic-deepSkyBlue-100":e!=null&&e.isUpdated?" !bg-semantic-yellow-100":e!=null&&e.uid?{"row-highlight":e.uid%2}:"",{loading:X,records:Z,limit:D,start:w,totalRecords:ee}=s,b=()=>{const e=u.filter(r=>!r.temp);return{ADDED_RECORDS:g.length,UPDATED_RECORDS:e.length,DELETED_RECORDS:m.length}};return n.jsxs("div",{className:"investment-table",children:[d.mode===E.UPDATE?n.jsx("div",{className:"mb-2 flex flex-row justify-center w-full text-primary-ptext-1000 text-left text-xs font-bold",children:n.jsxs("div",{className:"flex items-center",children:[n.jsxs("div",{className:"flex items-center mx-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-semantic-deepSkyBlue-100 border-none"}),n.jsxs("div",{className:"ml-2 ",children:["Added : ",b().ADDED_RECORDS]})]}),n.jsxs("div",{className:"flex items-center mx-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-semantic-yellow-100 border-none"}),n.jsxs("div",{className:"ml-2",children:["Updated : ",b().UPDATED_RECORDS]})]}),n.jsxs("div",{className:"flex items-center mx-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-semantic-crimson-100 border-none"}),n.jsxs("div",{className:"ml-2",children:["Deleted : ",b().DELETED_RECORDS]})]})]})}):"",n.jsx(de,{breakpoint:"768px",dataKey:j.dataKey,emptyMessage:J,first:w,lazy:!0,loading:X,onPage:T,paginator:!1,responsiveLayout:"scroll",rowClassName:W,rows:D,scrollHeight:"556px",stripedRows:!0,totalRecords:ee,value:Z,resizableColumns:!1,selection:d.selection,selectionMode:d.selectionMode,style:{width:"100%"},className:`border border-secondary-concrete px-0 overflow-x-auto rounded-lg read-only-table ${M}`,...j,children:d.children})]})}),ae=ne.memo(re);export{ae as D};
//# sourceMappingURL=DeviationTable-bfb232d0.js.map
