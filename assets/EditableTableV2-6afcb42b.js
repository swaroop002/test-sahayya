import{r as m,ao as he,cj as j,j as r,T as _,R as $}from"./index-e8217573.js";import{S as xe}from"./SimpleDropDown-061a3470.js";import{D as be}from"./datatable.esm-f474a654.js";const Te=l=>r.jsx($.Fragment,{}),E={CREATE:"CREATE",UPDATE:"UPDATE"},pe=m.forwardRef((l,B)=>{var F,w,I,k,D;const{standardDataFormatPromise:P,search:A,advanceSearch:ve,isIgnoreInitialLoad:K,onUpdateCallback:S,uniqueKey:n,className:q,allRecords:u,hideLegend:z,variant:H,getApiResponseCallback:g,...L}=l,[t,i]=m.useState({limit:((F=l.tableObj)==null?void 0:F.limit)??10,loading:((w=l.tableObj)==null?void 0:w.loading)??!0,totalRecords:((I=l.tableObj)==null?void 0:I.totalRecords)??0,start:((k=l.tableObj)==null?void 0:k.start)??0,records:[],search:l.search??"",page:((D=l.tableObj)==null?void 0:D.page)??0,errorMessage:""}),[V]=m.useState(0),[G,O]=m.useState(!1),[f,h]=m.useState([]),[x,b]=m.useState([]),[p,y]=m.useState([]);m.useEffect(()=>{P&&!K&&E.UPDATE===l.mode?(N(null),O(!0)):i({...t,loading:!1})},[]),m.useEffect(()=>{P&&E.UPDATE===l.mode?(N(null),O(!0)):i({...t,loading:!1})},[A]),m.useEffect(()=>{S&&S()},[t]),m.useImperativeHandle(B,()=>({search:()=>{C(void 0,!0)},getCurrentRecords:Z,getUpdatedRecords:ee,getAddedRecords:te,getLastAddedRecord:se,getDeletedRecords:re,getTotalRecordsCount:de,addRow:W,reportDataChange:Q,deleteRow:X,loadingState:t.loading,tableStatus:t,clearAll:U,reset:M,getLoadingState:J}));const J=()=>!0,C=(e,o)=>{M(),G&&l.mode===E.UPDATE?N(e,o):Y()},N=(e,o)=>{var d,c;if(!P)return;i({...t,records:[],loading:!0});const s={start:l.rows?(d=l.tableObj)==null?void 0:d.start:t.start,limit:l.rows?(c=l.tableObj)==null?void 0:c.limit:t.limit,search:l.search?l.search:t.search,page:0};if(e){const a=e.page?e.page:0,R=e.rows?e.rows:0;let v=a*R;v=v+V,s.start=v,s.page=a}return l.search&&(s.search=A??""),l.standardDataFormatPromise(s.start,s.limit,s.search).then(a=>{a.data&&(i(H==="secondary"?{...t,loading:!1,records:ae(a.data.results),totalRecords:a.data.totalRecords,start:s.start??0,search:s.search,errorMessage:""}:{...t,loading:!1,records:le(a.data.results,o),totalRecords:a.data.totalRecords,start:s.start??0,search:s.search,errorMessage:""}),g==null||g(a==null?void 0:a.data))}).catch(a=>{i({...t,loading:!1,records:[],totalRecords:0,start:s.start??0,search:s.search,errorMessage:he(a)}),g==null||g(void 0)})},Q=e=>{let o=[];o=t.records.map(d=>d[n]===e[n]?{...e,isUpdated:!0}:d),console.log("updatedRecordsLocal",o),i({...t,records:o}),console.log("rowData",e);const s=f.find(d=>d[n]===e[n]);console.log("find",s),h(s?f.map(d=>d[n]===e[n]?(console.log("record match",d),{...e,isUpdated:!0}):d):[...f,e])},W=e=>{console.log("addRow",e);const o=new j({length:5}),s={...e,uid:o(),temp:!0};b([...x,s]),i({...t,loading:!1,records:[s,...t.records],totalRecords:t.totalRecords+1})},X=e=>{if(console.log("deleteRow",e),Object.hasOwnProperty.call(e,"temp")){b(x.filter(c=>c[n]!==e[n])),h(f.filter(c=>c[n]!==e[n])),i({...t,records:t.records.filter(c=>c[n]!==e[n])});return}let s=[];if(s=t.records.map(c=>c[n]===e[n]?{...c,isActive:!e.isActive,isDeleted:!e.isDeleted}:c),i({...t,records:s}),!p.find(c=>c[n]===e[n]))y([...p,{...e,isActive:!1,isDeleted:!0}]);else{const c=p.filter(a=>a[n]!==e[n]);y([...c])}},Y=()=>{console.log("allRecords",u);const e=u==null?void 0:u.filter(o=>!o.uid);e==null||e.forEach(o=>{const s=new j({length:5});o.uid=s(),o.temp=!0}),b(e??[]),h(e??[]),i({...t,records:[...e??[]],totalRecords:t.totalRecords+(e??[]).length,loading:!1})},U=()=>{h([]),b([]),y([])},M=()=>{U(),i({...t,loading:!1,records:[],totalRecords:0,start:0,search:""})},Z=()=>t.records,ee=()=>f.filter(e=>!e.temp).map(e=>e),te=()=>f.filter(e=>e.temp===!0).map(e=>{const{uid:o,temp:s,...d}=e;return d}),se=()=>x[x.length-1],re=()=>p,le=(e,o)=>{console.log("allRecords",u);const s=u==null?void 0:u.filter(a=>!a.uid);s==null||s.forEach(a=>{const R=new j({length:5});a.uid=R(),a.temp=!0});const d=u==null?void 0:u.filter(a=>!a.temp);console.log("updatedRecordsFromAllRecords",d),console.log("updatedRecords",f);const c=e.map(a=>{const R=f.find(v=>v[n]===a[n]);return R&&o!==!0?R:a});return b(s??[]),[...s??[],...c]},ae=e=>e.map(s=>{if(s.uid)return s;{const d=new j({length:5});return s.uid=d(),s.temp=!0,s}}),oe=()=>{const{errorMessage:e}=t;return r.jsx("div",{className:"absolute left-0 top-0 flex flex-col w-full h-full bg-white justify-center items-center",children:r.jsx("div",{className:"text-sm text-inputBorderColour pt-3 font-medium",children:e?r.jsx("div",{className:"flex justify-center mt-7 ml-4",children:e}):l.emptyMessage??r.jsx(r.Fragment,{children:"No Data"})})})},ne=e=>{i({...t,limit:e.value})},de=()=>t.totalRecords,ce=e=>e!=null&&e.isDeleted?" !bg-semantic-crimson-100":e!=null&&e.temp?" !bg-semantic-deepSkyBlue-100":e!=null&&e.isUpdated&&!(e!=null&&e.temp)?" !bg-semantic-yellow-100":e!=null&&e.uid?{"row-highlight":e.uid%2}:"",{loading:ie,records:ue,limit:me,start:fe,totalRecords:ge,errorMessage:Ee}=t,Re={layout:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown ",RowsPerPageDropdown:e=>{const o=[{label:10,value:10},{label:20,value:20},{label:50,value:50},{label:"All",value:e.totalRecords}];return r.jsxs("div",{className:"flex ml-auto",children:[r.jsx("div",{className:"flex",children:r.jsx(_,{label:"Rows Per Page",className:"text-secondary-gray-500 text-xs ml-4 flex items-center"})}),r.jsx(xe,{value:e.value,options:o,onChange:ne,className:"border-none !w-20 !text-primary-gray-700 !text-xss !font-Roboto"})]})}},T=()=>{const e=f.filter(o=>!o.temp);return{ADDED_RECORDS:x.length,UPDATED_RECORDS:e.length,DELETED_RECORDS:p.length}};return console.log("updatedRecords",f),r.jsxs("div",{className:"investment-table",children:[!z&&r.jsx(r.Fragment,{children:l.mode===E.UPDATE?r.jsx("div",{className:"mb-2 flex flex-row justify-center w-full text-primary-ptext-1000 text-left text-xs font-bold",children:r.jsxs("div",{className:"flex items-center",children:[r.jsxs("div",{className:"flex items-center mx-2",children:[r.jsx("div",{className:"w-4 h-4 rounded-full bg-semantic-deepSkyBlue-100 border-none"}),r.jsxs("div",{className:"ml-2 ",children:["Added : ",T().ADDED_RECORDS]})]}),r.jsxs("div",{className:"flex items-center mx-2",children:[r.jsx("div",{className:"w-4 h-4 rounded-full bg-semantic-yellow-100 border-none"}),r.jsxs("div",{className:"ml-2",children:["Updated : ",T().UPDATED_RECORDS]})]}),r.jsxs("div",{className:"flex items-center mx-2",children:[r.jsx("div",{className:"w-4 h-4 rounded-full bg-semantic-crimson-100 border-none"}),r.jsxs("div",{className:"ml-2",children:["Deleted : ",T().DELETED_RECORDS]})]})]})}):""}),r.jsx(be,{breakpoint:"768px",dataKey:L.dataKey,emptyMessage:oe,first:fe,lazy:!0,loading:ie,onPage:C,paginator:E.UPDATE===l.mode,paginatorTemplate:Re,paginatorLeft:r.jsx(_,{label:`${t.start+1}-${t.start+t.limit>t.totalRecords?t.totalRecords:t.start+t.limit} of ${t.totalRecords}`,className:"text-secondary-gray-500 text-xs ml-4"}),responsiveLayout:"scroll",rowClassName:ce,rows:me,scrollHeight:"556px",stripedRows:!0,totalRecords:ge,value:ue,resizableColumns:!1,selection:l.selection,selectionMode:l.selectionMode,style:{width:"100%"},className:`border border-secondary-concrete px-0 overflow-x-auto rounded-lg read-only-table ${q}`,...L,children:l.children})]})}),Ae=$.memo(pe);export{Te as C,Ae as E};
//# sourceMappingURL=EditableTableV2-6afcb42b.js.map
