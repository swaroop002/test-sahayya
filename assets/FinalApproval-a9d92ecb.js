var mt=Object.defineProperty;var xt=(f,p,r)=>p in f?mt(f,p,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[p]=r;var N=(f,p,r)=>(xt(f,typeof p!="symbol"?p+"":p,r),r);import{at as ut,w as ft,r as a,aF as y,aG as E,q as ht,ad as ve,ae as Ne,af as je,g as vt,j as e,T as m,J as x,d$ as A,o as ge,i as Nt,cZ as jt,ao as F,f as q,fq as ye,aH as gt,fu as yt,fp as At}from"./index-e8217573.js";import{c as bt,M as St,C as Rt}from"./MainMessageBody-e15b4437.js";import{e as Tt}from"./eye_icon-081bddb3.js";import{B as u}from"./ButtonBox-9e46519a.js";import{D as C}from"./Dialog-adadaf64.js";import{E as It}from"./ErrorDialog-d5eef4d7.js";import{I as D}from"./InputTextArea-b90aad1d.js";import{R as Et}from"./ReadOnlyTable-86accb69.js";import{R as Ct}from"./RichTextEditor-a03bd2fb.js";import{S as Pt}from"./SaveComponent-160c5b32.js";import{S as Ot}from"./SimpleDropDown-061a3470.js";import{S as wt}from"./SimpleOverlayPanel-f23b2f6a.js";import{T as _t}from"./TextButton-41b4a67e.js";import{T as Lt}from"./Toast-ae99ea5b.js";import{C as j}from"./column.esm-938bad7d.js";import{C as kt}from"./CreditQueryService-75543be7.js";import"./Skeleton-7e12d019.js";import"./InputBox-b9e88f52.js";import"./withAuth-6de36ebf.js";import"./StageService-c1c03c89.js";import"./kebab-menu-8835ad2e.js";import"./No_data-1720c54e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./virtualscroller.esm-9939945c.js";import"./index-8739acfd.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./IconButton-36693dd9.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./TransitionGroup-c8afe0ce.js";const b="/custom/api/manage/approval/stage/final";class Ut extends ut{constructor(){super(...arguments);N(this,"getAll",(r=0,i=10,h)=>{const g=`${b}/${h}`;return this.makeGetRequestWithAuth(g)});N(this,"createReceipt",r=>{const i=b;return this.makePostRequestWithAuth(i,r)});N(this,"getRemarks",(r=0,i=10,h)=>{const g=`${b}/remark/${h}`;return this.makeGetRequestWithAuth(g)});N(this,"addRemarks",r=>{const i=b+"/remark";return this.makePutRequestWithAuth(i,r)});N(this,"onApprove",r=>{const i=b+"/approve";return this.makePutRequestWithAuth(i,r)});N(this,"onReject",r=>{const i=b+"/reject";return this.makePutRequestWithAuth(i,r)})}}const P=new Ut,Mt={IN_PROGRESS:"In Progress",CLOSED:"Closed"},Bt=f=>{const[p,r]=a.useState(y.VIEW),[i,h]=a.useState(!1),[g,H]=a.useState(!1),[K,X]=a.useState(!1),[Z,ee]=a.useState(!1),[c,Ae]=a.useState({respondedBy:"",respondedAt:"",queryMessage:"",queryResponse:""}),[O,te]=a.useState(!1),[be,Se]=a.useState(!1),[V,se]=a.useState(""),[$,ae]=a.useState(""),[W,w]=a.useState(""),[re,_]=a.useState(E.PRIMARY),[S,L]=a.useState(!1),[G,R]=a.useState(""),[Re,le]=a.useState(!1),[Te,T]=a.useState(!1),Y=a.useRef(null),k=a.useRef(null),v=a.useRef(null),[Ie,Ft]=a.useState("bottom-right"),[ne,oe]=a.useState(!1),[ie,Q]=a.useState(""),[z,ce]=a.useState(""),[Ee,Ce]=a.useState(""),d=ht(),de=a.useRef(null),[,U]=a.useState(void 0),l=a.useRef(new ve({validators:{...Ne()},...je(),autoForceUpdate:{forceUpdate:()=>U(t=>!t)}}));a.useEffect(()=>{Pe()},[]),a.useEffect(()=>{console.log(O,"message ");const t=vt("VITE_MESSAGE_CONVERSATION_TIMING"),s=async()=>{try{const o=await Rt.checkNewMessageAvailability((d==null?void 0:d.stageUid)??"");Se(o==null?void 0:o.data)}catch(o){console.log(o)}};s();const n=setInterval(s,t);return()=>{clearInterval(n)}},[]);const Pe=()=>{P.getRemarks(0,100,`${d.stageUid}`).then(t=>{console.log(t.data,"response"),t.data.uid===null?oe(!1):(oe(!0),Ce(t.data.uid),Q(t.data.remarks))}).catch(t=>{console.log(t)})};a.useEffect(()=>{G&&le(!0)},[G]),a.useEffect(()=>{var t;v!=null&&v.current&&W!==""&&((t=v==null?void 0:v.current)==null||t.showFunction())},[W,re,S]);const J=t=>{var s,n;(n=l==null?void 0:l.current)==null||n.showMessageFor((s=t==null?void 0:t.target)==null?void 0:s.name)},M=()=>{var s,n;let t=!1;return t=((s=l==null?void 0:l.current)==null?void 0:s.allValid())??!1,t||(U(o=>!o),(n=l==null?void 0:l.current)==null||n.showMessages(),U(o=>!o),!1)},I=()=>{l.current=new ve({validators:{...Ne()},...je(),autoForceUpdate:{forceUpdate:()=>U(t=>!t)}})},Oe=()=>{h(!0)},pe=t=>{te(!O)},we=()=>{var n,o;const{loanUid:t,stageUid:s}=d;return{loan:{uid:t},stage:{uid:s},status:At.IN_PROGRESS,queryMessage:(o=(n=de.current)==null?void 0:n.editor)==null?void 0:o.getContent()}},_e=async()=>{var s;if(!M())return;const t=we();try{console.log("object");const n=await P.createReceipt(t);w(gt.SAVED),_(E.PRIMARY),L(!S)}catch(n){R(F(n))}h(!1),(s=k==null?void 0:k.current)==null||s.search()},Le=()=>{h(!1),I()},ke=()=>{H(!1),ce(""),I()},Ue=()=>({uid:d.stageUid,stageName:"FINAL_APPROVAL",remarks:z}),Me=async()=>{if(!M())return;const t=Ue();return P.onApprove(t).then(s=>{_(E.PRIMARY),w("Saved Successfully"),L(!S),sessionStorage.getItem(yt.IS_WEB_VIEW)||T(!0)}).catch(s=>{R(F(s)),T(!1)})},Be=()=>({uid:d.stageUid,stageName:"FINAL_APPROVAL",remarks:$,reasonToReject:V}),Fe=async()=>{if(!M())return;const t=Be();return P.onReject(t).then(s=>{_(E.PRIMARY),w("Saved Successfully"),L(!S),T(!0)}).catch(s=>{R(F(s)),T(!1)})},qe=()=>{X(!1),se(""),ae(""),I()},De=()=>{ee(!1),I()},Ve=()=>{X(!0)},$e=()=>{H(!0)},We=()=>{const t={loan:{uid:d.loanUid},stage:{uid:d.stageUid},remarks:ie};return ne&&(t.uid=Ee),t},Ge=async()=>{if(!M())return;const t=We();if(ne)return P.addRemarks(t).then(s=>{_(E.PRIMARY),w("Saved Successfully"),L(!S),r(y.VIEW)}).catch(s=>{R(F(s)),T(!1),r(y.VIEW)})},Ye=()=>{r(y.EDIT)},Qe=()=>{r(y.VIEW),Q(""),I()},ze=()=>e.jsx(C,{className:"w-full md:!w-1/2",visible:Z,closable:!1,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(m,{className:"text-xl font-bold text-primary-ptext-1000",label:"label.approval.query"}),e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsxs("div",{children:[e.jsx(m,{className:"mr-3 text-xs font-bold text-primary-ptext-1000",label:"table.approval.query.raisedOn"}),e.jsx(m,{className:"text-xs text-primary-ptext-1000",label:q(c==null?void 0:c.respondedAt)})]}),e.jsxs("div",{children:[e.jsx(m,{className:"mr-3 text-xs font-bold text-primary-ptext-1000",label:"table.approval.query.raisedBy"}),e.jsx(m,{className:"text-xs text-primary-ptext-1000",label:c==null?void 0:c.respondedBy})]})]})]}),e.jsx(u,{buttonType:x.CANCEL_OUTLINE,size:"LOAN_DATA",onClick:De})]}),e.jsxs("div",{className:"flex flex-col ",children:[e.jsx(m,{label:"Query*",className:"text-xs text-primary-labelColor "}),e.jsx("div",{className:"h-40 bg-secondary-disabledBGColor border rounded-md",dangerouslySetInnerHTML:{__html:c==null?void 0:c.queryMessage}}),e.jsx("div",{className:"h-48 mt-3",children:e.jsx(D,{name:"notes",label:"table.approval.query.reply*",className:"!h-full",labelClassNames:"text-xs !text-primary-gray-700",value:c==null?void 0:c.queryResponse,variant:ge.SECONDARY,disabled:!0,hideMaxCount:!0})})]})]})}),Je=()=>{var t;return e.jsx(C,{className:"w-full md:!w-1/2",visible:g,closable:!1,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx("div",{children:e.jsx(m,{className:"text-xl font-bold text-primary-ptext-1000",label:"label.approval.confirmApprove"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.CANCEL_OUTLINE,onClick:ke}),e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.SUBMIT_OUTLINE,onClickWithLoader:Me})]})]}),e.jsx("div",{className:"w-full h-60",children:e.jsx(D,{name:"approvalRemarks",className:"!h-full",label:"label.approval.remarks*",disabled:!1,value:z,onChange:s=>ce(s.target.value),onBlur:J,validation:(t=l==null?void 0:l.current)==null?void 0:t.message("approvalRemarks",z,"mandatory")})})]})})},He=()=>{var t,s;return e.jsx(C,{className:"w-full md:!w-1/2",visible:K,closable:!1,children:e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 sm:gap-0",children:[e.jsx("div",{className:"w-fit",children:e.jsx(m,{className:"text-xl font-bold text-primary-ptext-1000",label:"label.approval.rejectApp"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.CANCEL_OUTLINE,onClick:qe}),e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.REJECT_APPLICATION,onClickWithLoader:Fe})]})]}),e.jsx("div",{className:"w-full sm:w-61",children:e.jsx(Ot,{name:"rejectReason",options:[{name:"insufficientInformation",value:"Insufficient Information"},{name:"lowCreditScore",value:"Low Credit Score"},{name:"inappropriateDocumentation",value:"Inappropriate Documentation"},{name:"other",value:"Other"}],optionLabel:"name",optionValue:"value",onChange:pt,label:"label.approval.rejectionReason*",placeholder:"label.approval.select",onBlur:J,validation:(t=l==null?void 0:l.current)==null?void 0:t.message("rejectReason",V,"mandatory"),value:V,disabled:!1})}),e.jsx("div",{className:"w-full h-60",children:e.jsx(D,{name:"rejectRemarks",className:"!h-full",label:"label.approval.remarks*",disabled:!1,onChange:dt,value:$,placeholder:"label.approval.enterMessage*",onBlur:J,validation:(s=l==null?void 0:l.current)==null?void 0:s.message("rejectRemarks",$,"mandatory")})})]})})},Ke=()=>e.jsx(C,{className:"w-full md:!w-1/2",visible:i,closable:!1,children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[e.jsx("div",{children:e.jsx(m,{className:"text-xl font-bold text-primary-ptext-1000",label:"label.approval.query"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.CANCEL_OUTLINE,onClick:Le}),e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.SUBMIT_OUTLINE,onClickWithLoader:_e})]})]}),e.jsx("div",{className:"text-editor-scroll ",children:e.jsx(Ct,{hideErrorRow:!0,ref:de,validation:{errorMessage:"pageObj.errorMessage"},height:200,disabled:!1})})]})}),Xe=()=>e.jsxs("div",{className:"flex flex-col gap-4 p-5 ",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Status :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:B.status})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Assigned to :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:B.assignedTo})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Delegated to :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:B.delegateTo})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Date of Initiation :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:q(B.initiation)})]})]}),Ze=t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center ",children:e.jsx("div",{className:"w-4 h-4 flex items-center",onClick:()=>it(t),children:e.jsx("img",{src:Tt,alt:"Sahayya Logo",className:"cursor-pointer"})})})}),et=t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-primary-ptext-900 font-BrownLight text-left truncate",children:t.status!=="IN_PROGRESS"?t==null?void 0:t.updatedByUserName:"-"})}),tt=t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-primary-ptext-900 font-BrownLight text-left truncate",children:t.status!=="IN_PROGRESS"?q(t==null?void 0:t.updatedAtSystemDate):"-"})}),st=t=>e.jsx("div",{className:"text-primary-ptext-900 font-BrownLight text-left truncate",children:Mt[`${t==null?void 0:t.status}`]??""}),at=t=>e.jsx("div",{className:"text-primary-ptext-900 font-BrownLight text-left truncate w-48",title:ye(t.queryMessage),children:ye(t.queryMessage)}),rt=t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-primary-ptext-900 font-BrownLight text-left truncate",children:t==null?void 0:t.createdByUserName})}),lt=t=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-primary-ptext-900 font-BrownLight text-left truncate",children:q(t==null?void 0:t.createdAtSystemDate)})}),[B,nt]=a.useState({assignedTo:"",delegateTo:"",initiation:"",status:""}),ot=t=>{var n,o,me,xe,ue,fe,he;const s=localStorage.getItem("stageDetail");nt({assignedTo:((o=(n=JSON.parse(s))==null?void 0:n.assignee)==null?void 0:o.name)??"NA",delegateTo:((xe=(me=JSON.parse(s))==null?void 0:me.delegate)==null?void 0:xe.name)??"NA",initiation:((ue=JSON.parse(s))==null?void 0:ue.createdAtSystemDate)??"NA",status:((fe=JSON.parse(s))==null?void 0:fe.status)??"NA"}),Y.current&&((he=Y.current)==null||he.toggle(t))},it=t=>{Ae({respondedBy:t.createdByUserName,respondedAt:t.createdAtSystemDate,queryMessage:t.queryMessage,queryResponse:t.queryResponse}),ee(!0)},ct=t=>{Q(t.target.value)},dt=t=>{ae(t.target.value)},pt=t=>{se(t.value)};return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap",children:[e.jsxs("div",{className:"w-full flex gap-3 py-2 px-5 items-center justify-between sm:justify-normal sm:w-fit",children:[e.jsx(m,{className:"text-primary-ptext-1000 font-bold",label:"heading.approval.final"}),e.jsx(_t,{className:"underline text-xs  !text-black  ",label:"View Details",onClick:ot}),e.jsxs("button",{onClick:pe,className:" relative",children:[e.jsx("img",{src:bt,alt:"ChatIcon",className:""})," ",be?e.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"}):e.jsx(e.Fragment,{})]})]}),e.jsxs("div",{className:"w-full my-2 px-5 flex items-center justify-end gap-5 text-xs text-primary-ptext-1000 sm:w-fit sm:justify-normal sm:my-0",children:[e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.REJECT_APPLICATION,onClick:Ve}),e.jsx(u,{className:"",size:"LOAN_DATA",buttonType:x.APPROVE,onClick:$e})]})]}),e.jsxs("div",{className:"flex flex-col gap-5 dde-layout-body-content",children:[e.jsxs("div",{className:"bg-white p-5 flex flex-col rounded-xl gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between ",children:[e.jsx("div",{children:e.jsx(m,{className:"text-xl font-bold text-primary-ptext-1000",label:"label.approval.query"})}),e.jsx("div",{children:e.jsx(u,{buttonType:x.ICON_TEXT_ROW,customLabel:"Add Query",onClick:Oe})})]}),e.jsx("div",{children:e.jsxs(Et,{ref:k,standardDataFormatPromise:kt.getAll,search:`&stage.uid=${d.stageUid}&isActive=${!0}`,dataKey:"uid",style:{width:"100%"},children:[e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6 w-30 truncate",header:`${A.t("table.approval.query.query")}`,body:at}),e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:`${A.t("table.approval.query.raisedOn")}`,body:lt}),e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:`${A.t("table.approval.query.raisedBy")}`,body:rt}),e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:`${A.t("table.approval.query.respondedOn")}`,body:tt}),e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:`${A.t("table.approval.query.respondedBy")}`,body:et}),e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:`${A.t("table.approval.query.status")}`,body:st}),e.jsx(j,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:"Actions",body:Ze})]})})]}),e.jsx("div",{className:"bg-white flex flex-col gap-3 p-5 rounded-xl",children:e.jsx(Pt,{title:"label.approval.notes",pageMode:p,onSave:Ge,onEdit:Ye,onCancel:Qe,children:e.jsx("div",{className:"h-40",children:e.jsx(D,{name:"notes",className:"!h-full",labelClassNames:"text-xs !text-primary-gray-700",value:ie,onChange:ct,variant:ge.SECONDARY,hideLabel:!0,disabled:p===y.VIEW})})})}),e.jsx(Lt,{position:Ie,ref:v,toastText:W,variant:re,onRemove:()=>{Te&&f.navigate(`${Nt}${jt}/${d.loanUid}`)}}),O?e.jsx(C,{visible:O,closable:!1,model:"false",onHide:()=>te(!1),className:"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162  ",children:e.jsx(St,{params:d,handleCloseOverLay:pe})}):null,e.jsx(It,{onHide:()=>{le(!1),R("")},visible:Re,errorMessage:G}),e.jsx(wt,{className:"rounded-lg shadow-lg !w-80 p-1.5 ",ref:Y,content:Xe()}),i&&Ke(),K&&He(),g&&Je(),Z&&ze()]})]})},ys=ft(Bt);export{ys as default};
//# sourceMappingURL=FinalApproval-a9d92ecb.js.map
