{"version":3,"file":"FinalOpinion-c6d0ce35.js","sources":["../../src/views/transaction/PageDDE/Legal/Sections/FinalOpinion/FinalOpinion.tsx"],"sourcesContent":["import DatePicker from \"components/DatePicker/DatePicker\";\nimport SaveComponent from \"components/Save/SaveComponent\";\nimport Section from \"components/Section/Section\";\nimport React, { useEffect, useState, forwardRef, useRef, useImperativeHandle } from \"react\";\nimport SimpleReactValidator from \"simple-react-validator\";\nimport {\n  INPUT_STYLE_TYPE,\n  PAGE_MODE,\n  STATIC_MASTER_TYPE_TOAST_TEXT,\n  TOAST_STYLE_TYPE,\n} from \"utils/Constant\";\nimport {\n  getStandardValidator,\n  messageReplace,\n  parseStandardAPIErrorMessage,\n  parseStandardAPIErrorMessageNew,\n} from \"utils/CommonUtil\";\nimport InputBox from \"components/InputBox\";\nimport AclGuard from \"components/AclGuard\";\nimport SimpleDropDown from \"components/SimpleDropDown/SimpleDropDown\";\nimport { IDropDownOptions } from \"views/transaction/PageDDE/Login/Helper\";\nimport InputTextArea from \"components/InputTextArea/InputTextArea\";\nimport { ILegalDropdownList, ILegalSectionProps } from \"../../PageReport/PageReport\";\nimport ErrorDialog from \"components/ErrorDialog/ErrorDialog\";\nimport ToastCustom from \"components/Toast\";\nimport LegalService from \"services/transaction/DDE/LegalService\";\nimport SkeletonCustom from \"components/Skeleton/Skeleton\";\nimport { useSelector } from \"react-redux\";\nimport { isLegalSectionAccessDisabled } from \"../../Helper\";\n\ninterface IProps extends ILegalSectionProps {\n  isLoadingInitial: boolean;\n  data?: ILegalFinalOpinionPageObj;\n  getDetailsCallback: () => void;\n}\n\nexport interface ILegalFinalOpinionPageObj {\n  legalUid: string;\n  status: string;\n  remark: string;\n  certificateOrOpinion: string;\n}\n\nexport const initialLegalFinalOpinionPageOj: ILegalFinalOpinionPageObj = {\n  legalUid: \"\",\n  status: \"\",\n  remark: \"\",\n  certificateOrOpinion: \"\",\n};\n\nexport const FINAL_OPINION_STATUS = {\n  POSITIVE: \"POSITIVE\",\n  NEGATIVE: \"NEGATIVE\",\n};\n\nconst FINAL_OPINION_LIST = [\n  { code: FINAL_OPINION_STATUS.POSITIVE, label: \"Positive\" },\n  { code: FINAL_OPINION_STATUS.NEGATIVE, label: \"Negative\" },\n];\n\nconst FinalOpinion: React.FC<IProps> = forwardRef((props, ref) => {\n  const { data, getDetailsCallback, isLoadingInitial, isLoading } = props;\n\n  /*\n    -------------------------------------------------------\n      State\n    -------------------------------------------------------\n    */\n  const [pageObj, setPageObj] = useState<ILegalFinalOpinionPageObj>({\n    ...initialLegalFinalOpinionPageOj,\n  });\n  const [pageMode, setPageMode] = useState(PAGE_MODE.VIEW);\n  const [toastMessage, setToastMessage] = useState(\"\");\n  const [triggerToast, setTriggerToast] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [showDialogAPIError, setShowDialogAPIError] = useState(false);\n  // ref\n  const toastMessageRef = useRef(null);\n\n  // --------------------------- validator initialization ---------------------- //\n  const [, forceUpdate] = useState<boolean>(false);\n\n  const simpleValidator = useRef(\n    new SimpleReactValidator({\n      validators: { ...getStandardValidator() },\n      ...messageReplace(),\n      autoForceUpdate: { forceUpdate: () => forceUpdate((prev) => !prev) },\n    })\n  );\n\n  useImperativeHandle(ref, () => ({\n    save: onSave,\n    onCancel: onCancel,\n  }));\n\n  // --------------------------- global variables ---------------------- //\n\n  /*\n     -------------------------------------------------------\n       useEffect\n     -------------------------------------------------------\n   */\n  useEffect(() => {\n    if (data?.legalUid) {\n      setPageObj((prevObj) => ({\n        ...prevObj,\n        ...data,\n      }));\n    }\n  }, [data]);\n\n  useEffect(() => {\n    if (toastMessageRef?.current && toastMessage !== \"\") {\n      // @ts-ignore: will be fixed in future\n      toastMessageRef?.current?.showFunction();\n      setToastMessage(\"\");\n    }\n  }, [toastMessage, triggerToast]);\n\n  useEffect(() => {\n    if (errorMessage) {\n      setShowDialogAPIError(true);\n    }\n  }, [errorMessage]);\n\n  /*\n    -------------------------------------------------------\n      Service Calls\n    -------------------------------------------------------\n  */\n\n  /*\n    -------------------------------------------------------\n      Handlers\n    -------------------------------------------------------\n  */\n  const handleChange = (e: any) => {\n    setPageObj((prevObj) => ({\n      ...prevObj,\n      [e.target.name]: e.target.value,\n    }));\n  };\n  /* \n    --------------------------------------------------------\n    Validators:\n    --------------------------------------------------------\n  */\n\n  const validate = (e: any) => {\n    simpleValidator?.current?.showMessageFor(e?.target?.name);\n  };\n\n  const validateForm = () => {\n    let isValid = false;\n    isValid = simpleValidator?.current?.allValid() ?? false;\n    if (isValid) {\n      return isValid;\n    } else {\n      forceUpdate((prev) => !prev);\n      simpleValidator?.current?.showMessages();\n      forceUpdate((prev) => !prev);\n      return false;\n    }\n  };\n\n  /*\n    -------------------------------------------------------\n      Button Click Handlers\n    -------------------------------------------------------\n  */\n\n  const onSave = async () => {\n    console.log(\"save\");\n\n    if (!validateForm()) {\n      return;\n    }\n    const payload = enrichForSave();\n\n    try {\n      const res = await LegalService.updateFinalOpinion(payload);\n\n      setToastMessage(STATIC_MASTER_TYPE_TOAST_TEXT.SAVED);\n      setTriggerToast(!triggerToast);\n      setPageMode(PAGE_MODE.VIEW);\n      getDetailsCallback?.();\n    } catch (error) {\n      setErrorMessage(parseStandardAPIErrorMessage(error));\n    }\n  };\n\n  const onEdit = () => setPageMode(PAGE_MODE.EDIT);\n\n  const onCancel = () => {\n    setPageMode(PAGE_MODE.VIEW);\n    resetValidator();\n    getDetailsCallback?.();\n  };\n\n  /*\n    -------------------------------------------------------\n      Helper Functions\n    -------------------------------------------------------\n  */\n  const enrichForSave = () => {\n    return {\n      uid: pageObj?.legalUid,\n      finalOpinionStatus: pageObj?.status,\n      finalOpinionRemarks: pageObj?.remark,\n      finalOpinionCertificate: pageObj?.certificateOrOpinion,\n    };\n  };\n\n  const resetValidator = () => {\n    simpleValidator.current = new SimpleReactValidator({\n      validators: { ...getStandardValidator() },\n      ...messageReplace(),\n      autoForceUpdate: { forceUpdate: () => forceUpdate((prev) => !prev) },\n    });\n    simpleValidator?.current?.hideMessages();\n  };\n\n  /*\n    -------------------------------------------------------\n      Sectional Rendering\n    -------------------------------------------------------\n  */\n\n  /*\n    -------------------------------------------------------\n    Main Rendering\n    -------------------------------------------------------\n  */\n\n  const { status, remark, certificateOrOpinion } = pageObj;\n  return (\n    <div>\n      <SaveComponent\n        title=\"heading.legal.finalOpinion*\"\n        pageMode={pageMode}\n        disabled={isLoading}\n        onSave={onSave}\n        onCancel={onCancel}\n        onEdit={onEdit}\n      >\n        {isLoadingInitial ? (\n          <SkeletonCustom height=\"19.375rem\" width=\"100%\" borderRadius=\"8px\" animation=\"wave\" />\n        ) : (\n          <AclGuard override={{ read: pageMode === PAGE_MODE.VIEW }}>\n            <div className=\" grid grid-cols-4 gap-3 \">\n              <div className=\"col-span-1\">\n                <SimpleDropDown\n                  label=\"label.legal.status*\"\n                  placeholder=\"placeholder.legal.status*\"\n                  name=\"status\"\n                  value={status}\n                  onChange={handleChange}\n                  validation={simpleValidator?.current?.message(`status`, status, \"mandatory\")}\n                  onBlur={validate}\n                  disabled={pageMode === PAGE_MODE.VIEW}\n                  options={FINAL_OPINION_LIST}\n                  optionLabel=\"label\"\n                  optionValue=\"code\"\n                />\n              </div>\n              <div className=\"col-span-3\"></div>\n              <div className=\"col-span-2 h-32\">\n                <InputTextArea\n                  name=\"remark\"\n                  className=\"!h-full\"\n                  label=\"label.legal.remarks*\"\n                  placeholder={\"placeholder.legal.description\"}\n                  variant={INPUT_STYLE_TYPE.SECONDARY}\n                  onChange={handleChange}\n                  value={remark}\n                  onBlur={validate}\n                  validation={simpleValidator?.current?.message(\"remark\", remark, \"mandatory\")}\n                />\n              </div>\n              <div className=\"col-span-2 h-32\">\n                <InputTextArea\n                  name=\"certificateOrOpinion\"\n                  className=\"!h-full\"\n                  label=\"label.legal.certificate/Opinion*\"\n                  placeholder={\"placeholder.legal.description\"}\n                  variant={INPUT_STYLE_TYPE.SECONDARY}\n                  onChange={handleChange}\n                  value={certificateOrOpinion}\n                  onBlur={validate}\n                  validation={simpleValidator?.current?.message(\n                    \"certificateOrOpinion\",\n                    certificateOrOpinion,\n                    \"mandatory\"\n                  )}\n                />\n              </div>\n            </div>\n          </AclGuard>\n        )}\n      </SaveComponent>\n\n      <ToastCustom\n        position={\"bottom-right\"}\n        ref={toastMessageRef}\n        toastText={toastMessage}\n        variant={TOAST_STYLE_TYPE.PRIMARY}\n      />\n\n      <ErrorDialog\n        onHide={() => {\n          setShowDialogAPIError(false);\n          setErrorMessage(\"\");\n        }}\n        visible={showDialogAPIError}\n        errorMessage={errorMessage}\n      />\n    </div>\n  );\n});\n\nexport default FinalOpinion;\n"],"names":["initialLegalFinalOpinionPageOj","FINAL_OPINION_STATUS","FINAL_OPINION_LIST","FinalOpinion","forwardRef","props","ref","data","getDetailsCallback","isLoadingInitial","isLoading","pageObj","setPageObj","useState","pageMode","setPageMode","PAGE_MODE","toastMessage","setToastMessage","triggerToast","setTriggerToast","errorMessage","setErrorMessage","showDialogAPIError","setShowDialogAPIError","toastMessageRef","useRef","forceUpdate","simpleValidator","SimpleReactValidator","getStandardValidator","messageReplace","prev","useImperativeHandle","onSave","onCancel","useEffect","prevObj","_a","handleChange","e","validate","_b","validateForm","isValid","payload","enrichForSave","res","LegalService","STATIC_MASTER_TYPE_TOAST_TEXT","error","parseStandardAPIErrorMessage","onEdit","resetValidator","status","remark","certificateOrOpinion","jsx","SaveComponent","SkeletonCustom","AclGuard","jsxs","SimpleDropDown","InputTextArea","INPUT_STYLE_TYPE","_c","ToastCustom","TOAST_STYLE_TYPE","ErrorDialog"],"mappings":"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"}