var ft=Object.defineProperty;var ht=(j,N,d)=>N in j?ft(j,N,{enumerable:!0,configurable:!0,writable:!0,value:d}):j[N]=d;var Re=(j,N,d)=>(ht(j,typeof N!="symbol"?N+"":N,d),d);import{at as xt,r as c,ad as le,ae as ce,af as de,c8 as we,v as Se,ao as ue,dc as yt,j as a,R as Ue,T as O,J as Pe,dd as _,o as bt}from"./index-e8217573.js";import{L as Dt}from"./loader-5f2cfb31.js";import{B as Ie}from"./ButtonBox-9e46519a.js";import{D as vt}from"./DatePicker-b1c13861.js";import{D as Nt}from"./Dialog-adadaf64.js";import{E as At}from"./ErrorDialog-d5eef4d7.js";import{F as Ke}from"./FileUploadCustom-5ab7fd25.js";import{M as gt}from"./FileUploadMenuBox-f47dc693.js";import{I as J,B as X}from"./IconButton-36693dd9.js";import{I as ke}from"./InputBox-b9e88f52.js";import{S as Et}from"./SimpleDropDown-061a3470.js";import{S as Tt}from"./Skeleton-7e12d019.js";import{T as Ot}from"./TextButton-41b4a67e.js";import{b as jt}from"./DocumentUploader-e2ec1a13.js";import{D as Ct}from"./DocumentService-a293b5f4.js";const Rt="/assets/Verified_Tick-f541c099.svg",P="/custom/api/login";class wt extends xt{constructor(){super(...arguments);Re(this,"savePartnerOrDirectorKycDocument",d=>{const p=`${P}/dde/corporate/director/kyc`;return this.makePostRequestWithAuth(p,d)})}getKycDocument(d,p){const m=`${P}/${d}/${p}/kyc`;return this.makeGetRequestWithAuth(m)}saveKycDocument(d,p){const m=`${P}/${p}/kyc`;return this.makePostRequestWithAuth(m,d)}updateKycDocument(d,p){const m=`${P}/${p}/kyc`;return this.makePutRequestWithAuth(m,d)}populateKycDocument(d,p){const m=`${P}/${p}/kyc/ocr`;return this.makePostRequestWithAuth(m,d)}getPopulateDocumentByKyc(d,p){const m=`${P}/${d}/${p}/prepopulatebykyc`;return this.makeGetRequestWithAuth(m)}sendOTPForAadhar(d){const p="/identity/api/integration/karza/eaadhaar/otp";return this.makePostRequestWithAuth(p,d)}validateAadhar(d,p){const m=`${P}/${p}/kyc/validate/aadhaar`;return this.makePostRequestWithAuth(m,d)}}const St=new wt,f={READ:"READ",EDIT:"EDIT"},Ut={mode:"VIEW"},Pt={uid:"",documentUid:"",primaryKeyAttributeName:"",sectionMetaDropdownOptions:[],documentType:"",documentName:"",documentUrl:[],documentNumber:"",dob:"",isActive:!0},It={showPopulateOcr:!1,enableOcr:!1},Kt={otp:"",message:"",requestId:"",verified:!1},me={DATE:"date",TEXT:"text",NUMBER:"number"},pe={MASKEDNO:"maskedNo",DOB:"dob"},Qt=j=>{const{isLoading:N,mode:d,disableKycCardMenu:p,uid:m,docNo:x,maskedDocNo:L,dateOfBirth:U,docName:h,docSections:C,isVerified:fe,uploadTitle:Me,documentListIndex:A,removeDocumentInList:he,cardNameList:B,handlerCardNameList:z,onSave:Ve,onRemove:xe,onPopulate:$e,ocrStatus:Q,onVerifyAadhar:_e,aadharVerificationStatus:F,handlerAadharVerificationStatus:ye,placeOfUpload:be}=j,[D,Y]=c.useState(d),[q,De]=c.useState(h??""),[ve,G]=c.useState(!1),[y,Ne]=c.useState([]),[Z,Ae]=c.useState([]),[l,g]=c.useState(Pt),[b,k]=c.useState({...Kt,verified:fe||!1}),[E,Le]=c.useState([]),[Be,Fe]=c.useState([]),[,M]=c.useState(void 0),[W,ee]=c.useState(!1),[te,H]=c.useState(It),[Ye,ae]=c.useState(!1),[qe,I]=c.useState(!1),[V,ge]=c.useState(!1),[se,$]=c.useState(""),[Ge,Ee]=c.useState(!1),u=c.useRef(new le({validators:{...ce()},...de(),autoForceUpdate:{forceUpdate:()=>M(e=>!e)}})),We=[{className:"",label:"Remove",command:()=>{if(he!==void 0&&A!==void 0){m?g(t=>({...t,isActive:!1})):he(A);const e=[...B];e.splice(A,1),z([...e])}},disabled:!1}];c.useEffect(()=>{He(),d==="EDIT"&&Y(f.READ)},[]),c.useEffect(()=>{se&&Ee(!0)},[se]),c.useEffect(()=>{W||(u.current=new le({validators:{...ce()},...de(),autoForceUpdate:{forceUpdate:()=>M(e=>!e)}}))},[W]),c.useEffect(()=>{if(h&&y.length){De(h);const e=y==null?void 0:y.find(t=>t.value===h);e&&Oe(e)}},[h,y]),c.useEffect(()=>{if(x&&h&&y.length){const e=ne(h);g(t=>({...t,documentNumber:x,[`${e}`]:L||x,primaryKeyAttributeName:e,dob:U??""})),ae(!1)}},[x,U,y]),c.useEffect(()=>{if((Q.failed||Q.success)&&ae(!1),E.length){const e=E.some(t=>t.isOcrActive===!0);H(e?t=>({...t,showPopulateOcr:!0}):t=>({...t,showPopulateOcr:!1}))}},[E,Q]),c.useEffect(()=>{F.failedToVerify?(I(!1),k({otp:"",requestId:"",message:"",verified:!1}),setTimeout(()=>{ye()},3e3)):F.verified&&(I(!1),k({otp:"",requestId:"",message:"",verified:!0}),setTimeout(()=>{ye()},3e3))},[F]),c.useEffect(()=>{const{documentNumber:e,documentUrl:t,sectionMetaDropdownOptions:o,isActive:s}=l;if((t.length>0||h)&&(t.length===o.length||h)?G(!0):G(!1),!e&&!l.uid&&x&&m&&h){const n=ne(h);g(r=>({...r,uid:m??"",documentNumber:x,[`${n}`]:L||x,primaryKeyAttributeName:n,dob:U??""}))}!s&&xe!==void 0&&xe({...l,uid:m},A)},[l]);const He=async()=>{y.length||Je()},Je=async()=>{var e;try{const t=await jt.getDocumentCategory(0,20,`${we.DOCUMENT_CATEGORY_KYC}`);if(Se(t)){const o=[];let s=[];const n=r=>{for(const v of r)if(v.isPrimaryAttribute)return v.name;return""};(e=t.data.results)==null||e.forEach(r=>{var v,R,w,T,i,K,ie;o.push({uid:(v=r.documentType)==null?void 0:v.uid,label:(R=r.documentType)==null?void 0:R.name,value:(w=r.documentType)==null?void 0:w.code,isActive:((T=r.documentType)==null?void 0:T.isActive)??!1}),s.push({code:(i=r.documentType)==null?void 0:i.code,attributes:(K=r.documentType)!=null&&K.attributeConfig?JSON.parse((ie=r.documentType)==null?void 0:ie.attributeConfig):[],primaryKey:""})}),s=s.map(r=>({...r,primaryKey:n(r.attributes)})),o.length?Ne(o):Ne([]),s.length?Ae([...s]):Ae([])}}catch(t){$(ue(t))}},Xe=async e=>{try{const t=await Ct.getDocument(e);if(Se(t))return t.data}catch(t){$(ue(t))}},ze=async e=>{De(e.value);const t=y==null?void 0:y.find(o=>o.value===e.value);if(t&&(Oe(t),u.current=new le({validators:{...ce()},...de(),autoForceUpdate:{forceUpdate:()=>M(o=>!o)}}),A!==void 0))if(B.includes(e.value)){const o=[...B];o[A]="",z(o),ge(!0)}else{const o=[...B];o[A]=e.value,z(o),ge(!1)}},Qe=e=>{k(t=>({...t,otp:e.target.value}))},Ze=e=>{g(t=>({...t,documentNumber:e.target.value.toUpperCase(),[e.target.name]:e.target.value.toUpperCase()}))},et=e=>{const{value:t}=e.target;g(o=>({...o,dob:t}))},tt=async()=>{let e=!1;if(e=await oe(),!e)return;let t={...l};const o=je(t.documentUrl);t={...t,documentUrl:o},Ve({...t,uid:m,primaryKeyAttributeName:ne(l.documentType)},A),Y(f.READ)},at=()=>{$e(l,A),ae(!0)},st=async()=>{let e=!1;e=await oe(),e&&(Te(!1),I(!0))},Te=async e=>{var t,o,s;try{const n={aadhaarNo:l.documentNumber,consent:"Y"},r=await St.sendOTPForAadhar(n);((t=r.data)==null?void 0:t.statusCode)===101?(k({otp:"",requestId:r.data.requestId??"",message:((o=r.data.result)==null?void 0:o.message)??"",verified:!1}),e||(ee(!0),(s=u.current)==null||s.hideMessages())):($("Failed to send OTP"),I(!1))}catch(n){$(ue(n)),I(!1)}},rt=()=>{k({otp:"",requestId:"",message:"",verified:!1}),ee(!1),I(!1)},ot=async()=>{let e=!1;e=await oe(),e&&(_e(l,b,A,m),ee(!1))},nt=()=>{Te(!0)},re=e=>{var t,o;(o=u==null?void 0:u.current)==null||o.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},oe=async()=>{var t,o;let e=!1;return e=((t=u==null?void 0:u.current)==null?void 0:t.allValid())??!1,e||(M(s=>!s),(o=u==null?void 0:u.current)==null||o.showMessages(),M(s=>!s),!1)},Oe=async e=>{var t;if(e&&e.uid){const o=await Xe(e.uid),s=[],n=[];(t=o==null?void 0:o.documentSections)==null||t.forEach(r=>{var v,R,w;r.isActive&&(((v=r.section)==null?void 0:v.code)===yt.DOCUMENT_SECTIONS_FRONT_PAGE?s.unshift({...r.section,isOcrActive:r.isOcrActive,documentSectionUid:r.uid}):s.push({...r.section,isOcrActive:r.isOcrActive,documentSectionUid:r.uid}),n.push({label:(R=r.section)==null?void 0:R.name,value:(w=r.section)==null?void 0:w.code}))}),g(h&&x?r=>({...r,documentUid:e.uid?e.uid:"",documentName:e.label,documentType:e.value,documentNumber:x||"",dob:U||"",sectionMetaDropdownOptions:n}):r=>({...r,documentUid:e.uid?e.uid:"",documentName:e.label,documentType:e.value,documentNumber:x||"",dob:U||"",documentUrl:[],sectionMetaDropdownOptions:n})),Le([...s]),Fe([...n]),G(!1)}},it=(e,t)=>{g({...l,documentUrl:[...l.documentUrl,{[`${t.name}`]:e.url,...e,code:t.code,name:t.name,isOcrActive:t.isOcrActive}]}),t.isOcrActive&&H(o=>({...o,enableOcr:!0}))},lt=e=>{let t=!1;const o=l.documentUrl.filter(n=>(n.name===e&&(t=n.isOcrActive),n.name!==e));t&&!(()=>o.some(n=>n.isOcrActive))()&&H(n=>({...n,enableOcr:!1})),g({...l,documentUrl:o})},ne=e=>{for(const t of Z)if(t.code===e)return t.primaryKey},je=e=>{const t=[],o=new Map;e.forEach(s=>{o.set(s.code,s)});for(let s=0;s<E.length;s++)t.push(o.get(E[s].code));return t},ct=()=>a.jsx("div",{className:"pointer-events-none h-32.5",children:a.jsx(Ke,{disabled:!0})}),Ce=()=>a.jsx("span",{children:a.jsx("img",{className:"w-3 h-3 animate-spin",src:Dt,alt:"loader"})}),dt=()=>{const e={label:"KYC",value:we.DOCUMENT_CATEGORY_KYC},t={label:"",value:""},o=s=>{var n,r,v,R,w;if(l.documentUrl.length>0){let T=[...l.documentUrl];T=je(T);const i={...T[s],sectionName:(n=T[s])==null?void 0:n.name,category:e.label,type:l.documentName};return{uid:"",placeOfUpload:be??"",name:"",fileName:i==null?void 0:i.fileName,fileType:i==null?void 0:i.contentType,download:"",category:i==null?void 0:i.category,type:i==null?void 0:i.type,sectionName:i==null?void 0:i.name,url:i==null?void 0:i.url}}else if(C&&(C==null?void 0:C.length)>0){const T=(r=E.find(S=>S.code===C[s].sectionType))==null?void 0:r.name,i=[],K=new Map;C.forEach(S=>{K.set(S.sectionType,S)});for(let S=0;S<E.length;S++)i.push(K.get(E[S].code));return{uid:"",placeOfUpload:be??"",name:"",fileName:((v=i==null?void 0:i[s])==null?void 0:v.fileName)??"",fileType:(R=i==null?void 0:i[s])==null?void 0:R.fileType,download:"",category:e.label,type:l.documentName,sectionName:T??"",url:((w=i==null?void 0:i[s])==null?void 0:w.url)??""}}};return a.jsx("div",{className:"flex justify-start h-32.5",children:a.jsx("div",{className:"flex gap-x-6 overflow-x-auto custom-kyc-doc-scroll",children:E.map((s,n)=>a.jsx(Ke,{mode:h?Ut.mode:void 0,docInfoForMediaGallery:o(n),uploaderIndex:n,getUrl:r=>{it(r,s)},savedFileInfoFromApi:C?C[n]:{},footerTitle:s.name,clearCardUploadSectionData:lt,metaCategoryDropdownOptions:[e??t],metaTypeDropdownOptions:[{uid:l.documentUid,label:l.documentName,value:l.documentType}],metaSectionDropdownOptions:Be??[t],disableMetaCategory:!0,disableMetaType:!0,disableMetaSection:!0,disableKebab:!!m||D===f.READ||b.verified,disabled:D===f.READ},`file-uploader-${l.documentType}-${s.code}`))})})},ut=()=>{var o;const e=Z.find(s=>s.code===q),t=(s,n)=>{let r=n.required?"mandatory":"optional";return s===_.PAN?(r=r+"|pan",r):s===_.AADHAR_CARD?(r=r+"|aadharCard",r):(s===_.PASSPORT&&n.name===pe.DOB&&(r=r+"|dob"),r)};return a.jsx("div",{children:(o=e==null?void 0:e.attributes)==null?void 0:o.map(s=>{var n,r;return a.jsx(Ue.Fragment,{children:a.jsxs("div",{className:"flex flex-col",children:[s.name!==pe.MASKEDNO&&a.jsx(O,{className:"self-start text-xs select-none",label:s.label,mandatory:s.required}),s.inputType===me.TEXT||s.inputType===me.NUMBER?a.jsx(c.Fragment,{children:s.name!==pe.MASKEDNO&&a.jsx("div",{className:"w-50",children:a.jsx(ke,{name:`${s.name}`,className:"!h-6 !py-1 !px-2 focus:outline-0 !focus:border focus:border-secondary-steelBlue-300 outline-0",value:(l==null?void 0:l[`${s.name}`])??"",onChange:Ze,onBlur:re,validation:(n=u==null?void 0:u.current)==null?void 0:n.message(`${s.name}`,l[`${s.name}`],t(e.code,s)),hideLabel:!0,disabled:D===f.READ||V||b.verified})})}):null,s.inputType===me.DATE&&a.jsx("div",{className:"w-50",children:a.jsx(vt,{name:"dob",value:new Date(l.dob),maxDate:new Date,variant:bt.SECONDARY,onChange:et,onBlur:re,placeholder:"DD-MM-YYYY ",validation:(r=u==null?void 0:u.current)==null?void 0:r.message("dob",l==null?void 0:l.dob,t(e.code,s)),hideLabel:!0,disabled:D===f.READ||V})})]})},`doc-attribute-${s.name}`)})})},mt=()=>{var e;return a.jsx(Nt,{className:"w-77 pt-6 pb-4 px-6",visible:W,closable:!1,children:a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"mb-16 select-none",children:[a.jsx("div",{className:"font-bold text-primary-primaryTextColor",children:a.jsx(O,{label:"Enter OTP"})}),a.jsx("div",{className:"text-xs",children:a.jsx(O,{label:b.message})})]}),a.jsx("div",{className:"w-64 mb-8 select-none",children:a.jsx(ke,{name:"otp",label:"OTP",onBlur:re,validation:(e=u==null?void 0:u.current)==null?void 0:e.message("otp",b==null?void 0:b.otp,"mandatory"),onChange:Qe})}),a.jsx("div",{className:"mb-8 flex justify-center",children:a.jsx(Ot,{label:"Resend OTP",className:"text-primary-sapphireBlue-1000 text-sm cursor-pointer underline select-none",onClick:nt})}),a.jsxs("div",{className:"flex gap-6 items-center justify-center text-xs text-primary-ptext-1000 select-none",children:[a.jsx(Ie,{buttonType:Pe.CANCEL_OUTLINE,onClick:rt}),a.jsx(Ie,{buttonType:Pe.VERIFY,onClickWithLoader:ot})]})]})})},pt=()=>a.jsxs("div",{className:`border ${D===f.READ?"border-primary-ptext-500":"border-primary-sapphireBlue-600"} rounded-xl p-5 flex flex-col gap-3 text-xs`,children:[a.jsx("div",{className:"flex items-center justify-end",children:a.jsxs("div",{className:"flex gap-3",children:[D===f.READ?a.jsx(J,{className:"select-none",buttonType:X.EDIT,onClick:()=>Y(f.EDIT),tooltipOptions:{position:"top",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:d===f.READ||V}):a.jsxs("div",{className:"flex gap-6",children:[a.jsx(J,{className:"select-none",buttonType:X.CANCEL,onClick:()=>Y(f.READ),tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}}),a.jsx(J,{className:"select-none",buttonType:X.SAVE,onClickWithLoader:tt,tooltipOptions:{position:"top",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:!ve})]}),a.jsx(gt,{model:We,variant:"SECONDARY",disabled:p||!1})]})}),a.jsxs("div",{className:"w-3/4 h-8",children:[a.jsx(Et,{placeholder:"Select Document Type",hideLabel:!0,hideErrorRow:!0,optionLabel:"label",optionValue:"value",options:y,value:q,onChange:ze,disabled:!!m||D===f.READ||b.verified}),V&&a.jsx("div",{className:"pl-2 text-xxs text-semantic-crimson-600",children:a.jsx(O,{label:"Document already selected"})})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"font-thin text-primary-ptext-900 select-none",children:a.jsx(O,{label:Me??"Attach Documents (PDF, JPG, JPEG or PNG)"})}),q&&!V?dt():ct()]}),a.jsx("div",{className:`-mx-5 px-5 pt-3 border-t-0.5 ${D===f.READ?" border-primary-ptext-500":" border-primary-sapphireBlue-600"}`,children:a.jsxs("div",{className:"flex flex-col gap-2",children:[te.showPopulateOcr&&a.jsx("div",{className:"self-end",children:a.jsxs(J,{className:"select-none",buttonType:X.OCR,onClick:at,tooltipOptions:{position:"top",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:D===f.READ||!te.enableOcr||b.verified,children:[Ye&&Ce(),a.jsx(O,{className:`font-normal text-xs text-primary-ptext-600 ${te.enableOcr&&D!==f.READ?"text-primary-sapphireBlue-600 cursor-pointer":""} ${b.verified?"!text-primary-ptext-600 pointer-events-none":""}`,label:"label.populate.OCR"})]})}),a.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[Z.length&&q?ut():null,l.documentType===_.AADHAR_CARD&&!b.verified&&a.jsxs("div",{className:"self-end flex flex-col",children:[a.jsxs("button",{className:`w-43 h-8 flex gap-1.5 items-center justify-center py-1 text-center border rounded-md select-none ${D===f.READ||!ve?"pointer-events-none border-primary-ptext-400 bg-primary-ptext-200 text-primary-ptext-600":"border-primary-copyTextColor text-primary-copyTextColor cursor-pointer"}`,onClick:st,children:[qe&&Ce(),a.jsx(O,{className:"cursor-pointer",label:"Validate Aadhar"})]}),a.jsx("span",{className:"h-4 text-xxs text-semantic-crimson-600",children:F.failedToVerify&&a.jsx(O,{label:"Aadhar Validation Failed"})})]}),l.documentType===_.AADHAR_CARD&&b.verified&&a.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[a.jsx("img",{src:Rt,alt:"verified"}),a.jsx(O,{label:"Verified"})]})]})]})})]});return a.jsx(Ue.Fragment,{children:a.jsxs("div",{className:"w-full h-full",children:[N?a.jsx("div",{className:"flex items-center justify-center w-full h-full",children:a.jsx(Tt,{height:"19rem",width:"100%",borderRadius:"8px",animation:"wave"})}):pt(),W&&mt(),a.jsx(At,{onHide:()=>{Ee(!1),$("")},visible:Ge,errorMessage:se})]})})};export{Qt as K,Rt as V,St as a};
//# sourceMappingURL=KYCV3-298daeeb.js.map
