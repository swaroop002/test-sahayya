import{w as K,q as H,x as q,r as s,aG as E,g as z,ag as Q,dl as L,j as e,T as W,J as Z,ax as X,K as ee,M as se,e0 as te,Q as ae,V as oe,L as le,cZ as y,b as I,l as P,i as ie,ao as ne,f as re,e as ce}from"./index-e8217573.js";import{B as de}from"./ButtonBox-9e46519a.js";import{E as me}from"./ErrorDialog-d5eef4d7.js";import{T as xe}from"./TextButton-41b4a67e.js";import{T as ue}from"./Toast-ae99ea5b.js";import{L as ge}from"./LoanService-d10912e0.js";import{P as fe}from"./PDService-c0e55969.js";import{u as pe}from"./LoanDetailActions-c6533c8e.js";import{S as he}from"./SimpleOverlayPanel-f23b2f6a.js";import{c as Ne,M as Se,C as Te}from"./MainMessageBody-e15b4437.js";import{D as je}from"./Dialog-adadaf64.js";import{A as Ae}from"./ACLService-e19daf7c.js";import"./kebab-menu-8835ad2e.js";import"./loader-5f2cfb31.js";import"./TransitionGroup-c8afe0ce.js";import"./Skeleton-7e12d019.js";import"./InputBox-b9e88f52.js";import"./withAuth-6de36ebf.js";import"./StageService-c1c03c89.js";const ve=M=>{const i=H();i.loanUid;const O=i.stageUid??"",_=q(),[C]=s.useState("bottom-right"),[R,m]=s.useState(!1),[x,f]=s.useState(""),[u,V]=s.useState(""),[p,U]=s.useState(E.PRIMARY),[h,k]=s.useState(!1),[N,S]=s.useState(!1),[c,T]=s.useState(!1),[G,B]=s.useState(!1),n=s.useRef(null);s.useEffect(()=>{j()},[]),s.useEffect(()=>{console.log(c,"message ");const t=z("VITE_MESSAGE_CONVERSATION_TIMING"),a=async()=>{try{const o=await Te.checkNewMessageAvailability((i==null?void 0:i.stageUid)??"");B(o==null?void 0:o.data)}catch(o){console.log(o)}};a();const l=setInterval(a,t);return()=>{clearInterval(l)}},[]),s.useEffect(()=>{j()},[i.stageUid]),s.useEffect(()=>{x&&m(!0)},[x]),s.useEffect(()=>{var t;n!=null&&n.current&&u!==""&&((t=n==null?void 0:n.current)==null||t.showFunction())},[u,p,h]);const j=()=>{const a=`&uid=${i.loanUid}`,l=JSON.parse(Q(le.STAGE_DETAIL));(l==null?void 0:l.status)===L.COMPLETED||(l==null?void 0:l.status)===L.CANCELLED?S(!0):S(!1),ge.getAll(0,1,a).then(o=>{const r=o.data.results[0];console.log("results===",r),_(pe(r))}).catch(o=>{console.log(o)})},$=async()=>fe.completeStage(O).then(t=>{if(console.log(t),V("Stage completed successfully"),U(E.PRIMARY),k(!h),Ae.isRouteHasAccess(y)){const a=`${I}${P}${ie}${y}/${i.loanUid}/`;window.location.href=a}else{const a=I+P+ce;window.location.href=a}}).catch(t=>{console.log(t),m(!0),f(ne(t))}),A=t=>{T(!c)},[d,J]=s.useState({assignedTo:"",delegateTo:"",initiation:"",status:""}),g=s.useRef(null),F=t=>{var l,o,r,v,D,b,w;const a=localStorage.getItem("stageDetail");J({assignedTo:((o=(l=JSON.parse(a))==null?void 0:l.assignee)==null?void 0:o.name)??"NA",delegateTo:((v=(r=JSON.parse(a))==null?void 0:r.delegate)==null?void 0:v.name)??"NA",initiation:((D=JSON.parse(a))==null?void 0:D.createdAtSystemDate)??"NA",status:((b=JSON.parse(a))==null?void 0:b.status)??"NA"}),g.current&&((w=g.current)==null||w.toggle(t))},Y=()=>e.jsxs("div",{className:"flex flex-col gap-4 p-5 ",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Status :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:d.status})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Assigned to :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:d.assignedTo})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Delegated to :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:d.delegateTo})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Date of Initiation :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:re(d.initiation)})]})]});return e.jsxs("div",{className:"flex flex-col gap-5 ",children:[M.location.pathname.includes("initiate")?null:e.jsxs("div",{className:"flex items-center justify-between gap-5 w-full",children:[e.jsx("div",{className:"flex items-center gap-5 w-11/12",children:e.jsxs("div",{className:"border-r flex  items-center border-secondary-stext-600 px-5 gap-2 py-2 ",children:[e.jsx(W,{className:"text-primary-ptext-1000 font-bold",label:"heading.personal.discussion"}),e.jsx(xe,{className:"underline text-xs  !text-black  ",label:"View Details",onClick:F}),e.jsxs("button",{onClick:A,className:" relative",children:[e.jsx("img",{src:Ne,alt:"ChatIcon",className:""})," ",G?e.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"}):e.jsx(e.Fragment,{})]})]})}),e.jsx("div",{className:"w-1/12",children:e.jsx(de,{buttonType:Z.STAGE_COMPLETE,onClickWithLoader:$,size:"LOAN_DATA",disabled:N})})]}),e.jsx("div",{className:"pd-layout-body-content",children:e.jsxs(X,{override:{read:N},children:[e.jsx(s.Suspense,{fallback:e.jsx(ee,{}),children:e.jsx(se,{children:te.map((t,a)=>e.jsx(ae,{path:t.path,element:e.jsx(t.component,{})},a))})}),e.jsx(oe,{})]})}),e.jsx(me,{onHide:()=>{m(!1),f("")},visible:R,errorMessage:x}),c?e.jsx(je,{visible:c,closable:!1,model:"false",onHide:()=>T(!1),className:"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162  !h-162",children:e.jsx(Se,{params:i,handleCloseOverLay:A})}):null,e.jsx(he,{className:"rounded-lg shadow-lg !w-80 p-1.5 ",ref:g,content:Y()}),e.jsx(ue,{position:C,ref:n,toastText:u,variant:p})]})},Je=K(ve);export{Je as default};
//# sourceMappingURL=PD-be106104.js.map
