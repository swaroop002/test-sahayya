import{q as Ze,r as c,aG as R,ad as se,ae as te,af as ae,dg as T,v as le,ao as j,aF as f,j as s,K as De,R as we,d7 as ne,aH as ie,T as d,fl as es,fr as ss,dz as ts,aw as as}from"./index-e8217573.js";import{C as r,E as ls}from"./EditableTableV2-6afcb42b.js";import{E as ns}from"./ErrorDialog-d5eef4d7.js";import{R as is}from"./ReadOnlyTable-86accb69.js";import{R as ds}from"./RichTextEditor-a03bd2fb.js";import{S as de}from"./SaveComponent-160c5b32.js";import{S as cs}from"./Section-00ef9f2b.js";import{S as ce}from"./SimpleDropDown-061a3470.js";import{S as rs}from"./SimpleTab-27fa8860.js";import{S as ps}from"./Skeleton-7e12d019.js";import{T as us}from"./TextButton-41b4a67e.js";import{T as xs}from"./Toast-ae99ea5b.js";import{a as ms}from"./CustomHooks-0ce50620.js";import{D as N}from"./DedupeService-b4b7e998.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./virtualscroller.esm-9939945c.js";import"./ButtonBox-9e46519a.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./No_data-1720c54e.js";import"./index-8739acfd.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./IconButton-36693dd9.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./withAuth-6de36ebf.js";import"./TransitionGroup-c8afe0ce.js";const hs={uid:"",lanId:"",stage:"",applicantUid:"",applicantFirstname:"",applicantMiddlename:"",applicantLastname:"",applicantType:"",addressType:"",propertyType:"",address:"",city:"",pincode:"",state:"",latitude:"",longitude:""},fs={loanUid:"",stageUid:"",addressSearch:{addressSearchPageMode:f.VIEW,addressInLoan:[]},finalStatus:{uid:"",isFinalStatusLoading:!1,status:"",statusEditorData:"",finalStatusPageMode:f.VIEW}},M={[`${T.COLLATERAL_PROPERTY}`]:"Collateral Property",[`${T.PERMANENT}`]:"Permanent",[`${T.RESIDENTIAL}`]:"Residential"},Ss={VALID:"Valid",INVALID:"Invalid"},Qs=()=>{const x=Ze(),[re,pe]=c.useState(!0),[m,h]=c.useState(fs),[ue,xe]=c.useState([]),[S,U]=c.useState(hs),[E,me]=c.useState(0),[k,he]=c.useState([]),[fe,bs]=c.useState("bottom-right"),[L,F]=c.useState(""),[C,v]=c.useState(R.PRIMARY),[P,V]=c.useState(!1),[I,g]=c.useState(""),[Se,_]=c.useState(!1),b=c.useRef(null),be=c.useRef(null),ye=c.useRef(null),y=c.useRef(null),$=c.useRef(null),p=ms(),[,A]=c.useState(!1),u=c.useRef(new se({validators:{...te()},...ae(),autoForceUpdate:{forceUpdate:()=>A(e=>!e)}}));c.useEffect(()=>{x!=null&&x.loanUid&&(x!=null&&x.stageUid)&&h(e=>({...e,loanUid:x.loanUid??"",stageUid:x.stageUid??""}))},[x==null?void 0:x.stageUid,x==null?void 0:x.loanUid]),c.useEffect(()=>{ke()},[]),c.useEffect(()=>{m.loanUid&&oe()},[m.loanUid]),c.useEffect(()=>{S.uid&&O()},[S.uid]),c.useEffect(()=>{I&&_(!0)},[I]),c.useEffect(()=>{var e;b!=null&&b.current&&L!==""&&((e=b==null?void 0:b.current)==null||e.showFunction())},[L,C,P]);const oe=async()=>{var t,a;const e=`loan.uid=${m.loanUid}&primaryAddressType=${T.COLLATERAL_PROPERTY}&isActive=${!0}`;try{const l=await N.getAddress(e);if(le(l)){const i=(a=(t=l==null?void 0:l.data)==null?void 0:t.results)==null?void 0:a.map(n=>{var H,q,z,X,J,Q,Z,D,w,ee;return{uid:(n==null?void 0:n.uid)??"",lanId:((H=n==null?void 0:n.loan)==null?void 0:H.lanId)??"",applicantUid:((q=n==null?void 0:n.applicant)==null?void 0:q.uid)??"",applicantFirstname:((z=n==null?void 0:n.applicant)==null?void 0:z.firstName)??"",applicantMiddlename:((X=n==null?void 0:n.applicant)==null?void 0:X.middleName)??"",applicantLastname:((J=n==null?void 0:n.applicant)==null?void 0:J.lastName)??"",applicantType:((Q=n==null?void 0:n.applicant)==null?void 0:Q.applicantType)??"",addressType:(n==null?void 0:n.primaryAddressType)??"",propertyType:(n==null?void 0:n.propertyType)??"",address:(n==null?void 0:n.address)??"",city:((Z=n==null?void 0:n.city)==null?void 0:Z.name)??"",pincode:((D=n==null?void 0:n.pincode)==null?void 0:D.pinCode)??"",state:((ee=(w=n==null?void 0:n.city)==null?void 0:w.state)==null?void 0:ee.name)??"",latitude:`${(n==null?void 0:n.latitude)??0}`,longitude:`${(n==null?void 0:n.longitude)??0}`}}),o=i.map(n=>({tabName:`${M[n.addressType]??""} - ${n.applicantFirstname}`,key:n.uid}));h(n=>({...n,addressSearch:{...n.addressSearch,addressInLoan:i}})),he(o),xe(i),U(i[E]),pe(!1)}}catch(l){console.log(l),g(j(l))}},O=async()=>{var t,a;const e=`linkedAddressUid=${S.uid}&linkedLanId=${S.lanId}&type=Status`;h(l=>({...l,finalStatus:{...l.finalStatus,isFinalStatusLoading:!0}}));try{const l=await N.getAddressDedupeStatus(e);if(le(l)){const i=(a=(t=l.data)==null?void 0:t.results)==null?void 0:a[0];h(i?o=>({...o,finalStatus:{...o.finalStatus,isFinalStatusLoading:!1,uid:(i==null?void 0:i.uid)??"",status:(i==null?void 0:i.action)??"",statusEditorData:(i==null?void 0:i.remark)??""}}):o=>({...o,finalStatus:{...o.finalStatus,uid:null,isFinalStatusLoading:!1,status:"",statusEditorData:"",finalStatusPageMode:f.VIEW}}))}}catch(l){console.log(l),h(i=>({...i,finalStatus:{...i.finalStatus,isFinalStatusLoading:!1}})),g(j(l))}},ge=e=>{var t,a;(a=u==null?void 0:u.current)==null||a.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},Ne=()=>{var t,a;let e=!1;return e=(t=u==null?void 0:u.current)==null?void 0:t.allValid(),e||(A(l=>!l),(a=u==null?void 0:u.current)==null||a.showMessages(),A(l=>!l),!1)},je=()=>{var e;u.current=new se({validators:{...te()},...ae(),autoForceUpdate:{forceUpdate:()=>A(t=>!t)}}),(e=u==null?void 0:u.current)==null||e.hideMessages()},Ae=e=>{me(e.index);const t=ue.filter(a=>a.uid===k[e.index].key);U(t[0])},Te=e=>{h(t=>({...t,finalStatus:{...t.finalStatus,status:e.target.value}}))},Ee=async e=>{var a;const t=Fe(e);try{const l=await N.searchAddressForDedupe(t);as(l)&&((a=y.current)==null||a.search())}catch(l){console.log(l),g(j(l))}},Le=async()=>{var t,a;const e=Ce();try{const l=await N.updateDedupeMultiple(e);ne(l)&&(v(R.PRIMARY),F(ie.SAVED),V(!P),h(i=>({...i,addressSearch:{...i.addressSearch,addressSearchPageMode:f.VIEW}})),(t=y.current)==null||t.search(),(a=y.current)==null||a.clearAll())}catch(l){console.log(l),g(j(l))}},Pe=()=>{h(e=>({...e,addressSearch:{...e.addressSearch,addressSearchPageMode:f.EDIT}}))},Ie=()=>{h(e=>({...e,addressSearch:{...e.addressSearch,addressSearchPageMode:f.VIEW}}))},Re=async()=>{if(!Ne())return;const e=ve();try{const t=await N.updateDedupeFinalStatus(e);ne(t)&&(v(R.PRIMARY),F(ie.SAVED),V(!P),h(a=>({...a,finalStatus:{...a.finalStatus,finalStatusPageMode:f.VIEW}})))}catch(t){console.log(t),g(j(t))}},Me=()=>{h(e=>({...e,finalStatus:{...e.finalStatus,finalStatusPageMode:f.EDIT}}))},Ue=()=>{O(),h(e=>({...e,finalStatus:{...e.finalStatus,finalStatusPageMode:f.VIEW}})),je()},ke=()=>{var e;(e=y.current)==null||e.search()},Fe=e=>({lat:e.latitude,long:e.longitude,pincode:e.pincode,stageUid:m.stageUid,addressUid:e.uid,lanId:e.lanId}),Ce=()=>{var t,a;return(a=(t=y.current)==null?void 0:t.getUpdatedRecords())==null?void 0:a.map(l=>({uid:l.uid,action:l.action}))},ve=()=>{var t,a;return{uid:m.finalStatus.uid?m.finalStatus.uid:null,isLinkage:!1,linkedLanId:S.lanId,linkedAddressUid:S.uid,action:m.finalStatus.status,remark:(a=(t=$.current)==null?void 0:t.editor)==null?void 0:a.getContent(),type:"Status"}},Ve=e=>{var t,a,l;return e!=null&&e.address?s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.applicant)==null?void 0:a.firstName)??"-"}):e!=null&&e.blackList?s.jsx(d,{className:"",label:((l=e==null?void 0:e.blackList)==null?void 0:l.firstName)??"-"}):s.jsx(d,{className:"",label:(e==null?void 0:e.applicantFirstname)??"-"})},_e=e=>{var t,a,l;return e!=null&&e.address?s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.applicant)==null?void 0:a.middleName)??"-"}):e!=null&&e.blackList?s.jsx(d,{className:"",label:((l=e==null?void 0:e.blackList)==null?void 0:l.firstName)??"-"}):s.jsx(d,{className:"",label:(e==null?void 0:e.applicantMiddlename)??"-"})},$e=e=>{var t,a,l;return e!=null&&e.address?s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.applicant)==null?void 0:a.lastName)??"-"}):e!=null&&e.blackList?s.jsx(d,{className:"",label:((l=e==null?void 0:e.blackList)==null?void 0:l.firstName)??"-"}):s.jsx(d,{className:"",label:(e==null?void 0:e.applicantLastname)??"-"})},W=e=>{var t;return e!=null&&e.linkedAddressUid?s.jsx(d,{className:"",label:M[`${(t=e==null?void 0:e.address)==null?void 0:t.primaryAddressType}`]??"-"}):s.jsx(d,{className:"",label:M[`${e==null?void 0:e.addressType}`]??"-"})},Y=e=>{var t,a;return e!=null&&e.linkedAddressUid?s.jsx(d,{className:"",label:((t=e==null?void 0:e.address)==null?void 0:t.address)??"-"}):e!=null&&e.blackList?s.jsx(d,{className:"",label:((a=e==null?void 0:e.blackList)==null?void 0:a.address)??"-"}):s.jsx(d,{className:"",label:(e==null?void 0:e.address)??"-"})},K=e=>{var t,a,l;return e!=null&&e.linkedAddressUid?s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.city)==null?void 0:a.name)??"-"}):e!=null&&e.blackList?s.jsx(d,{className:"",label:((l=e==null?void 0:e.blackList)==null?void 0:l.city)??"-"}):s.jsx(d,{className:"",label:(e==null?void 0:e.city)??"-"})},B=e=>{var t,a,l,i;return e!=null&&e.linkedAddressUid?s.jsx(d,{className:"",label:((l=(a=(t=e==null?void 0:e.address)==null?void 0:t.city)==null?void 0:a.state)==null?void 0:l.name)??"-"}):e!=null&&e.blackList?s.jsx(d,{className:"",label:((i=e==null?void 0:e.blackList)==null?void 0:i.state)??"-"}):s.jsx(d,{className:"",label:(e==null?void 0:e.state)??"-"})},G=e=>{var t,a,l;if(e!=null&&e.linkedAddressUid)return s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.pincode)==null?void 0:a.pinCode)??"-"});if(e!=null&&e.blackList){let i=(l=e==null?void 0:e.blackList)==null?void 0:l.pincode;return i=i==null?void 0:i.split(" "),i=i==null?void 0:i.join(""),s.jsx(d,{className:"",label:i??"-"})}else return s.jsx(d,{className:"",label:(e==null?void 0:e.pincode)??"-"})},Oe=e=>s.jsx(us,{className:"text-primary-sapphireBlue-600",label:"text.masterData.types.search",onClick:()=>Ee(e),disabled:m.addressSearch.addressSearchPageMode===f.VIEW}),We=()=>s.jsx("div",{className:"flex justify-center items-center w-full",children:s.jsx(d,{label:"label.dedupe.action",className:""})}),Ye=e=>s.jsx(ce,{name:"action",className:"!w-32",options:ss,optionLabel:"label",optionValue:"value",value:e.action??"",onChange:t=>{var l;const a={...e};a.action=t.target.value,(l=y.current)==null||l.reportDataChange(a)},disabled:m.addressSearch.addressSearchPageMode===f.VIEW}),Ke=e=>s.jsx(d,{className:"",label:(e==null?void 0:e.lanId)??"-"}),Be=e=>{var t,a;return s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.applicant)==null?void 0:a.applicantType)??"-"})},Ge=e=>s.jsx(d,{className:"",label:(e==null?void 0:e.matchingList)??"-"}),He=e=>{var t,a;return s.jsx(d,{className:"",label:((a=(t=e==null?void 0:e.address)==null?void 0:t.loan)==null?void 0:a.loanStatus)??"-"})},qe=e=>s.jsx(d,{className:"",label:ts(e==null?void 0:e.dateOfSearch)}),ze=e=>s.jsx(d,{className:"",label:Ss[`${e==null?void 0:e.previousStatus}`]??"-"}),Xe=()=>s.jsxs("div",{className:"flex flex-col justify-center items-start space-y-4",children:[s.jsx("div",{className:"w-full",children:s.jsx(d,{className:"text-primary-ptext-1000 text-xs",label:"label.section.addressSearch.addressDetails"})}),s.jsxs(is,{value:[m.addressSearch.addressInLoan[E]],className:"selected-existing-doc-read-table !min-h-auto",ref:ye,dataKey:"uid",children:[s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.addressType"),body:W}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.address"),body:Y}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.city"),body:K}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.state"),body:B}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.pincode"),body:G}),s.jsx(r,{className:"text-primary-ptext-1000 text-center text-xs p-1 pl-6 h-12 custom-header",header:We(),body:Oe})]}),s.jsx("div",{className:"w-full",children:s.jsx(d,{className:"text-primary-ptext-1000 text-xs",label:"label.dedupe.matchResults"})}),S.uid&&S.lanId?s.jsx("div",{className:"w-full",children:s.jsxs(ls,{ref:y,standardDataFormatPromise:N.getAddressForDedupe,search:`&linkedAddressUid=${S.uid}&linkedLanId=${S.lanId}&type=Address`,paginator:!0,uniqueKey:"uid",mode:"UPDATE",children:[s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.loanApplicationNo"),body:Ke}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.applicantType"),body:Be}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.firstName"),body:Ve}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.middleName"),body:_e}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.lastName"),body:$e}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.addressType"),body:W}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.address"),body:Y,style:{minWidth:"200px"}}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.city"),body:K}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.state"),body:B}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.pincode"),body:G}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.matchingList"),body:Ge}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.fileStatus"),body:He}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.dateOfSearch"),body:qe}),s.jsx(r,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.section.addressSearch.prevStatus"),body:ze}),s.jsx(r,{className:"text-primary-ptext-1000 text-center text-xs p-1 px-6 h-12",header:p("label.dedupe.status"),body:Ye})]})}):s.jsx(s.Fragment,{})]}),Je=()=>{var i;const{isFinalStatusLoading:e,finalStatusPageMode:t,status:a,statusEditorData:l}=m.finalStatus;return e?s.jsx(ps,{height:"19rem",width:"100%",borderRadius:"8px",animation:"wave"}):s.jsxs("div",{className:"flex flex-col justify-center items-start w-full gap-y-3 mt-3",children:[s.jsx("div",{className:"w-62.5",children:s.jsx(ce,{label:"label.section.finalStatus.status*",name:"status",value:a,onChange:Te,options:[...es],optionLabel:"label",optionValue:"value",onBlur:ge,validation:(i=u==null?void 0:u.current)==null?void 0:i.message("status",a,"mandatory"),disabled:m.finalStatus.finalStatusPageMode===f.VIEW})}),s.jsx(ds,{ref:$,initialValue:l,disabled:t===f.VIEW})]})},Qe=e=>s.jsx("div",{className:"mt-4",children:s.jsx(cs,{children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(de,{pageMode:m.addressSearch.addressSearchPageMode,title:"heading.section.addressSearch",onCancel:Ie,onEdit:Pe,onSave:Le,children:Xe()}),s.jsx(de,{pageMode:m.finalStatus.finalStatusPageMode,title:"heading.section.finalStatus",onCancel:Ue,onEdit:Me,onSave:Re,children:Je()})]})})},e==null?void 0:e.key);return re?s.jsx(De,{}):s.jsxs(we.Fragment,{children:[s.jsx(rs,{className:"simple-tab-custom",showTooltip:!0,scrollable:!0,optionLabel:["tabName"],optionKey:["key"],headerClassName:"",ref:be,activeIndex:E,tabs:k,onTabChange:Ae,renderContent:Qe}),s.jsx(xs,{position:fe,ref:b,toastText:L,variant:C}),s.jsx(ns,{onHide:()=>{_(!1),g("")},visible:Se,errorMessage:I})]})};export{Qs as default};
//# sourceMappingURL=PageAddressDedupe-61078beb.js.map
