import{aF as M,q as Ze,cj as es,r as n,aG as D,v as T,ao as A,eX as ss,j as i,K as ts,R as as,J as ns,d4 as U,d7 as $,aH as y,T as os,de as is,c8 as re,cn as rs,d8 as de,d9 as le,aw as ce}from"./index-e8217573.js";import{B as ds}from"./ButtonBox-9e46519a.js";import{S as ls}from"./SaveComponent-160c5b32.js";import{S as cs}from"./SimpleTab-27fa8860.js";import{S as fs}from"./Skeleton-7e12d019.js";import{T as gs}from"./TextData-06df331b.js";import{T as ms}from"./Toast-ae99ea5b.js";import{A as us}from"./Address-75e58af3.js";import{E as Is}from"./ErrorDialog-d5eef4d7.js";import{S as As}from"./Section-00ef9f2b.js";import{W as fe}from"./WarningDialog-77a1cb18.js";import{A as q}from"./ApplicantService-924aa5cb.js";import{S as j}from"./StaticMasterDataService-689a6eca.js";import{A as J}from"./AddressService-27926b64.js";import{B as K}from"./BasicInformation-dd84bcb0.js";import{F as Ss,C as Os,G as Ts,H as ps}from"./Helper-03e9d878.js";import{D as Es}from"./DocumentUploader-e2ec1a13.js";import{i as Ns,O as Ps}from"./OrganisationDetails-d4c0c611.js";import"./kebab-menu-8835ad2e.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./IconButton-36693dd9.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./TransitionGroup-c8afe0ce.js";import"./AutoComplete-0bca608a.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./InputBox-b9e88f52.js";import"./InputTextArea-b90aad1d.js";import"./Dialog-adadaf64.js";import"./esm-70d64670.js";import"./index-8739acfd.js";import"./SimpleDropDown-061a3470.js";import"./TextButton-41b4a67e.js";import"./City-7102c574.js";import"./Pincode-a7c9b067.js";import"./DatePicker-b1c13861.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";import"./MediaGallery-5884b284.js";import"./FileUploadService-1aaf11f7.js";import"./DocumentService-a293b5f4.js";import"./SystemDatePicker-abe08a29.js";const ge={organisationDetails:{isOrganisationDetailsLoading:!1,organisationDetailsData:{...Ns}},addressInfo:{isAddressLoading:!1,address:{},addressInfoPageMode:M.VIEW,isSameAsRegGSTAddress:!1}},Et=()=>{var ae,ne;const S=Ze().loanUid??"",Y=new es({length:5}),[V,X]=n.useState(!0),[I,me]=n.useState({corporateGuarantor:{name:"",key:""},index:null}),[ue,Ie]=n.useState(""),[c,h]=n.useState(0),[Ae,Se]=n.useState(0),[Oe,Te]=n.useState(!1),[r,w]=n.useState([{firstName:"New Tab",key:Y()}]),[Ds,z]=n.useState(!1),[pe,Ee]=n.useState(!1),[Ne,B]=n.useState({SEGMENT_OPTION:[],BUSINESS_CONSTITUTION_OPTION:[],OWNERSHIP_OPTION:[],NO_EMPLOYEE_OPTION:[]}),[g,f]=n.useState({...ge}),[Pe,Re]=n.useState({orgBasicInfoAPICall:!1}),[De,hs]=n.useState("bottom-right"),[F,C]=n.useState(""),[Q,_]=n.useState(D.PRIMARY),[R,b]=n.useState(!1),[L,m]=n.useState(""),[he,p]=n.useState(!1),[Ce,W]=n.useState(!1),[_e,Z]=n.useState(!1),be=n.useRef(null),E=n.useRef(null),u=n.useRef(null),N=n.useRef(null),P=n.useRef(null),xe=(e,s)=>[{className:"",label:"Remove Corporate Guarantor",command:()=>{me({corporateGuarantor:e,index:s}),p(!0)}}];n.useEffect(()=>{Ge()},[]),n.useEffect(()=>{var e;(e=r[c])!=null&&e.uid&&(qe(),ee())},[c,Oe]),n.useEffect(()=>{var e,s,t;(s=(e=g==null?void 0:g.organisationDetails)==null?void 0:e.organisationDetailsData)!=null&&s.uid&&((t=r[c])!=null&&t.uid)&&k()},[(ae=g==null?void 0:g.organisationDetails)==null?void 0:ae.organisationDetailsData]),n.useEffect(()=>{L&&Z(!0)},[L]),n.useEffect(()=>{var e;E!=null&&E.current&&F!==""&&((e=E==null?void 0:E.current)==null||e.showFunction())},[F,Q,R]),n.useEffect(()=>{var e;(e=r[c])!=null&&e.uid&&!V&&ee()},[V,Pe.orgBasicInfoAPICall]),n.useEffect(()=>{se({index:r.length-1})},[pe]);const ye=async()=>{var e,s,t,a,o,d,O;try{const l=await q.getApplicantInfo(0,20,U.PRIMARY,S);if(T(l)&&((e=l.data)!=null&&e.totalRecords))return Ie((a=(t=(s=l.data)==null?void 0:s.results)==null?void 0:t[0])==null?void 0:a.uid),((O=(d=(o=l.data)==null?void 0:o.results)==null?void 0:d[0])==null?void 0:O.uid)??""}catch(l){m(A(l))}},H=async(e,s)=>{var t,a,o;try{const d=await q.getApplicantInfo(0,20,U.CORPORATE_GUARANTOR,S);if(T(d)&&((t=d.data)!=null&&t.totalRecords)){const O=(o=(a=d.data)==null?void 0:a.results)==null?void 0:o.map((l,v)=>!(l!=null&&l.firstName)&&!l.lastName?{...l,firstName:`Cor-Gaur... ${v+1}`}:{...l});w(O),X(!1),e==="ORG_BASIC_INFO"&&Re(l=>({...l,orgBasicInfoAPICall:!l.orgBasicInfoAPICall})),s&&s(O)}else G(),X(!1)}catch(d){m(A(d))}},ee=async e=>{const s=r[c];e||f(t=>({...t,organisationDetails:{...t.organisationDetails,isOrganisationDetailsLoading:!0}}));try{const t=await K.getCorporateBasicInfo(s==null?void 0:s.uid);T(t)?f(a=>({...a,organisationDetails:{...a.organisationDetails,organisationDetailsData:Ss(t==null?void 0:t.data),isOrganisationDetailsLoading:!1}})):f(a=>({...a,organisationDetails:{...a.organisationDetails,isOrganisationDetailsLoading:!1}}))}catch(t){m(A(t))}},k=async e=>{const s=r[c];if(e||f(t=>({...t,addressInfo:{...t.addressInfo,isAddressLoading:!0}})),S&&(s!=null&&s.uid))try{const t=await J.getOrgRegisteredAddress(S,s==null?void 0:s.uid);T(t)?f(a=>{var o;return{...a,addressInfo:{...a.addressInfo,isAddressLoading:!1,address:Os(t.data),isSameAsRegGSTAddress:((o=t==null?void 0:t.data)==null?void 0:o.isSameAsRegisteredGstAddress)??!1}}}):f(a=>({...a,addressInfo:{...a.addressInfo,isAddressLoading:!1}}))}catch(t){m(A(t))}},Me=async()=>{await j.getAll(0,200,"staticMasterType.code=CORPORATE_SEGMENT").then(t=>{T(t)?B(a=>({...a,SEGMENT_OPTION:[...t.data.results??[]]})):console.log("error")})},we=async()=>{await j.getAll(0,10,"staticMasterType.code=BUSINESS_CONSTITUTION").then(e=>{T(e)?B(s=>({...s,BUSINESS_CONSTITUTION_OPTION:[...e.data.results??[]]})):console.log("error")})},Be=async()=>{await j.getAll(0,10,"staticMasterType.code=OWNERSHIP_OF_BUSINESS_PREMISES").then(e=>{T(e)?B(s=>({...s,OWNERSHIP_OPTION:[...e.data.results??[]]})):console.log("error")})},ve=async()=>{await j.getAll(0,10,"staticMasterType.code=NO_OF_EMPLOYEES").then(e=>{T(e)?B(s=>({...s,NO_EMPLOYEE_OPTION:[...e.data.results??[]]})):console.log("error")})},se=e=>{var t,a;let s=(t=u==null?void 0:u.current)==null?void 0:t.getData();s&&(s={...s,isActive:void 0,uid:void 0,loanDocuments:[],loanDocumentsProof:{}}),e.index!==c&&!((a=r==null?void 0:r[c])!=null&&a.uid)&&ss(s)?(W(!0),Se(e.index)):e.index!==c&&(x(),h(e.index))},Ue=()=>{x(),h(Ae),W(!1)},je=async()=>{var s,t;const e=(s=u==null?void 0:u.current)==null?void 0:s.save();if(e){const a=Ts(e,S,ue,U.CORPORATE_GUARANTOR);if(e.uid)try{const o=await K.updateCorporateBasicInfo(a);$(o)&&(C(y.SAVED),_(D.PRIMARY),b(!R),(t=u==null?void 0:u.current)==null||t.onSaveSuccess(),H("ORG_BASIC_INFO",d=>{d.length-1<c&&h((d==null?void 0:d.length)-1)}))}catch(o){m(A(o))}else try{const o=await K.createCorporateBasicInfo(a);ce(o)&&(C(y.SAVED),_(D.PRIMARY),b(!R),H("ORG_BASIC_INFO",d=>{d.length-1<c&&h((d==null?void 0:d.length)-1)}))}catch(o){console.log(o),m(A(o))}}},Ye=()=>{f(e=>({...e,addressInfo:{...e.addressInfo,addressInfoPageMode:M.CREATE}}))},Ve=()=>{var e,s;(e=N==null?void 0:N.current)==null||e.resetValidator(),(s=P==null?void 0:P.current)==null||s.resetValidator(),f(t=>({...t,addressInfo:{...t.addressInfo,addressInfoPageMode:M.VIEW}}))},Fe=async e=>{var a,o,d,O,l,v,oe;const s=(a=N==null?void 0:N.current)==null?void 0:a.save(),t=(o=P==null?void 0:P.current)==null?void 0:o.getUploadedData();if(!s||!t)return Promise.resolve(!0);if(s&&t){const ie=ps({...s,uid:(O=(d=g.addressInfo)==null?void 0:d.address)==null?void 0:O.uid,isSameAsRegGSTAddress:(l=g.addressInfo)==null?void 0:l.isSameAsRegGSTAddress,addressDocumentsInfo:t??{}},S,e,U.CORPORATE_GUARANTOR);return(oe=(v=g.addressInfo)==null?void 0:v.address)!=null&&oe.uid?Le(ie):We(ie)}},Le=async e=>J.updateOrgRegisteredAddress(e).then(s=>{$(s)&&(k(),_(D.PRIMARY),C(y.SAVED),b(!R),z(!0),f(t=>({...t,addressInfo:{...t.addressInfo,addressInfoPageMode:M.VIEW}})))}).catch(s=>{m(A(s))}),We=async e=>J.createOrgRegisteredAddress(e).then(s=>{ce(s)&&(k(),_(D.PRIMARY),C(y.SAVED),b(!R),z(!0),f(t=>({...t,addressInfo:{...t.addressInfo,addressInfoPageMode:M.VIEW}})))}).catch(s=>{m(A(s))}),He=()=>{w(e=>[...e,{firstName:"New Tab",key:Y()}]),Ee(e=>!e)},ke=async(e,s)=>{if(e!=null&&e.uid)try{const t=await q.deleteApplicantInfo(e==null?void 0:e.uid);if($(t)){if(C(y.SAVED),_(D.PRIMARY),b(!R),r.length===1){G(),p(!1),x();return}te(s),p(!1)}}catch(t){m(A(t)),p(!1)}else{if(r.length===1){G(),p(!1),x();return}te(s),p(!1)}},Ge=()=>{ye(),H(),$e()},te=e=>{const s=[...r];e>=0&&e<r.length&&(s.splice(e,1),w(s),e+1===r.length-1&&c===e+1||(e===r.length-1&&c===e||e!==r.length-1&&c===r.length-1||e<c?setTimeout(()=>{h(c-1)},5):e===c&&(x(),Te(t=>!t))))},G=()=>{w([{firstName:"New Tab",key:Y()}])},$e=()=>{Me(),we(),Be(),ve()},x=()=>{f({...ge})},qe=()=>{f(e=>({...e,addressInfo:{...e.addressInfo,isAddressLoading:!0}}))},Je=e=>({ocrStageName:de.LOGIN,ocrSubstageName:le.DDE,ocrPayloadData:{loanUid:S,applicant:{uid:e}}}),Ke=e=>{const{isOrganisationDetailsLoading:s,organisationDetailsData:t}=g.organisationDetails;return i.jsx(Ps,{data:t,dropDownOptions:Ne,ref:u,isLoading:s,pageType:is.CORPORATE_GUARANTOR,documentCategory:re.DOCUMENT_CATEGORY_BUSINESS_PROOF,ocrRelatedData:Je(e==null?void 0:e.uid),onSaveOrganisationDetails:je})},Xe=e=>{var o;const{isAddressLoading:s,addressInfoPageMode:t,address:a}=g.addressInfo;return s?i.jsx(fs,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):i.jsx(ls,{disabled:!(e!=null&&e.uid),title:"subHeading.dde.red.address.organisation",pageMode:t,onEdit:Ye,onSave:()=>Fe(e==null?void 0:e.uid),onCancel:Ve,children:i.jsxs(us,{ref:N,variant:rs.SECONDARY,pageMode:t,data:a,children:[i.jsx(gs,{label:"label.text.address.proof",value:"Attach Documents (PDF, JPG, JPEG or PNG)",titleClass:"text-primary-sideBarBgColor text-sm font-bold mb-1"}),i.jsx(Es,{ref:P,mode:t,savedDocument:(o=a.loanDocuments)!=null&&o[0]?a.loanDocuments[0]:{},queryParamForDocList:re.DOCUMENT_CATEGORY_ADDRESS_PROOF,ocrStageName:de.LOGIN,ocrSubstageName:le.DDE,ocrPayloadData:{loanUid:S,applicant:{uid:e==null?void 0:e.uid}}})]})})},ze=(e,s)=>i.jsx("div",{className:"flex flex-col gap-4",children:i.jsx(As,{title:"heading.dde.organisation.details",children:i.jsxs(i.Fragment,{children:[Ke(e),Xe(e)]})})},e==null?void 0:e.key),Qe=()=>i.jsx(os,{className:"",label:`( ${r.length>1?`${r.length} Members`:`${r.length} Member`} )`});return V?i.jsx(ts,{}):i.jsxs(as.Fragment,{children:[i.jsxs("div",{className:"scrollable-tab dynamic-tab relative deleteable-header",children:[i.jsx(cs,{showTooltip:!0,enableTabMenu:!0,scrollable:!0,tabHeaderMenuModel:(e,s)=>xe(e,s),optionLabel:["firstName","middleName","lastName"],optionKey:["uid","key"],headerClassName:"dynamic-header",ref:be,activeIndex:c,tabs:r,onTabChange:se,renderContent:ze}),i.jsxs("div",{className:"absolute top-0 right-0 text-[#A3A3A3] text-xs flex justify-evenly items-center w-[15%] space-x-4 pb-2.5 border-b",children:[Qe(),i.jsx("div",{className:"",children:i.jsx(ds,{buttonType:ns.ICON_BUTTON_ADD,onClick:He})})]})]}),i.jsx(ms,{position:De,ref:E,toastText:F,variant:Q}),i.jsx(Is,{onHide:()=>{Z(!1),m("")},visible:_e,errorMessage:L}),i.jsx(fe,{visible:he,className:"w-76 !px-14",title:"Remove Corporate Guarantor ?",warningMessage:`Corporate Guarantor ${(ne=I==null?void 0:I.corporateGuarantor)==null?void 0:ne.firstName} will be removed`,onCancel:()=>p(!1),onConfirm:()=>{ke(I==null?void 0:I.corporateGuarantor,I==null?void 0:I.index)},onHide:()=>{}}),i.jsx(fe,{visible:Ce,className:"w-76 !px-14",title:"Discard added data ?",warningMessage:"Your data will be lost if not saved before navigating to a different tab",onCancel:()=>W(!1),onConfirm:Ue,onHide:()=>{}})]})};export{Et as default};
//# sourceMappingURL=PageCorporateGuarantors-752394d1.js.map
