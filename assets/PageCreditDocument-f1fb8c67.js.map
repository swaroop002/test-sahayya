{"version":3,"file":"PageCreditDocument-f1fb8c67.js","sources":["../../src/views/transaction/PageCAM/PageCreditDocument/PageCreditDocument.tsx"],"sourcesContent":["import DocumentUploader, {\n  DOC_UPLOADER_MODE,\n  IDocumentUploaderRef,\n  dummySavedDocStructure,\n  IDocumentInfo,\n} from \"components/DocumentUploader/DocumentUploader\";\nimport ErrorDialog from \"components/ErrorDialog/ErrorDialog\";\nimport SaveComponent from \"components/Save/SaveComponent\";\nimport Section from \"components/Section/Section\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport DocumentCategoryService from \"services/DocumentCategoryService\";\nimport DocumentService from \"services/DocumentService\";\nimport { parseStandardAPIErrorMessage } from \"utils/CommonUtil\";\nimport {\n  DOCUMENT_CATEGORY,\n  LOAN_SECTION_KEY,\n  PAGE_MODE,\n  STATIC_MASTER_TYPE_TOAST_TEXT,\n  TOAST_STYLE_TYPE,\n} from \"utils/Constant\";\nimport ToastCustom from \"components/Toast\";\nimport { useParams } from \"react-router-dom\";\nimport CamService from \"services/transaction/CamService\";\nimport {\n  prepareAttributes,\n  prepareDocSections,\n  structLoanDocumentsFromAPIResponse,\n} from \"views/transaction/PageDDE/Login/Helper\";\nimport SkeletonCustom from \"components/Skeleton/Skeleton\";\n\ninterface IPageObj {\n  uid: string;\n  sectionCode: string;\n  docTypeUid: string;\n  isLoading: boolean;\n  savedDocuments: any[];\n}\n\nconst initialPageObjData: IPageObj = {\n  uid: \"\",\n  sectionCode: \"\",\n  docTypeUid: \"\",\n  isLoading: false,\n  savedDocuments: [],\n};\nconst PageCreditDocument = () => {\n  const params: { loanUid?: string; stageUid?: string } = useParams();\n  const [pageMode, setPageMode] = useState(PAGE_MODE.VIEW);\n  const [pageObj, setPageObj] = useState({ ...initialPageObjData });\n  const [showDialogAPIError, setShowDialogAPIError] = useState(false);\n  const [errorMessage, setErrorMessage] = useState<any>(\"\");\n  const [toastMessage, setToastMessage] = useState(\"\");\n  const [toastMessageVariant, setToastMessageVariant] = useState(TOAST_STYLE_TYPE.PRIMARY);\n  const [triggerToast, setTriggerToast] = useState(false);\n\n  const creditDocUploaderRef = useRef<IDocumentUploaderRef | null>(null);\n  const toastMessageRef = useRef<any>(null);\n\n  /*-------------------------------------useEffect -------------------------- */\n\n  useEffect(() => {\n    // getDocumentInfo();\n    init();\n  }, []);\n\n  const init = () => {\n    getCreditDocuments();\n  };\n\n  const getCreditDocuments = async () => {\n    setPageObj((prevPageObj) => ({\n      ...prevPageObj,\n      isLoading: true,\n    }));\n    try {\n      const res = await CamService.getCreditDocuments(\n        `loanUid=${params?.loanUid}&stageUid=${params?.stageUid}`\n      );\n      setPageObj((prevPageObj) => ({\n        ...prevPageObj,\n        savedDocuments: structLoanDocumentsFromAPIResponse(res?.data?.loanDocuments),\n        isLoading: false,\n      }));\n    } catch (e) {\n      setErrorMessage(parseStandardAPIErrorMessage(e));\n      setPageObj((prevPageObj) => ({\n        ...prevPageObj,\n        isLoading: false,\n      }));\n    }\n  };\n\n  useEffect(() => {\n    if (toastMessageRef?.current && toastMessage !== \"\") {\n      // @ts-ignore: will be fixed in future\n      toastMessageRef?.current?.showFunction();\n      setToastMessage(\"\");\n    }\n  }, [toastMessage, triggerToast]);\n\n  useEffect(() => {\n    if (errorMessage) {\n      setShowDialogAPIError(true);\n    }\n  }, [errorMessage]);\n\n  /*-------------------------------------Event Handlers-------------------------- */\n\n  /*-----------------------------------onClick,onToggle-------------------------- */\n\n  const onCancelCreditDocs = () => {\n    setPageMode(PAGE_MODE.VIEW);\n  };\n\n  // const onSaveCreditDocs = () => {\n  //   if (creditDocUploaderRef.current) {\n  //     const docsRecs = creditDocUploaderRef.current?.getUploadedData();\n  //     console.log(docsRecs);\n  //   }\n  // };\n\n  const onSave = async () => {\n    const unSavedDocuments: IDocumentInfo | undefined =\n      creditDocUploaderRef.current?.getUploadedData();\n    if (!unSavedDocuments) {\n      return;\n    }\n    const payload = enrichForSave(unSavedDocuments);\n    try {\n      await CamService.updateCreditDocuments(payload);\n\n      setToastMessage(STATIC_MASTER_TYPE_TOAST_TEXT.SAVED);\n      setTriggerToast(!triggerToast);\n      setPageMode(PAGE_MODE.VIEW);\n      getCreditDocuments();\n    } catch (error) {\n      setErrorMessage(parseStandardAPIErrorMessage(error));\n    }\n  };\n\n  /*-----------------------------------Helper-------------------------- */\n  const enrichForSave = (unSavedDocument: IDocumentInfo) => {\n    return {\n      uid: pageObj.uid,\n      loan: {\n        uid: params?.loanUid,\n      },\n      stage: {\n        uid: params?.stageUid,\n      },\n      loanDocuments: unSavedDocument?.documentUid\n        ? [\n            {\n              uid: unSavedDocument?.uid,\n              docType: {\n                uid: unSavedDocument?.documentUid,\n              },\n              docNo: unSavedDocument?.[`${unSavedDocument.primaryKeyAttributeName}`] ?? null,\n              dob: unSavedDocument.dob ? unSavedDocument.dob : null,\n              loanSectionKey: LOAN_SECTION_KEY.CAM_CREDIT_DOCUMENT,\n              docCategory: unSavedDocument?.documentCategory,\n              attributes: prepareAttributes(unSavedDocument),\n              documentSections: prepareDocSections(unSavedDocument?.documentSectionUrls),\n            },\n          ]\n        : [],\n    };\n  };\n\n  return (\n    <div className=\"flex flex-col\">\n      <Section title={\"label.cam.recommendation.creditDoc\"}>\n        {pageObj?.isLoading ? (\n          <SkeletonCustom height=\"19.375rem\" width=\"100%\" borderRadius=\"8px\" animation=\"wave\" />\n        ) : (\n          <SaveComponent\n            title={\"label.cam.recommendation.docAndRec\"}\n            pageMode={pageMode}\n            onEdit={() => setPageMode(PAGE_MODE.EDIT)}\n            onCancel={onCancelCreditDocs}\n            onSave={onSave}\n          >\n            <DocumentUploader\n              ref={creditDocUploaderRef}\n              mandatoryDocUpload\n              savedDocument={pageObj.savedDocuments?.[0] ? pageObj.savedDocuments?.[0] : {}}\n              mode={pageMode === PAGE_MODE.EDIT ? DOC_UPLOADER_MODE.EDIT : DOC_UPLOADER_MODE.VIEW}\n              queryParamForDocList={DOCUMENT_CATEGORY.DOCUMENT_CATEGORY_CREDIT_DOCUMENTS}\n              docUploadTypeTitle={`PDF/JPG/Excel/ZIP`}\n            />\n          </SaveComponent>\n        )}\n      </Section>\n      <ToastCustom\n        position={\"bottom-right\"}\n        ref={toastMessageRef}\n        toastText={toastMessage}\n        variant={TOAST_STYLE_TYPE.PRIMARY}\n      />\n      <ErrorDialog\n        onHide={() => {\n          setShowDialogAPIError(false);\n          setErrorMessage(\"\");\n        }}\n        visible={showDialogAPIError}\n        errorMessage={errorMessage}\n      />\n    </div>\n  );\n};\n\nexport default PageCreditDocument;\n"],"names":["initialPageObjData","PageCreditDocument","params","useParams","pageMode","setPageMode","useState","PAGE_MODE","pageObj","setPageObj","showDialogAPIError","setShowDialogAPIError","errorMessage","setErrorMessage","toastMessage","setToastMessage","TOAST_STYLE_TYPE","triggerToast","setTriggerToast","creditDocUploaderRef","useRef","toastMessageRef","useEffect","init","getCreditDocuments","prevPageObj","res","CamService","structLoanDocumentsFromAPIResponse","_a","e","parseStandardAPIErrorMessage","onCancelCreditDocs","onSave","unSavedDocuments","payload","enrichForSave","STATIC_MASTER_TYPE_TOAST_TEXT","error","unSavedDocument","LOAN_SECTION_KEY","prepareAttributes","prepareDocSections","jsxs","jsx","Section","SkeletonCustom","SaveComponent","DocumentUploader","_b","DOC_UPLOADER_MODE","DOCUMENT_CATEGORY","ToastCustom","ErrorDialog"],"mappings":"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"}