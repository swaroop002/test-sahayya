import{aF as H,q as kt,cj as It,r as u,aG as _,v as q,ao as S,eX as pt,j as d,K as St,R as ie,J as Ie,d4 as L,d7 as $,aH as v,T as At,aw as G,de as ht,d9 as j,dc as z,dd as pe,d8 as Et}from"./index-e8217573.js";import{B as Se}from"./ButtonBox-9e46519a.js";import{E as bt}from"./ErrorDialog-d5eef4d7.js";import{L as Pt}from"./LazyLoader-70599949.js";import{S as Ct}from"./SimpleTab-27fa8860.js";import{T as Lt}from"./Toast-ae99ea5b.js";import{W as Ae}from"./WarningDialog-77a1cb18.js";import{S as xt}from"./SaveComponent-160c5b32.js";import{S as he}from"./Section-00ef9f2b.js";import{A as re}from"./ApplicantService-924aa5cb.js";import{K as Kt,a as O}from"./KYCV3-298daeeb.js";import{B as J}from"./BasicInformation-dd84bcb0.js";import{i as Rt,B as _t}from"./BasicInformation-f2687bb1.js";import{c as Ot,u as Ee,D as Vt,v as Mt,o as be,q as wt,r as Bt,t as vt}from"./Helper-03e9d878.js";import{b as jt}from"./MediaGallery-5884b284.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./TransitionGroup-c8afe0ce.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./IconButton-36693dd9.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./DatePicker-b1c13861.js";import"./withAuth-6de36ebf.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";import"./SimpleDropDown-061a3470.js";import"./virtualscroller.esm-9939945c.js";import"./FileUploadService-1aaf11f7.js";import"./InputBox-b9e88f52.js";import"./Skeleton-7e12d019.js";import"./TextButton-41b4a67e.js";import"./DocumentUploader-e2ec1a13.js";import"./AutoComplete-0bca608a.js";import"./search_icon-459d6871.js";import"./DocumentService-a293b5f4.js";import"./StaticMasterDataService-689a6eca.js";import"./InputAddon-04f948e7.js";import"./ProfilePictureUpload-60f86be0.js";import"./TextData-06df331b.js";import"./SystemDatePicker-abe08a29.js";import"./index-8739acfd.js";const Pe={basicInformation:{isBasicInfoLoading:!1,basicInfo:{...Rt},basicInfoPageMode:H.VIEW},kycDocuments:{isKycLoading:!1,kycDocList:[Ot],uniqueKycCardTracker:[],populateOcr:{uid:"",success:!1,failed:!1},aadharVerificationStatus:{verified:!1,failedToVerify:!1},savedDocuments:[]}},wa=()=>{var Te;const h=kt().loanUid??"",X=new It({length:5}),[Q,ne]=u.useState(!0),[b,Ce]=u.useState({dependant:{name:"",key:""},index:null}),[Le,xe]=u.useState(""),[N,U]=u.useState(0),[Ke,Re]=u.useState(0),[_e,Oe]=u.useState(!1),[f,Y]=u.useState([{firstName:"New Tab",key:X()}]),[Yt,ue]=u.useState(!1),[Ve,Me]=u.useState(!1),[C,y]=u.useState({...Pe}),[we,Be]=u.useState({basicInfoAPICall:!1}),[ve,je]=u.useState(1),[Ue,Ft]=u.useState("bottom-right"),[Z,V]=u.useState(""),[le,M]=u.useState(_.PRIMARY),[x,w]=u.useState(!1),[ee,p]=u.useState(""),[Ye,B]=u.useState(!1),[Fe,te]=u.useState(!1),[We,de]=u.useState(!1),qe=u.useRef(null),K=u.useRef(null),I=u.useRef(null),Ge=(e,t)=>[{className:"",label:"Remove Dependant",command:()=>{Ce({dependant:e,index:t}),B(!0)}}];u.useEffect(()=>{nt()},[]),u.useEffect(()=>{var e;(e=f[N])!=null&&e.uid&&(ft(),me())},[N,_e]),u.useEffect(()=>{ee&&de(!0)},[ee]),u.useEffect(()=>{var e;K!=null&&K.current&&Z!==""&&((e=K==null?void 0:K.current)==null||e.showFunction())},[Z,le,x]),u.useEffect(()=>{var e;(e=f[N])!=null&&e.uid&&!Q&&me()},[Q,we.basicInfoAPICall]),u.useEffect(()=>{fe({index:f.length-1})},[Ve]);const He=async()=>{var e,t,o,s,i,l,c;try{const a=await re.getApplicantInfo(0,20,L.PRIMARY,h);if(q(a)&&((e=a.data)!=null&&e.totalRecords))return xe((s=(o=(t=a.data)==null?void 0:t.results)==null?void 0:o[0])==null?void 0:s.uid),((c=(l=(i=a.data)==null?void 0:i.results)==null?void 0:l[0])==null?void 0:c.uid)??""}catch(a){p(S(a))}},$e=async()=>{try{const e=await J.generateDependantId(h);if(G(e)){const t=[...f];t[N]={...e==null?void 0:e.data,firstName:`Dep... ${N+1}`},Y([...t]),y(o=>({...o,basicInformation:{...o.basicInformation,basicInfo:Ee(e==null?void 0:e.data)}}))}}catch(e){p(S(e))}},ae=async(e,t)=>{var o,s,i;try{const l=await re.getApplicantInfo(0,20,L.DEPENDANT,h);if(q(l)&&((o=l.data)!=null&&o.totalRecords)){const c=(i=(s=l.data)==null?void 0:s.results)==null?void 0:i.map((a,r)=>!(a!=null&&a.firstName)&&!a.lastName?{...a,firstName:`Dep... ${r+1}`}:{...a});Y(c),ne(!1),t&&t(c),e==="BASIC_INFO"&&Be(a=>({...a,basicInfoAPICall:!a.basicInfoAPICall}))}else se(),ne(!1)}catch(l){p(S(l))}},me=async e=>{const t=f[N];e||y(o=>({...o,basicInformation:{...o.basicInformation,isBasicInfoLoading:!0}}));try{const o=await J.getDde(t==null?void 0:t.uid);q(o)?y(s=>({...s,basicInformation:{...s.basicInformation,basicInfo:Ee(o==null?void 0:o.data),isBasicInfoLoading:!1,basicInfoPageMode:H.VIEW}})):y(s=>({...s,basicInformation:{...s.basicInformation,isBasicInfoLoading:!1,basicInfoPageMode:H.VIEW}}))}catch(o){p(S(o))}},ze=async(e,t)=>{var o,s,i,l,c,a,r,D,T,m,n,g,A,P;t||y(R=>({...R,kycDocuments:{...R.kycDocuments,isKycLoading:!0}}));try{const R=await O.getKycDocument(h,e);if(q(R)){const{data:E}=R,ce=[],ke=[],Tt=k=>k.map(W=>({sectionUid:W.uid??"",fileName:W.fileName??"",fileType:W.fileType??"",sectionType:W.smDocSectionType??"",url:W.url}));for(const k in E)ce.push({listId:k,uid:k,docName:((i=(s=(o=E[k])==null?void 0:o[0].kyc)==null?void 0:s.docType)==null?void 0:i.code)??"",docNo:((c=(l=E[k])==null?void 0:l[0].kyc)==null?void 0:c.docNo)??"",maskedDocNo:((r=(a=E[k])==null?void 0:a[0].kyc)==null?void 0:r.maskedDocNo)??"",dob:((T=(D=E[k])==null?void 0:D[0].kyc)==null?void 0:T.dob)??"",docSections:Tt(E[k]),isVerified:((n=(m=E[k])==null?void 0:m[0].kyc)==null?void 0:n.isVerified)??!1}),ke.push(((P=(A=(g=E[k])==null?void 0:g[0].kyc)==null?void 0:A.docType)==null?void 0:P.code)??"");ce.length?y(k=>({...k,kycDocuments:{...k.kycDocuments,kycDocList:[...ce],uniqueKycCardTracker:[...ke],isKycLoading:!1}})):y(k=>({...k,kycDocuments:{...k.kycDocuments,isKycLoading:!1}}))}}catch(R){y(E=>({...E,kycDocuments:{...E.kycDocuments,isKycLoading:!1}})),p(S(R))}},fe=e=>{var s,i,l;let t=(s=I==null?void 0:I.current)==null?void 0:s.getData();t=Vt(t);const o=!!((i=f==null?void 0:f[N])!=null&&i.lastName);e.index!==N&&!o&&pt(t)?(te(!0),Re(e.index)):e.index!==N&&(F(),U(e.index),(l=I==null?void 0:I.current)==null||l.resetValidator())},Je=()=>{var e;F(),U(Ke),te(!1),(e=I==null?void 0:I.current)==null||e.resetValidator()},Xe=()=>{y(e=>({...e,kycDocuments:{...e.kycDocuments,aadharVerificationStatus:{verified:!1,failedToVerify:!1}}}))},Qe=async(e,t,o)=>{const{kycDocuments:{kycDocList:s}}=C;if(e.uid){const i=await De(e==null?void 0:e.uid,t),l=be(h,t,e,i,L.DEPENDANT);try{const c=await O.updateKycDocument(l,j.DDE);if($(c)){const{data:a}=c,r=a.meta?JSON.parse(a.meta):null,D=n=>{var g,A;return n===z.DOCUMENT_SECTIONS_FRONT_PAGE?((g=r==null?void 0:r.ocrResponse)==null?void 0:g.frontMaskedImageUrl)??"":n===z.DOCUMENT_SECTIONS_BACK_PAGE?((A=r==null?void 0:r.ocrResponse)==null?void 0:A.backMaskedImageUrl)??"":""},T=n=>{var g;return((g=a.docType)==null?void 0:g.code)===pe.AADHAR_CARD?n.map(P=>({sectionUid:P.uid??"",fileName:P.fileName??"",fileType:P.fileType??"",sectionType:P.smDocSectionType??"",url:r?D(P.smDocSectionType):P.url})):n},m=s.map(n=>{var g;return n.uid===a.uid?{...n,docName:((g=a.docType)==null?void 0:g.code)??"",docNo:a.docNo,maskedDocNo:a.maskedDocNo??"",docSections:T(a.kycDocuments),dob:a.dob??""}:n});y(n=>({...n,kycDocuments:{...n.kycDocuments,kycDocList:[...m]}})),M(_.PRIMARY),V(v.SAVED),w(!x)}}catch(c){p(S(c))}}else{const i=wt(h,t,e,L.DEPENDANT);try{const l=await O.saveKycDocument(i,j.DDE);if(G(l)){const{data:c}=l,a=c.meta?JSON.parse(c.meta):null,r=m=>{var n,g;return m===z.DOCUMENT_SECTIONS_FRONT_PAGE?((n=a==null?void 0:a.ocrResponse)==null?void 0:n.frontMaskedImageUrl)??"":m===z.DOCUMENT_SECTIONS_BACK_PAGE?((g=a==null?void 0:a.ocrResponse)==null?void 0:g.backMaskedImageUrl)??"":""},D=m=>{var n;return((n=c.docType)==null?void 0:n.code)===pe.AADHAR_CARD?m.map(A=>({sectionUid:A.uid??"",fileName:A.fileName??"",fileType:A.fileType??"",sectionType:A.smDocSectionType??"",url:a?r(A.smDocSectionType):A.url})):m},T=s.map((m,n)=>{var g;return n===o?{...m,uid:c.uid??"",docName:((g=c.docType)==null?void 0:g.code)??"",docNo:c.docNo??"",maskedDocNo:c.maskedDocNo??"",docSections:D(c.kycDocuments),dob:c.dob??""}:m});y(m=>{var n;return{...m,kycDocuments:{...m.kycDocuments,kycDocList:[...T],savedDocuments:[...m.kycDocuments.savedDocuments,(n=c.docType)==null?void 0:n.code],uniqueKycCardTracker:oe()}}}),M(_.PRIMARY),V(v.SAVED),w(!x)}}catch(l){p(S(l))}}},Ze=async(e,t,o)=>{if(e.uid){const s=be(h,t,e,await De(e==null?void 0:e.uid,t),L.DEPENDANT);try{const i=await O.updateKycDocument(s,j.DDE);$(i)&&(o!==void 0&&ye(o),M(_.QUATERNARY),V(v.REMOVED),w(!x))}catch(i){p(S(i))}}},et=async(e,t,o)=>{const{kycDocuments:{kycDocList:s,populateOcr:i}}=C,l=Bt(h,t,i.uid,e,L.DEPENDANT);try{const c=await O.populateKycDocument(l,j.DDE);if(G(c)){const{data:a}=c,r=s.map((D,T)=>{var m;return T===o?{...D,uid:a.uid,docName:((m=a.docType)==null?void 0:m.code)??"",docNo:a.docNo??"",dob:a.dob??""}:D});y(D=>({...D,kycDocuments:{...D.kycDocuments,kycDocList:[...r],uniqueKycCardTracker:oe(),populateOcr:{...D.kycDocuments.populateOcr,uid:a.uid??"",success:!0,failed:!1}}}))}}catch(c){y(a=>({...a,kycDocuments:{...a.kycDocuments,populateOcr:{...a.kycDocuments.populateOcr,success:!1,failed:!0}}})),p(S(c))}},tt=async(e,t,o,s,i)=>{const l=vt(h,o,e,t,L.DEPENDANT,i),{kycDocuments:{kycDocList:c}}=C;try{const a=await O.validateAadhar(l,j.DDE);if(G(a)){const{data:r}=a,D=c.map((T,m)=>{var n;return m===s?{...T,uid:r.uid,docName:(n=r.docType)==null?void 0:n.code,docNo:r.docNo??"",maskedDocNo:r.maskedDocNo??"",dob:r.dob??""}:T});y(T=>({...T,kycDocuments:{...T.kycDocuments,kycDocList:[...D],uniqueKycCardTracker:oe(),aadharVerificationStatus:{...T.kycDocuments.aadharVerificationStatus,verified:!0}}}))}}catch(a){y(r=>({...r,kycDocuments:{...r.kycDocuments,aadharVerificationStatus:{...r.kycDocuments.aadharVerificationStatus,failedToVerify:!0}}})),p(S(a))}},at=()=>{Y(e=>[...e,{firstName:"New Tab",key:X()}]),Me(e=>!e)},ot=async(e,t)=>{if(e!=null&&e.uid)try{const o=await re.deleteApplicantInfo(e==null?void 0:e.uid);if($(o)){if(V(v.SAVED),M(_.PRIMARY),w(!x),f.length===1){se(),F(),B(!1);return}Ne(t),B(!1)}}catch(o){p(S(o))}else{if(f.length===1){se(),B(!1),F();return}Ne(t),B(!1)}},st=()=>{var t;const e=(t=I==null?void 0:I.current)==null?void 0:t.save();if(!e)return Promise.resolve(!0);if(e){const o=Mt(e,h,Le,L.DEPENDANT);e.uid?J.updateDde(o).then(s=>{$(s)&&(M(_.PRIMARY),V(v.SAVED),w(!x),ue(!0),ae("BASIC_INFO",i=>{i.length-1<N&&U((i==null?void 0:i.length)-1)}))}).catch(s=>{p(S(s))}):J.createBasicInformation(o).then(s=>{G(s)&&(M(_.PRIMARY),V(v.SAVED),w(!x),ue(!0),ae("BASIC_INFO",i=>{i.length-1<N&&U((i==null?void 0:i.length)-1)}))}).catch(s=>{p(S(s))})}},ct=()=>{var e;(e=f==null?void 0:f[N])!=null&&e.uid||$e(),y(t=>({...t,basicInformation:{...t.basicInformation,basicInfoPageMode:H.CREATE}}))},it=()=>{var e;(e=I==null?void 0:I.current)==null||e.cancel(),y(t=>({...t,basicInformation:{...t.basicInformation,basicInfoPageMode:H.VIEW}}))},rt=e=>{e!=null&&e.uid&&ze(e==null?void 0:e.uid)},nt=()=>{He(),ae()},ut=async e=>{try{const t=await O.getKycDocument(h,e);if(q(t)){const{data:o}=t;return o}}catch(t){p(S(t))}},De=async(e,t)=>(await ut(t))[e],oe=()=>{const{kycDocuments:{uniqueKycCardTracker:e}}=C,t=[...e];return t.splice(t.length-1,1),[...t]},lt=()=>{const e={listId:`kyc-card-${ve+1}`,uid:"",docName:"",docNo:"",maskedDocNo:"",dob:"",docSections:[],isVerified:!1};je(t=>t+1),y(t=>({...t,kycDocuments:{...t.kycDocuments,kycDocList:[...t.kycDocuments.kycDocList,e],populateOcr:{uid:"",success:!1,failed:!1}}}))},dt=e=>{y(t=>({...t,kycDocuments:{...t.kycDocuments,uniqueKycCardTracker:[...e]}}))},ye=e=>{const{kycDocuments:{kycDocList:t}}=C,o=t.filter((s,i)=>i!==e);y(s=>({...s,kycDocuments:{...s.kycDocuments,kycDocList:[...o]}}))},Ne=e=>{const t=[...f];e>=0&&e<f.length&&(t.splice(e,1),Y(t),mt(e))},mt=e=>{e+1===f.length-1&&N===e+1||(e===f.length-1&&N===e||e!==f.length-1&&N===f.length-1||e<N?setTimeout(()=>{U(N-1)},5):e===N&&(F(),Oe(t=>!t)))},se=()=>{Y([{firstName:"New Tab",key:X()}])},F=()=>{y({...Pe})},ft=()=>{y(e=>({...e,basicInformation:{...e.basicInformation,isBasicInfoLoading:!0},kycDocuments:{...e.kycDocuments,isKycLoading:!0}}))},Dt=e=>({ocrStageName:Et.LOGIN,ocrSubstageName:j.DDE,ocrPayloadData:{loanUid:h,applicant:{uid:e}}}),yt=e=>{const{basicInfoPageMode:t,basicInfo:o,isBasicInfoLoading:s}=C.basicInformation;return d.jsx(_t,{relationship:!0,type:"DDE",pageType:ht.DEPENDANT,pageMode:t,ref:I,data:o,isLoading:s,ocrRelatedData:Dt(e)})},ge=e=>{const{isKycLoading:t,kycDocList:o,uniqueKycCardTracker:s,populateOcr:i,aadharVerificationStatus:l}=C.kycDocuments;return d.jsx("div",{className:"grid grid-cols-2 gap-5",children:o.map((c,a)=>d.jsx("div",{children:d.jsx(Kt,{mode:e!=null&&e.uid?"EDIT":"READ",isLoading:t,uid:c.uid,documentListIndex:a,docName:c.docName,docNo:c.docNo,dateOfBirth:c.dob,docSections:c.docSections,maskedDocNo:c.maskedDocNo,isVerified:c.isVerified,removeDocumentInList:ye,cardNameList:s,handlerCardNameList:dt,ocrStatus:i,onSave:(r,D)=>Qe(r,e==null?void 0:e.uid,D),onRemove:(r,D)=>{Ze(r,e==null?void 0:e.uid,D)},onPopulate:(r,D)=>et(r,e==null?void 0:e.uid,D),onVerifyAadhar:(r,D,T,m)=>tt(r,D,e==null?void 0:e.uid,T,m),aadharVerificationStatus:l,handlerAadharVerificationStatus:Xe,placeOfUpload:jt.LOGIN_DEPENDANTS})},`document-${c.listId}`))})},Nt=(e,t)=>d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx(he,{title:"heading.basicInformation",children:d.jsx(xt,{pageMode:C.basicInformation.basicInfoPageMode,onEdit:ct,onSave:st,onCancel:it,children:yt(e==null?void 0:e.uid)})}),d.jsx(he,{title:"KYC Documents",children:e!=null&&e.uid?d.jsx(Pt,{onLazyLoad:()=>rt(e),children:d.jsxs(ie.Fragment,{children:[ge(e),d.jsx("div",{className:"p-5 w-full rounded-xl bg-slate-100 mt-5",children:d.jsx(Se,{buttonType:Ie.ICON_TEXT_ROW,customLabel:"Add Another Document",onClick:lt})})]})}):d.jsx(ie.Fragment,{children:ge(e)})})]},e==null?void 0:e.key),gt=()=>d.jsx(At,{className:" ",label:`( ${f.length>1?`${f.length} Dependants`:`${f.length} Dependant`} )`});return Q?d.jsx(St,{}):d.jsxs(ie.Fragment,{children:[d.jsxs("div",{className:"scrollable-tab dynamic-tab relative deleteable-header",children:[d.jsx(Ct,{showTooltip:!0,scrollable:!0,enableTabMenu:!0,tabHeaderMenuModel:(e,t)=>Ge(e,t),optionLabel:["firstName","middleName","lastName"],optionKey:["uid","key"],headerClassName:"dynamic-header",ref:qe,activeIndex:N,tabs:f,onTabChange:fe,renderContent:Nt}),d.jsxs("div",{className:"absolute top-0 right-0 text-[#A3A3A3] text-xs flex justify-evenly items-center w-[15%] space-x-4 pb-2.5 border-b",children:[gt(),d.jsx("div",{className:"",children:d.jsx(Se,{buttonType:Ie.ICON_BUTTON_ADD,onClick:at})})]})]}),d.jsx(Lt,{position:Ue,ref:K,toastText:Z,variant:le}),d.jsx(bt,{onHide:()=>{de(!1),p("")},visible:We,errorMessage:ee}),d.jsx(Ae,{visible:Ye,className:"w-76 !px-14",title:"Remove dependant ?",warningMessage:`Dependant ${(Te=b==null?void 0:b.dependant)==null?void 0:Te.firstName} will be removed`,onCancel:()=>B(!1),onConfirm:()=>{ot(b==null?void 0:b.dependant,b==null?void 0:b.index)},onHide:()=>{}}),d.jsx(Ae,{visible:Fe,className:"w-76 !px-14",title:"Discard added data ?",warningMessage:"Your data will be lost if not saved before navigating to a different tab",onCancel:()=>te(!1),onConfirm:Je,onHide:()=>{}})]})};export{wa as default};
//# sourceMappingURL=PageDependents-a031a6e7.js.map
