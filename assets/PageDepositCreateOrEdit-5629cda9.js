import{w as Be,q as Me,r,aF as C,aG as M,ad as Ue,ae as ke,af as Le,d5 as Fe,ao as S,j as s,T as u,J,ax as Oe,aH as Q,dV as U,dW as Ye,dX as We,d3 as $e,o as T,b3 as z,c8 as qe,dQ as Ke,dR as Ge,aa as De,dY as He,f as Z}from"./index-e8217573.js";import{A as w}from"./AutoComplete-0bca608a.js";import{B as ee}from"./ButtonBox-9e46519a.js";import{D as Ve,a as te}from"./DocumentUploader-e2ec1a13.js";import{E as Xe}from"./ErrorDialog-d5eef4d7.js";import{I as Je,B as Qe}from"./IconButton-36693dd9.js";import{I as se}from"./InputBox-b9e88f52.js";import{R as ze}from"./ReadOnlyTable-86accb69.js";import{S as Ze}from"./Skeleton-7e12d019.js";import{S as we}from"./SystemDatePicker-abe08a29.js";import{T as ne}from"./TextData-06df331b.js";import{T as et}from"./Toast-ae99ea5b.js";import{W as tt}from"./WarningDialog-77a1cb18.js";import{u as p}from"./CustomHooks-0ce50620.js";import{C as h}from"./column.esm-938bad7d.js";import{D as st}from"./DepositAccountService-fb3e0018.js";import{F as g}from"./FeeService-43f7dd78.js";import{g as ae}from"./Helper-54d1e873.js";import{s as nt,p as at,a as ot}from"./Helper-03e9d878.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./kebab-menu-8835ad2e.js";import"./loader-5f2cfb31.js";import"./DatePicker-b1c13861.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";import"./MediaGallery-5884b284.js";import"./Download_Icon-51fc7f46.js";import"./Dialog-adadaf64.js";import"./index-8739acfd.js";import"./FileUploadService-1aaf11f7.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./SimpleDropDown-061a3470.js";import"./DocumentService-a293b5f4.js";import"./StaticMasterDataService-689a6eca.js";import"./sortIcon-54357a29.js";import"./eye_icon-081bddb3.js";import"./No_data-1720c54e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./TransitionGroup-c8afe0ce.js";const lt={sahayyaBankAccount:{uid:"",name:"",branch:"",accountNumber:""},loan:{uid:"",name:""},tableData:[],dateOfDeposits:"",dropdownOptions:{instrumentType:[]},deleteReceipt:{showPopUp:!1,uid:""},depositAmount:"",depositAmountInWords:"",savedDocuments:[],pageMode:C.EDIT,isLoading:!0},ct=y=>{var K;const c=Me(),[n,x]=r.useState({...lt,pageMode:c!=null&&c.depositUid?C.VIEW:C.EDIT}),[oe,k]=r.useState(!1),[v,A]=r.useState(""),[j,P]=r.useState(""),[L,F]=r.useState(M.PRIMARY),[_,O]=r.useState(!1),[Y,W]=r.useState([{name:""}]),[,B]=r.useState(!1),b=r.useRef(null);r.useRef(null);const N=r.useRef(null),i=r.useRef(new Ue({validators:{...ke()},...Le(),autoForceUpdate:{forceUpdate:()=>B(e=>!e)}})),I=r.useRef(null);r.useEffect(()=>{var e;(e=b==null?void 0:b.current)==null||e.search()},[]),r.useEffect(()=>{v&&k(!0)},[v]),r.useEffect(()=>{var e;N!=null&&N.current&&j!==""&&((e=N==null?void 0:N.current)==null||e.showFunction(),P(""))},[j,L,_]),r.useEffect(()=>{x(e=>{const t={...e};let a=0;if(Array.isArray(t.tableData)){for(const o of t.tableData)a+=ae(o.amount);t.depositAmount=a,t.depositAmountInWords=Fe(a)}return t})},[n==null?void 0:n.tableData]),r.useEffect(()=>{c!=null&&c.depositUid&&le()},[c==null?void 0:c.depositUid]);const le=async()=>{var e;x(t=>({...t,isLoading:!0}));try{const t=await g.getOneFeeCollectionDeposit(c==null?void 0:c.depositUid),a=[];if((e=t==null?void 0:t.data)!=null&&e.depositReceipts)for(const o of t.data.depositReceipts)o!=null&&o.receipt&&a.push(o==null?void 0:o.receipt);x(o=>{var l,f,d,m,E,R,G,D,H,V,X;return{...o,dateOfDeposits:(l=t==null?void 0:t.data)==null?void 0:l.depositDate,depositAmount:(f=t==null?void 0:t.data)==null?void 0:f.totalAmount,totalAmountInWords:(d=t==null?void 0:t.data)==null?void 0:d.totalAmountInWords,savedDocuments:nt((m=t==null?void 0:t.data)==null?void 0:m.loanDocuments),tableData:a,sahayyaBankAccount:{...o.sahayyaBankAccount,name:(R=(E=t==null?void 0:t.data)==null?void 0:E.depositAccount)==null?void 0:R.holderName,branch:(H=(D=(G=t==null?void 0:t.data)==null?void 0:G.depositAccount)==null?void 0:D.ifsc)==null?void 0:H.branch,accountNumber:(X=(V=t==null?void 0:t.data)==null?void 0:V.depositAccount)==null?void 0:X.accountNumber},isLoading:!1}})}catch(t){console.log(t),A(S(t)),x(a=>({...a,isLoading:!1}))}},ce=e=>{x(t=>({...t,[e.target.name]:e.target.value}))},ie=e=>{const{value:t}=e.target;x(typeof t=="object"?a=>{var o,l;return{...a,[e.target.name]:{name:(o=t==null?void 0:t.bank)==null?void 0:o.name,uid:t.uid,branch:(l=t==null?void 0:t.ifsc)==null?void 0:l.branch,accountNumber:t==null?void 0:t.accountNumber}}}:a=>({...a,[e.target.name]:{name:t,uid:"",branch:"",accountNumber:""}}))},re=async e=>{var a,o;const{value:t}=e.target;if(typeof t=="object"){let l;try{l=await g.getFeeCollectionReceipt(0,1e3,`&loan.uid=${t==null?void 0:t.uid}&smInstrumentType:nq=${(a=Ke)==null?void 0:a.UPI}&status=${Ge.PENDING_DEPOSIT}`)}catch(d){A(S(d))}let f=[];(o=l==null?void 0:l.data)!=null&&o.results&&(f=[...l.data.results]),x(d=>{const m={...d};return e.target.value,m.tableData=[...m.tableData,...f],m.loan.name="",m})}else x(l=>({...l,loan:{...l.loan,name:t}}))},$=e=>{var t,a;(a=i==null?void 0:i.current)==null||a.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},de=()=>{var t,a;let e=!1;return e=((t=i==null?void 0:i.current)==null?void 0:t.allValid())??!1,e||(B(o=>!o),(a=i==null?void 0:i.current)==null||a.showMessages(),B(o=>!o),!1)},q=()=>{x(e=>({...e,deleteReceipt:{...e.deleteReceipt,showPopUp:!1,uid:""}}))},ue=async()=>{var e;try{await g.deleteDdeReceipt(n.deleteReceipt.uid),F(M.PRIMARY),P(Q.SAVED),O(!_),(e=b==null?void 0:b.current)==null||e.search(),q()}catch(t){console.log(t),A(S(t))}},me=async()=>{var a;const e=(a=I==null?void 0:I.current)==null?void 0:a.getUploadedData();if(!de()||!e)return;const t=fe(e);if(t)try{await g.createFeeCollectionDeposit(t),F(M.PRIMARY),P(Q.SAVED),O(!_),y.navigate(U)}catch(o){console.log(o),A(S(o))}console.log("on save")},xe=()=>{var e;(e=y==null?void 0:y.location)!=null&&e.pathname.includes(Ye)?(y.navigate(U),y.navigate(We)):y.navigate(U)},fe=e=>{var a;const t=[];return n.tableData.forEach(o=>{var l;t.push({loan:{uid:(l=o==null?void 0:o.loan)==null?void 0:l.uid},receipt:{uid:o==null?void 0:o.uid},deposit:null})}),{totalAmount:n==null?void 0:n.depositAmount,totalAmountInWords:n==null?void 0:n.depositAmountInWords,depositDate:n==null?void 0:n.dateOfDeposits,depositAccount:{uid:(a=n==null?void 0:n.sahayyaBankAccount)==null?void 0:a.uid},loanDocuments:e!=null&&e.documentUid?[{uid:e==null?void 0:e.uid,docType:{uid:e==null?void 0:e.documentUid},isActive:e==null?void 0:e.isActive,docNo:(e==null?void 0:e[`${e.primaryKeyAttributeName}`])??"",dob:e.dob?e==null?void 0:e.unsavedDocuments.dob:null,loanSectionKey:$e.RECEIPT,docCategory:e==null?void 0:e.documentCategory,attributes:at(e),documentSections:ot(e==null?void 0:e.documentSectionUrls)}]:[],depositReceipts:t}},pe=e=>{x(t=>{const a={...t};return a.tableData=a.tableData.filter(o=>o.uid!==e),a})},he=async(e,t)=>{var o;let a=[];await((o=t==null?void 0:t.service)==null?void 0:o.call(t,0,10,e.query).then(l=>{l.data.results&&(l==null?void 0:l.status)===200&&(a=[...l.data.results])})),a.length===0&&a.push({name:""}),W(a)},ye=async e=>{var l,f;let t=[];const a=/^[0-9]$/;let o="";(f=(l=e==null?void 0:e.query)==null?void 0:l.toLowerCase())!=null&&f.includes("lan")||a!=null&&a.test(e==null?void 0:e.query)?o=`&lanId:lk=${e==null?void 0:e.query}`:o=`&applicantName:lk=${e==null?void 0:e.query}`;try{await g.getLoans(0,100,o).then(d=>{var m;d.status===200&&((m=d==null?void 0:d.data)!=null&&m.results)&&(t=[...d.data.results])})}catch(d){console.log(d)}t.length===0&&t.push({name:"",uid:""}),W(t)},be=e=>{var t;return(e==null?void 0:e.uid)===void 0||(e==null?void 0:e.uid)===""?s.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:s.jsx(u,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):s.jsx("div",{className:"flex flex-col",children:s.jsx(u,{className:"text-primary-labelColor",label:`${(t=e==null?void 0:e.bank)==null?void 0:t.name}`})})},Ne=e=>(e==null?void 0:e.uid)===void 0||(e==null?void 0:e.uid)===""?s.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:s.jsx(u,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):s.jsx("div",{className:"flex flex-col",children:s.jsx(u,{className:"text-primary-labelColor",label:`${e==null?void 0:e.lanId} | ${e==null?void 0:e.applicantName} | ${e==null?void 0:e.branch}`})}),Ae=e=>{var t;return s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:(t=e==null?void 0:e.loan)==null?void 0:t.lanId})},Ee=e=>{var t;return s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:(t=e==null?void 0:e.loan)==null?void 0:t.applicantName})},Te=e=>{var t,a;return s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:(a=(t=e==null?void 0:e.loan)==null?void 0:t.branch)==null?void 0:a.name})},ge=e=>{var t;return s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:((t=He)==null?void 0:t[e==null?void 0:e.smInstrumentType])??""})},Ce=e=>s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:Z(e==null?void 0:e.instrumentDate)}),Ie=e=>s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:e==null?void 0:e.txnRefNo}),Re=e=>s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:z(e==null?void 0:e.amount,"en-IN",0)}),Se=e=>s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:e==null?void 0:e.createdByUserName}),ve=e=>s.jsx(u,{className:" text-xs text-secondary-labelColor ",label:Z(e==null?void 0:e.updatedAtSystemDate)}),je=e=>s.jsx("div",{className:"grid grid-cols-2",children:s.jsx("div",{className:"",children:s.jsx(Je,{buttonType:Qe.DELETE,onClick:()=>pe(e==null?void 0:e.uid),tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})})}),Pe=()=>{var e,t;return s.jsxs("div",{className:"col-span-4",children:[s.jsxs(ze,{value:n.tableData,dataKey:"uid",ref:b,className:"  make-deposit-table ",children:[s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:p("label.fees.loanApplicationNo(s)"),body:Ae}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6 ",header:p("label.fees.applicantName"),body:Ee}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs w-1/12  p-1 h-12 pl-6",header:p("label.fees.branch"),body:Te}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.fees.instrumentType"),body:ge}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:p("label.fees.instrumentDate"),body:Ce}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:p("label.fees.utr/Chq.No."),body:Ie}),s.jsx(h,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6",header:p("label.fees.amount"),body:Re}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:p("label.fees.collectedBy"),body:Se}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:p("label.fees.updatedOn"),body:ve}),s.jsx(h,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:p("label.fees.action"),body:je})]}),s.jsx(De,{validation:(t=i==null?void 0:i.current)==null?void 0:t.message("receipts",(e=n==null?void 0:n.tableData)==null?void 0:e.length,"arrayMinOneReceipt")})]})},_e=()=>{var e,t,a,o,l,f,d,m,E;return s.jsxs("div",{className:" grid grid-cols-4 gap-3",children:[s.jsx("div",{children:s.jsx(w,{label:"label.fees.sahayyaBankAccount*",name:"sahayyaBankAccount",field:"name",value:(e=n==null?void 0:n.sahayyaBankAccount)==null?void 0:e.name,variant:T.PRIMARY,suggestions:Y,completeMethod:R=>he(R,{field:"",search:"",service:st.getBankAccount}),onBlur:$,validation:(a=i==null?void 0:i.current)==null?void 0:a.message("sahayyaBankAccount",(t=n==null?void 0:n.sahayyaBankAccount)==null?void 0:t.uid,"mandatory"),onChange:ie,itemTemplate:be})}),s.jsx("div",{children:s.jsx(se,{label:"label.fees.accountBranch",name:"",value:(o=n==null?void 0:n.sahayyaBankAccount)==null?void 0:o.branch,variant:T.SECONDARY,disabled:!0})}),s.jsx("div",{children:s.jsx(se,{label:"label.fees.branchAccountNumber",name:"",value:(l=n==null?void 0:n.sahayyaBankAccount)==null?void 0:l.accountNumber,variant:T.SECONDARY,disabled:!0})}),s.jsx("div",{}),s.jsx("div",{className:"col-span-4",children:s.jsx(w,{label:"label.fees.applicantNameOrApplicationNo",name:"receipt",field:"name",value:(f=n==null?void 0:n.loan)==null?void 0:f.name,variant:T.PRIMARY,suggestions:Y,completeMethod:ye,onChange:re,itemTemplate:Ne})}),Pe(),s.jsx("div",{children:s.jsx(ne,{label:"label.fees.depositAmount(₹)*",value:`${z(ae(n==null?void 0:n.depositAmount),"en-IN",0)}`})}),s.jsx("div",{children:s.jsx(ne,{label:"label.fees.amountInWords",value:`${n==null?void 0:n.depositAmountInWords}`})}),s.jsx("div",{}),s.jsx("div",{className:"grid-group",children:s.jsx(we,{label:"label.fees.dateOfDeposit*",name:"dateOfDeposits",onChange:ce,value:n!=null&&n.dateOfDeposits?new Date(n==null?void 0:n.dateOfDeposits):null,variant:T.SECONDARY,onBlur:$,validation:(d=i==null?void 0:i.current)==null?void 0:d.message("dateOfDeposits",n==null?void 0:n.dateOfDeposits,"mandatory")})}),s.jsx("div",{className:"col-span-4",children:s.jsx("div",{className:"col-span-4",children:s.jsx(Ve,{ref:I,savedDocument:(m=n.savedDocuments)!=null&&m[0]?(E=n.savedDocuments)==null?void 0:E[0]:{},mode:c!=null&&c.depositUid?te.VIEW:te.EDIT,queryParamForDocList:qe.DOCUMENT_CATEGORY_FEE_DEPOSIT})})})]})};return s.jsxs("div",{className:"p-3 rounded-masterDataPageRadius bg-white flex flex-col gap-3 overflow-scroll h-screen",children:[s.jsxs("div",{className:"flex w-full justify-between items-center",children:[s.jsx(u,{label:c!=null&&c.depositUid?"label.fees.editDeposit":"label.fees.makeDeposit",className:"text-primary-ptext-1000 text-h2 font-bold flex"}),s.jsxs("div",{className:"flex gap-10",children:[s.jsx(ee,{buttonType:J.CANCEL_OUTLINE,className:"create-button",onClick:xe}),n.pageMode===C.VIEW?null:s.jsx(ee,{buttonType:J.MAKE_DEPOSIT,onClickWithLoader:me})]})]}),s.jsx(Oe,{override:{read:n.pageMode===C.VIEW},children:n.isLoading===void 0?s.jsx(Ze,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):_e()}),s.jsx(tt,{visible:(K=n==null?void 0:n.deleteReceipt)==null?void 0:K.showPopUp,className:"w-76 !px-14",title:"heading.dde.fees.receiptDelete",warningMessage:"description.dde.fees.receiptDelete",onCancel:q,onConfirm:()=>ue(),onHide:()=>{}}),s.jsx(et,{position:"bottom-right",ref:N,toastText:j,variant:L}),s.jsx(Xe,{onHide:()=>{k(!1),A("")},visible:oe,errorMessage:v})]})},zt=Be(ct);export{zt as default};
//# sourceMappingURL=PageDepositCreateOrEdit-5629cda9.js.map
