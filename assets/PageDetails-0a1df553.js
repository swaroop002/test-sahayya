import{r as l,q as Fe,ad as We,ae as Pe,af as Ye,ao as he,b2 as ce,eT as de,j as s,ax as Oe,aF as _,o as j,a8 as Le,T as F,d6 as ke,b3 as He,d5 as ze,z as Xe,w as Je,aG as $e,aH as Ke}from"./index-e8217573.js";import{E as Qe}from"./ErrorDialog-d5eef4d7.js";import{S as Ze}from"./SaveComponent-160c5b32.js";import{S as Ve}from"./Section-00ef9f2b.js";import{S as ea}from"./Skeleton-7e12d019.js";import{A as ee}from"./AutoComplete-0bca608a.js";import{I as ie}from"./InputBox-b9e88f52.js";import{S as aa}from"./SimpleDropDown-061a3470.js";import{T as na}from"./TextData-06df331b.js";import{O as ta}from"./Branch-732bec0f.js";import{P as Ge}from"./PartnerMasterDataService-d9d86d95.js";import{P as sa}from"./ProductConfigProductService-51cfb6b7.js";import{S as ra}from"./StaticMasterDataService-689a6eca.js";import{T as oa}from"./Toast-ae99ea5b.js";import{S as _e}from"./SourcingService-387bf5b5.js";import"./ButtonBox-9e46519a.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./IconButton-36693dd9.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./TransitionGroup-c8afe0ce.js";const la={uid:"",id:"",userUid:"",loanRequestDetails:{product:{name:"",uid:""},loanAmount:"",loanAmountInWords:"",loanTenure:"",loanTenureInWords:""},sourceAndBranch:{channelType:"",channel:{name:"",uid:""},salesAgent:{name:"",uid:""},branch:{name:"",uid:""}}},ua=l.forwardRef((h,p)=>{var me,fe,Ae,Te,xe,ge,ve,pe,ye,Se,Ce,je,Be;const N=Fe(),{pageMode:H,data:B}=h;let M=!0;const[ae,m]=l.useState(!1),[,q]=l.useState(void 0),[E,w]=l.useState([]),[y,I]=l.useState([]),[a,f]=l.useState({...B});l.useRef(null);const o=l.useRef(new We({validators:{...Pe()},...Ye(),autoForceUpdate:{forceUpdate:()=>q(e=>!e)}}));l.useImperativeHandle(p,()=>({onSave:le,onCancel:u})),l.useEffect(()=>{T()},[]),l.useEffect(()=>{var e;M?M=!1:(e=a==null?void 0:a.sourceAndBranch)!=null&&e.channelType?(S(),o.current.showMessages()):S()},[(me=a==null?void 0:a.sourceAndBranch)==null?void 0:me.channelType]),l.useEffect(()=>{f(e=>({...e,...B}))},[B]);const T=async()=>{(h==null?void 0:h.mode)==="DDE"&&ne()},ne=async()=>{var e,n,r;try{const t=await ra.getAll(0,10,"staticMasterType.code=CHANNEL_TYPE&isActive=true"),c=[];(n=(e=t==null?void 0:t.data)==null?void 0:e.results)==null||n.forEach(i=>{c.push({label:i==null?void 0:i.name,value:i==null?void 0:i.code,uid:i==null?void 0:i.uid})}),I(c)}catch(t){console.error(t),(r=h.onError)==null||r.call(h,he(t))}},R=e=>{const{name:n,value:r}=e.target;f(typeof r=="object"?t=>({...t,sourceAndBranch:{...t.sourceAndBranch,[n]:r}}):t=>{var c;return n==="branch"&&((c=a.sourceAndBranch)!=null&&c.salesAgent)?{...t,sourceAndBranch:{...t.sourceAndBranch,[n]:{name:r},salesAgent:{name:"",uid:""}}}:{...t,sourceAndBranch:{...t.sourceAndBranch,[n]:{name:r}}}})},te=e=>{const{name:n,value:r}=e.target;f(t=>({...t,loanRequestDetails:{...t.loanRequestDetails,[n]:r,loanTenureInWords:ke(r)}}))},se=e=>{const{name:n,value:r}=e.target;f(typeof r=="object"?t=>({...t,loanRequestDetails:{...t.loanRequestDetails,[n]:r}}):t=>({...t,loanRequestDetails:{...t.loanRequestDetails,[n]:{name:r}}}))},G=e=>{const{name:n,value:r}=e.target,t=ce(r);f(c=>({...c,loanRequestDetails:{...c.loanRequestDetails,[n]:He(t,"en-IN",0),loanAmountInWords:ze(t)}}))},re=e=>{const{name:n,value:r}=e.target;f(t=>({...t,sourceAndBranch:{...t.sourceAndBranch,[n]:r,...n==="channelType"?{channel:{name:"",uid:""}}:{}}}))},x=e=>{var n,r;(r=o==null?void 0:o.current)==null||r.showMessageFor((n=e==null?void 0:e.target)==null?void 0:n.name)},oe=()=>{var n,r;let e=!1;return e=((n=o==null?void 0:o.current)==null?void 0:n.allValid())??!1,e||(q(t=>!t),(r=o==null?void 0:o.current)==null||r.showMessages(),q(t=>!t),!1)},le=()=>{let e=!1;return e=oe(),e?C():void 0},d=()=>{var e,n;return!((e=a==null?void 0:a.sourceAndBranch)!=null&&e.channelType)||((n=a==null?void 0:a.sourceAndBranch)==null?void 0:n.channelType)===de.DIRECT?"optional":"mandatory"},A=()=>{var e,n;return!(!((e=a==null?void 0:a.sourceAndBranch)!=null&&e.channelType)||((n=a==null?void 0:a.sourceAndBranch)==null?void 0:n.channelType)===de.DIRECT)},S=()=>{var e;o.current=new We({validators:{...Pe()},...Ye(),autoForceUpdate:{forceUpdate:()=>q(n=>!n)}}),(e=o==null?void 0:o.current)==null||e.hideMessages()},u=()=>{var e;(e=o==null?void 0:o.current)==null||e.hideMessages(),T()},C=()=>{var n,r,t,c,i,$,Ee,Ie,Re,be,Ne,Me,qe,we,De,Ue;return{product:{uid:(r=(n=a==null?void 0:a.loanRequestDetails)==null?void 0:n.product)==null?void 0:r.uid},branch:{uid:(c=(t=a==null?void 0:a.sourceAndBranch)==null?void 0:t.branch)==null?void 0:c.uid},amount:ce((i=a==null?void 0:a.loanRequestDetails)==null?void 0:i.loanAmount),amountInWords:($=a==null?void 0:a.loanRequestDetails)==null?void 0:$.loanAmountInWords,tenure:parseInt((Ee=a==null?void 0:a.loanRequestDetails)==null?void 0:Ee.loanTenure),tenureInWords:(Ie=a==null?void 0:a.loanRequestDetails)==null?void 0:Ie.loanTenureInWords,salesAgent:{uid:(be=(Re=a==null?void 0:a.sourceAndBranch)==null?void 0:Re.salesAgent)==null?void 0:be.uid},salesManager:{uid:((qe=(Me=(Ne=a==null?void 0:a.sourceAndBranch)==null?void 0:Ne.salesAgent)==null?void 0:Me.parent)==null?void 0:qe.uid)||null},...(h==null?void 0:h.mode)==="DDE"?{userUid:a==null?void 0:a.userUid,id:a==null?void 0:a.id,uid:a==null?void 0:a.uid,smChannelType:(we=a==null?void 0:a.sourceAndBranch)==null?void 0:we.channelType,smChannelName:W()?"":(Ue=(De=a==null?void 0:a.sourceAndBranch)==null?void 0:De.channel)==null?void 0:Ue.name}:{}}},W=()=>{const e=y==null?void 0:y.find(n=>n.value===ue);return(e==null?void 0:e.value)===de.DIRECT},P=async e=>{let n=[];m(!0);try{await sa.findByName(0,50,e.query).then(r=>{r.status===200&&(n=[...r.data.results],m(!1))})}catch(r){console.log(r)}n.length===0&&n.push({name:"",uid:""}),w(n)},O=async e=>{var r,t;let n=[];m(!0);try{await Xe.getUserByBranchAndName(0,50,(t=(r=a==null?void 0:a.sourceAndBranch)==null?void 0:r.branch)==null?void 0:t.uid,e.query).then(c=>{c.status===200&&(n=[...c.data],m(!1))})}catch(c){console.log(c)}n.length===0&&n.push({name:"",uid:""}),w(n)},k=async e=>{let n=[];m(!0);try{await ta.getFilterByName(0,50,e.query).then(r=>{r.status===200&&(n=[...r.data],m(!1))})}catch(r){console.log(r)}n.length===0&&n.push({name:"",code:"",uid:""}),w(n)},z=async e=>{var r;let n=[];m(!0);try{const t=await Ge.getChannelName(0,50,`&loanUid=${N==null?void 0:N.loanUid}&channelType=${(r=a==null?void 0:a.sourceAndBranch)==null?void 0:r.channelType}&name=${e.query}`);t!=null&&t.data&&t.status===200&&(n=[...t.data],m(!1))}catch(t){console.log(t)}n.length===0&&n.push({name:"",uid:""}),w(n)},b=(e,n,r)=>(e==null?void 0:e.name)===void 0||(e==null?void 0:e.name.length)<1?s.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:s.jsx(F,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):s.jsxs("div",{className:"flex flex-col",children:[s.jsx(F,{className:"text-primary-labelColor",label:n}),r?s.jsx(F,{className:"text-secondary-gray-500 text-xxs",label:r}):null]}),X=e=>{var n;return b(e,`${e==null?void 0:e.name} ${e==null?void 0:e.lastName}`,`${(n=e==null?void 0:e.designation)==null?void 0:n.name}`)},J=e=>b(e,`${e==null?void 0:e.name}`),K=e=>{var r,t,c,i,$;let n="";return(r=e==null?void 0:e.city)!=null&&r.name&&((t=e==null?void 0:e.city)!=null&&t.state)&&(n=`${(c=e==null?void 0:e.city)==null?void 0:c.name}, ${($=(i=e==null?void 0:e.city)==null?void 0:i.state)==null?void 0:$.name}`),b(e,`${e==null?void 0:e.name}`,n)},Q=e=>{var n;return b(e,`${e==null?void 0:e.name}`,(n=e==null?void 0:e.city)==null?void 0:n.name)},{loanRequestDetails:{product:g,loanAmount:Y,loanAmountInWords:Z,loanTenure:L,loanTenureInWords:V},sourceAndBranch:{salesAgent:v,branch:D,channelType:ue,channel:U}}=a;return s.jsxs(Oe,{override:{read:H===_.VIEW},children:[s.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[s.jsx("div",{children:s.jsx(ee,{label:"input.sourceDetails.product",name:"product",value:g==null?void 0:g.name,variant:j.PRIMARY,suggestions:E,completeMethod:P,onChange:se,itemTemplate:J,onBlur:x,validation:(fe=o==null?void 0:o.current)==null?void 0:fe.message("product",g==null?void 0:g.uid,"mandatory")})}),s.jsx("div",{children:s.jsx(ie,{label:"input.sourceDetails.loanAmount",name:"loanAmount",variant:j.SECONDARY,onChange:G,onBlur:x,value:Y,className:"text-right",validation:(Ae=o==null?void 0:o.current)==null?void 0:Ae.message("loanAmount",ce(Y),"mandatory|onlyInteger|min:100000,num|max:50000000,num")})}),s.jsx("div",{className:"col-span-2 pb-5",children:s.jsxs("div",{className:"group grid",children:[s.jsx(Le,{label:"input.sourceDetails.loanAmountWords"}),s.jsx("div",{className:"mt-1",children:s.jsx(Le,{label:Z})})]})}),s.jsx("div",{children:s.jsx(ie,{label:"input.sourceDetails.loanTenure",name:"loanTenure",variant:j.SECONDARY,onChange:te,onBlur:x,value:L,className:"text-right",validation:(Te=o==null?void 0:o.current)==null?void 0:Te.message("loanTenure",L,"mandatory|checkNumber|onlyInteger|min:12,num|max:360,num")})}),s.jsx("div",{children:s.jsx(na,{label:"input.sourceDetails.loanTenureWords",value:V})}),s.jsx("div",{}),s.jsx("div",{})]}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(F,{label:"Source & Branch",className:"text-xs font-bold text-primary-ptext-10000"}),s.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[(h==null?void 0:h.mode)==="DDE"?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsx(aa,{label:"label.dde.channelType",name:"channelType",value:ue,variant:j.PRIMARY,options:y,optionLabel:"label",optionValue:"value",onChange:re,onBlur:x,validation:(xe=o==null?void 0:o.current)==null?void 0:xe.message("channelType",ue,"mandatory")})}),s.jsx("div",{children:s.jsx("div",{children:s.jsx(ee,{label:A()?"label.dde.channelNameMandatory":"label.dde.channelName",name:"channel",value:W()?"":U==null?void 0:U.name,variant:j.PRIMARY,suggestions:E,completeMethod:z,onChange:R,itemTemplate:Q,onBlur:x,validation:(ge=o==null?void 0:o.current)==null?void 0:ge.message("channel",U==null?void 0:U.uid,d()),disabled:W()})})}),s.jsx("div",{}),s.jsx("div",{})]}):null,s.jsx("div",{children:s.jsx(ee,{label:"input.sourceDetails.branch",name:"branch",variant:j.PRIMARY,onBlur:x,suggestions:E,completeMethod:k,onChange:R,itemTemplate:K,value:D==null?void 0:D.name,validation:(ve=o==null?void 0:o.current)==null?void 0:ve.message("branch",D==null?void 0:D.uid,"mandatory")})}),s.jsx("div",{children:s.jsx(ee,{label:"input.sourceDetails.salesAgent",name:"salesAgent",variant:j.PRIMARY,onBlur:x,value:v==null?void 0:v.name,suggestions:E,completeMethod:O,onChange:R,itemTemplate:X,validation:(pe=o==null?void 0:o.current)==null?void 0:pe.message("salesAgent",v==null?void 0:v.uid,"mandatory"),disabled:!((Se=(ye=a==null?void 0:a.sourceAndBranch)==null?void 0:ye.branch)!=null&&Se.uid)})}),s.jsx("div",{children:s.jsx(ie,{label:"input.sourceDetails.salesManager",name:"salesManager",variant:j.SECONDARY,onChange:R,onBlur:x,value:((Be=(je=(Ce=a==null?void 0:a.sourceAndBranch)==null?void 0:Ce.salesAgent)==null?void 0:je.parent)==null?void 0:Be.name)??"",disabled:!0})}),s.jsx("div",{})]})]})]})}),ca=h=>{const p=Fe(),[,N]=l.useState(void 0),[H,B]=l.useState(_.VIEW),[M,ae]=l.useState(""),[m,q]=l.useState($e.PRIMARY),[E,w]=l.useState(!1),[y,I]=l.useState(""),[a,f]=l.useState(!1),o=l.useRef(null),T=l.useRef(null),[ne,R]=l.useState(!0),[te,se]=l.useState({...la});l.useEffect(()=>{G()},[]),l.useEffect(()=>{var d;o!=null&&o.current&&M!==""&&((d=o==null?void 0:o.current)==null||d.showFunction(),ae(""))},[M,m,E]),l.useEffect(()=>{y&&f(!0)},[y]);const G=async()=>{var d,A,S;try{const u=await _e.getDdeDetails(p==null?void 0:p.loanUid),C=await Ge.getChannelName(0,50,`&loanUid=${p==null?void 0:p.loanUid}&channelType=${(d=u==null?void 0:u.data)==null?void 0:d.smChannelType}&name=${(A=u.data)==null?void 0:A.smChannelName}`);console.log("details ",u);const W=He((S=u.data)==null?void 0:S.amount,"en-IN",0);se(P=>{var O,k,z,b,X,J,K,Q,g,Y,Z,L,V,v;return{...P,userUid:(O=u.data)==null?void 0:O.userUid,id:(k=u.data)==null?void 0:k.id,uid:(z=u.data)==null?void 0:z.uid,loanRequestDetails:{...P.loanRequestDetails,product:(b=u.data)==null?void 0:b.product,loanAmount:W,loanAmountInWords:(X=u.data)==null?void 0:X.amountInWords,loanTenure:(J=u.data)==null?void 0:J.tenure,loanTenureInWords:(K=u.data)==null?void 0:K.tenureInWords},sourceAndBranch:{...P.sourceAndBranch,branch:(Q=u.data)==null?void 0:Q.branch,channelType:(g=u.data)==null?void 0:g.smChannelType,channel:{name:((Z=(Y=C==null?void 0:C.data)==null?void 0:Y[0])==null?void 0:Z.name)??"",uid:((V=(L=C==null?void 0:C.data)==null?void 0:L[0])==null?void 0:V.uid)??""},salesAgent:((v=u.data)==null?void 0:v.salesAgent)??{name:"",uid:""}}}}),R(!1)}catch(u){console.log(u),R(!1),I(he(u))}},re=async()=>{var A;const d=await((A=T==null?void 0:T.current)==null?void 0:A.onSave());if(d)return _e.updateDde(d).then(S=>{ae(Ke.SAVED),q($e.PRIMARY),w(!E),I(""),B(_.VIEW)}).catch(S=>{I(he(S))})},x=()=>{var d;N(A=>!A),(d=T==null?void 0:T.current)==null||d.onCancel(),N(A=>!A),B(_.VIEW),G()},oe=d=>{I(d)},le=()=>s.jsx(F,{label:"label.dde.loanRequestDetails",className:"text-xs font-bold text-primary-ptext-10000"});return s.jsxs("div",{children:[s.jsx(Ve,{title:"heading.sourceDetails",children:ne?s.jsx(ea,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):s.jsx(Ze,{renderHeaderContent:le,pageMode:H,onEdit:()=>B(_.CREATE),onSave:re,onCancel:x,children:s.jsx(ua,{mode:"DDE",pageMode:H,ref:T,onError:oe,data:te})})}),s.jsx("div",{className:"",children:s.jsx(oa,{position:"bottom-right",ref:o,toastText:M,variant:m})}),s.jsx(Qe,{onHide:()=>{f(!1),I("")},visible:a,errorMessage:y})]})},$a=Je(ca);export{$a as default};
//# sourceMappingURL=PageDetails-0a1df553.js.map
