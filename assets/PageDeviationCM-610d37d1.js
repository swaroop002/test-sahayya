import{w as Nt,r as i,aF as u,aG as S,y as jt,ad as Ot,ae as Dt,af as Rt,j as a,ax as Ee,J as y,o as v,T as Y,ba as H,aH as b,ao as G,az as Pt,aA as bt,aI as Ae,aJ as Se,aK as I,av as It,bb as Lt}from"./index-e8217573.js";import{B as C}from"./ButtonBox-9e46519a.js";import{I as Mt}from"./InputBox-b9e88f52.js";import{I as Te}from"./InputTextArea-b90aad1d.js";import{P as _t}from"./PageTitle-b3bba3d4.js";import{S as T}from"./SimpleDropDown-061a3470.js";import{T as wt}from"./Toast-ae99ea5b.js";import{P as K}from"./ProductDeviation-5dd373c2.js";import{A as Ut}from"./AutoComplete-0bca608a.js";import{C as Yt}from"./CheckBox-8a0c0e77.js";import{E as Ft,C as L}from"./EditableTableV2-6afcb42b.js";import{E as kt}from"./ErrorDialog-d5eef4d7.js";import{M as Bt}from"./MenuBox-defc36b0.js";import{O as Wt}from"./Approval-120dc31f.js";import{P as Ne}from"./ProdcutDeviationCategory-d8b5e79a.js";import{B as Vt}from"./BusinessRuleService-e622f5ea.js";import{I as Jt}from"./IncomeSchemeService-d239ebaf.js";import{P as qt}from"./ProductConfigProductService-51cfb6b7.js";import{S as Ht}from"./StaticMasterDataService-689a6eca.js";import{S as Gt}from"./StaticMasterTypeService-480bff1a.js";import"./kebab-menu-8835ad2e.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./TransitionGroup-c8afe0ce.js";import"./search_icon-459d6871.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";const Kt=M=>{var le,ue,de,pe;const[l,X]=i.useState({deviationCategory:"",displayName:"",name:"",typeOfDeviation:"",ruleApplied:"",referenceType:"",productName:"",productScheme:"",description:"",reasons:"",attachments:[]}),F={isActive:!0,type:{uid:""},rule:{uid:""},user:{uid:""},approvalLevel:{uid:""}},[je,Oe]=i.useState({name:"",ruleApplied:"",referenceType:"",productName:"",productScheme:"",description:"",reasons:""}),[p,$]=i.useState(u.CREATE),[,k]=i.useState(void 0),[De,Re]=i.useState([]),[Pe,be]=i.useState([]),[g,Ie]=i.useState(""),n=i.useRef(null),[B,N]=i.useState(""),[Le,Q]=i.useState("bottom-right"),[z,j]=i.useState(S.PRIMARY),[W,O]=i.useState(""),[E,D]=i.useState(!1),[Me,V]=i.useState(!1),h=i.useRef(null),[_e,Z]=i.useState(!1),[we,J]=i.useState([]),[Ue,Ye]=i.useState(void 0),[Fe,ke]=i.useState(!0),_=i.useRef(null),[Be,We]=i.useState([]),[ee,Ve]=i.useState([]),[Je,qe]=i.useState([]),[w,te]=i.useState(""),[A,ae]=i.useState("");i.useEffect(()=>{var t;const e=jt.parse(M.location.search);e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&$(e.mode),Ie(e.uid),pt(),mt(),vt(),Ct(),gt(),Fe&&e.mode===u.CREATE&&((t=n==null?void 0:n.current)==null||t.addRow(F),ke(!1))},[]),i.useEffect(()=>{g&&et()},[g]),i.useEffect(()=>{console.log("object")},[l]),i.useEffect(()=>{var e;h!=null&&h.current&&W!==""&&((e=h==null?void 0:h.current)==null||e.showFunction())},[W,z,E]),i.useEffect(()=>{B&&Z(!0)},[B]);function He(e,t){const o=t.find(s=>s.uid===e);return o?o.name:null}const x=e=>{var s;const{name:t,value:o}=e.target;if(t==="typeOfDeviation"){const r=He(o,Je);ae(o),te(r),(s=n==null?void 0:n.current)==null||s.reset()}X(r=>{let d={...r,[t]:o};return t==="productName"?d={...d,productScheme:null,productConfigType:" PRODUCT"}:t==="productScheme"&&(d={...d,productName:null,productConfigType:"PRODUCT_INCOME_SCHEME"}),d})},oe=async()=>{var t,o;let e=!1;return e=((t=c==null?void 0:c.current)==null?void 0:t.allValid())??!1,e||(k(s=>!s),(o=c==null?void 0:c.current)==null||o.showMessages(),k(s=>!s),!1)},ne=()=>{var s,r,d;const e=[...((s=n.current)==null?void 0:s.getAddedRecords())??[],...((r=n.current)==null?void 0:r.getDeletedRecords())??[],...((d=n.current)==null?void 0:d.getUpdatedRecords())??[]],t={deviationCategory:{uid:l.deviationCategory},name:l.displayName,type:{uid:l.typeOfDeviation},referenceType:"",product:{uid:l.productName},incomeSchemeProduct:{uid:l.productScheme},reason:l.reasons,description:l.description},o=e.map(m=>w!=="Automatic"?{...m,rule:null,type:{uid:A??""},approvalLevel:{uid:m.approvalLevel.uid??""},isActive:m.isActive??""}:{...m,rule:{uid:m.rule.uid??""},type:{uid:A??""},approvalLevel:{uid:m.approvalLevel.uid??""},isActive:m.isActive??""});return t.product.uid?t.referenceType="PRODUCT":t.incomeSchemeProduct.uid?t.referenceType="PRODUCT_INCOME_SCHEME":t.referenceType=null,l.productName?t.incomeSchemeProduct=null:(l.productScheme||(t.incomeSchemeProduct=null),t.product=null),t.approvalFunctions=o,t},Ge=()=>{var m,R,P;const e=[...((m=n.current)==null?void 0:m.getAddedRecords())??[],...((R=n.current)==null?void 0:R.getDeletedRecords())??[],...((P=n.current)==null?void 0:P.getUpdatedRecords())??[]],t={uid:g,deviationCategory:{uid:l.deviationCategory},name:l.displayName,type:{uid:l.typeOfDeviation},referenceType:"",product:{uid:l.productName},incomeSchemeProduct:{uid:l.productScheme},reason:l.reasons,description:l.description};t.product.uid?t.referenceType="PRODUCT":t.incomeSchemeProduct.uid?t.referenceType="PRODUCT_INCOME_SCHEME":t.referenceType=null,l.productName?t.incomeSchemeProduct=null:(l.productScheme||(t.incomeSchemeProduct=null),t.product=null);const o=e.map(f=>w!=="Automatic"?{rule:null,type:{uid:A??""},approvalLevel:{uid:f.approvalLevel.uid??""},isActive:f.isActive??""}:{rule:{uid:f.rule.userUid??""},type:{uid:A??""},approvalLevel:{uid:f.approvalLevel.uid??""},isActive:f.isActive??""});t.approvalFunctions=o;let s;const r=t,d=je;return p===u.CREATE?s={name:l.name,operationType:Ae.CREATE,entity:Se.DEVIATION,initialStateJson:"",finalStateJson:I(r),reqPayload:I(r),reasonForChange:l.reasons}:(r.uid=g,s={uid:g,name:l.name,operationType:Ae.UPDATE,entity:Se.DEVIATION,initialStateJson:I(d),finalStateJson:I(r),reqPayload:I(r),reasonForChange:l.reasons}),s},Ke=async()=>{N("");let e=!1;if(e=await oe(),!e){Q("top-right"),j(S.QUATERNARY),O(b.ERROR),D(!E);return}if(p===u.CREATE){const t=ne();return K.save(t).then(o=>{j(S.PRIMARY),O(b.SAVED),D(!E),V(!0)}).catch(o=>{N(G(o))})}else{const t=ne();return K.update(g,t).then(o=>{j(S.PRIMARY),O(b.SAVED),D(!E),V(!0)}).catch(o=>{N(G(o))})}},Xe=()=>{M.navigate(H)},$e=async()=>{N("");let e=!1;if(e=await oe(),!e){Q("top-right"),j(S.QUATERNARY),O(b.ERROR),D(!E);return}const t=Ge();return Gt.approve(t).then(o=>{j(S.PRIMARY),O(b.SENT_FOR_APPROVAL),D(!E),V(!0)}).catch(o=>{N(G(o))})},Qe=()=>{M.navigate(H)},ze=()=>{$(u.EDIT)},Ze=()=>{var e,t,o,s,r;console.log((e=n==null?void 0:n.current)==null?void 0:e.getCurrentRecords().length),w=="Automatic"?(t=n==null?void 0:n.current)==null||t.addRow(F):(o=n==null?void 0:n.current)!=null&&o.getCurrentRecords()&&((s=n==null?void 0:n.current)==null?void 0:s.getCurrentRecords().length)<1&&((r=n==null?void 0:n.current)==null||r.addRow(F))},et=()=>{K.getDeviationCategoryInfo(g).then(e=>{var t,o,s,r,d,m,R,P,f,me,ve,ge,fe,he,xe,ye,Ce;console.log(e.data,"response"),X({...l,deviationCategory:((t=e.data)==null?void 0:t.deviationCategory.uid)??"",displayName:((o=e.data)==null?void 0:o.name)??"",typeOfDeviation:((s=e.data)==null?void 0:s.type.uid)??"",referenceType:"",productName:((d=(r=e.data)==null?void 0:r.product)==null?void 0:d.uid)??"",productScheme:((R=(m=e.data)==null?void 0:m.incomeSchemeProduct)==null?void 0:R.uid)??"",reasons:((P=e.data)==null?void 0:P.reason)??"",description:((f=e.data)==null?void 0:f.description)??""}),te((ve=(me=e==null?void 0:e.data)==null?void 0:me.type)==null?void 0:ve.name),ae((fe=(ge=e==null?void 0:e.data)==null?void 0:ge.type)==null?void 0:fe.uid),Oe({...l,name:e.data.name,ruleApplied:((xe=(he=e.data)==null?void 0:he.rule)==null?void 0:xe.uid)??"",productName:(ye=e.data.product)==null?void 0:ye.uid,productScheme:(Ce=e.data.incomeSchemeProduct)==null?void 0:Ce.uid,description:e.data.description,reasons:e.data.reason,deviationCategory:e.data.deviationCategory.uid})}).catch(e=>{console.log(e)})},U=e=>{var t,o;(o=c==null?void 0:c.current)==null||o.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},tt=()=>{switch(p){case u.CREATE:return"heading.productConfiguration.deviation.create";case u.VIEW:return"heading.productConfiguration.deviation.view";case u.EDIT:return"heading.productConfiguration.deviation.edit";default:return"heading.productConfiguration.deviation.create"}},at=e=>{Vt.getAll().then(t=>{var s,r;const o=((r=(s=t.data)==null?void 0:s.results)==null?void 0:r.length)>0?[...t.data.results]:[];o.length===0?J([{name:Lt.NO_Rules}]):J([...o])})},ot=(e,t)=>{clearTimeout(Ue),Ye(setTimeout(e,t))},nt=e=>{e.query,e.query.length>=1?ot(at(),1200):J([])},st=e=>e.name===void 0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-39",children:[a.jsx("img",{src:It,alt:"search-icon",className:" h-7 w-7"}),a.jsx(Y,{className:"text-primary-labelColor mt-2",label:"Loading..."})]}):a.jsxs("div",{className:"flex flex-col",children:[a.jsx(Y,{className:"text-primary-labelColor",label:e.name}),a.jsx(Y,{className:"text-secondary-gray-500 text-xxs",label:e.code})]}),rt=e=>{var t;return a.jsx("div",{className:"w-40 relative  ",children:a.jsx(Ut,{value:(t=e==null?void 0:e.rule)==null?void 0:t.name,variant:Pt.PRIMARY,suggestions:we,completeMethod:nt,onChange:o=>{var d;const s=o.target.value,r={...e};typeof o.target.value=="object"&&(r.rule.uid=s.uid),r.rule.name=s,(d=n.current)==null||d.reportDataChange(r)},itemTemplate:st,field:"name",disabled:w!=="Automatic"||p===u.VIEW,hideLabel:!0,name:`rule-${e.uid}`,errorClassNames:"!m-0 !p-0 !text-xxs !h-2.5"})})},[q,it]=i.useState([{items:[{label:"Delete",className:""}]}]),ct=(e,t)=>{var o;(o=n==null?void 0:n.current)==null||o.deleteRow(e),setTimeout(()=>{var s,r;(s=n==null?void 0:n.current)==null||s.getAddedRecords(),(r=n==null?void 0:n.current)==null||r.getDeletedRecords()},2)},lt=(e,t,o)=>{var s;console.log(q),it(r=>[{...r[0],items:[{...r[0].items[0],command:()=>{ct(e)}}]}]),(s=_==null?void 0:_.current)==null||s.toggle(o),console.log(q)},ut=(e,t)=>a.jsx(Yt,{name:"isActive",variant:bt.PRIMARY,onChange:o=>{var r;const s={...e};s.isActive=o.target.checked,(r=n.current)==null||r.reportDataChange(s)},checked:e.isActive,disabled:p===u.VIEW}),dt=(e,t)=>a.jsx("div",{className:"w-20 flex items-center justify-center ml-2",children:a.jsx(C,{buttonType:y.MENU,onClick:o=>lt(e,t,o),className:"!rounded-none bg-transparent !hover:bg-primary-gray-300"})}),pt=()=>{qt.getAll().then(e=>{Re([...e.data.results])}).catch(e=>{console.log("err")})},mt=()=>{Jt.getAll().then(e=>{be([...e.data.results])}).catch(e=>{console.log("err")})},vt=()=>Ne.getAll().then(e=>{e.status===200&&We(e.data.results)}),gt=()=>Ht.getAll(0,30,"&staticMasterType.code=TYPE_OF_DEVIATION").then(e=>{e.status===200&&Ve(e.data.results),qe(e.data.results)}),c=i.useRef(new Ot({validators:{...Dt()},...Rt(),autoForceUpdate:{forceUpdate:()=>k(e=>!e)}})),ft=e=>{var t;(t=c==null?void 0:c.current)==null||t.showMessageFor(e.target.name)},ht=e=>a.jsx(T,{name:"type",variant:v.SECONDARY,disabled:!0,value:A==""?e.type.uid:A,options:ee,optionLabel:"name",optionValue:"uid"}),[xt,yt]=i.useState([]),Ct=()=>{Wt.getAll().then(e=>{yt([...e.data.results])}).catch(e=>{console.log("err")})},Et=e=>{var t,o,s;return a.jsx(T,{name:"approvalLevel",variant:v.SECONDARY,onChange:r=>{var m;const d={...e};d.approvalLevel.uid=r.target.value,(m=n.current)==null||m.reportDataChange(d)},value:(t=e.approvalLevel)==null?void 0:t.uid,onBlur:ft,validation:(s=c==null?void 0:c.current)==null?void 0:s.message("approvalLevel",(o=e.approvalLevel)==null?void 0:o.uid,"mandatory"),options:xt,optionLabel:"name",optionValue:"uid"})},{name:Xt,ruleApplied:$t,productName:At,displayName:se,deviationCategory:re,typeOfDeviation:ie,productScheme:St,description:Tt,reasons:ce}=l;return a.jsx(Ee,{children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex w-full justify-between  items-center",children:[a.jsx(_t,{title:tt()}),a.jsx("div",{className:"flex",children:p===u.CREATE||p===u.EDIT?a.jsxs("div",{className:"flex gap-10",children:[a.jsxs("div",{className:"flex gap-5",children:[a.jsx(C,{buttonType:y.CANCEL_OUTLINE,onClick:Xe}),a.jsx(C,{buttonType:y.SAVE_OUTLINE,onClickWithLoader:Ke})]}),a.jsx("div",{children:a.jsx(C,{className:"approve-primary",buttonType:y.SEND_FOR_APPROVAL,onClickWithLoader:$e})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mr-5",children:a.jsx(C,{buttonType:y.BACK_OUTLINE,onClick:Qe})}),a.jsx("div",{className:"",children:a.jsx(C,{buttonType:y.EDIT_OUTLINE,className:"blue-primary",onClick:ze})})]})})]}),a.jsxs(Ee,{override:{read:[u.VIEW,u.REVIEW].includes(p)},children:[a.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[a.jsx("div",{className:"col-span-4  md:col-span-1",children:a.jsx(T,{label:"input.productConfiguration.deviation.categoryWithoutStar",name:"deviationCategory",variant:v.SECONDARY,options:Be,onChange:x,value:re,optionLabel:"name",optionValue:"uid",disabled:p===u.VIEW,onBlur:U,validation:(le=c==null?void 0:c.current)==null?void 0:le.message("deviationCategory",re,"mandatory")})}),a.jsx("div",{className:"col-span-4  md:col-span-1",children:a.jsx(Mt,{label:"input.productConfiguration.deviation.name",name:"displayName",variant:v.SECONDARY,onChange:x,value:se,disabled:p===u.VIEW,onBlur:U,validation:(ue=c==null?void 0:c.current)==null?void 0:ue.message("displayName",se,"mandatory|max:50")})}),a.jsx("div",{className:"col-span-4  md:col-span-1",children:a.jsx(T,{label:"input.productConfiguration.deviation.typeOfDeviationWithStar",name:"typeOfDeviation",variant:v.SECONDARY,options:ee,onChange:x,value:ie,optionLabel:"name",optionValue:"uid",disabled:p!==u.CREATE,onBlur:U,validation:(de=c==null?void 0:c.current)==null?void 0:de.message("typeOfDeviation",ie,"mandatory")})}),a.jsx("div",{className:""}),a.jsxs("div",{className:"col-span-4 md:col-span-2 flex w-full gap-2 ",children:[a.jsx("div",{className:"w-1/2",children:a.jsx(T,{label:"input.productConfiguration.deviation.productName",name:"productName",variant:v.SECONDARY,options:De,onChange:x,value:At,optionLabel:"name",optionValue:"uid",disabled:p===u.VIEW})}),a.jsx("div",{children:a.jsx("div",{className:"flex  justify-center items-center h-full",children:"or"})}),a.jsx("div",{className:"w-1/2",children:a.jsx(T,{label:"input.productConfiguration.deviation.productScheme",name:"productScheme",options:Pe,variant:v.SECONDARY,onChange:x,value:St,optionLabel:"name",optionValue:"uid",disabled:p===u.VIEW})})]}),a.jsx("div",{className:"sm:hidden md:col-span-2 md:block"}),a.jsx("div",{className:"sm:hidden"}),a.jsx("div",{className:"col-span-8 sm:col-span-4 md:col-span-2",children:a.jsx(Te,{label:"input.productConfiguration.transaction.description",name:"description",variant:v.SECONDARY,maxCount:200,onChange:x,value:Tt,disabled:p===u.VIEW})}),a.jsx("div",{className:"col-span-8  sm:col-span-4 md:col-span-2",children:a.jsx(Te,{label:"input.productConfiguration.transaction.reasons",name:"reasons",variant:v.SECONDARY,maxCount:200,onChange:x,value:ce,onBlur:U,validation:(pe=c==null?void 0:c.current)==null?void 0:pe.message("reasons",ce,"mandatory"),disabled:p===u.VIEW})})]}),a.jsxs("div",{className:"mt-3 flex w-full justify-between",children:[a.jsx(Y,{label:"Approvals",className:"text-primary-ptext-1000 text-base font-Roboto font-bold flex"}),a.jsx(C,{buttonType:y.ICON_TEXT_ROW,onClick:Ze})]}),a.jsx("div",{className:"w-full ",children:a.jsxs(Ft,{uniqueKey:"uid",standardDataFormatPromise:Ne.getAllDeviationTable,ref:n,search:`&deviation.uid=${g}`,mode:p===u.CREATE?"CREATE":"UPDATE",children:[a.jsx(L,{className:"text-primary-ptext-1000 text-left text-xs w-1/4 p-1 h-12 pl-6",header:"Type of Deviation*",body:ht}),a.jsx(L,{className:"text-primary-ptext-1000 text-left text-xs w-1/3 pt-1 h-12 pl-6",header:"Rule",body:rt}),a.jsx(L,{className:"text-primary-ptext-1000 text-left text-xs w-1/4 p-1 h-12 pl-6",header:"Approval Levels*",body:Et}),a.jsx(L,{className:"text-primary-ptext-1000 text-left text-xs w-1/3 p-1 h-12 pl-6",header:"Active",body:ut}),a.jsx(L,{className:"text-primary-ptext-1000  text-right text-xs w-1/3 h-12 px-6",header:"Actions",style:{minWidth:"50px",width:"50px"},body:dt})]})})]}),a.jsx("div",{className:"",children:a.jsx(wt,{position:Le,ref:h,toastText:W,variant:z,onRemove:()=>{Me&&M.navigate(H)}})}),a.jsx(Bt,{className:"w-20 bg-white  font-Roboto text-xs text-primary-pText-1300 pt-2 rounded-lg mt-0.5 flex justify-center align-center shadow-autoCompletePanel",model:q,ref:_}),a.jsx(kt,{onHide:()=>Z(!1),visible:_e,errorMessage:B})]})})},Na=Nt(Kt);export{Na as default};
//# sourceMappingURL=PageDeviationCM-610d37d1.js.map
