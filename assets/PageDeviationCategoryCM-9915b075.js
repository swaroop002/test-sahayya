import{w as he,r,aF as c,aG as k,ad as Ce,ae as Te,af as Ee,y as ye,v as be,ao as b,j as a,J as u,o as x,T as Ne,b8 as je,aH as Se,b9 as _,az as Ae,aN as B}from"./index-e8217573.js";import{B as m}from"./ButtonBox-9e46519a.js";import{D as U}from"./DatePicker-b1c13861.js";import{E as Ie}from"./EditableTable-382c73da.js";import{I as Re}from"./InputBox-b9e88f52.js";import{I as w}from"./InputTextArea-b90aad1d.js";import{P as De}from"./PageTitle-b3bba3d4.js";import{S as Pe}from"./SimpleDropDown-061a3470.js";import{T as Oe}from"./Toast-ae99ea5b.js";import{C as N}from"./column.esm-938bad7d.js";import{O as Me}from"./Department-d5551750.js";import{P as f}from"./ProdcutDeviationCategory-d8b5e79a.js";import"./kebab-menu-8835ad2e.js";import"./withAuth-6de36ebf.js";import"./No_data-1720c54e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./virtualscroller.esm-9939945c.js";import"./TransitionGroup-c8afe0ce.js";const Ye=h=>{var Y,F;const[p,j]=r.useState({displayName:"",encrypted:"",description:"",reasons:"",isActive:""}),[d,S]=r.useState(c.CREATE),A={department:"",applicableFrom:"",applicableTo:"",isAdded:!0};r.useRef(!0);const i=r.useRef(null),[L,$]=r.useState([]),[Fe,C]=r.useState(""),W=r.useRef(null),[I,R]=r.useState(!1),[,g]=r.useState(void 0),[T,G]=r.useState(void 0),[K,X]=r.useState(""),[q,z]=r.useState(!1),[H,J]=r.useState(k.PRIMARY),[Q,V]=r.useState(!1),[D,Z]=r.useState([]),[P,ee]=r.useState([]);r.useState({limit:10,loading:!1,totalRecords:0,start:0,search:"",runCustomQuery:!1,records:[]});const o=r.useRef(new Ce({validators:{...Te()},...Ee(),autoForceUpdate:{forceUpdate:()=>g(e=>!e)}}));r.useEffect(()=>{const e=ye.parse(h.location.search);e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&S(e.mode),e!=null&&e.uid&&(e==null?void 0:e.uid)!==void 0&&(G(e.uid),f.getDeviationCategoryInfo(e.uid).then(t=>{var n,s,v;be(t)&&t.data.length!==0&&j({...p,displayName:((n=t==null?void 0:t.data)==null?void 0:n.name)??"",reasons:((s=t==null?void 0:t.data)==null?void 0:s.reason)??"",description:((v=t==null?void 0:t.data)==null?void 0:v.description)??""})}).catch(t=>{C(b(t))}))},[]),r.useEffect(()=>{var e,t;d===c.CREATE?(e=i==null?void 0:i.current)==null||e.addRecords(A):(t=i==null?void 0:i.current)==null||t.search()},[d]),r.useEffect(()=>{Me.getAll().then(e=>{e.status===200&&$(e.data.results)})},[]);const E=e=>{const{name:t,value:n}=e.target;j(s=>({...s,[t]:n}))},te=e=>{if(e!=null&&e.isInactive)return" !bg-primary-red-200";if(e!=null&&e.isAdded)return" !bg-primary-plum-200";if(e!=null&&e.isUpdated)return" !bg-semantic-yellow-200"},l=e=>{var t,n;(n=o==null?void 0:o.current)==null||n.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},ae=async()=>{var t,n;let e=!1;return e=((t=o==null?void 0:o.current)==null?void 0:t.allValid())&&!I,e||(g(s=>!s),(n=o==null?void 0:o.current)==null||n.showMessages(),g(s=>!s),!1)},ne=()=>{const e=[...P,...D],t={name:p.displayName,reason:p.reasons,description:p.description,approvalFunctions:e.map(n=>({uid:n.uid,department:{uid:n.department.uid?n.department.uid:n.department},applicableFrom:B(n.applicableFrom),applicableTo:B(n.applicableTo)}))};return d===c.EDIT&&(t.uid=T),t},se=()=>{var t,n;const e=(t=i==null?void 0:i.current)==null?void 0:t.getAddedRecords();if(ee(e),d===c.EDIT){const s=(n=i==null?void 0:i.current)==null?void 0:n.getUpdatedRecords();Z(s)}},oe=async()=>{var t;C("");let e=!1;if(e=await ae(),e){const n=ne();return d===c.CREATE?f.save(n).then(s=>{s.status===200&&(J(k.PRIMARY),X(Se.SAVED),V(!Q),z(!0))}).catch(s=>{console.log(s.response.data),C(b(s))}):f.update(T,n).then(s=>{console.log(s)}).catch(s=>{console.log(s)})}else return g(n=>!n),(t=o==null?void 0:o.current)==null||t.showMessages(),g(n=>!n),!1},re=()=>{h.navigate(_)},ie=()=>{console.log("this is onApproveClick")},ce=()=>{h.navigate(_)},de=()=>{S(c.EDIT)},le=()=>{var e;(e=i==null?void 0:i.current)==null||e.addRecords(A)},ue=()=>{switch(d){case c.CREATE:return"heading.productConfiguration.deviation.category.create";case c.VIEW:return"heading.productConfiguration.deviation.category.view";case c.EDIT:return"heading.productConfiguration.deviation.category.edit";default:return"heading.productConfiguration.deviation.category.create"}},y=(e,t,n)=>{var s;(s=i==null?void 0:i.current)==null||s.updateRecords(e,t,n),setTimeout(()=>{se()},2)},me=e=>{f.getAll(0,10,`name=${e.target.value}`).then(t=>{t.status===200&&(t.data.results.length>0?R(!0):R(!1))}).catch(t=>{C(b(t))})},pe=(e,t)=>{var n,s,v;return a.jsx(Pe,{variant:Ae.SECONDARY,options:L,optionLabel:"name",optionValue:"uid",onBlur:l,validation:(n=o==null?void 0:o.current)==null?void 0:n.message(`deviationTable-Bank-${t.rowIndex}`,e.department,"mandatory"),name:`deviationTable-Bank-${t.rowIndex}`,onChange:fe=>{y(t,fe.target.value,"department")},value:(s=e.department)!=null&&s.uid?(v=e.department)==null?void 0:v.uid:e.department})},ge=(e,t)=>{var n;return a.jsx(U,{value:new Date(e.applicableFrom),variant:x.SECONDARY,placeholder:"DD-MMM-YYYY",onChange:s=>{y(t,s.target.value,"applicableFrom")},onBlur:l,name:`deviationTable-applicableFrom-${t.rowIndex}`,validation:(n=o==null?void 0:o.current)==null?void 0:n.message(`deviationTable-applicableFrom-${t.rowIndex}`,e.applicableFrom,"mandatory")})},ve=(e,t)=>{var n;return a.jsx(U,{value:new Date(e.applicableTo),variant:x.SECONDARY,placeholder:"DD-MMM-YYYY",onChange:s=>{y(t,s.target.value,"applicableTo")},onBlur:l,name:`deviationTable-applicableTo-${t.rowIndex}`,validation:(n=o==null?void 0:o.current)==null?void 0:n.message(`deviationTable-applicableTo-${t.rowIndex}`,e.applicableTo,"mandatory")})},{displayName:O,description:xe,reasons:M}=p;return a.jsxs("div",{className:"h-full border mx-6",children:[a.jsxs("div",{className:"flex w-full justify-between pt-6 items-center",children:[a.jsx("div",{className:" h-7.5",children:a.jsx(De,{title:ue()})}),a.jsx("div",{className:"flex mr-5",children:d===c.CREATE||d===c.EDIT?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mr-5",children:a.jsx(m,{buttonType:u.CANCEL_OUTLINE,onClick:re})}),a.jsx("div",{className:"mr-10",children:a.jsx(m,{buttonType:u.SAVE_OUTLINE,onClick:oe})}),a.jsx("div",{children:a.jsx(m,{className:"approve-primary",buttonType:u.SEND_FOR_APPROVAL,onClick:ie})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mr-5",children:a.jsx(m,{buttonType:u.BACK_OUTLINE,onClick:ce})}),a.jsx("div",{className:"",children:a.jsx(m,{buttonType:u.EDIT_OUTLINE,className:"blue-primary",onClick:de})})]})})]}),a.jsx("div",{className:"grid grid-cols-4 gap-3 mt-3",children:a.jsx("div",{className:"col-span-1",children:a.jsx(Re,{label:"input.productConfiguration.deviation.category.name",name:"displayName",variant:x.SECONDARY,onChange:E,onBlur:e=>{me(e),l(e)},value:O,disabled:d===c.VIEW,validation:I?"Duplicate Entry Found":(Y=o==null?void 0:o.current)==null?void 0:Y.message("displayName",O,"mandatory")})})}),a.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[a.jsx("div",{className:"col-span-2",children:a.jsx(w,{label:"input.productConfiguration.deviation.category.description",name:"description",variant:x.SECONDARY,maxCount:200,onChange:E,value:xe,onBlur:l,disabled:d===c.VIEW})}),a.jsx("div",{className:"col-span-2",children:a.jsx(w,{label:"input.productConfiguration.deviation.category.reasons",name:"reasons",variant:x.SECONDARY,maxCount:200,onChange:E,value:M,onBlur:l,validation:(F=o==null?void 0:o.current)==null?void 0:F.message("reasons",M,"mandatory"),disabled:d===c.VIEW})})]}),a.jsxs("div",{className:"mt-3 flex w-full justify-between",children:[a.jsx(Ne,{label:"text.productConfiguration.approval",className:"text-primary-ptext-1000 text-base font-Roboto font-bold flex"}),a.jsx(m,{buttonType:u.ICON_TEXT_ROW,onClick:le})]}),a.jsx("div",{className:"",children:a.jsxs(Ie,{standardDataFormatPromise:f.getAllDeviationCategory,className:"border border-secondary-concrete px-0 overflow-x-auto mt-4 rounded-lg read-only-table !min-h-111 w-full",dataKey:"id",search:d==c.EDIT&&`deviationCategory.uid=${T}&`,hidePaginator:d==c.CREATE,ref:i,pageMode:d,updatedRecords:D,addedRecords:P,showStatusBar:d===c.EDIT,rowClassName:d==c.EDIT&&te,children:[a.jsx(N,{className:"text-primary-ptext-1000 text-left text-xs w-2/12 p-1 h-12 pl-6",header:"Department",body:pe}),a.jsx(N,{className:"text-primary-ptext-1000 text-left text-xs w-2/12 p-1 h-12 pl-6",header:"Applicable From *",body:ge}),a.jsx(N,{className:"text-primary-ptext-1000 text-left text-xs w-2/12 p-1 h-12 pl-6",header:"Application to *",body:ve})]})}),a.jsx("div",{className:"",children:a.jsx(Oe,{position:"bottom-right",ref:W,toastText:K,variant:H,onRemove:()=>{q&&h.navigate(je)}})})]})},tt=he(Ye);export{tt as default};
//# sourceMappingURL=PageDeviationCategoryCM-9915b075.js.map
