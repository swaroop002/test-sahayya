import{q as je,r as o,aF as x,aG as F,R as Ue,ad as N,ae as R,af as O,v as $,ao as C,j as i,ax as Ne,T as v,J as Re,d7 as Oe,aH as G,fj as H,d$ as A,o as b,er as j}from"./index-e8217573.js";import{A as k}from"./AutoComplete-0bca608a.js";import{B as Ce}from"./ButtonBox-9e46519a.js";import{D as Pe}from"./DeviationTable-bfb232d0.js";import{C as I}from"./EditableTableV2-6afcb42b.js";import{E as Se}from"./ErrorDialog-d5eef4d7.js";import{I as _e,B as Me}from"./IconButton-36693dd9.js";import{I as Le}from"./Info-6f3aa97c.js";import{I as q}from"./InputTextArea-b90aad1d.js";import{S as Ye}from"./SaveComponent-160c5b32.js";import{S as Fe}from"./Section-00ef9f2b.js";import{S as $e}from"./SimpleDropDown-061a3470.js";import{T as Be}from"./TextButton-41b4a67e.js";import{T as We}from"./Toast-ae99ea5b.js";import{S as Ve}from"./StaticMasterDataService-689a6eca.js";import{L as P}from"./LegalService-c6087928.js";import{l as z}from"./Helper-fa7c957e.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./kebab-menu-8835ad2e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./TransitionGroup-c8afe0ce.js";import"./Helper-03e9d878.js";import"./DocumentUploader-e2ec1a13.js";import"./DatePicker-b1c13861.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";import"./MediaGallery-5884b284.js";import"./index-8739acfd.js";import"./Skeleton-7e12d019.js";import"./FileUploadService-1aaf11f7.js";import"./InputBox-b9e88f52.js";import"./DocumentService-a293b5f4.js";const Ge={uid:"",loan:{uid:""},stage:{uid:""},deviation:{uid:""},actualDeviation:"",smDeviationType:j.TYPE_OF_DEVIATION_MANUAL,mitigation:"",isActive:!0,smDeviationCategory:""},He={showInfo:!0,dropdownOptions:{deviationType:[],deviationForAutomatic:[],deviationForManual:[]},stageUid:"",legalUid:"",tableObj:{search:""}},Lt=()=>{const p=je(),[n,g]=o.useState({...He}),[U,S]=o.useState(x.VIEW),[X,J]=o.useState([]),[ke,K]=o.useState("bottom-right"),[_,M]=o.useState(""),[L,B]=o.useState(!1),[qe,Q]=o.useState(F.PRIMARY),[Z,W]=o.useState(!1),[Y,T]=o.useState(""),r=Ue.useRef(null),h=o.useRef(null),[,f]=o.useState(!1),l=o.useRef(new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>f(e=>!e)}}));o.useEffect(()=>{g(e=>({...e,stageUid:(p==null?void 0:p.stageUid)??""})),w()},[]),o.useEffect(()=>{n!=null&&n.stageUid&&D()},[n==null?void 0:n.stageUid]),o.useEffect(()=>{n.legalUid&&g(e=>({...e,tableObj:{search:`?loanUid=${p.loanUid}&legalUid=${n.legalUid}&reEvalDeviations=false`}}))},[n==null?void 0:n.legalUid]),o.useEffect(()=>{var e;n.tableObj.search&&((e=r.current)==null||e.search())},[n.tableObj]),o.useEffect(()=>{var e;h!=null&&h.current&&_!==""&&((e=h==null?void 0:h.current)==null||e.showFunction(),M(""))},[_,L]),o.useEffect(()=>{Y&&W(!0)},[Y]);const D=()=>{P.getLegalDetails((n==null?void 0:n.stageUid)??"").then(e=>{$(e)&&g(t=>{var s,a,u;return{...t,legalUid:(u=(a=(s=e==null?void 0:e.data)==null?void 0:s.results)==null?void 0:a[0])==null?void 0:u.uid}})}).catch(e=>{console.log(e),T(C(e))})},w=()=>{Ve.getAll(0,1e3,"staticMasterType.code=TYPE_OF_DEVIATION&").then(e=>{var t;$(e)&&me("deviationType",(t=e==null?void 0:e.data)==null?void 0:t.results)}).catch(e=>{console.log(e),T(C(e))})},ee=(e,t)=>{var a;let s={...t};s={...s,smDeviationType:e.target.value},(a=r.current)==null||a.reportDataChange(s)},te=(e,t)=>{var a,u,m;const{value:s}=e.target;if(typeof s=="object"){let d={...t};d={...d,deviation:{...d.deviation,uid:((a=e.target.value)==null?void 0:a.uid)??"",name:((u=e.target.value)==null?void 0:u.name)??""}},(m=r.current)==null||m.reportDataChange(d)}},V=(e,t)=>{var a;let s={...t.rowData};s={...s,[`${t.field}`]:e.target.value},(a=r.current)==null||a.reportDataChange(s)},E=e=>{var t,s;(s=l==null?void 0:l.current)==null||s.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},ie=()=>{var t,s;let e=!1;return e=((t=l==null?void 0:l.current)==null?void 0:t.allValid())??!1,e||(f(a=>!a),(s=l==null?void 0:l.current)==null||s.showMessages(),f(a=>!a),!1)},se=()=>{g(e=>({...e,showInfo:!1}))},ne=()=>{var e;(e=r.current)==null||e.addRow({...Ge})},le=e=>{var t;(t=r.current)==null||t.deleteRow(e),l.current=new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>f(s=>!s)}})},ae=async()=>{var t,s;if(!ie())return;const e=ue();try{const a=await P.updateDeviations(e);Oe(a)&&(M(G.SAVED),B(!L),S(x.VIEW),(t=r.current)==null||t.clearAll(),(s=r.current)==null||s.search())}catch(a){console.log(a),T(C(a))}},oe=()=>S(x.EDIT),de=()=>{var e;S(x.VIEW),pe(),g(t=>({...t,tableObj:{search:`?loanUid=${p.loanUid}&legalUid=${n.legalUid}&reEvalDeviations=false`}})),(e=r.current)==null||e.clearAll()},re=async()=>{var e;try{l.current=new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>f(t=>!t)}}),g(t=>({...t,tableObj:{search:`?loanUid=${p.loanUid}&legalUid=${n.legalUid}&reEvalDeviations=true`}})),(e=r.current)==null||e.clearAll()}catch(t){console.log(t),T(C(t))}},ce=async(e,t)=>{var a,u;let s=[];try{const m=`&deviationCategory.name=${H.LEGAL_DEVIATIONS}&type.code=${j.TYPE_OF_DEVIATION_MANUAL}&name:lk=${e.query}`,d=await P.getDeviationNames(0,10,m);$(d)&&(s=(u=(a=d==null?void 0:d.data)==null?void 0:a.results)==null?void 0:u.map(c=>({name:c==null?void 0:c.name,uid:c==null?void 0:c.uid})))}catch{Q(F.QUATERNARY),K("top-right"),M(G.ERROR),B(!L)}s.length===0&&s.push({name:"",uid:""}),J(s)},ue=()=>{var m,d,c;const e={loanUid:(p==null?void 0:p.loanUid)??"",stageUid:(n==null?void 0:n.stageUid)??""};let t=((m=r.current)==null?void 0:m.getAddedRecords())??[],s=((d=r.current)==null?void 0:d.getDeletedRecords())??[],a=((c=r.current)==null?void 0:c.getUpdatedRecords())??[];return t=t.map(y=>({...y,loan:{uid:e==null?void 0:e.loanUid},stage:{uid:e==null?void 0:e.stageUid},smDeviationCategory:H.LEGAL_DEVIATIONS})),s=s.map(y=>z(y)),a=a.map(y=>z(y)),[...t,...s,...a]},me=(e,t)=>{g(s=>({...s,dropdownOptions:{...s==null?void 0:s.dropdownOptions,[e]:t??[]}}))},pe=()=>{var e;l.current=new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>f(t=>!t)}}),(e=l==null?void 0:l.current)==null||e.hideMessages()},ve=e=>(e==null?void 0:e.name)===void 0?i.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:i.jsx(v,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):i.jsx("div",{className:"flex flex-col",children:i.jsx(v,{className:"text-primary-labelColor",label:e==null?void 0:e.name})}),ge=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:A.t("label.legal.deviationType*")})}),he=e=>{var t;return i.jsx("div",{className:"h-24",children:i.jsx($e,{placeholder:"placeholder.legal.deviationType",name:`typeOfDeviation${e==null?void 0:e.uid}`,value:e==null?void 0:e.smDeviationType,variant:b.PRIMARY,options:n.dropdownOptions.deviationType,optionLabel:"name",optionValue:"code",onChange:s=>ee(s,e),onBlur:E,validation:(t=l==null?void 0:l.current)==null?void 0:t.message(`typeOfDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.smDeviationType,"mandatory"),hideLabel:!0,disabled:!0})})},xe=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:A.t("label.legal.deviation*")})}),fe=e=>{var t,s,a,u,m,d;return i.jsx("div",{className:"h-24",children:(e==null?void 0:e.smDeviationType)===j.TYPE_OF_DEVIATION_MANUAL?i.jsx(k,{variant:b.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(t=e==null?void 0:e.deviation)==null?void 0:t.name,suggestions:X,completeMethod:c=>ce(c),onChange:c=>te(c,e),itemTemplate:ve,onBlur:E,validation:(a=l==null?void 0:l.current)==null?void 0:a.message(`deviation${e==null?void 0:e.uid}`,(s=e==null?void 0:e.deviation)==null?void 0:s.name,"mandatory"),hideLabel:!0}):i.jsx(i.Fragment,{children:(e==null?void 0:e.smDeviationType)===j.TYPE_OF_DEVIATION_AUTOMATIC?i.jsx(k,{variant:b.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(u=e==null?void 0:e.deviation)==null?void 0:u.name,onBlur:E,validation:(d=l==null?void 0:l.current)==null?void 0:d.message(`deviation${e==null?void 0:e.uid}`,(m=e==null?void 0:e.deviation)==null?void 0:m.name,"mandatory"),hideLabel:!0,disabled:!0}):null})})},Te=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:A.t("label.legal.actualDeviation*")})}),Ee=e=>{var t;return i.jsx("div",{className:"h-24",children:i.jsx(q,{name:`actualDeviation${e==null?void 0:e.uid}`,className:"!h-full",variant:b.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.actualDeviation,onChange:s=>V(s,{rowData:e,field:"actualDeviation"}),onBlur:E,validation:(t=l==null?void 0:l.current)==null?void 0:t.message(`actualDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.actualDeviation,"mandatory"),hideLabel:!0})})},ye=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:A.t("label.legal.mitigants*")})}),Ae=e=>{var t;return i.jsx("div",{className:"h-24",children:i.jsx(q,{name:`mitigates${e==null?void 0:e.uid}`,className:"!h-full",variant:b.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.mitigation,onChange:s=>V(s,{rowData:e,field:"mitigation"}),onBlur:E,validation:(t=l==null?void 0:l.current)==null?void 0:t.message(`mitigates${e==null?void 0:e.uid}`,e==null?void 0:e.mitigation,"mandatory"),hideLabel:!0})})},be=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:A.t("label.investmentInfo.table.colTitle.action")})}),Ie=e=>i.jsx("div",{className:"h-24",children:i.jsx(_e,{buttonType:Me.DELETE,onClick:()=>{le(e)},tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:U===x.VIEW||(e==null?void 0:e.smDeviationType)===j.TYPE_OF_DEVIATION_AUTOMATIC})});return i.jsxs("div",{className:"grid gap-5 mb-5",children:[n!=null&&n.showInfo?i.jsx(Le,{description:"description.legal.info",onClose:se}):null,i.jsx(Fe,{title:"label.legal.legalDeviation",children:i.jsx(Ye,{title:"",pageMode:U,onSave:ae,onCancel:de,onEdit:oe,children:i.jsxs(Ne,{override:{read:U===x.VIEW},children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("div",{className:"",children:i.jsx(v,{label:"label.legal.deviations",className:"text-primary-sideBarBgColor text-xs font-bold"})}),i.jsxs("div",{className:"flex",children:[i.jsx("div",{className:" mr-3 self-center",children:i.jsx(Be,{label:"Populate Auto Deviations",onClick:re,disabled:!(n!=null&&n.legalUid)})}),i.jsx("div",{className:" mr-3 self-center",children:i.jsx(Ce,{buttonType:Re.ICON_TEXT_ROW,customLabel:"Add",onClick:ne,disabled:U===x.VIEW})})]})]}),n.stageUid&&n.legalUid?i.jsxs(Pe,{ref:r,standardDataFormatPromise:P.getLegalDeviations,search:n.tableObj.search,uniqueKey:"uid",mode:"UPDATE",isIgnoreInitialLoad:!0,children:[i.jsx(I,{header:ge,className:"text-primary-ptext-1000 text-xs py-3 pl-6",style:{minWidth:"170px",width:"170px"},body:he}),i.jsx(I,{header:xe,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:fe}),i.jsx(I,{header:Te,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:Ee}),i.jsx(I,{header:ye,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:Ae}),i.jsx(I,{header:be,className:"text-primary-ptext-1000 text-center text-xs py-3 px-6",style:{minWidth:"50px",width:"50px"},body:Ie})]}):null]})})}),i.jsx(We,{position:"bottom-right",ref:h,toastText:_,variant:F.PRIMARY}),i.jsx(Se,{onHide:()=>{W(!1),T("")},visible:Z,errorMessage:Y})]})};export{Lt as default};
//# sourceMappingURL=PageDeviations-0f286afa.js.map
