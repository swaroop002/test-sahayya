import{q as Ce,r,aF as g,aG as $,R as Oe,ad as U,ae as C,af as O,v as L,ao as R,j as t,ax as Re,T as p,J as Se,d7 as _e,aH as X,fj as B,d$ as y,o as I,er as j}from"./index-e8217573.js";import{A as J}from"./AutoComplete-0bca608a.js";import{B as Pe}from"./ButtonBox-9e46519a.js";import{D as Me}from"./DeviationTable-bfb232d0.js";import{C as b}from"./EditableTableV2-6afcb42b.js";import{E as Ye}from"./ErrorDialog-d5eef4d7.js";import{I as Fe,B as $e}from"./IconButton-36693dd9.js";import{I as Le}from"./Info-6f3aa97c.js";import{I as K}from"./InputTextArea-b90aad1d.js";import{S as Be}from"./SaveComponent-160c5b32.js";import{S as He}from"./Section-00ef9f2b.js";import{S as Ve}from"./SimpleDropDown-061a3470.js";import{T as We}from"./TextButton-41b4a67e.js";import{T as ke}from"./Toast-ae99ea5b.js";import{S as Ge}from"./StaticMasterDataService-689a6eca.js";import{T as S}from"./TechnicalService-8f4efd87.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./kebab-menu-8835ad2e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./TransitionGroup-c8afe0ce.js";const qe={uid:"",loan:{uid:""},stage:{uid:""},deviation:{uid:""},actualDeviation:"",smDeviationType:j.TYPE_OF_DEVIATION_MANUAL,mitigation:"",isActive:!0,smDeviationCategory:""},ze={showInfo:!0,dropdownOptions:{deviationType:[],deviationForAutomatic:[],deviationForManual:[]},stageUid:"",technicalUid:"",tableObj:{search:""}},Ui=()=>{const v=Ce(),[N,_]=r.useState(g.VIEW),[s,x]=r.useState({...ze}),[Q,Z]=r.useState([]),[Xe,D]=r.useState("bottom-right"),[,f]=r.useState(!1),[P,M]=r.useState(""),[Y,H]=r.useState(!1),[Je,w]=r.useState($.PRIMARY),[F,E]=r.useState(""),[ee,V]=r.useState(!1),a=Oe.useRef(null),T=r.useRef(null),l=r.useRef(new U({validators:{...C()},...O(),autoForceUpdate:{forceUpdate:()=>f(e=>!e)}}));r.useEffect(()=>{x(e=>({...e,stageUid:(v==null?void 0:v.stageUid)??""})),te()},[]),r.useEffect(()=>{s!=null&&s.stageUid&&ie()},[s==null?void 0:s.stageUid]),r.useEffect(()=>{s.technicalUid&&x(e=>({...e,tableObj:{search:`?loanUid=${v.loanUid}&technicalUid=${s.technicalUid}&reEvalDeviations=false`}}))},[s==null?void 0:s.technicalUid]),r.useEffect(()=>{var e;s.tableObj.search&&((e=a==null?void 0:a.current)==null||e.search())},[s.tableObj]),r.useEffect(()=>{var e;T!=null&&T.current&&P!==""&&((e=T==null?void 0:T.current)==null||e.showFunction(),M(""))},[P,Y]),r.useEffect(()=>{F&&V(!0)},[F]);const ie=()=>{S.getTechnicalDetails((s==null?void 0:s.stageUid)??"").then(e=>{L(e)&&x(i=>{var n,c,d;return{...i,technicalUid:(d=(c=(n=e==null?void 0:e.data)==null?void 0:n.results)==null?void 0:c[0])==null?void 0:d.uid}})}).catch(e=>{console.log(e),E(R(e))})},te=()=>{Ge.getAll(0,1e3,"staticMasterType.code=TYPE_OF_DEVIATION").then(e=>{var i;L(e)&&pe("deviationType",(i=e==null?void 0:e.data)==null?void 0:i.results)}).catch(e=>{console.log(e),E(R(e))})},ne=(e,i)=>{var c;let n={...i};n={...n,smDeviationType:e.target.value},(c=a.current)==null||c.reportDataChange(n)},se=(e,i)=>{var c,d,h;const{value:n}=e.target;if(typeof n=="object"){let u={...i};u={...u,deviation:{...u.deviation,uid:((c=e.target.value)==null?void 0:c.uid)??"",name:((d=e.target.value)==null?void 0:d.name)??""}},(h=a.current)==null||h.reportDataChange(u)}},W=(e,i)=>{var c;let n={...i.rowData};n={...n,[`${i.field}`]:e.target.value},(c=a.current)==null||c.reportDataChange(n)},A=e=>{var i,n;(n=l==null?void 0:l.current)==null||n.showMessageFor((i=e==null?void 0:e.target)==null?void 0:i.name)},le=()=>{var i,n;let e=!1;return e=((i=l==null?void 0:l.current)==null?void 0:i.allValid())??!1,e||(f(c=>!c),(n=l==null?void 0:l.current)==null||n.showMessages(),f(c=>!c),!1)},oe=()=>{x(e=>({...e,showInfo:!1}))},ce=()=>{var e;(e=a.current)==null||e.addRow({...qe})},ae=e=>{var i;(i=a.current)==null||i.deleteRow(e),l.current=new U({validators:{...C()},...O(),autoForceUpdate:{forceUpdate:()=>f(n=>!n)}})},re=async()=>{var i,n;if(!le())return;const e=he();try{const c=await S.updateDeviations(e);_e(c)&&(M(X.SAVED),H(!Y),_(g.VIEW),(i=a.current)==null||i.clearAll(),(n=a.current)==null||n.search())}catch(c){E(R(c))}},de=()=>_(g.EDIT),ue=()=>{var e;_(g.VIEW),xe(),x(i=>({...i,tableObj:{search:`?loanUid=${v.loanUid}&technicalUid=${s.technicalUid}&reEvalDeviations=false`}})),(e=a==null?void 0:a.current)==null||e.clearAll()},me=async()=>{var e;l.current=new U({validators:{...C()},...O(),autoForceUpdate:{forceUpdate:()=>f(i=>!i)}});try{x(i=>({...i,tableObj:{search:`?loanUid=${v.loanUid}&technicalUid=${s.technicalUid}&reEvalDeviations=true`}})),(e=a.current)==null||e.clearAll()}catch(i){E(R(i))}},ve=async(e,i)=>{var c,d;let n=[];try{const h=`&deviationCategory.name=${B.TECHNICAL_DEVIATIONS}&type.code=${j.TYPE_OF_DEVIATION_MANUAL}&name:lk=${e.query}`,u=await S.getDeviationNames(0,10,h);L(u)&&(n=(d=(c=u==null?void 0:u.data)==null?void 0:c.results)==null?void 0:d.map(m=>({name:m==null?void 0:m.name,uid:m==null?void 0:m.uid})))}catch{w($.QUATERNARY),D("top-right"),M(X.ERROR),H(!Y)}n.length===0&&n.push({name:"",uid:""}),Z(n)},he=()=>{var u,m,k;const e={loanUid:(v==null?void 0:v.loanUid)??"",stageUid:s==null?void 0:s.stageUid},i=o=>{var G,q,z;return{uid:o==null?void 0:o.uid,loan:{uid:(G=o==null?void 0:o.loan)==null?void 0:G.uid},stage:{uid:(q=o==null?void 0:o.stage)==null?void 0:q.uid},actualDeviation:o==null?void 0:o.actualDeviation,deviation:{uid:(z=o==null?void 0:o.deviation)==null?void 0:z.uid},smDeviationType:o==null?void 0:o.smDeviationType,mitigation:o==null?void 0:o.mitigation,isActive:o==null?void 0:o.isActive,smDeviationCategory:B.TECHNICAL_DEVIATIONS}};let n=((u=a.current)==null?void 0:u.getAddedRecords())??[],c=((m=a.current)==null?void 0:m.getDeletedRecords())??[],d=((k=a.current)==null?void 0:k.getUpdatedRecords())??[];return n=n.map(o=>({...o,loan:{uid:e==null?void 0:e.loanUid},stage:{uid:e==null?void 0:e.stageUid},smDeviationCategory:B.TECHNICAL_DEVIATIONS})),c=c.map(o=>i(o)),d=d.map(o=>i(o)),[...n,...c,...d]},pe=(e,i)=>{x(n=>({...n,dropdownOptions:{...n==null?void 0:n.dropdownOptions,[e]:i??[]}}))},xe=()=>{var e;l.current=new U({validators:{...C()},...O(),autoForceUpdate:{forceUpdate:()=>f(i=>!i)}}),(e=l==null?void 0:l.current)==null||e.hideMessages()},Te=e=>(e==null?void 0:e.name)===void 0?t.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:t.jsx(p,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):t.jsx("div",{className:"flex flex-col",children:t.jsx(p,{className:"text-primary-labelColor",label:e==null?void 0:e.name})}),ge=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(p,{label:y.t("label.legal.deviationType*")})}),fe=e=>{var i;return t.jsx("div",{className:"h-24",children:t.jsx(Ve,{placeholder:"placeholder.legal.deviationType",name:`typeOfDeviation${e==null?void 0:e.uid}`,value:e==null?void 0:e.smDeviationType,variant:I.PRIMARY,options:s.dropdownOptions.deviationType,optionLabel:"name",optionValue:"code",onChange:n=>ne(n,e),onBlur:A,validation:(i=l==null?void 0:l.current)==null?void 0:i.message(`typeOfDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.smDeviationType,"mandatory"),hideLabel:!0,disabled:!0})})},Ee=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(p,{label:y.t("label.legal.deviation*")})}),Ae=e=>{var i,n,c,d,h,u;return t.jsx("div",{className:"h-24",children:(e==null?void 0:e.smDeviationType)===j.TYPE_OF_DEVIATION_MANUAL?t.jsx(J,{variant:I.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(i=e==null?void 0:e.deviation)==null?void 0:i.name,suggestions:Q,completeMethod:m=>ve(m),onChange:m=>se(m,e),itemTemplate:Te,onBlur:A,validation:(c=l==null?void 0:l.current)==null?void 0:c.message(`deviation${e==null?void 0:e.uid}`,(n=e==null?void 0:e.deviation)==null?void 0:n.name,"mandatory"),hideLabel:!0}):t.jsx(t.Fragment,{children:(e==null?void 0:e.smDeviationType)===j.TYPE_OF_DEVIATION_AUTOMATIC?t.jsx(J,{variant:I.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(d=e==null?void 0:e.deviation)==null?void 0:d.name,onBlur:A,validation:(u=l==null?void 0:l.current)==null?void 0:u.message(`deviation${e==null?void 0:e.uid}`,(h=e==null?void 0:e.deviation)==null?void 0:h.name,"mandatory"),hideLabel:!0,disabled:!0}):null})})},ye=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(p,{label:y.t("label.legal.actualDeviation*")})}),Ie=e=>{var i;return t.jsx("div",{className:"h-24",children:t.jsx(K,{name:`actualDeviation${e==null?void 0:e.uid}`,className:"!h-full",variant:I.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.actualDeviation,onChange:n=>W(n,{rowData:e,field:"actualDeviation"}),onBlur:A,validation:(i=l==null?void 0:l.current)==null?void 0:i.message(`actualDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.actualDeviation,"mandatory"),hideLabel:!0})})},be=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(p,{label:y.t("label.legal.mitigants*")})}),je=e=>{var i;return t.jsx("div",{className:"h-24",children:t.jsx(K,{name:`mitigates${e==null?void 0:e.uid}`,className:"!h-full",variant:I.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.mitigation,onChange:n=>W(n,{rowData:e,field:"mitigation"}),onBlur:A,validation:(i=l==null?void 0:l.current)==null?void 0:i.message(`mitigates${e==null?void 0:e.uid}`,e==null?void 0:e.mitigation,"mandatory"),hideLabel:!0})})},Ne=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(p,{label:y.t("label.investmentInfo.table.colTitle.action")})}),Ue=e=>t.jsx("div",{className:"h-24",children:t.jsx(Fe,{buttonType:$e.DELETE,onClick:()=>ae(e),tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:N===g.VIEW||(e==null?void 0:e.smDeviationType)===j.TYPE_OF_DEVIATION_AUTOMATIC})});return t.jsxs("div",{className:"grid gap-5 mb-5",children:[s!=null&&s.showInfo?t.jsx(Le,{description:"description.legal.info",onClose:oe}):null,t.jsx(He,{title:"heading.technical.technicalDeviations",children:t.jsx(Be,{title:"",pageMode:N,onSave:re,onCancel:ue,onEdit:de,children:t.jsxs(Re,{override:{read:N===g.VIEW},children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("div",{className:"",children:t.jsx(p,{label:"label.legal.deviations",className:"text-primary-sideBarBgColor text-xs font-bold"})}),t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:" mr-3 self-center",children:t.jsx(We,{label:"Populate Auto Deviations",onClick:me,disabled:!(s!=null&&s.technicalUid)})}),t.jsx("div",{className:" mr-3 self-center",children:t.jsx(Pe,{buttonType:Se.ICON_TEXT_ROW,customLabel:"Add",onClick:ce,disabled:N===g.VIEW})})]})]}),s.stageUid&&s.technicalUid?t.jsxs(Me,{ref:a,standardDataFormatPromise:S.getTechnicalDeviations,search:s.tableObj.search,uniqueKey:"uid",mode:"UPDATE",isIgnoreInitialLoad:!0,children:[t.jsx(b,{header:ge,className:"text-primary-ptext-1000 text-xs py-3 pl-6",style:{minWidth:"170px",width:"170px"},body:fe}),t.jsx(b,{header:Ee,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:Ae}),t.jsx(b,{header:ye,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:Ie}),t.jsx(b,{header:be,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:je}),t.jsx(b,{header:Ne,className:"text-primary-ptext-1000 text-center text-xs py-3 px-6 action-content",body:Ue})]}):null]})})}),t.jsx(ke,{position:"bottom-right",ref:T,toastText:P,variant:$.PRIMARY}),t.jsx(Ye,{onHide:()=>{V(!1),E("")},visible:ee,errorMessage:F})]})};export{Ui as default};
//# sourceMappingURL=PageDeviations-9cfa6520.js.map
