import{q as Ie,r as o,aF as f,aG as $,R as Ue,ad as N,ae as R,af as O,v as B,ao as C,j as i,ax as Ne,T as v,J as Re,d7 as Oe,aH as H,fj as k,d$ as E,o as A,er as I}from"./index-e8217573.js";import{A as G}from"./AutoComplete-0bca608a.js";import{B as Ce}from"./ButtonBox-9e46519a.js";import{D as Pe}from"./DeviationTable-bfb232d0.js";import{C as j}from"./EditableTableV2-6afcb42b.js";import{E as Se}from"./ErrorDialog-d5eef4d7.js";import{I as _e,B as Me}from"./IconButton-36693dd9.js";import{I as Ye}from"./Info-6f3aa97c.js";import{I as q}from"./InputTextArea-b90aad1d.js";import{S as Fe}from"./SaveComponent-160c5b32.js";import{S as $e}from"./Section-00ef9f2b.js";import{S as Be}from"./SimpleDropDown-061a3470.js";import{T as Le}from"./TextButton-41b4a67e.js";import{T as We}from"./Toast-ae99ea5b.js";import{S as Ve}from"./StaticMasterDataService-689a6eca.js";import{R as P}from"./RcuService-53ccbee9.js";import{g as z}from"./Helper-06cc777c.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./kebab-menu-8835ad2e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./link-0172a3d4.js";import"./loader-5f2cfb31.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./TransitionGroup-c8afe0ce.js";import"./RichTextEditor-a03bd2fb.js";import"./index-8739acfd.js";import"./Skeleton-7e12d019.js";const He={uid:"",loan:{uid:""},stage:{uid:""},deviation:{uid:""},actualDeviation:"",smDeviationType:I.TYPE_OF_DEVIATION_MANUAL,mitigation:"",isActive:!0,smDeviationCategory:""},ke={showInfo:!0,dropdownOptions:{deviationType:[],deviationForAutomatic:[],deviationForManual:[]},stageUid:"",rcuUid:"",tableObj:{search:""}},Nt=()=>{const p=Ie(),[l,h]=o.useState({...ke}),[U,S]=o.useState(f.VIEW),[X,J]=o.useState([]),[Ge,K]=o.useState("bottom-right"),[_,M]=o.useState(""),[Y,L]=o.useState(!1),[qe,Q]=o.useState($.PRIMARY),[Z,W]=o.useState(!1),[F,T]=o.useState(""),c=Ue.useRef(null),x=o.useRef(null),[,g]=o.useState(!1),n=o.useRef(new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>g(e=>!e)}}));o.useEffect(()=>{h(e=>({...e,stageUid:(p==null?void 0:p.stageUid)??""})),w()},[]),o.useEffect(()=>{l.stageUid&&D()},[l.stageUid]),o.useEffect(()=>{l.rcuUid&&h(e=>({...e,tableObj:{search:`?loanUid=${p.loanUid}&rcuUid=${l.rcuUid}&reEvalDeviations=false`}}))},[l.rcuUid]),o.useEffect(()=>{var e;l.tableObj.search&&((e=c.current)==null||e.search())},[l.tableObj]),o.useEffect(()=>{var e;x!=null&&x.current&&_!==""&&((e=x==null?void 0:x.current)==null||e.showFunction(),M(""))},[_,Y]),o.useEffect(()=>{F&&W(!0)},[F]);const D=()=>{P.getRcuDetails((l==null?void 0:l.stageUid)??"").then(e=>{B(e)&&h(t=>{var s,a,u;return{...t,rcuUid:(u=(a=(s=e==null?void 0:e.data)==null?void 0:s.results)==null?void 0:a[0])==null?void 0:u.uid}})}).catch(e=>{console.log(e),T(C(e))})},w=()=>{Ve.getAll(0,1e3,"staticMasterType.code=TYPE_OF_DEVIATION&").then(e=>{var t;B(e)&&me("deviationType",(t=e==null?void 0:e.data)==null?void 0:t.results)}).catch(e=>{console.log(e),T(C(e))})},ee=(e,t)=>{var a;let s={...t};s={...s,smDeviationType:e.target.value},(a=c.current)==null||a.reportDataChange(s)},te=(e,t)=>{var a,u,m;const{value:s}=e.target;if(typeof s=="object"){let r={...t};r={...r,deviation:{...r.deviation,uid:((a=e.target.value)==null?void 0:a.uid)??"",name:((u=e.target.value)==null?void 0:u.name)??""}},(m=c.current)==null||m.reportDataChange(r)}},V=(e,t)=>{var a;let s={...t.rowData};s={...s,[`${t.field}`]:e.target.value},(a=c.current)==null||a.reportDataChange(s)},b=e=>{var t,s;(s=n==null?void 0:n.current)==null||s.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},ie=()=>{var t,s;let e=!1;return e=((t=n==null?void 0:n.current)==null?void 0:t.allValid())??!1,e||(g(a=>!a),(s=n==null?void 0:n.current)==null||s.showMessages(),g(a=>!a),!1)},se=()=>{h(e=>({...e,showInfo:!1}))},ne=()=>{var e;(e=c.current)==null||e.addRow({...He})},ae=e=>{var t;(t=c.current)==null||t.deleteRow(e),n.current=new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>g(s=>!s)}})},le=async()=>{var t,s;if(!ie())return;const e=ue();try{const a=await P.updateDeviations(e);Oe(a)&&(M(H.SAVED),L(!Y),S(f.VIEW),(t=c.current)==null||t.clearAll(),(s=c.current)==null||s.search())}catch(a){console.log(a),T(C(a))}},oe=()=>S(f.EDIT),re=()=>{var e;S(f.VIEW),pe(),h(t=>({...t,tableObj:{search:`?loanUid=${p.loanUid}&rcuUid=${l.rcuUid}&reEvalDeviations=false`}})),(e=c.current)==null||e.clearAll()},ce=async()=>{var e;try{n.current=new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>g(t=>!t)}}),h(t=>({...t,tableObj:{search:`?loanUid=${p.loanUid}&rcuUid=${l.rcuUid}&reEvalDeviations=true`}})),(e=c.current)==null||e.clearAll()}catch(t){console.log(t),T(C(t))}},de=async(e,t)=>{var a,u;let s=[];try{const m=`&deviationCategory.name=${k.RCU_DEVIATIONS}&type.code=${I.TYPE_OF_DEVIATION_MANUAL}&name:lk=${e.query}`,r=await P.getDeviationNames(0,10,m);B(r)&&(s=(u=(a=r==null?void 0:r.data)==null?void 0:a.results)==null?void 0:u.map(d=>({name:d==null?void 0:d.name,uid:d==null?void 0:d.uid})))}catch{Q($.QUATERNARY),K("top-right"),M(H.ERROR),L(!Y)}s.length===0&&s.push({name:"",uid:""}),J(s)},ue=()=>{var m,r,d;const e={loanUid:(p==null?void 0:p.loanUid)??"",stageUid:(l==null?void 0:l.stageUid)??""};let t=((m=c.current)==null?void 0:m.getAddedRecords())??[],s=((r=c.current)==null?void 0:r.getDeletedRecords())??[],a=((d=c.current)==null?void 0:d.getUpdatedRecords())??[];return t=t.map(y=>({...y,loan:{uid:e==null?void 0:e.loanUid},stage:{uid:e==null?void 0:e.stageUid},smDeviationCategory:k.RCU_DEVIATIONS})),s=s.map(y=>z(y)),a=a.map(y=>z(y)),[...t,...s,...a]},me=(e,t)=>{h(s=>({...s,dropdownOptions:{...s==null?void 0:s.dropdownOptions,[e]:t??[]}}))},pe=()=>{var e;n.current=new N({validators:{...R()},...O(),autoForceUpdate:{forceUpdate:()=>g(t=>!t)}}),(e=n==null?void 0:n.current)==null||e.hideMessages()},ve=e=>(e==null?void 0:e.name)===void 0?i.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:i.jsx(v,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):i.jsx("div",{className:"flex flex-col",children:i.jsx(v,{className:"text-primary-labelColor",label:e==null?void 0:e.name})}),he=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:E.t("label.legal.deviationType*")})}),xe=e=>{var t;return i.jsx("div",{className:"h-24",children:i.jsx(Be,{placeholder:"placeholder.legal.deviationType",name:`typeOfDeviation${e==null?void 0:e.uid}`,value:e==null?void 0:e.smDeviationType,variant:A.PRIMARY,options:l.dropdownOptions.deviationType,optionLabel:"name",optionValue:"code",onChange:s=>ee(s,e),onBlur:b,validation:(t=n==null?void 0:n.current)==null?void 0:t.message(`typeOfDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.smDeviationType,"mandatory"),hideLabel:!0,disabled:!0})})},fe=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:E.t("label.legal.deviation*")})}),ge=e=>{var t,s,a,u,m,r;return i.jsx("div",{className:"h-24",children:(e==null?void 0:e.smDeviationType)===I.TYPE_OF_DEVIATION_MANUAL?i.jsx(G,{variant:A.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(t=e==null?void 0:e.deviation)==null?void 0:t.name,suggestions:X,completeMethod:d=>de(d),onChange:d=>te(d,e),itemTemplate:ve,onBlur:b,validation:(a=n==null?void 0:n.current)==null?void 0:a.message(`deviation${e==null?void 0:e.uid}`,(s=e==null?void 0:e.deviation)==null?void 0:s.name,"mandatory"),hideLabel:!0}):i.jsx(i.Fragment,{children:(e==null?void 0:e.smDeviationType)===I.TYPE_OF_DEVIATION_AUTOMATIC?i.jsx(G,{variant:A.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(u=e==null?void 0:e.deviation)==null?void 0:u.name,onBlur:b,validation:(r=n==null?void 0:n.current)==null?void 0:r.message(`deviation${e==null?void 0:e.uid}`,(m=e==null?void 0:e.deviation)==null?void 0:m.name,"mandatory"),hideLabel:!0,disabled:!0}):null})})},Te=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:E.t("label.legal.actualDeviation*")})}),be=e=>{var t;return i.jsx("div",{className:"h-24",children:i.jsx(q,{name:`actualDeviation${e==null?void 0:e.uid}`,className:"!h-full",variant:A.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.actualDeviation,onChange:s=>V(s,{rowData:e,field:"actualDeviation"}),onBlur:b,validation:(t=n==null?void 0:n.current)==null?void 0:t.message(`actualDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.actualDeviation,"mandatory"),hideLabel:!0})})},ye=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:E.t("label.legal.mitigants*")})}),Ee=e=>{var t;return i.jsx("div",{className:"h-24",children:i.jsx(q,{name:`mitigates${e==null?void 0:e.uid}`,className:"!h-full",variant:A.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.mitigation,onChange:s=>V(s,{rowData:e,field:"mitigation"}),onBlur:b,validation:(t=n==null?void 0:n.current)==null?void 0:t.message(`mitigates${e==null?void 0:e.uid}`,e==null?void 0:e.mitigation,"mandatory"),hideLabel:!0})})},Ae=()=>i.jsx("div",{className:"flex items-center",children:i.jsx(v,{label:E.t("label.investmentInfo.table.colTitle.action")})}),je=e=>i.jsx("div",{className:"h-24",children:i.jsx(_e,{buttonType:Me.DELETE,onClick:()=>ae(e),tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:U===f.VIEW||(e==null?void 0:e.smDeviationType)===I.TYPE_OF_DEVIATION_AUTOMATIC})});return i.jsxs("div",{className:"grid gap-5 mb-5",children:[l!=null&&l.showInfo?i.jsx(Ye,{description:"description.legal.info",onClose:se}):null,i.jsx($e,{title:"label.rcu.rcuDeviations",children:i.jsx(Fe,{title:"",pageMode:U,onSave:le,onCancel:re,onEdit:oe,children:i.jsxs(Ne,{override:{read:U===f.VIEW},children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("div",{className:"",children:i.jsx(v,{label:"label.legal.deviations",className:"text-primary-sideBarBgColor text-xs font-bold"})}),i.jsxs("div",{className:"flex",children:[i.jsx("div",{className:" mr-3 self-center",children:i.jsx(Le,{label:"Populate Auto Deviations",onClick:ce,disabled:!(l!=null&&l.rcuUid)})}),i.jsx("div",{className:" mr-3 self-center",children:i.jsx(Ce,{buttonType:Re.ICON_TEXT_ROW,customLabel:"Add",onClick:ne,disabled:U===f.VIEW})})]})]}),l.stageUid&&l.rcuUid?i.jsxs(Pe,{ref:c,standardDataFormatPromise:P.getRcuDeviations,search:l.tableObj.search,uniqueKey:"uid",mode:"UPDATE",isIgnoreInitialLoad:!0,children:[i.jsx(j,{header:he,className:"text-primary-ptext-1000 text-left text-xs py-3 pl-6",style:{minWidth:"170px",width:"170px"},body:xe}),i.jsx(j,{header:fe,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:ge}),i.jsx(j,{header:Te,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:be}),i.jsx(j,{header:ye,className:"table-header-right text-primary-ptext-1000 text-xs py-3 pl-6",body:Ee}),i.jsx(j,{header:Ae,className:"text-primary-ptext-1000 text-center text-xs py-3 px-6",style:{minWidth:"50px",width:"50px"},body:je})]}):null]})})}),i.jsx(We,{position:"bottom-right",ref:x,toastText:_,variant:$.PRIMARY}),i.jsx(Se,{onHide:()=>{W(!1),T("")},visible:Z,errorMessage:F})]})};export{Nt as default};
//# sourceMappingURL=PageDeviations-b4726533.js.map
