import{q as K,r as f,j as t,cn as X,d3 as U,ao as C,c8 as O,dc as A,f as W,J as q}from"./index-e8217573.js";import{B as J}from"./ButtonBox-9e46519a.js";import{C as a}from"./EditableTableV2-6afcb42b.js";import{E as V}from"./ErrorDialog-d5eef4d7.js";import{F as w}from"./FileUploadBox-d8087723.js";import{I as z}from"./IconButton-36693dd9.js";import{I as Q}from"./Info-6f3aa97c.js";import{M as Z}from"./MenuBox-defc36b0.js";import{R as D}from"./ReadOnlyTable-86accb69.js";import{S as ee}from"./Section-00ef9f2b.js";import{F as M}from"./FileUploadService-1aaf11f7.js";import{T}from"./TechnicalService-8f4efd87.js";import"./kebab-menu-8835ad2e.js";import"./SimpleDropDown-061a3470.js";import"./virtualscroller.esm-9939945c.js";import"./withAuth-6de36ebf.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";import"./SimpleToolTip-3cfbb0c5.js";import"./TransitionGroup-c8afe0ce.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./No_data-1720c54e.js";const te={showInfo:!0,stageUid:""},Oe=()=>{const c=K(),[i,S]=f.useState({...te}),[b,E]=f.useState(""),[_,j]=f.useState(!1),y=f.useRef(null),N=f.useRef(null),g=[{items:[]}];f.useEffect(()=>{S(e=>({...e,stageUid:(c==null?void 0:c.stageUid)??""}))},[]),f.useEffect(()=>{b&&j(!0)},[b]);const R=()=>{S(e=>({...e,showInfo:!1}))},I=async e=>{var o;console.log("delete row data");try{const r=P(e);await T.updateDocumentExchange(r),(o=y.current)==null||o.search()}catch(r){console.log(r),E(C(r))}},v=async e=>{var u,d;const o=e.files[0],r=new Date().getTime(),l=Math.random().toString(36).substring(2,8),s=(u=o==null?void 0:o.name)==null?void 0:u.split(".");let m="";if((s==null?void 0:s.length)>1){for(let n=0;n<s.length-1&&n!==s.length-1;n++)m+=s[n];const p=`${m}_${r}_${l}.${s[s.length-1]}`;try{const n=await M.saveFile(o,p),x=L(n.data);await T.updateDocumentExchange(x),(d=y.current)==null||d.search()}catch(n){console.log(n),E(C(n))}}},F=async e=>{var l,s,m,u,d;const o=(s=(l=e==null?void 0:e.documentSections)==null?void 0:l[0])==null?void 0:s.url,r=(u=(m=e==null?void 0:e.documentSections)==null?void 0:m[0])==null?void 0:u.fileName;try{const p=await M.getSignedURL(o);fetch((d=p.data)==null?void 0:d.SignedUrl).then(n=>{if(!n.ok)throw new Error("Network response was not ok: "+n.status);return n.blob()}).then(n=>{const x=URL.createObjectURL(n),h=document.createElement("a");h.href=x,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(x)}).catch(n=>{console.error("Error fetching the file:",n)})}catch(p){E(C(p))}},k=(e,o)=>{var s;const r=[];r.push({label:"Remove",className:"px-1.5 text-xs text-primary-labelColor h-6.5 hover:bg-primary-sapphireBlue-100",command:()=>{I(o)}});const l=[...r];g[0].items=[...l],(s=N==null?void 0:N.current)==null||s.show(e)},L=e=>({docType:{uid:"a1f9c167-ecbb-461d-9b47-7b1efebc6a19"},loanSectionKey:U.DOCUMENT_EXCHANGE,docCategory:O.DOCUMENT_CATEGORY_EXCHANGE_DOCUMENTS,stage:{uid:i.stageUid},loan:{uid:c==null?void 0:c.loanUid},documentSections:[{section:A.DOCUMENT_SECTIONS_FILE_1,fileName:e==null?void 0:e.fileName,fileType:e==null?void 0:e.contentType,thumbUrl:e==null?void 0:e.thumbUrl,url:e==null?void 0:e.url}]}),P=e=>{var r,l,s,m,u,d,p,n,x,h;return{uid:e==null?void 0:e.uid,docType:{uid:"a1f9c167-ecbb-461d-9b47-7b1efebc6a19"},loanSectionKey:U.DOCUMENT_EXCHANGE,docCategory:O.DOCUMENT_CATEGORY_EXCHANGE_DOCUMENTS,stage:{uid:i.stageUid},loan:{uid:c==null?void 0:c.loanUid},documentSections:[{uid:(l=(r=e==null?void 0:e.documentSections)==null?void 0:r[0])==null?void 0:l.uid,section:A.DOCUMENT_SECTIONS_FILE_1,fileName:(m=(s=e==null?void 0:e.documentSections)==null?void 0:s[0])==null?void 0:m.fileName,fileType:(d=(u=e==null?void 0:e.documentSections)==null?void 0:u[0])==null?void 0:d.fileType,thumbUrl:(n=(p=e==null?void 0:e.documentSections)==null?void 0:p[0])==null?void 0:n.thumbUrl,url:(h=(x=e==null?void 0:e.documentSections)==null?void 0:x[0])==null?void 0:h.url,isActive:!1}],isActive:!1}},B=e=>t.jsx("span",{children:(e==null?void 0:e.createdByUserName)??""}),G=e=>{var o;return t.jsx("span",{children:(o=e==null?void 0:e.documentSections)==null?void 0:o[0].fileName})},Y=e=>{var o;return t.jsx("span",{children:((o=e==null?void 0:e.documentSections)==null?void 0:o[0].fileType)??""})},$=e=>t.jsx("span",{children:W(e==null?void 0:e.updatedAt)??""}),H=e=>t.jsxs("div",{className:"flex gap-2 justify-center items-center",children:[t.jsx(z,{onClick:()=>F(e),buttonType:"DOWNLOAD",tooltipOptions:{position:"top",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}}),t.jsx("div",{className:"",children:t.jsx(J,{buttonType:q.MENU,onClick:o=>k(o,e)})})]});return t.jsxs("div",{className:"grid gap-5 mb-5",children:[i!=null&&i.showInfo?t.jsx(Q,{description:"description.legal.info",onClose:R}):null,t.jsx(ee,{title:"heading.technical.TechnicalDocumentExchange",children:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex justify-end",children:t.jsx("div",{className:" mr-3 self-center",children:t.jsx(w,{label:"Add",onSelect:v,variant:X.PRIMARY})})}),c!=null&&c.loanUid&&(i!=null&&i.stageUid)?t.jsxs(D,{ref:y,standardDataFormatPromise:T.getDocumentExchangeList,search:`&loanUid=${c.loanUid}&stageUid=${i.stageUid}&loanSectionKey=${U.DOCUMENT_EXCHANGE}&isActive=true`,dataKey:"uid",children:[t.jsx(a,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:"User",body:B}),t.jsx(a,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:"File Name",body:G}),t.jsx(a,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:"File Type",body:Y}),t.jsx(a,{className:"text-primary-ptext-1000 text-left text-xs p-1 h-12 pl-6",header:"Updated On",body:$}),t.jsx(a,{className:"text-primary-ptext-1000 text-center text-xs p-1 h-12 px-6 action-content",header:"Actions",body:H})]}):null]})}),t.jsx(Z,{ref:N,model:g,variant:"SECONDARY",buttonClassName:"!bg-transparent",className:"width-full-menubox bg-white  w-max p-1.5 rounded-md mt-0.5 border shadow-autoCompletePanel"}),t.jsx(V,{onHide:()=>{j(!1),E("")},visible:_,errorMessage:b})]})};export{Oe as default};
//# sourceMappingURL=PageDocumentExchange-38d10a2a.js.map
