import{r as o,aF as I,ad as ye,ae as be,af as Te,j as e,T as xe,ax as ve,c8 as fn,aG as pe,q as Be,aH as Ie,ao as te,R as $e,et as xn,o as X,ep as An,dU as En,fm as cn,O as pn,d$ as $,fn as gn,b3 as rn,J as yn,b2 as dn,cj as kn,ff as Oe,fo as Cn}from"./index-e8217573.js";import{B as bn}from"./ButtonBox-9e46519a.js";import{E as ke}from"./ErrorDialog-d5eef4d7.js";import{S as _e}from"./Section-00ef9f2b.js";import{S as Sn}from"./SimpleTab-27fa8860.js";import{S as Me}from"./Skeleton-7e12d019.js";import{T as Ce}from"./Toast-ae99ea5b.js";import{W as vn}from"./WarningDialog-77a1cb18.js";import{S as un}from"./StaticMasterDataService-689a6eca.js";import{C as se}from"./CamService-5ccef840.js";import{s as Xe,g as ge,o as Ae,p as Ge,q as He,r as mn,i as Bn,t as In,v as Mn,w as Un,x as Ln,y as Rn,b as Fn,z as _n}from"./Helper-54d1e873.js";import{D as Tn,a as Ke}from"./DocumentUploader-e2ec1a13.js";import{S as Re}from"./SaveComponent-160c5b32.js";import{p as Pn,a as Yn}from"./Helper-03e9d878.js";import{D as jn,B as $n,I as On,i as Hn}from"./DynamicColumnTable-7d520ba8.js";import{I as ce}from"./InputBox-b9e88f52.js";import{I as hn}from"./InputTextArea-b90aad1d.js";import{S as Ee}from"./SimpleDropDown-061a3470.js";import{S as We}from"./SystemDatePicker-abe08a29.js";import{C as O,E as Wn}from"./EditableTableV2-6afcb42b.js";import{R as qn}from"./ReadOnlyTable-86accb69.js";import{I as Xn,B as Gn}from"./IconButton-36693dd9.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./FileUploadMenuBox-f47dc693.js";import"./MenuBox-defc36b0.js";import"./TransitionGroup-c8afe0ce.js";import"./loader-5f2cfb31.js";import"./AutoComplete-0bca608a.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./DatePicker-b1c13861.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";import"./MediaGallery-5884b284.js";import"./Download_Icon-51fc7f46.js";import"./index-8739acfd.js";import"./FileUploadService-1aaf11f7.js";import"./DocumentService-a293b5f4.js";import"./link-0172a3d4.js";import"./RichTextEditor-a03bd2fb.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./No_data-1720c54e.js";import"./sortIcon-54357a29.js";import"./eye_icon-081bddb3.js";const Pe={savedDocuments:[]},Kn=o.forwardRef((p,ne)=>{var G,P;const{data:u,isLoading:R}=p;o.useState({...Pe});const[v,s]=o.useState(I.VIEW),[m,f]=o.useState(""),[N,M]=o.useState(!1),[_,H]=o.useState(""),[Q,V]=o.useState(!1),W=o.useRef(null),z=o.useRef(null),[,D]=o.useState(!1);return o.useRef(new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>D(E=>!E)}})),o.useEffect(()=>{console.log("bank account statement",u)},[u]),o.useEffect(()=>{var E;W!=null&&W.current&&m!==""&&((E=W==null?void 0:W.current)==null||E.showFunction(),f(""))},[m,N]),o.useEffect(()=>{_&&V(!0)},[_]),e.jsxs("div",{children:[e.jsxs("div",{className:"border border-primary-ptext-500  rounded-xl p-5 flex flex-col gap-3",children:[e.jsx("div",{children:e.jsx(xe,{label:"label.cam.bankAccountStatement",className:"text-primary-sideBarBgColor text-sm font-bold mb-1"})}),R?e.jsx(Me,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(ve,{override:{read:v===I.VIEW},children:e.jsx("div",{className:" grid grid-cols-4 gap-3 ",children:e.jsx("div",{className:"col-span-4",children:e.jsx(Tn,{ref:z,savedDocument:(G=u==null?void 0:u.savedDocuments)!=null&&G[0]?(P=u.savedDocuments)==null?void 0:P[0]:{},mode:Ke.VIEW,queryParamForDocList:fn.DOCUMENT_CATEGORY_BANK_ACCOUNT_DOCUMENT})})})})]}),e.jsx(Ce,{position:"bottom-right",ref:W,toastText:m,variant:pe.PRIMARY}),e.jsx(ke,{onHide:()=>{V(!1),H("")},visible:Q,errorMessage:_})]})}),Ye={savedDocuments:[]},zn=o.forwardRef((p,ne)=>{var ue,C;const u=Be(),{data:R,isLoading:v,tab:s,getDetailsCallback:m}=p,[f,N]=o.useState({...Ye}),[M,_]=o.useState(I.VIEW),[H,Q]=o.useState(""),[V,W]=o.useState(!1),[z,D]=o.useState(""),[G,P]=o.useState(!1),E=o.useRef(null),K=o.useRef(null),[,k]=o.useState(!1);o.useRef(new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>k(g=>!g)}})),o.useImperativeHandle(ne,()=>({save:T,onCancel:y})),o.useEffect(()=>{N(g=>({...g,savedDocuments:R.savedDocuments}))},[R]),o.useEffect(()=>{var g;E!=null&&E.current&&H!==""&&((g=E==null?void 0:E.current)==null||g.showFunction(),Q(""))},[H,V]),o.useEffect(()=>{z&&P(!0)},[z]);const T=async()=>{var Y;const g=(Y=K.current)==null?void 0:Y.getUploadedData();if(!g)return;const U=he(g);try{await se.updateBankStatementAnalysis(U),Q(Ie.SAVED),W(!V),_(I.VIEW),m==null||m()}catch(F){D(te(F))}},L=()=>_(I.EDIT),y=()=>{var g;_(I.VIEW),m==null||m(),(g=K==null?void 0:K.current)==null||g.resetDocUpload()},he=g=>({loan:{uid:u==null?void 0:u.loanUid},stage:{uid:u==null?void 0:u.stageUid},bankingDetail:{uid:s==null?void 0:s.bankingDetailsUid},loanDocuments:g!=null&&g.documentUid?[{uid:g==null?void 0:g.uid,docType:{uid:g==null?void 0:g.documentUid},docNo:(g==null?void 0:g[`${g.primaryKeyAttributeName}`])??null,dob:g.dob?g.dob:null,docCategory:g==null?void 0:g.documentCategory,attributes:Pn(g),documentSections:Yn(g==null?void 0:g.documentSectionUrls)}]:[]});return e.jsxs("div",{children:[e.jsx(Re,{title:"label.cam.bankStatementAnalysis",pageMode:M,onSave:T,onCancel:y,onEdit:L,children:v?e.jsx(Me,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(ve,{override:{read:M===I.VIEW},children:e.jsx("div",{className:" grid grid-cols-4 gap-3 ",children:e.jsx("div",{className:"col-span-4",children:e.jsx(Tn,{ref:K,savedDocument:(ue=f.savedDocuments)!=null&&ue[0]?(C=f.savedDocuments)==null?void 0:C[0]:{},mode:M===I.VIEW?Ke.VIEW:Ke.EDIT,queryParamForDocList:fn.DOCUMENT_CATEGORY_BANK_STATEMENTS_ANALYSIS})})})})}),e.jsx(Ce,{position:"bottom-right",ref:E,toastText:H,variant:pe.PRIMARY}),e.jsx(ke,{onHide:()=>{P(!1),D("")},visible:G,errorMessage:z})]})}),Le={applicantType:"",customer:"",bankFinancier:"",accountNumber:"",accountHolderName:"",accountType:"",ifscCode:"",branchName:"",odLimit:"",dateOfBankAccountOpening:"",bankStatementFrom:"",bankStatementTo:"",noOfMonths:"",minChargeDetails:"",remarks:"",isCalculating:!1},Jn=o.forwardRef((p,ne)=>{var Ne,Fe,Ue,Qe,Ze,Ve,De,we,en,nn,tn,sn,an;const{data:u,dropDownOptions:R,tab:v,isLoading:s,getDetailsCallback:m}=p,f=Be(),[N,M]=o.useState({...Le}),[_,H]=o.useState(I.VIEW),[Q,V]=o.useState(""),[W,z]=o.useState(!1),[D,G]=o.useState(""),[P,E]=o.useState(!1),[K,k]=o.useState(void 0),T=o.useRef(null);$e.useRef(null);const[,L]=o.useState(!1),y=o.useRef(new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>L(h=>!h)}}));o.useEffect(()=>{M(h=>({...h,...u}))},[u]),o.useEffect(()=>{var h;T!=null&&T.current&&Q!==""&&((h=T==null?void 0:T.current)==null||h.showFunction(),V(""))},[Q,W]),o.useEffect(()=>{D&&E(!0)},[D]);const he=async h=>{M(x=>({...x,isCalculating:!0}));try{const x=ie(h),S=await se.engine(x);M(Z=>{var Se;return{...Z,isCalculating:!1,noOfMonths:ge((Se=S==null?void 0:S.data)==null?void 0:Se.noOfMonthsOfBankingStatement)}})}catch(x){console.log(x),M(S=>({...S,isCalculating:!1})),G(te(x))}},ue=h=>{M(x=>{let S={...x};return S={...S,applicantType:h.target.value,customer:"",bankFinancier:"",accountNumber:"",accountHolderName:"",accountType:"",ifscCode:"",branchName:""},S})},C=h=>{M(x=>{let S={...x};return S={...S,customer:h.target.value,bankFinancier:"",accountNumber:"",accountHolderName:"",accountType:"",ifscCode:"",branchName:""},S})},g=h=>{M(x=>{let S={...x};return S={...S,bankFinancier:h.target.value,accountNumber:"",accountHolderName:"",accountType:"",ifscCode:"",branchName:""},S})},U=h=>{var S;const x=(S=R==null?void 0:R.accountNumber)==null?void 0:S.find(Z=>(Z==null?void 0:Z.uid)===h.target.value);M(Z=>{var on,ln;let Se={...Z};return Se={...Se,accountNumber:h.target.value,accountHolderName:(x==null?void 0:x.accountHolderName)??"",accountType:(x==null?void 0:x.smAccountType)??"",ifscCode:((on=x==null?void 0:x.ifsc)==null?void 0:on.ifscCode)??"",branchName:((ln=x==null?void 0:x.ifsc)==null?void 0:ln.branch)??""},Se})},Y=(h,x)=>{M(S=>{let Z={...S};return x!=null&&x.currency?Z={...Z,[h.target.name]:Xe(h.target.value)}:Z={...Z,[h.target.name]:h.target.value},Z.accountNumber&&((x==null?void 0:x.field)==="bankStatementFrom"||(x==null?void 0:x.field)==="bankStatementTo")&&me(he(Z),1200),Z})},F=h=>{var x,S;(S=y==null?void 0:y.current)==null||S.showMessageFor((x=h==null?void 0:h.target)==null?void 0:x.name)},re=()=>{var x,S;let h=!1;return h=((x=y==null?void 0:y.current)==null?void 0:x.allValid())??!1,h||(L(Z=>!Z),(S=y==null?void 0:y.current)==null||S.showMessages(),L(Z=>!Z),!1)},ae=async()=>{if(!re())return;const h=fe();try{let x=se.createBankingBasicDetails;u!=null&&u.accountNumber&&(x=se.updateBankingBasicDetails);const S=await x(h);console.log("res",S),u!=null&&u.accountNumber?m==null||m():m==null||m({reloadRelatedSections:!0,bankingDetailUid:N==null?void 0:N.accountNumber}),V(Ie.SAVED),z(!W),H(I.VIEW)}catch(x){G(te(x))}},w=()=>H(I.EDIT),j=()=>{H(I.VIEW),de(),u!=null&&u.accountNumber?m==null||m():M(h=>({...h,...Le}))},ie=h=>({loanUid:f==null?void 0:f.loanUid,stageUid:f==null?void 0:f.stageUid,bankingStatementFrom:h==null?void 0:h.bankStatementFrom,bankingStatementTo:h==null?void 0:h.bankStatementTo}),me=(h,x)=>{clearTimeout(K),k(setTimeout(h,x))},de=()=>{var h;y.current=new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>L(x=>!x)}}),(h=y==null?void 0:y.current)==null||h.hideMessages()},fe=()=>({loan:{uid:(f==null?void 0:f.loanUid)??""},stage:{uid:(f==null?void 0:f.stageUid)??""},isActive:!0,uid:v.tabUid,bankingDetail:{uid:N==null?void 0:N.accountNumber,odCcLimit:ge(N==null?void 0:N.odLimit),bankAccountOpeningDate:N==null?void 0:N.dateOfBankAccountOpening,bankingStatementFrom:N==null?void 0:N.bankStatementFrom,bankingStatementTo:N==null?void 0:N.bankStatementTo,noOfMonthsOfBankingStatement:ge(N==null?void 0:N.noOfMonths),minChargeDetails:N==null?void 0:N.minChargeDetails,remarks:N==null?void 0:N.remarks}}),{applicantType:oe,customer:a,bankFinancier:b,accountNumber:t,accountHolderName:r,accountType:i,ifscCode:d,branchName:n,odLimit:c,dateOfBankAccountOpening:l,bankStatementFrom:A,bankStatementTo:J,noOfMonths:B,minChargeDetails:ee,remarks:q}=N;return e.jsxs(e.Fragment,{children:[e.jsx(Re,{title:"label.dde.bankingDetails",pageMode:_,onSave:ae,onCancel:j,onEdit:w,disabled:N==null?void 0:N.isCalculating,children:s?e.jsx(Me,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(ve,{override:{read:_===I.VIEW},children:e.jsxs("div",{className:"grid grid-cols-4 gap-3 ",children:[e.jsx("div",{className:"",children:e.jsx(Ee,{label:"label.cam.applicantType*",placeholder:"placeholder.cam.applicantType",name:"applicantType",value:oe,onChange:ue,validation:(Ne=y==null?void 0:y.current)==null?void 0:Ne.message("applicantType",oe,"mandatory"),onBlur:F,options:xn,optionLabel:"name",optionValue:"code"})}),e.jsx("div",{children:e.jsx(Ee,{label:"label.cam.customerName*",placeholder:"placeholder.cam.customerName",name:"customer",value:a,onChange:C,validation:(Fe=y==null?void 0:y.current)==null?void 0:Fe.message("customer",a,"mandatory"),onBlur:F,options:oe!==""?(Ue=R.customerName)==null?void 0:Ue.filter(h=>{var x;return((x=h==null?void 0:h.applicant)==null?void 0:x.applicantType)===oe}):[],optionLabel:"applicant.firstName",optionValue:"applicant.uid"})}),e.jsx("div",{children:e.jsx(Ee,{label:"label.cam.bankFinancierName*",placeholder:"placeholder.cam.bankFinancierName*",name:"bankFinancier",value:b,onChange:g,validation:(Qe=y==null?void 0:y.current)==null?void 0:Qe.message("bankFinancier",b,"mandatory"),onBlur:F,options:a!==""?(Ze=R.bankFinancierName)==null?void 0:Ze.filter(h=>{var x;return((x=h==null?void 0:h.applicant)==null?void 0:x.uid)===a}):[],optionLabel:"ifsc.bank.name",optionValue:"ifsc.bank.uid"})}),e.jsx("div",{children:e.jsx(Ee,{label:"label.cam.accountNumber*",placeholder:"placeholder.cam.accountNumber*",name:"accountNumber",value:t,onChange:U,validation:(Ve=y==null?void 0:y.current)==null?void 0:Ve.message("accountNumber",t,"mandatory"),onBlur:F,options:b!==""?(De=R.accountNumber)==null?void 0:De.filter(h=>{var x,S;return((S=(x=h==null?void 0:h.ifsc)==null?void 0:x.bank)==null?void 0:S.uid)===b}):[],optionLabel:"accountNo",optionValue:"uid"})}),e.jsx("div",{children:e.jsx(ce,{label:"label.cam.accountHolderName*",name:"accountHolderName",variant:X.SECONDARY,value:r??"",disabled:!0})}),e.jsx("div",{children:e.jsx(ce,{label:"label.cam.accountType",name:"accountType",variant:X.SECONDARY,value:An(i)??"",disabled:!0})}),e.jsx("div",{children:e.jsx(ce,{label:"label.cam.ifscCode",name:"ifscCode",variant:X.SECONDARY,value:d??"",disabled:!0})}),e.jsx("div",{children:e.jsx(ce,{label:"label.cam.branchName",name:"emi",variant:X.SECONDARY,value:n??"",disabled:!0})}),e.jsx("div",{children:e.jsx(ce,{label:"label.cam.odLimit*",name:"odLimit",className:"text-right",variant:X.SECONDARY,value:c??"",onChange:h=>Y(h,{currency:!0}),validation:(we=y==null?void 0:y.current)==null?void 0:we.message("odLimit",En(c),"mandatory"),onBlur:F})}),e.jsx("div",{children:e.jsx(We,{label:"label.cam.dateOfBankAccountOpening*",name:"dateOfBankAccountOpening",value:l,variant:X.SECONDARY,onChange:Y,onBlur:F,validation:(en=y==null?void 0:y.current)==null?void 0:en.message("dateOfBankAccountOpening",l,"mandatory"),placeholder:"DD-MMM-YYYY "})}),e.jsx("div",{children:e.jsx(We,{label:"label.cam.bankStatementFrom*",name:"bankStatementFrom",value:A,variant:X.SECONDARY,onChange:h=>Y(h,{field:"bankStatementFrom"}),onBlur:F,validation:(nn=y==null?void 0:y.current)==null?void 0:nn.message("bankStatementFrom",A,`mandatory|toAndFromDate:to,${cn.BANK_STATEMENT_FROM.value},${J??""}`),placeholder:"DD-MMM-YYYY "})}),e.jsx("div",{children:e.jsx(We,{label:"label.cam.bankStatementTo*",name:"bankStatementTo",value:J,variant:X.SECONDARY,onChange:h=>Y(h,{field:"bankStatementTo"}),onBlur:F,validation:(tn=y==null?void 0:y.current)==null?void 0:tn.message("bankStatementTo",J,`mandatory|toAndFromDate:from,${cn.BANK_STATEMENT_TO.value},${A??""}`),placeholder:"DD-MMM-YYYY "})}),e.jsx("div",{children:e.jsx(ce,{label:"label.cam.noOfMonths",name:"noOfMonths",variant:X.SECONDARY,value:B??"",className:"text-right",disabled:!0})}),e.jsx("div",{children:e.jsx(hn,{name:"minChargeDetails",className:"!min-h-20 !max-h-40 h-25",label:"label.cam.minChargeDetails*",placeholder:"placeholder.initiationInfo.description",variant:X.SECONDARY,maxCount:200,onChange:Y,value:ee,onBlur:F,validation:(sn=y==null?void 0:y.current)==null?void 0:sn.message("minChargeDetails",ee,"mandatory")})}),e.jsx("div",{children:e.jsx(hn,{name:"remarks",className:"!min-h-20 !max-h-40 h-25",label:"label.cam.remarks*",placeholder:"placeholder.initiationInfo.description",variant:X.SECONDARY,maxCount:200,onChange:Y,value:q,onBlur:F,validation:(an=y==null?void 0:y.current)==null?void 0:an.message("remarks",q,"mandatory")})})]})})}),e.jsx(Ce,{position:"bottom-right",ref:T,toastText:Q,variant:pe.PRIMARY}),e.jsx(ke,{onHide:()=>{E(!1),G("")},visible:P,errorMessage:D})]})});var Je=function(){};Je.displayName="ColumnGroup";Je.defaultProps={__TYPE:"ColumnGroup"};function ze(){return ze=Object.assign?Object.assign.bind():function(p){for(var ne=1;ne<arguments.length;ne++){var u=arguments[ne];for(var R in u)Object.prototype.hasOwnProperty.call(u,R)&&(p[R]=u[R])}return p},ze.apply(this,arguments)}var je=function p(ne){var u=pn.findDiffKeys(ne,p.defaultProps);return o.createElement("tr",ze({className:ne.className,style:ne.style},u),ne.children)};je.displayName="Row";je.defaultProps={__TYPE:"Row",style:null,className:null};const Qn={tableData:[],total:{creditTransactionNo:"",creditTransactionAmount:"",debitTransactionNo:"",debitTransactionAmount:"",checkBounceInward:"",checkBounceOutward:""}},le={MONTH:"month",CREDIT_TNX_NO:"creditTransactionNo",CREDIT_TNX_AMOUNT:"creditTransactionAmount",DEBIT_TNX_NO:"debitTransactionNo",DEBIT_TNX_AMOUNT:"debitTransactionAmount",INWARD_CHECK_BOUNCE:"checkBounceInward",OUTWARD_CHECK_BOUNCE:"checkBounceOutward"},Zn=o.forwardRef((p,ne)=>{const{data:u,isLoading:R,tab:v,getDetailsCallback:s}=p,m=Be(),[f,N]=o.useState({...Qn}),[M,_]=o.useState(I.VIEW),[H,Q]=o.useState(""),[V,W]=o.useState(!1),[z,D]=o.useState(""),[G,P]=o.useState(!1),E=o.useRef(null),K=$e.useRef(null),[,k]=o.useState(!1),T=o.useRef(new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>k(n=>!n)}}));o.useEffect(()=>{(u==null?void 0:u.length)>0&&(N(n=>({...n,tableData:u})),U())},[u]),o.useEffect(()=>{var n;E!=null&&E.current&&H!==""&&((n=E==null?void 0:E.current)==null||n.showFunction(),Q(""))},[H,V]),o.useEffect(()=>{z&&P(!0)},[z]);const L=(n,c)=>{N(l=>{const A={...l},J=A.tableData.findIndex(B=>B.month===c.rowData.month&&B.year===c.rowData.year);return J===-1||(c.currency?A.tableData[J][`${c.field}`]=Ge(n.target.value):A.tableData[J][`${c.field}`]=n.target.value,Y(c.field)),A})},y=n=>{var c,l;(l=T==null?void 0:T.current)==null||l.showMessageFor((c=n==null?void 0:n.target)==null?void 0:c.name)},he=()=>{var c,l;let n=!1;return n=((c=T==null?void 0:T.current)==null?void 0:c.allValid())??!1,n||(k(A=>!A),(l=T==null?void 0:T.current)==null||l.showMessages(),k(A=>!A),!1)},ue=async()=>{if(!he())return;const n=F();console.log("credit debit save data ",n);try{await se.updateCreditDebitTransaction(n),Q(Ie.SAVED),W(!V),_(I.VIEW),s==null||s()}catch(c){D(te(c))}},C=()=>_(I.EDIT),g=()=>{_(I.VIEW),s==null||s()},U=()=>{for(const n in f==null?void 0:f.total){let c=0;u==null||u.forEach(l=>{c+=ge(l==null?void 0:l[n])}),N(l=>({...l,total:{...l.total,[n]:c}}))}},Y=n=>{setTimeout(()=>{var l;let c=0;(l=f.tableData)==null||l.forEach(A=>{c+=ge(A==null?void 0:A[n])}),N(A=>({...A,total:{...A.total,[n]:c}}))},500)},F=()=>{var c;const n=[];return(c=f==null?void 0:f.tableData)==null||c.forEach(l=>{const A={uid:l==null?void 0:l.uid,month:l==null?void 0:l.month,year:l==null?void 0:l.year,noOfCreditTransactions:Ae(l==null?void 0:l.creditTransactionNo),noOfDebitTransactions:Ae(l==null?void 0:l.debitTransactionNo),totalCreditAmount:Ae(l==null?void 0:l.creditTransactionAmount),totalDebitAmount:Ae(l==null?void 0:l.debitTransactionAmount),noOfInwardChequeBounce:Ae(l==null?void 0:l.checkBounceInward),noOfOutwardChequeBounce:Ae(l==null?void 0:l.checkBounceOutward)};n.push(A)}),{loan:{uid:m==null?void 0:m.loanUid},stage:{uid:m==null?void 0:m.stageUid},bankingDetail:{uid:v==null?void 0:v.bankingDetailsUid},bankingAnalysis:n}},re=()=>e.jsx(xe,{className:" font-medium text-primary-ptext-1000  ",label:"label.cam.total"}),ae=n=>e.jsx(xe,{className:" text-xs text-secondary-labelColor ",label:`${gn(n==null?void 0:n.month)} ${n==null?void 0:n.year}`}),w=n=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(ce,{name:`creditTransactionNo${n==null?void 0:n.uid}`,variant:X.SECONDARY,onChange:l=>L(l,{rowData:n,field:"creditTransactionNo"}),onBlur:y,value:(n==null?void 0:n.creditTransactionNo)??"",className:"text-right",validation:(c=T==null?void 0:T.current)==null?void 0:c.message(`creditTransactionNo${n==null?void 0:n.uid}`,n==null?void 0:n.creditTransactionNo,"checkNumber|onlyPositive")})})},j=n=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(ce,{name:`creditTransactionAmount${n==null?void 0:n.uid}`,variant:X.SECONDARY,onChange:l=>L(l,{rowData:n,field:"creditTransactionAmount",currency:!0}),onBlur:y,value:(n==null?void 0:n.creditTransactionAmount)??"",className:"text-right",validation:(c=T==null?void 0:T.current)==null?void 0:c.message(`creditTransactionAmount${n==null?void 0:n.uid}`,ge(n==null?void 0:n.creditTransactionAmount),"checkNumber|onlyPositive")})})},ie=n=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(ce,{name:`debitTransactionNo${n==null?void 0:n.uid}`,variant:X.SECONDARY,className:"text-right",onChange:l=>L(l,{rowData:n,field:"debitTransactionNo"}),onBlur:y,value:(n==null?void 0:n.debitTransactionNo)??"",validation:(c=T==null?void 0:T.current)==null?void 0:c.message(`debitTransactionNo${n==null?void 0:n.uid}`,n==null?void 0:n.debitTransactionNo,"checkNumber|onlyPositive")})})},me=n=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(ce,{name:`debitTransactionAmount${n==null?void 0:n.uid}`,variant:X.SECONDARY,onChange:l=>L(l,{rowData:n,field:"debitTransactionAmount",currency:!0}),className:"text-right",value:(n==null?void 0:n.debitTransactionAmount)??"",validation:(c=T==null?void 0:T.current)==null?void 0:c.message(`debitTransactionAmount${n==null?void 0:n.uid}`,ge(n==null?void 0:n.debitTransactionAmount),"checkNumber|onlyPositive")})})},de=n=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(ce,{name:`checkBounceInward${n==null?void 0:n.uid}`,variant:X.SECONDARY,onChange:l=>L(l,{rowData:n,field:"checkBounceInward"}),className:"text-right",value:(n==null?void 0:n.checkBounceInward)??"",validation:(c=T==null?void 0:T.current)==null?void 0:c.message(`checkBounceInward${n==null?void 0:n.uid}`,n==null?void 0:n.checkBounceInward,"checkNumber|onlyPositive")})})},fe=n=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(ce,{name:`checkBounceOutward${n==null?void 0:n.uid}`,variant:X.SECONDARY,onChange:l=>L(l,{rowData:n,field:"checkBounceOutward"}),className:"text-right",value:(n==null?void 0:n.checkBounceOutward)??"",validation:(c=T==null?void 0:T.current)==null?void 0:c.message(`checkBounceOutward${n==null?void 0:n.uid}`,n==null?void 0:n.checkBounceOutward,"checkNumber|onlyPositive")})})},oe=()=>e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`${f==null?void 0:f.total.creditTransactionNo}`}),a=()=>e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`₹${rn(ge(f==null?void 0:f.total.creditTransactionAmount),"en-IN",0)}`}),b=()=>{var n;return e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`${(n=f==null?void 0:f.total)==null?void 0:n.debitTransactionNo}`})},t=()=>{var n;return e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`₹${rn(ge((n=f==null?void 0:f.total)==null?void 0:n.debitTransactionAmount),"en-IN",0)}`})},r=()=>{var n;return e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`${(n=f==null?void 0:f.total)==null?void 0:n.checkBounceInward}`})},i=()=>{var n;return e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`${(n=f==null?void 0:f.total)==null?void 0:n.checkBounceOutward}`})},d=e.jsxs(Je,{children:[e.jsxs(je,{children:[e.jsx(O,{className:"pl-6 py-3 font-medium text-xs border-r border-secondary-stext-300",header:$.t("label.cam.month"),rowSpan:2,field:le.MONTH}),e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 table-header-of-sub-header bg-secondary-steelBlue-200 ",header:$.t("label.cam.creditTransaction"),colSpan:2}),e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 table-header-of-sub-header bg-secondary-steelBlue-200 ",header:$.t("label.cam.debitTransaction"),colSpan:2}),e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 table-header-of-sub-header bg-secondary-steelBlue-200 ",header:$.t("label.cam.noOfChequeBounces"),colSpan:2})]}),e.jsxs(je,{children:[e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 ",header:$.t("label.cam.no"),colSpan:1,field:le.CREDIT_TNX_NO}),e.jsx(O,{className:"pl-6  font-medium text-xs  py-1.5 ",header:$.t("label.cam.amount(₹)"),colSpan:1,field:le.CREDIT_TNX_AMOUNT}),e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 ",header:$.t("label.cam.no"),colSpan:1,field:le.DEBIT_TNX_NO}),e.jsx(O,{className:"pl-6 font-medium text-xs  py-1.5 ",header:$.t("label.cam.amount(₹)"),colSpan:1,field:le.DEBIT_TNX_AMOUNT}),e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 ",header:$.t("label.cam.noOfInward"),colSpan:1,field:le.INWARD_CHECK_BOUNCE}),e.jsx(O,{className:"pl-6 font-medium text-xs py-1.5 ",header:$.t("label.cam.noOfOutward"),colSpan:1,field:le.OUTWARD_CHECK_BOUNCE})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(Re,{title:"label.cam.creditAndDebit",pageMode:M,onSave:ue,onCancel:g,onEdit:C,children:R?e.jsx(Me,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(ve,{override:{read:M===I.VIEW},children:e.jsxs(qn,{value:f.tableData,className:" share-payment-details-table",ref:K,dataKey:"uid",headerColumnGroup:d,children:[e.jsx(O,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6 min-w-24",header:$.t("label.cam.month"),body:ae,footer:re,field:le.MONTH}),e.jsx(O,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6",header:$.t("label.cam.no"),body:w,footer:oe,field:le.DEBIT_TNX_NO}),e.jsx(O,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6 ",header:$.t("label.cam.amount(₹)"),body:j,footer:a,field:le.DEBIT_TNX_AMOUNT}),e.jsx(O,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6",header:$.t("label.cam.no"),body:ie,footer:b,field:le.CREDIT_TNX_NO}),e.jsx(O,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6",header:$.t("label.cam.amount(₹)"),body:me,footer:t,field:le.CREDIT_TNX_AMOUNT}),e.jsx(O,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6",header:$.t("label.cam.noOfInward"),body:de,footer:r,field:le.INWARD_CHECK_BOUNCE}),e.jsx(O,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6",header:$.t("label.cam.noOfOutward"),body:fe,footer:i,field:le.OUTWARD_CHECK_BOUNCE})]})})}),e.jsx(Ce,{position:"bottom-right",ref:E,toastText:H,variant:pe.PRIMARY}),e.jsx(ke,{onHide:()=>{P(!1),D("")},visible:G,errorMessage:z})]})}),Vn={columns:[],rows:[],inputFields:[]},qe="DAY",Dn=o.forwardRef((p,ne)=>{const{data:u,isLoading:R,tab:v,getDetailsCallback:s}=p,m=Be(),[f,N]=o.useState({...Vn}),[M,_]=o.useState(I.VIEW),[H,Q]=o.useState(""),[V,W]=o.useState(!1),[z,D]=o.useState(""),[G,P]=o.useState(!1),E=o.useRef(null);$e.useRef(null);const[,K]=o.useState(!1);o.useRef(new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>K(C=>!C)}})),o.useEffect(()=>{var F,re,ae,w,j,ie,me,de,fe,oe,a,b;console.log("call api");const C=[],g=[],U=(re=(F=u==null?void 0:u[0])==null?void 0:F.bankingAnalysis)==null?void 0:re.length,Y=[];if((u==null?void 0:u.length)>0&&U>0){g.push({label:"Day/Month",key:qe});for(const t of u[0].bankingAnalysis){const r=`${t==null?void 0:t.month}${t==null?void 0:t.year}`,i=`${gn(t==null?void 0:t.month)}-${t==null?void 0:t.year} (₹)`;Y.push(r),g.push({label:i,key:r})}for(let t=0;t<(u==null?void 0:u.length);t++){const r=(ae=u==null?void 0:u[t])==null?void 0:ae.dayOfMonth;let i={[qe]:r};for(let d=0;d<U;d++){const n=(ie=(j=(w=u==null?void 0:u[t])==null?void 0:w.bankingAnalysis)==null?void 0:j[d])==null?void 0:ie.month,c=(fe=(de=(me=u==null?void 0:u[t])==null?void 0:me.bankingAnalysis)==null?void 0:de[d])==null?void 0:fe.year,l=(b=(a=(oe=u==null?void 0:u[t])==null?void 0:oe.bankingAnalysis)==null?void 0:a[d])==null?void 0:b.amount;i={...i,[`${n}${c}`]:Ge(l)}}C.push(i)}N(t=>({...t,columns:g,rows:C,inputFields:Y}))}},[u]),o.useEffect(()=>{console.log("monthly banking analysis",f)},[f]),o.useEffect(()=>{var C;E!=null&&E.current&&H!==""&&((C=E==null?void 0:E.current)==null||C.showFunction(),Q(""))},[H,V]),o.useEffect(()=>{z&&P(!0)},[z]);const k=(C,g)=>{N(U=>{const Y={...U};return Y.rows[g.index][g.column.key]=Ge(C.target.value),Y})},T=async()=>{const C=ue();console.log("onSave payload",C);try{await se.updateMonthlyBankingAnalysis(C),Q(Ie.SAVED),W(!V),_(I.VIEW),s==null||s()}catch(g){D(te(g))}},L=()=>_(I.EDIT),y=()=>{_(I.VIEW),s==null||s()},he=C=>{const g=(C==null?void 0:C.substring(0,3))??"",U=(C==null?void 0:C.substring(3))??"";return{month:g,year:Number(U)}},ue=()=>{var g;const C=[];for(const U of f.rows){const Y=Object.keys(U),F={dayOfMonth:U==null?void 0:U.DAY,bankingAnalysis:[]},re=[],ae=u==null?void 0:u.find(w=>(w==null?void 0:w.dayOfMonth)===(U==null?void 0:U.DAY));for(const w of Y){if(w===qe)continue;const j=he(w),ie=(g=ae==null?void 0:ae.bankingAnalysis)==null?void 0:g.find(de=>de.month===(j==null?void 0:j.month)&&de.year===(j==null?void 0:j.year)),me={uid:(ie==null?void 0:ie.uid)??void 0,amount:Ae(U==null?void 0:U[w]),month:j==null?void 0:j.month,year:j==null?void 0:j.year};re.push(me)}F.bankingAnalysis=re,C.push(F)}return{loan:{uid:m==null?void 0:m.loanUid},stage:{uid:m==null?void 0:m.stageUid},bankingDetail:{uid:v==null?void 0:v.bankingDetailsUid},monthlyBankingAnalysis:C}};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{title:"label.cam.monthlyBankingAnalysis",pageMode:M,onSave:T,onCancel:y,onEdit:L,children:R?e.jsx(Me,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(ve,{override:{read:M===I.VIEW},children:e.jsx(jn,{rows:f==null?void 0:f.rows,columns:f==null?void 0:f.columns,inputFields:f==null?void 0:f.inputFields,handleChange:k})})}),e.jsx(Ce,{position:"bottom-right",ref:E,toastText:H,variant:pe.PRIMARY}),e.jsx(ke,{onHide:()=>{P(!1),D("")},visible:G,errorMessage:z})]})}),wn={uid:"",smCustomerType:"",smExpenseType:"",smExpenseFrequency:"",amount:"",remarks:"",isActive:!0},Nn={total:{amount:""}},et=o.forwardRef((p,ne)=>{const{data:u,dropDownOptions:R,getDetailsCallback:v}=p,s=Be(),[m,f]=o.useState({...Nn}),[N,M]=o.useState(I.VIEW),[_,H]=o.useState(""),[Q,V]=o.useState(!1),[W,z]=o.useState(""),[D,G]=o.useState(!1),P=o.useRef(null),E=$e.useRef(null),[,K]=o.useState(!1),k=o.useRef(new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>K(a=>!a)}}));o.useEffect(()=>{f(a=>({...a,...u}))},[u]),o.useEffect(()=>{var a;P!=null&&P.current&&_!==""&&((a=P==null?void 0:P.current)==null||a.showFunction(),H(""))},[_,Q]),o.useEffect(()=>{W&&G(!0)},[W]);const T=(a,b)=>{var r;let t={...b.rowData};b.currency?t={...t,[`${b.field}`]:Xe(a.target.value)}:t={...t,[`${b.field}`]:a.target.value},(r=E.current)==null||r.reportDataChange(t)},L=a=>{var b,t;(t=k==null?void 0:k.current)==null||t.showMessageFor((b=a==null?void 0:a.target)==null?void 0:b.name)},y=()=>{var b,t;let a=!1;return a=((b=k==null?void 0:k.current)==null?void 0:b.allValid())??!1,a||(K(r=>!r),(t=k==null?void 0:k.current)==null||t.showMessages(),K(r=>!r),!1)},he=async()=>{var b,t;if(!y())return;const a=F();try{await se.updateMonthlyExpense(a),H(Ie.SAVED),V(!Q),M(I.VIEW),(b=E.current)==null||b.clearAll(),(t=E.current)==null||t.search(),v==null||v()}catch(r){z(te(r))}},ue=()=>M(I.EDIT),C=()=>{var a,b;M(I.VIEW),Y(),(a=E.current)==null||a.clearAll(),(b=E.current)==null||b.search(),v==null||v()},g=()=>{var a;(a=E.current)==null||a.addRow({...wn})},U=a=>{var b;(b=E.current)==null||b.deleteRow(a),k.current=new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>K(t=>!t)}})},Y=()=>{var a;k.current=new ye({validators:{...be()},...Te(),autoForceUpdate:{forceUpdate:()=>K(b=>!b)}}),(a=k==null?void 0:k.current)==null||a.hideMessages()},F=()=>{var i,d,n;console.log("enrich for save");let a=((i=E.current)==null?void 0:i.getAddedRecords())??[],b=((d=E.current)==null?void 0:d.getDeletedRecords())??[],t=((n=E.current)==null?void 0:n.getUpdatedRecords())??[];a=a.map(c=>He(c)),b=b.map(c=>He(c)),t=t.map(c=>He(c));const r=[...a,...b,...t];return{loan:{uid:s==null?void 0:s.loanUid},stage:{uid:s==null?void 0:s.stageUid},monthlyExpenses:r}},re=a=>{var r;const b=(r=E.current)==null?void 0:r.getCurrentRecords();let t=0;b==null||b.forEach(i=>{t+=ge(i==null?void 0:i[a])}),f(i=>({...i,total:{...i.total,[a]:t}}))},ae=a=>{var b;return e.jsx("div",{className:"pt-4",children:e.jsx(Ee,{hideLabel:!0,placeholder:"placeholder.cam.customerType",name:`smCustomerType${a==null?void 0:a.uid}`,value:a==null?void 0:a.smCustomerType,variant:X.PRIMARY,options:xn,optionLabel:"name",optionValue:"code",onChange:t=>T(t,{rowData:a,field:"smCustomerType"}),onBlur:L,validation:(b=k==null?void 0:k.current)==null?void 0:b.message(`smCustomerType${a==null?void 0:a.uid}`,a.smCustomerType,"mandatory")})})},w=a=>{var b;return e.jsx("div",{className:"pt-4",children:e.jsx(Ee,{hideLabel:!0,placeholder:"placeholder.cam.expenseType",name:`smExpenseType${a==null?void 0:a.uid}`,value:a==null?void 0:a.smExpenseType,variant:X.PRIMARY,options:R.expenseType,optionLabel:"name",optionValue:"code",onChange:t=>T(t,{rowData:a,field:"smExpenseType"}),onBlur:L,validation:(b=k==null?void 0:k.current)==null?void 0:b.message(`expenseType${a==null?void 0:a.uid}`,a.smExpenseType,"mandatory")})})},j=a=>{var b;return e.jsx("div",{className:"pt-4",children:e.jsx(Ee,{hideLabel:!0,placeholder:"placeholder.cam.expenseFrequency",name:`smExpenseFrequency${a==null?void 0:a.uid}`,value:a==null?void 0:a.smExpenseFrequency,variant:X.PRIMARY,options:R.expenseFrequency,optionLabel:"name",optionValue:"code",onChange:t=>T(t,{rowData:a,field:"smExpenseFrequency"}),onBlur:L,validation:(b=k==null?void 0:k.current)==null?void 0:b.message(`expenseFrequency${a==null?void 0:a.uid}`,a.smExpenseFrequency,"mandatory")})})},ie=a=>{var b;return e.jsx("div",{className:"pt-4",children:e.jsx(ce,{name:`amount${a==null?void 0:a.uid}`,variant:X.SECONDARY,onChange:t=>T(t,{rowData:a,field:"amount",currency:!0}),className:"text-right",onBlur:L,value:a==null?void 0:a.amount,validation:(b=k==null?void 0:k.current)==null?void 0:b.message(`amount${a==null?void 0:a.uid}`,dn(mn(a==null?void 0:a.amount)),"mandatory|checkNumber|onlyPositive"),hideLabel:!0})})},me=a=>{var b;return e.jsx("div",{className:"pt-4",children:e.jsx(ce,{name:`remarks${a==null?void 0:a.uid}`,variant:X.SECONDARY,onChange:t=>T(t,{rowData:a,field:"remarks"}),onBlur:L,value:a==null?void 0:a.remarks,validation:(b=k==null?void 0:k.current)==null?void 0:b.message(`remarks${a==null?void 0:a.uid}`,dn(mn(a==null?void 0:a.remarks)),"mandatory"),hideLabel:!0})})},de=a=>e.jsx("div",{className:"",children:e.jsx(Xn,{buttonType:Gn.DELETE,onClick:()=>U(a),disabled:N===I.VIEW,tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})}),fe=()=>e.jsx(xe,{className:" font-medium text-primary-ptext-1000  ",label:"label.cibilDetails.enquirySummary.thead.total"}),oe=()=>{var a;return e.jsx(xe,{className:" font-medium text-primary-ptext-1000 text-right",label:`₹${Xe((a=m==null?void 0:m.total)==null?void 0:a.amount)}`})};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{title:"",pageMode:N,onSave:he,onCancel:C,onEdit:ue,children:e.jsx(ve,{override:{read:N===I.VIEW},children:e.jsx("div",{className:" grid grid-cols-4 gap-3  ",children:e.jsx("div",{className:"col-span-4",children:typeof N=="string"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex mb-3 justify-end",children:e.jsx("div",{className:" mr-3 self-center",children:e.jsx(bn,{buttonType:yn.ICON_TEXT_ROW,customLabel:"label.cam.add",onClick:g})})}),e.jsxs(Wn,{ref:E,uniqueKey:"uid",standardDataFormatPromise:se.getMonthlyExpense,search:`&stage.uid=${s==null?void 0:s.stageUid}&loan.uid=${s==null?void 0:s.loanUid}&isActive=true`,mode:"UPDATE",className:"table-auto-height",onUpdateCallback:()=>{re("amount")},children:[e.jsx(O,{header:$.t("label.cam.applicantType"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6  min-w-40",body:ae,footer:fe}),e.jsx(O,{header:$.t("label.cam.expenseType"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6 min-w-40",body:w}),e.jsx(O,{header:$.t("label.cam.expenseFrequency"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6 min-w-40",body:j}),e.jsx(O,{header:$.t("label.cam.amount(₹)"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:ie,footer:oe,footerClassName:" text-right"}),e.jsx(O,{header:$.t("label.cam.remarks"),className:" text-primary-ptext-1000 text-xs h-12 pl-6 ",body:me}),e.jsx(O,{header:$.t("label.investmentInfo.table.colTitle.action"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6 ",style:{minWidth:"50px",width:"50px"},body:de})]})]}):null})})})}),e.jsx(Ce,{position:"bottom-right",ref:P,toastText:_,variant:pe.PRIMARY}),e.jsx(ke,{onHide:()=>{G(!1),z("")},visible:D,errorMessage:W})]})}),nt={dropdownOptions:{typeOfApplicant:[],accountNumber:[],accountType:[],bankFinancierName:[]},bakingAnalysis:{tabs:[],index:0,deleteWarningPopup:!1,deleteTabUid:""},bankingBasicDetail:{...Le},monthlyBankingAnalysis:[],bankAccountStatement:{...Pe},bankStatementAnalysis:{...Ye},bankingSummary:[],incomeEligibilityCalculations:{...Hn},monthlyHouseholdExpense:{...Nn},creditDebitTransaction:[],isLoading:{tabs:!1,creditDebitTransaction:!1,monthlyBankingAnalysis:!1,incomeEligibilityCalculations:!1,bankingBasicDetail:!1,bankStatementAnalysis:!1,monthlyHouseholdExpense:!1}},Qt=()=>{var fe,oe,a,b;const p=Be();new kn({length:5});const[ne,u]=o.useState(!1),[R,v]=o.useState(""),[s,m]=o.useState({...nt}),[f,N]=o.useState(""),[M,_]=o.useState(pe.PRIMARY),[H,Q]=o.useState(!1),V=o.useRef(null),W=o.useRef(null);o.useState(!1);const z=(t,r)=>[{className:"",label:"Remove",command:()=>{s.bakingAnalysis.tabs.filter(d=>d.tabUid!=="").length===1&&(t!=null&&t.tabUid)||m(d=>({...d,bakingAnalysis:{...d.bakingAnalysis,deleteTabUid:(t==null?void 0:t.tabUid)??"",deleteWarningPopup:!0}}))}}];o.useEffect(()=>{D()},[p==null?void 0:p.loanUid,p==null?void 0:p.stageUid]);const D=()=>{G({onLoad:!0}),E(),y(),ue(),C()};o.useEffect(()=>{var t,r,i,d;(t=s==null?void 0:s.isLoading)!=null&&t.bankingBasicDetail||(r=s==null?void 0:s.isLoading)!=null&&r.monthlyBankingAnalysis||(i=s==null?void 0:s.isLoading)!=null&&i.creditDebitTransaction||(d=s==null?void 0:s.isLoading)!=null&&d.tabs?ie(!0):ie(!1)},[(fe=s==null?void 0:s.isLoading)==null?void 0:fe.bankingBasicDetail,(oe=s==null?void 0:s.isLoading)==null?void 0:oe.monthlyBankingAnalysis,s==null?void 0:s.creditDebitTransaction,(a=s==null?void 0:s.isLoading)==null?void 0:a.tabs]);const G=async t=>{var r,i,d,n,c,l,A,J;try{t!=null&&t.ignoreLoader||m(ee=>({...ee,isLoading:{...ee.isLoading,tabs:!0}}));const B=await se.getBankingAnalysisTabs((p==null?void 0:p.stageUid)??"",(p==null?void 0:p.loanUid)??"");if(((i=(r=B==null?void 0:B.data)==null?void 0:r.results)==null?void 0:i.length)===0)m(ee=>({...ee,bakingAnalysis:{...ee.bakingAnalysis,tabs:[{tabUid:"",applicantType:"",disabled:!1,name:"New Tab",bankingDetailsUid:""}],index:0},isLoading:{...ee.isLoading,tabs:!1}}));else{if(t!=null&&t.onLoad){const q=(l=(c=(n=(d=B==null?void 0:B.data)==null?void 0:d.results)==null?void 0:n[0])==null?void 0:c.bankingDetail)==null?void 0:l.uid;K(q??""),k(q??""),T(q??""),L(q??"")}const ee=[];(J=(A=B==null?void 0:B.data)==null?void 0:A.results)==null||J.forEach(q=>{var Ue;const Ne=w(q),Fe={tabUid:q==null?void 0:q.uid,bankingDetailsUid:((Ue=q==null?void 0:q.bankingDetail)==null?void 0:Ue.uid)??"",name:Ne,disabled:!1};ee.push(Fe)}),m(q=>{var Ne;return{...q,bakingAnalysis:{...q.bakingAnalysis,tabs:ee},bankingSummary:[...Bn((Ne=B==null?void 0:B.data)==null?void 0:Ne.results)],isLoading:{...q.isLoading,tabs:!1}}})}}catch(B){m(ee=>({...ee,isLoading:{...ee.isLoading,tabs:!1}})),v(te(B))}},P=async t=>{var r;try{const i=re(t);await se.updateBankingBasicDetails(i),N(Ie.SAVED),Q(!H);const d=((r=s==null?void 0:s.bakingAnalysis)==null?void 0:r.index)??0;let n=0;d===0?n=1:n=d-1,m(c=>({...c,bakingAnalysis:{...c.bakingAnalysis,deleteTabUid:"",deleteWarningPopup:!1}})),g({index:n},!0)}catch(i){v(te(i))}},E=async()=>{var t,r;try{const i=await se.bankingDetailsSearch((p==null?void 0:p.loanUid)??"",`&applicant.applicantType:in=[${Oe.PRIMARY},${Oe.CO_APPLICANT},${Oe.GUARANTOR}]`),d=[],n=[],c=[];(r=(t=i==null?void 0:i.data)==null?void 0:t.results)==null||r.forEach(l=>{d!=null&&d.some(A=>{var J,B;return((J=A.applicant)==null?void 0:J.uid)===((B=l==null?void 0:l.applicant)==null?void 0:B.uid)})||d.push(l),n!=null&&n.some(A=>{var J,B,ee,q;return((B=(J=A==null?void 0:A.ifsc)==null?void 0:J.bank)==null?void 0:B.uid)===((q=(ee=l.ifsc)==null?void 0:ee.bank)==null?void 0:q.uid)})||n.push(l),c!=null&&c.some(A=>(A==null?void 0:A.accountNo)===l.accountNo)||c.push(l)}),m(l=>({...l,dropdownOptions:{...l==null?void 0:l.dropdownOptions,customerName:d,bankFinancierName:n,accountNumber:c}}))}catch(i){console.log(i),v(te(i))}},K=async(t,r)=>{if(t){r||m(i=>({...i,isLoading:{...i.isLoading,bankingBasicDetail:!0}}));try{const i=await se.getBankingBasicDetailsAndAccountStatement(t??"");m(d=>({...d,bankingBasicDetail:{...d.bankingBasicDetail,...In(i==null?void 0:i.data)},bankAccountStatement:{...d.bankAccountStatement,...Mn(i==null?void 0:i.data)},isLoading:{...d.isLoading,bankingBasicDetail:!1}}))}catch(i){v(te(i)),m(d=>({...d,isLoading:{...d.isLoading,bankingBasicDetail:!1}}))}}},k=async(t,r)=>{if(t){r||m(i=>({...i,isLoading:{...i.isLoading,bankStatementAnalysis:!0}}));try{const i=await se.getBankStatementAnalysis((p==null?void 0:p.stageUid)??"",t);m(d=>({...d,bankStatementAnalysis:{...d.bankStatementAnalysis,...Un(i==null?void 0:i.data)},isLoading:{...d.isLoading,bankStatementAnalysis:!1}}))}catch(i){v(te(i)),m(d=>({...d,isLoading:{...d.isLoading,bankStatementAnalysis:!1}}))}}},T=async(t,r)=>{if(t){r||m(i=>({...i,isLoading:{...i.isLoading,monthlyBankingAnalysis:!0}}));try{const i=await se.getMonthlyBankingAnalysis((p==null?void 0:p.stageUid)??"",t);m(d=>({...d,monthlyBankingAnalysis:Ln(i==null?void 0:i.data),isLoading:{...d.isLoading,monthlyBankingAnalysis:!1}}))}catch(i){v(te(i)),m(d=>({...d,isLoading:{...d.isLoading,monthlyBankingAnalysis:!1}}))}}},L=async(t,r)=>{if(t){r||m(i=>({...i,isLoading:{...i.isLoading,creditDebitTransaction:!0}}));try{const i=await se.getCreditDebitTransaction((p==null?void 0:p.stageUid)??"",t);m(d=>({...d,creditDebitTransaction:Rn(i==null?void 0:i.data),isLoading:{...d.isLoading,creditDebitTransaction:!1}}))}catch(i){v(te(i)),m(d=>({...d,isLoading:{...d.isLoading,creditDebitTransaction:!1}}))}}},y=async t=>{t||m(r=>({...r,isLoading:{...r.isLoading,incomeEligibilityCalculations:!0,monthlyHouseholdExpense:!0}}));try{const r=await se.getCamStageDetails((p==null?void 0:p.stageUid)??"");m(i=>({...i,incomeEligibilityCalculations:{...i.incomeEligibilityCalculations,...Fn(r==null?void 0:r.data)},monthlyHouseholdExpense:{...i.monthlyHouseholdExpense,..._n(r==null?void 0:r.data)},isLoading:{...i.isLoading,incomeEligibilityCalculations:!1,monthlyHouseholdExpense:!1}}))}catch(r){v(te(r)),m(i=>({...i,isLoading:{...i.isLoading,incomeEligibilityCalculations:!1,monthlyHouseholdExpense:!1}}))}},he=(t,r)=>{K(t??"",!0),G({ignoreLoader:!0,onLoad:!1}),r!=null&&r.reloadRelatedSections&&(T(t??""),L(t??""))},ue=async()=>{var t;try{const r=await un.getAll(0,50,"staticMasterType.code=FREQUENCY_OF_EXPENSE&");ae("expenseFrequency",(t=r==null?void 0:r.data)==null?void 0:t.results)}catch(r){v(te(r))}},C=async()=>{var t;try{const r=await un.getAll(0,50,"staticMasterType.code=TYPE_OF_EXPENSE&");ae("expenseType",(t=r==null?void 0:r.data)==null?void 0:t.results)}catch(r){v(te(r))}},g=(t,r)=>{var i,d,n;if(((i=s==null?void 0:s.bakingAnalysis)==null?void 0:i.index)!==t.index){m(l=>({...l,bakingAnalysis:{...l.bakingAnalysis,index:t.index}}));const c=(n=(d=s==null?void 0:s.bakingAnalysis)==null?void 0:d.tabs)!=null&&n[t.index]?{...s.bakingAnalysis.tabs[t.index]}:void 0;c!=null&&c.tabUid?(K((c==null?void 0:c.bankingDetailsUid)??""),k((c==null?void 0:c.bankingDetailsUid)??""),T((c==null?void 0:c.bankingDetailsUid)??""),L((c==null?void 0:c.bankingDetailsUid)??"")):m(l=>({...l,bankingBasicDetail:{...Le},monthlyBankingAnalysis:[],creditDebitTransaction:[],bankAccountStatement:{...Pe},bankStatementAnalysis:{...Ye}})),r&&G({ignoreLoader:!0})}},U=()=>{m(t=>({...t,bakingAnalysis:{...t.bakingAnalysis,tabs:[...t.bakingAnalysis.tabs,{applicantType:"",disabled:!1,name:"New Tab",bankingDetailsUid:"",tabUid:""}],index:t.bakingAnalysis.tabs.length},bankingBasicDetail:{...Le},monthlyBankingAnalysis:[],creditDebitTransaction:[],bankAccountStatement:{...Pe},bankStatementAnalysis:{...Ye}}))},Y=()=>{m(t=>({...t,bakingAnalysis:{...t.bakingAnalysis,deleteWarningPopup:!1,deleteTabUid:""}}))},F=()=>{var t,r,i;if((t=s==null?void 0:s.bakingAnalysis)!=null&&t.deleteTabUid)P((r=s==null?void 0:s.bakingAnalysis)==null?void 0:r.deleteTabUid);else{const d=((i=s==null?void 0:s.bakingAnalysis)==null?void 0:i.index)??0,n={...s==null?void 0:s.bakingAnalysis};let c=0;d===0?c=1:c=d-1,g({index:c}),m(l=>{const A={...l};return l.bakingAnalysis.index,A.bakingAnalysis={...l.bakingAnalysis,deleteWarningPopup:!1,tabs:n==null?void 0:n.tabs.filter((J,B)=>B!==d)},A})}},re=t=>({uid:t,isActive:!1}),ae=(t,r)=>{m(i=>({...i,dropdownOptions:{...i==null?void 0:i.dropdownOptions,[t]:r??[]}}))},w=t=>{var i,d,n,c,l,A,J,B;return`${((n=Cn)==null?void 0:n[(d=(i=t==null?void 0:t.bankingDetail)==null?void 0:i.applicant)==null?void 0:d.applicantType])??""} - ${((l=(c=t==null?void 0:t.bankingDetail)==null?void 0:c.applicant)==null?void 0:l.firstName)??""} ${((J=(A=t==null?void 0:t.ifsc)==null?void 0:A.bank)==null?void 0:J.name)??""} ${((B=t==null?void 0:t.bankingDetail)==null?void 0:B.accountNo)??""}`},j=()=>({customerType:s==null?void 0:s.dropdownOptions.customerType,expenseType:s==null?void 0:s.dropdownOptions.expenseType,expenseFrequency:s==null?void 0:s.dropdownOptions.expenseFrequency}),ie=t=>{m(r=>{const i={...r};return i.bakingAnalysis.tabs.map(d=>{d.disabled=t}),i})},me=()=>{var t,r,i;return{customerName:(t=s==null?void 0:s.dropdownOptions)==null?void 0:t.customerName,bankFinancierName:(r=s==null?void 0:s.dropdownOptions)==null?void 0:r.bankFinancierName,accountNumber:(i=s==null?void 0:s.dropdownOptions)==null?void 0:i.accountNumber}},de=(t,r)=>{var i,d,n,c,l;return(i=s==null?void 0:s.isLoading)!=null&&i.tabs?e.jsx("div",{className:"pt-6",children:e.jsx(Me,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"})}):e.jsxs("div",{className:"grid gap-5",children:[e.jsx("div",{className:"mt-5",children:e.jsx(Jn,{isLoading:s==null?void 0:s.isLoading.bankingBasicDetail,data:s==null?void 0:s.bankingBasicDetail,tab:t,dropDownOptions:me(),getDetailsCallback:A=>he(A!=null&&A.bankingDetailUid?A==null?void 0:A.bankingDetailUid:t==null?void 0:t.bankingDetailsUid,A)})}),(s==null?void 0:s.monthlyBankingAnalysis.length)>0?e.jsx(Dn,{isLoading:(d=s==null?void 0:s.isLoading)==null?void 0:d.monthlyBankingAnalysis,data:s==null?void 0:s.monthlyBankingAnalysis,tab:t,getDetailsCallback:()=>{T((t==null?void 0:t.bankingDetailsUid)??"",!1),G({ignoreLoader:!0})}}):null,(s==null?void 0:s.creditDebitTransaction.length)>0?e.jsx(Zn,{isLoading:(n=s==null?void 0:s.isLoading)==null?void 0:n.creditDebitTransaction,data:s==null?void 0:s.creditDebitTransaction,tab:t,getDetailsCallback:()=>{L((t==null?void 0:t.bankingDetailsUid)??"",!1),G({ignoreLoader:!0})}}):null,e.jsx(Kn,{data:s==null?void 0:s.bankAccountStatement,isLoading:(c=s==null?void 0:s.isLoading)==null?void 0:c.bankingBasicDetail}),e.jsx(zn,{isLoading:(l=s==null?void 0:s.isLoading)==null?void 0:l.bankStatementAnalysis,data:s==null?void 0:s.bankStatementAnalysis,tab:t,getDetailsCallback:()=>k((t==null?void 0:t.bankingDetailsUid)??"",!0)})]})};return e.jsxs("div",{className:"grid gap-5",children:[e.jsx(_e,{title:"label.cam.bankingAnalysis",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"relative w-full scrollable-tab dynamic-tab deleteable-header",children:e.jsx(Sn,{showTooltip:!0,enableTabMenu:!0,scrollable:!0,tabHeaderMenuModel:(t,r)=>z(t),optionLabel:["name"],optionKey:"bankingDetailsUid",headerClassName:"document-check-tabs",ref:W,activeIndex:s.bakingAnalysis.index,tabs:s.bakingAnalysis.tabs,onTabChange:g,renderContent:de})}),e.jsx("div",{className:"",children:e.jsx(bn,{buttonType:yn.ICON_BUTTON_ADD,onClick:U})})]})}),e.jsx(_e,{title:"label.cam.bankingSummary",children:e.jsx($n,{isLoading:(b=s==null?void 0:s.isLoading)==null?void 0:b.tabs,data:s==null?void 0:s.bankingSummary})}),e.jsx(_e,{title:"label.cam.incomeEligibilityCalculation&BriefSummary",children:e.jsx(On,{isLoading:s.isLoading.incomeEligibilityCalculations,data:s==null?void 0:s.incomeEligibilityCalculations,getDetailsCallback:()=>y(!0)})}),e.jsx(_e,{title:"label.cam.monthlyHouseHoldExpense",children:e.jsx(et,{data:s==null?void 0:s.monthlyHouseholdExpense,dropDownOptions:j(),getDetailsCallback:()=>y(!0)})}),e.jsx(vn,{visible:s.bakingAnalysis.deleteWarningPopup,className:"w-76 !px-14",title:"Remove Tab ?",warningMessage:"This  tab will be removed .",onCancel:Y,onConfirm:F,onHide:()=>{}}),e.jsx(ke,{onHide:()=>{u(!1),v("")},visible:ne,errorMessage:R}),e.jsx(Ce,{position:"bottom-right",ref:V,toastText:f,variant:M})]})};export{Qt as default};
//# sourceMappingURL=PageIncomeExpenseDetail-ccac0d26.js.map
