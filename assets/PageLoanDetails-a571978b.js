import{r as a,q as Fe,R as Ue,j as n,T as ge,d$ as b,J as Ge,aG as $e,b3 as Me,dY as yt,f as ct,aF as V,ad as be,ae as Ne,af as ve,ax as Xe,aH as ze,ao as Z,o as S,et as Je,ff as pe,b2 as at,eu as ft,cn as gt,aa as bt,c8 as mt,ex as Nt,ey as dt,v as _e}from"./index-e8217573.js";import{E as Ye}from"./ErrorDialog-d5eef4d7.js";import{S as Pe}from"./Section-00ef9f2b.js";import{T as ke}from"./Toast-ae99ea5b.js";import{B as Ve}from"./ButtonBox-9e46519a.js";import{D as vt}from"./Dialog-adadaf64.js";import{C as g,E as Qe}from"./EditableTableV2-6afcb42b.js";import{R as rt}from"./ReadOnlyTable-86accb69.js";import{T as Tt}from"./TextButton-41b4a67e.js";import{F as ot}from"./FeeService-43f7dd78.js";import{g as It}from"./Helper-2869971b.js";import{g as At,F as St,L as Ct,h as Rt,P as Et,R as jt,S as Lt,e as Ot,f as Mt,i as Pt,a as Ut,b as Ft,c as $t,d as Yt}from"./Summary-8a53bc7e.js";import{I as Ze,B as De}from"./IconButton-36693dd9.js";import{I as F}from"./InputBox-b9e88f52.js";import{S as we}from"./SaveComponent-160c5b32.js";import{S as de}from"./SimpleDropDown-061a3470.js";import{C as re}from"./CamService-5ccef840.js";import{A as We,g as Te,s as Y,r as ut,B as qe,C as Ke,a as kt,c as Bt,d as _t,e as Ht,f as Gt,D as Vt,j as Wt}from"./Helper-54d1e873.js";import{F as qt}from"./FileUploadBox-d8087723.js";import{i as Kt,M as Xt}from"./MediaGallery-5884b284.js";import{M as zt}from"./MenuBox-defc36b0.js";import{S as Jt}from"./Skeleton-7e12d019.js";import{F as Qt}from"./FileUploadService-1aaf11f7.js";import{b as Zt}from"./DocumentUploader-e2ec1a13.js";import{D as Dt}from"./DocumentService-a293b5f4.js";import{S as He}from"./StaticMasterDataService-689a6eca.js";import{S as wt}from"./StageService-c1c03c89.js";import"./TransitionGroup-c8afe0ce.js";import"./kebab-menu-8835ad2e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./virtualscroller.esm-9939945c.js";import"./No_data-1720c54e.js";import"./loader-5f2cfb31.js";import"./RadioButton-86c37166.js";import"./withAuth-6de36ebf.js";import"./RichTextEditor-a03bd2fb.js";import"./index-8739acfd.js";import"./InputAddon-04f948e7.js";import"./WarningDialog-77a1cb18.js";import"./sortIcon-54357a29.js";import"./Download_Icon-51fc7f46.js";import"./eye_icon-081bddb3.js";import"./link-0172a3d4.js";import"./FileUploadMenuBox-f47dc693.js";import"./Helper-03e9d878.js";import"./SimpleToolTip-3cfbb0c5.js";import"./AutoComplete-0bca608a.js";import"./search_icon-459d6871.js";import"./DatePicker-b1c13861.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";const pt={isReceiptDialogVisible:!1},en=a.forwardRef((C,he)=>{const{data:U}=C,J=Fe(),[A,i]=a.useState({...pt}),[u,$]=a.useState(""),[ne,se]=a.useState(!1),[W,le]=a.useState(""),[D,w]=a.useState(!1),M=a.useRef(null),ee=Ue.useRef(null),oe=Ue.useRef(null);a.useImperativeHandle(he,()=>({onSearch:q})),a.useEffect(()=>{i(N=>({...N,...U}))},[U]),a.useEffect(()=>{var N;M!=null&&M.current&&u!==""&&((N=M==null?void 0:M.current)==null||N.showFunction(),$(""))},[u,ne]),a.useEffect(()=>{W&&w(!0)},[W]),a.useEffect(()=>{W&&w(!0)},[]);const k=()=>{i(N=>({...N,isReceiptDialogVisible:!N.isReceiptDialogVisible}))},q=()=>{ee.current.search()},H=N=>n.jsx("span",{children:Me(N.totalFeeAmt,"en-IN",0)}),G=N=>n.jsx("span",{children:Me(N.totalReceiptAmt,"en-IN",0)}),m=N=>n.jsx("span",{children:Me(N.balanceReceiptAmt,"en-IN",0)}),B=N=>n.jsx("span",{children:N.receiptRefNo}),f=N=>{var ue;return n.jsx("span",{children:((ue=yt)==null?void 0:ue[N.smInstrumentType])??""})},P=N=>n.jsx("span",{children:ct(N.instrumentDate)}),ie=N=>n.jsx("span",{children:N.txnRefNo}),R=N=>n.jsx("span",{children:Me(N.amount,"en-IN",0)}),_=N=>n.jsx("span",{children:N.remarks}),ae=N=>n.jsx("span",{children:ct(N.updatedAt)}),me=N=>n.jsx("span",{children:It(N==null?void 0:N.status)});return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"border border-primary-ptext-500 rounded-xl p-5 flex flex-col gap-3 ",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx(ge,{className:"",label:"heading.dde.balance"}),n.jsx("div",{children:n.jsx(Tt,{label:"label.cam.viewReceipts",className:"text-primary-copyTextColor text-sm cursor-pointer",onClick:k})})]}),n.jsxs(rt,{standardDataFormatPromise:ot.getBalance,search:`&loan.uid=${J.loanUid}`,ref:ee,dataKey:"uid",className:"table-auto-height",paginator:!1,children:[n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.totalFeeReceivable"),body:H}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.totalAmountReceived"),body:G,style:{minWidth:"300px"}}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.balance"),body:m})]})]}),n.jsxs(vt,{onHide:k,visible:A.isReceiptDialogVisible,modal:!0,closable:!1,className:"p-6 min-h-122 h-fit lg:w-[1000px]",children:[n.jsxs("div",{className:"flex items-center justify-between ",children:[n.jsx("div",{children:n.jsx(ge,{className:"text-base font-bold  text-primary-primaryTextColor",label:"label.cam.receipts"})}),n.jsx("div",{children:n.jsx(Ve,{buttonType:Ge.CLOSE_OUTLINE,onClick:k})})]}),n.jsxs(rt,{standardDataFormatPromise:ot.getFeeCollectionReceipt,search:`&loan.uid=${J.loanUid}`,ref:oe,dataKey:"uid",children:[n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.receiptId"),body:B}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.InstrumentType"),body:f}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.InstrumentDate"),body:P}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.cheque/TxId"),body:ie}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.amount"),body:R}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.remarks"),body:_}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.updatedDate"),body:ae}),n.jsx(g,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:b.t("label.cam.status"),body:me})]})]}),n.jsx(ke,{position:"bottom-right",ref:M,toastText:u,variant:$e.PRIMARY}),n.jsx(Ye,{onHide:()=>{w(!1),le("")},visible:D,errorMessage:W})]})}),ht={total:{appraisedNetMonthlyIncome:0,monthlyObligation:0},roi:0,tenure:0,row:{isCalculating:!1,uid:""}},tn={uid:"",isActive:!0,applicant:{applicantType:"",fullName:""},incomeScheme:{uid:"",name:""},appraisedNetMonthlyIncome:"",isIncomeConsidered:"",monthlyObligation:"",foir:"",maxEmi:"",emiFactor:"",eligibility:""},nn=a.forwardRef((C,he)=>{const{data:U,dropDownOptions:J,getDetailsCallback:A}=C,i=Fe(),[u,$]=a.useState({...ht}),[ne,se]=a.useState(V.VIEW),[W,le]=a.useState(""),[D,w]=a.useState(!1),[M,ee]=a.useState(""),[oe,k]=a.useState(!1),[q,H]=a.useState(void 0),G=a.useRef(null),m=Ue.useRef(null),[,B]=a.useState(!1),f=a.useRef(new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>B(t=>!t)}}));a.useImperativeHandle(he,()=>({onSearch:o})),a.useEffect(()=>{$(t=>({...t,total:{...U.total}}))},[U]),a.useEffect(()=>{var t;G!=null&&G.current&&W!==""&&((t=G==null?void 0:G.current)==null||t.showFunction(),le(""))},[W,D]),a.useEffect(()=>{M&&k(!0)},[M]);const P=async t=>{var l,d,h,v,L,E;$(T=>({...T,row:{...T.row,isCalculating:!0,uid:(t==null?void 0:t.uid)??""}}));try{const T=X(t),j=await re.engine(T);$(Se=>({...Se,row:{...Se.row,isCalculating:!1,uid:""}}));const ce=(l=m==null?void 0:m.current)==null?void 0:l.getCurrentRecords(),Be={...ce==null?void 0:ce.find(Se=>Se.uid===(t==null?void 0:t.uid)),monthlyObligation:Y((d=j==null?void 0:j.data)==null?void 0:d.incDetailMonthlyObligation),eligibility:Y((h=j==null?void 0:j.data)==null?void 0:h.incDetailEligibility),emiFactor:Y((v=j==null?void 0:j.data)==null?void 0:v.incDetailEmiFactor),maxEmi:Y((L=j==null?void 0:j.data)==null?void 0:L.incDetailMaxEmi)};(E=m.current)==null||E.reportDataChange(Be)}catch(T){console.log(T),$(j=>({...j,row:{...j.row,isCalculating:!1,uid:""}})),ee(Z(T))}},ie=(t,l)=>{var h;let d={...l};d={...d,applicant:{...d.applicant,applicantType:t.target.value,uid:""}},(h=m.current)==null||h.reportDataChange(d)},R=(t,l)=>{var h;let d={...l};d={...d,applicant:{...d.applicant,uid:t.target.value}},(h=m.current)==null||h.reportDataChange(d)},_=(t,l)=>{var v,L,E,T;const d=(v=J.productIncomeSchemeForIncomeDetail)==null?void 0:v.find(j=>(j==null?void 0:j.uid)===t.target.value);let h={...l};h={...h,incomeScheme:{...h.incomeScheme,uid:t.target.value},foir:((E=(L=d==null?void 0:d.details)==null?void 0:L[0])==null?void 0:E.maxFoir)??"",monthlyObligation:"",maxEmi:"",emiFactor:"",eligibility:""},P(h),(T=m.current)==null||T.reportDataChange(h)},ae=(t,l)=>{var h;let d={...l.rowData};l.currency?(d={...d,[`${l.field}`]:Y(t.target.value)},(l==null?void 0:l.field)==="appraisedNetMonthlyIncome"&&I(()=>P(d),1200)):d={...d,[`${l.field}`]:t.target.value},(h=m.current)==null||h.reportDataChange(d)},me=(t,l)=>{var h,v,L,E;let d={...l};if(t.target.value===!1)d={...d,isIncomeConsidered:t.target.value,monthlyObligation:"",maxEmi:"",emiFactor:"",eligibility:"",foir:""};else{const T=(h=J.productIncomeSchemeForIncomeDetail)==null?void 0:h.find(j=>{var ce;return(j==null?void 0:j.uid)===((ce=l==null?void 0:l.incomeScheme)==null?void 0:ce.uid)});d={...d,isIncomeConsidered:t.target.value,foir:((L=(v=T==null?void 0:T.details)==null?void 0:v[0])==null?void 0:L.maxFoir)??""},P(d)}(E=m.current)==null||E.reportDataChange(d)},N=t=>{var l,d;(d=f==null?void 0:f.current)==null||d.showMessageFor((l=t==null?void 0:t.target)==null?void 0:l.name)},ue=()=>{var l,d;let t=!1;return t=((l=f==null?void 0:f.current)==null?void 0:l.allValid())??!1,t||(B(h=>!h),(d=f==null?void 0:f.current)==null||d.showMessages(),B(h=>!h),!1)},Ie=async()=>{var l,d;if(!ue())return;const t=y();try{await re.updateIncomeDetails(t),le(ze.SAVED),w(!D),se(V.VIEW),A==null||A(),(l=m.current)==null||l.clearAll(),(d=m.current)==null||d.search()}catch(h){ee(Z(h))}},Ae=()=>se(V.EDIT),xe=()=>{var t,l;se(V.VIEW),K(),(t=m.current)==null||t.clearAll(),(l=m.current)==null||l.search(),A==null||A()},ye=()=>{var t;(t=m.current)==null||t.addRow({...tn})},r=t=>{var l;(l=m.current)==null||l.deleteRow(t),f.current=new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>B(d=>!d)}})},o=()=>{var t;(t=m==null?void 0:m.current)==null||t.search()},I=(t,l)=>{clearTimeout(q),H(setTimeout(t,l))},K=()=>{var t;f.current=new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>B(l=>!l)}}),(t=f==null?void 0:f.current)==null||t.hideMessages()},X=t=>{var d;return{loanUid:i==null?void 0:i.loanUid,stageUid:i==null?void 0:i.stageUid,applicantUid:(d=t==null?void 0:t.applicant)==null?void 0:d.uid,incDetailFoir:Te(t==null?void 0:t.foir),roi:U==null?void 0:U.roi,tenure:U==null?void 0:U.tenure,incDetailAppraisedMonthlyIncome:Te(t==null?void 0:t.appraisedNetMonthlyIncome)}},y=()=>{var v,L,E;console.log("enrich for save");let t=((v=m.current)==null?void 0:v.getAddedRecords())??[],l=((L=m.current)==null?void 0:L.getDeletedRecords())??[],d=((E=m.current)==null?void 0:E.getUpdatedRecords())??[];t=t.map(T=>We(T)),l=l.map(T=>We(T)),d=d.map(T=>We(T));const h=[...t,...l,...d];return{loan:{uid:i==null?void 0:i.loanUid},stage:{uid:i==null?void 0:i.stageUid},incomeDetails:h}},O=t=>{var h;const l=(h=m.current)==null?void 0:h.getCurrentRecords();let d=0;l==null||l.forEach(v=>{d+=Te(v==null?void 0:v[t])}),$(v=>({...v,total:{...v.total,[t]:d}}))},te=t=>{var l,d,h,v;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.applicantType",name:`applicantType${t==null?void 0:t.uid}`,value:(l=t==null?void 0:t.applicant)==null?void 0:l.applicantType,variant:S.PRIMARY,options:(d=Je)==null?void 0:d.filter(L=>L.code!==pe.GUARANTOR),optionLabel:"name",optionValue:"code",onChange:L=>ie(L,t),onBlur:N,validation:(v=f==null?void 0:f.current)==null?void 0:v.message(`applicantType${t==null?void 0:t.uid}`,(h=t.applicant)==null?void 0:h.applicantType,"mandatory")})})},fe=t=>{var l,d,h,v,L,E,T,j,ce;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.customerName",name:`customerName${t==null?void 0:t.uid}`,value:(l=t==null?void 0:t.applicant)==null?void 0:l.uid,variant:S.PRIMARY,options:((d=t==null?void 0:t.applicant)==null?void 0:d.applicantType)===pe.PRIMARY?(h=J.customerName)==null?void 0:h.filter(z=>(z==null?void 0:z.applicantType)===pe.PRIMARY):((v=t==null?void 0:t.applicant)==null?void 0:v.applicantType)===pe.CO_APPLICANT?(L=J.customerName)==null?void 0:L.filter(z=>(z==null?void 0:z.applicantType)===pe.CO_APPLICANT):((E=t==null?void 0:t.applicant)==null?void 0:E.applicantType)===pe.GUARANTOR?(T=J.customerName)==null?void 0:T.filter(z=>(z==null?void 0:z.applicantType)===pe.GUARANTOR):[],optionLabel:"fullName",optionValue:"uid",onChange:z=>R(z,t),onBlur:N,validation:(ce=f==null?void 0:f.current)==null?void 0:ce.message(`customerName${t==null?void 0:t.uid}`,(j=t.applicant)==null?void 0:j.uid,"mandatory")})})},Q=t=>{var l,d,h,v,L;return n.jsx("div",{className:"pt-4 pr-3 ",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.incomeScheme",className:" selected-label-w-135",name:`incomeScheme${t==null?void 0:t.uid}`,value:(l=t==null?void 0:t.incomeScheme)==null?void 0:l.uid,variant:S.PRIMARY,options:J.productIncomeSchemeForIncomeDetail,optionLabel:"incomeSchemeName.name",optionValue:"uid",onChange:E=>_(E,t),onBlur:N,validation:(h=f==null?void 0:f.current)==null?void 0:h.message(`incomeScheme${t==null?void 0:t.uid}`,(d=t.incomeScheme)==null?void 0:d.uid,"mandatory"),disabled:((v=u==null?void 0:u.row)==null?void 0:v.isCalculating)&&((L=u==null?void 0:u.row)==null?void 0:L.uid)!==(t==null?void 0:t.uid)})})},Ce=t=>{var l,d,h;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`appraisedNetMonthlyIncome${t==null?void 0:t.uid}`,variant:S.SECONDARY,onChange:v=>ae(v,{rowData:t,field:"appraisedNetMonthlyIncome",currency:!0}),className:"text-right",onBlur:N,value:Y(t==null?void 0:t.appraisedNetMonthlyIncome),validation:(l=f==null?void 0:f.current)==null?void 0:l.message(`appraisedNetMonthlyIncome${t==null?void 0:t.uid}`,at(ut(t==null?void 0:t.appraisedNetMonthlyIncome)),"mandatory|checkNumber|onlyPositive|min:1,num"),hideLabel:!0,disabled:((d=u==null?void 0:u.row)==null?void 0:d.isCalculating)&&((h=u==null?void 0:u.row)==null?void 0:h.uid)!==(t==null?void 0:t.uid)})})},Re=t=>{var l,d,h;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.incomeScheme",name:`isIncomeConsidered${t==null?void 0:t.uid}`,value:t==null?void 0:t.isIncomeConsidered,variant:S.PRIMARY,options:ft,optionLabel:"name",optionValue:"code",onChange:v=>me(v,t),onBlur:N,validation:(l=f==null?void 0:f.current)==null?void 0:l.message(`isIncomeConsidered${t==null?void 0:t.uid}`,t.isIncomeConsidered,"mandatory"),disabled:((d=u==null?void 0:u.row)==null?void 0:d.isCalculating)&&((h=u==null?void 0:u.row)==null?void 0:h.uid)!==(t==null?void 0:t.uid)})})},Ee=t=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`monthlyObligation${t==null?void 0:t.uid}`,variant:S.SECONDARY,value:Y(t==null?void 0:t.monthlyObligation),className:"text-right ",disabled:!0,hideLabel:!0})}),je=t=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`foir${t==null?void 0:t.uid}`,variant:S.SECONDARY,value:t==null?void 0:t.foir,disabled:!0,className:"text-right ",hideLabel:!0})}),Le=t=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`maxEmi${t==null?void 0:t.uid}`,variant:S.SECONDARY,onChange:l=>ae(l,{rowData:t,field:"maxEmi",currency:!0}),value:Y(t==null?void 0:t.maxEmi),className:"text-right",disabled:!0,hideLabel:!0})}),Oe=t=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`maxEmi${t==null?void 0:t.uid}`,variant:S.SECONDARY,value:Y(t==null?void 0:t.emiFactor),className:"text-right",disabled:!0,hideLabel:!0})}),e=t=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`eligibility${t==null?void 0:t.uid}`,variant:S.SECONDARY,onChange:l=>ae(l,{rowData:t,field:"eligibility",currency:!0}),value:Y(t==null?void 0:t.eligibility),className:"text-right",disabled:!0,hideLabel:!0})}),p=t=>n.jsx("div",{className:"",children:n.jsx(Ze,{buttonType:De.DELETE,onClick:()=>r(t),disabled:ne===V.VIEW,tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})}),s=()=>n.jsx(ge,{className:"font-medium  text-primary-ptext-1000",label:"label.cibilDetails.enquirySummary.thead.total"}),c=()=>{var l,d;const t=Y((l=u==null?void 0:u.total)==null?void 0:l.appraisedNetMonthlyIncome);return n.jsx(ge,{className:"font-medium text-right  text-primary-ptext-1000",label:((d=u==null?void 0:u.total)==null?void 0:d.appraisedNetMonthlyIncome)>0?`₹${t}`:""})},x=()=>{var l,d;const t=Y((l=u==null?void 0:u.total)==null?void 0:l.monthlyObligation);return n.jsx(ge,{className:"font-medium text-right  text-primary-ptext-1000",label:((d=u==null?void 0:u.total)==null?void 0:d.monthlyObligation)>0?`₹${t}`:""})};return n.jsxs(n.Fragment,{children:[n.jsx(we,{title:"label.cam.incomeDetails",pageMode:ne,onSave:Ie,onCancel:xe,onEdit:Ae,children:n.jsx(Xe,{override:{read:ne===V.VIEW},children:n.jsx("div",{className:"grid grid-cols-4 gap-3 ",children:n.jsx("div",{className:"col-span-4",children:typeof ne=="string"?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex justify-end mb-3",children:n.jsx("div",{className:"self-center mr-3 ",children:n.jsx(Ve,{buttonType:Ge.ICON_TEXT_ROW,customLabel:"label.cam.add",onClick:ye})})}),n.jsxs(Qe,{ref:m,uniqueKey:"uid",standardDataFormatPromise:re.getIncomeDetails,search:`&loan.uid=${i==null?void 0:i.loanUid}&isActive=true&stage.uid=${i==null?void 0:i.stageUid}`,mode:"UPDATE",className:"table-auto-height",onUpdateCallback:()=>{O("appraisedNetMonthlyIncome"),O("monthlyObligation")},children:[n.jsx(g,{header:b.t("label.cam.applicantType"),className:"h-12 pl-6 text-xs text-left text-primary-ptext-1000 min-w-35",body:te,footer:s}),n.jsx(g,{header:b.t("label.cam.customerName"),className:"h-12 pl-6 text-xs text-left text-primary-ptext-1000 min-w-50",body:fe}),n.jsx(g,{header:b.t("label.cam.incomeScheme"),className:"h-12 pl-6 text-xs  text-primary-ptext-1000 max-w-135 w-37",body:Q}),n.jsx(g,{header:b.t("label.cam.appraisedNetMonthlyIncome"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:Ce,footer:c,footerClassName:" text-right"}),n.jsx(g,{header:b.t("label.cam.isIncomeConsidered"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:Re}),n.jsx(g,{header:b.t("label.cam.monthlyObligation"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:Ee,footer:x,footerClassName:" text-right"}),n.jsx(g,{header:b.t("label.cam.foir(AsPerPolicy)"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:je}),n.jsx(g,{header:b.t("label.cam.maxEmi"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:Le}),n.jsx(g,{header:b.t("label.cam.emiFactor"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:Oe}),n.jsx(g,{header:b.t("label.cam.eligibility"),className:"h-12 pl-6 text-xs table-header-right text-primary-ptext-1000",body:e}),n.jsx(g,{header:b.t("label.investmentInfo.table.colTitle.action"),className:"h-12 px-6 text-xs text-right text-primary-ptext-1000",style:{minWidth:"50px",width:"50px"},body:p})]})]}):null})})})}),n.jsx(ke,{position:"bottom-right",ref:G,toastText:W,variant:$e.PRIMARY}),n.jsx(Ye,{onHide:()=>{k(!1),ee("")},visible:oe,errorMessage:M})]})}),sn={docTypeUid:"",documentSection:""},ln={total:{premiumAmountInclusiveGst:0}},cn={smApplicantType:"",smInsuranceType:"",smVendor:"",premiumAmountInclusiveGst:"",isActive:!0,loanDocument:{uid:"",docType:{uid:""},docCategory:"",documentSections:[]}},dn=a.forwardRef((C,he)=>{const{dropDownOptions:U,isLoading:J,data:A,getDetailsCallback:i}=C,u=Fe(),[$,ne]=a.useState({...ln}),[se,W]=a.useState(V.VIEW),[le,D]=a.useState(""),[w,M]=a.useState(!1),[ee,oe]=a.useState(""),[k,q]=a.useState(!1),[H,G]=a.useState({...Kt}),[m,B]=a.useState(!1),f=a.useRef(null),P=Ue.useRef(null),[,ie]=a.useState(!1),R=a.useRef(new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>ie(s=>!s)}})),_=a.useRef(null),ae=a.useRef(null);a.useImperativeHandle(he,()=>({refresh:fe}));const me=[{items:[]}];a.useEffect(()=>{console.log("data",A)},[A]),a.useEffect(()=>{var s;f!=null&&f.current&&le!==""&&((s=f==null?void 0:f.current)==null||s.showFunction(),D(""))},[le,w]),a.useEffect(()=>{ee&&q(!0)},[ee]);const N=(s,c)=>{var t;console.log("handle change");let x={...c.rowData};c.currency?x={...x,[c.field]:Y(s.target.value)}:x={...x,[`${c.field}`]:s.target.value},(t=P.current)==null||t.reportDataChange(x)},ue=s=>{var c,x;(x=R==null?void 0:R.current)==null||x.showMessageFor((c=s==null?void 0:s.target)==null?void 0:c.name)},Ie=()=>{var c,x;let s=!1;return s=((c=R==null?void 0:R.current)==null?void 0:c.allValid())??!1,s||(ie(t=>!t),(x=R==null?void 0:R.current)==null||x.showMessages(),ie(t=>!t),!1)},Ae=()=>{var s;(s=P.current)==null||s.addRow({...cn})},xe=async()=>{var c,x;if(console.log("save"),!Ie())return;const s=O();try{await re.updateInsuranceDetails(s),D(ze.SAVED),M(!w),W(V.VIEW),i==null||i(),(c=P.current)==null||c.clearAll(),(x=P.current)==null||x.search()}catch(t){oe(Z(t))}},ye=()=>W(V.EDIT),r=()=>{var s,c;W(V.VIEW),te(),(s=P.current)==null||s.clearAll(),(c=P.current)==null||c.search()},o=s=>{var c;(c=P.current)==null||c.deleteRow(s),R.current=new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>ie(x=>!x)}})},I=async(s,c)=>{var v;const x=s.files[0],t=new Date().getTime(),l=Math.random().toString(36).substring(2,8),d=(v=x==null?void 0:x.name)==null?void 0:v.split(".");let h="";if((d==null?void 0:d.length)>1){for(let E=0;E<d.length-1&&E!==d.length-1;E++)h+=d[E];const L=`${h}_${t}_${l}.${d[d.length-1]}`;try{const E=await Qt.saveFile(x,L);y(E.data,c)}catch(E){console.log(E),oe(Z(E))}}},K=(s,c)=>{var t,l,d,h,v,L,E,T,j,ce,z,Be,Se,et,tt,nt,st,it,lt;let x={uid:"",placeOfUpload:"",name:"",fileName:"",fileType:"",download:"",category:"",type:"",sectionName:"",url:""};c!=null&&c.loanDocument&&(x={uid:((t=c==null?void 0:c.loanDocument)==null?void 0:t.uid)??"",placeOfUpload:"",name:((h=(d=(l=c==null?void 0:c.loanDocument)==null?void 0:l.stage)==null?void 0:d.loan)==null?void 0:h.applicantName)??"-",fileName:((E=(L=(v=c==null?void 0:c.loanDocument)==null?void 0:v.documentSections)==null?void 0:L[0])==null?void 0:E.fileName)??"-",fileType:((ce=(j=(T=c==null?void 0:c.loanDocument)==null?void 0:T.documentSections)==null?void 0:j[0])==null?void 0:ce.fileType)??"-",download:"",category:((z=c==null?void 0:c.loanDocument)==null?void 0:z.docCategory)??"-",type:((Se=(Be=c==null?void 0:c.loanDocument)==null?void 0:Be.docType)==null?void 0:Se.name)??"-",sectionName:((nt=(tt=(et=c==null?void 0:c.loanDocument)==null?void 0:et.documentSections)==null?void 0:tt[0])==null?void 0:nt.sectionName)??"-",url:((lt=(it=(st=c==null?void 0:c.loanDocument)==null?void 0:st.documentSections)==null?void 0:it[0])==null?void 0:lt.url)??""}),G(x),B(!0)},X=s=>{var t;const c=(t=P.current)==null?void 0:t.getCurrentRecords();let x=0;c==null||c.forEach(l=>{x+=Te(l==null?void 0:l[s])}),ne(l=>({...l,total:{...l.total,[s]:x}}))},y=(s,c)=>{var t,l,d,h;const x={...c,loanDocument:{...c.loanDocument,docType:{...c.loanDocument.docType,uid:(A==null?void 0:A.docTypeUid)??""},docCategory:mt.DOCUMENT_CATEGORY_EXCHANGE_DOCUMENTS,documentSections:[{uid:(d=(l=(t=c==null?void 0:c.loanDocument)==null?void 0:t.documentSections)==null?void 0:l[0])==null?void 0:d.uid,section:(A==null?void 0:A.documentSection)??"",fileName:s==null?void 0:s.fileName,fileType:s==null?void 0:s.contentType,thumbUrl:s==null?void 0:s.thumbUrl,url:s==null?void 0:s.url}]}};(h=P.current)==null||h.reportDataChange(x)},O=()=>{var d,h,v,L,E;console.log("enrich for save");let s={},c=((d=P.current)==null?void 0:d.getAddedRecords())??[],x=((h=P.current)==null?void 0:h.getDeletedRecords())??[],t=((v=P.current)==null?void 0:v.getUpdatedRecords())??[];c=c.map(T=>({...T,premiumAmountInclusiveGst:Te(T==null?void 0:T.premiumAmountInclusiveGst)})),t=t.map(T=>qe(T)),x=x.map(T=>qe(T));let l=[...c,...x,...t];if(l.length===0){let T=((L=P.current)==null?void 0:L.getCurrentRecords())??[];T=T.map(j=>qe(j)),l=[...T]}return s={loan:{uid:u==null?void 0:u.loanUid},stage:{uid:u==null?void 0:u.stageUid},totalInsuranceAmount:(E=$==null?void 0:$.total)==null?void 0:E.premiumAmountInclusiveGst,stageInsurances:l},s},te=()=>{var s;R.current=new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>ie(c=>!c)}}),(s=R==null?void 0:R.current)==null||s.hideMessages()},fe=()=>{var s;(s=P.current)==null||s.search()},Q=(s,c)=>{var l;const x=[];x.push({label:"Remove",className:"px-1.5 text-xs text-primary-labelColor h-6.5 hover:bg-primary-sapphireBlue-100",command:()=>{o(c)}});const t=[...x];me[0].items=[...t],(l=_==null?void 0:_.current)==null||l.show(s)},Ce=s=>{var c,x;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.typeOfApplicant",name:`smApplicantType${s==null?void 0:s.uid}`,value:s==null?void 0:s.smApplicantType,variant:S.PRIMARY,options:(c=Je)==null?void 0:c.filter(t=>t.code!==pe.GUARANTOR),optionLabel:"name",optionValue:"code",onChange:t=>N(t,{rowData:s,field:"smApplicantType"}),onBlur:ue,validation:(x=R==null?void 0:R.current)==null?void 0:x.message(`smApplicantType${s==null?void 0:s.uid}`,s.smApplicantType,"mandatory")})})},Re=s=>n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.typeOfInsurance",name:`smInsuranceType${s==null?void 0:s.uid}`,value:s==null?void 0:s.smInsuranceType,variant:S.PRIMARY,options:U.typeOfInsurance,optionLabel:"name",optionValue:"code",onChange:c=>N(c,{rowData:s,field:"smInsuranceType"})})}),Ee=s=>n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"label.cam.selectVendor",name:`smVendor${s==null?void 0:s.uid}`,value:s==null?void 0:s.smVendor,variant:S.PRIMARY,options:U.vender,optionLabel:"name",optionValue:"code",onChange:c=>N(c,{rowData:s,field:"smVendor"})})}),je=s=>{var c;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`premiumAmountInclusiveGst${s==null?void 0:s.uid}`,className:"text-right",hideLabel:!0,variant:S.SECONDARY,value:Y(s==null?void 0:s.premiumAmountInclusiveGst),onBlur:ue,onChange:x=>N(x,{rowData:s,field:"premiumAmountInclusiveGst",currency:!0}),validation:(c=R==null?void 0:R.current)==null?void 0:c.message(`premiumAmountInclusiveGst${s==null?void 0:s.uid}`,at(ut(s==null?void 0:s.premiumAmountInclusiveGst)),"mandatory|checkNumber|onlyPositive")})})},Le=s=>{var c,x,t,l;return n.jsxs("div",{className:"flex flex-col items-center pb-1.5",children:[n.jsx("div",{className:`w-6 mt-3 file-upload-${s==null?void 0:s.uid}`,children:n.jsx(qt,{onSelect:d=>I(d,s),variant:gt.TERTIARY,tooltipContent:"Attachment",tooltipId:s==null?void 0:s.uid,disabled:se===V.VIEW})}),n.jsx("div",{className:"mt-1.5",children:n.jsx(bt,{validation:(l=R==null?void 0:R.current)==null?void 0:l.message(`file${s==null?void 0:s.uid}`,(t=(x=(c=s.loanDocument)==null?void 0:c.documentSections)==null?void 0:x[0])==null?void 0:t.fileName,"mandatory")})})]})},Oe=s=>{var c,x,t,l,d,h;return n.jsxs("div",{className:"flex justify-center items-center pb-2",children:[(t=(x=(c=s==null?void 0:s.loanDocument)==null?void 0:c.documentSections)==null?void 0:x[0])!=null&&t.url?n.jsx(Ze,{buttonType:De.VIEW,onClick:v=>K(v,s)}):null,n.jsx("div",{className:(h=(d=(l=s==null?void 0:s.loanDocument)==null?void 0:l.documentSections)==null?void 0:d[0])!=null&&h.url?"ml-3":"ml-9",children:n.jsx(Ve,{buttonType:Ge.MENU,onClick:v=>Q(v,s)})})]})},e=()=>n.jsx(ge,{className:" font-medium text-primary-ptext-1000  ",label:"label.cibilDetails.enquirySummary.thead.total"}),p=()=>{var c,x;const s=Me((c=$==null?void 0:$.total)==null?void 0:c.premiumAmountInclusiveGst);return n.jsx(ge,{className:" font-medium text-primary-ptext-1000 text-right",label:((x=$==null?void 0:$.total)==null?void 0:x.premiumAmountInclusiveGst)>0?`₹${s}`:""})};return n.jsx(Pe,{title:"label.cam.insuranceDetails",children:n.jsxs(n.Fragment,{children:[n.jsx(we,{title:"label.cam.premiumDetails",className:"",pageMode:se,onSave:xe,onCancel:r,onEdit:ye,children:J?n.jsx(Jt,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):n.jsxs(Xe,{override:{read:se===V.VIEW},children:[n.jsx("div",{className:"flex justify-end  items-center",children:n.jsx("div",{className:" mr-3  self-center",children:n.jsx(Ve,{buttonType:Ge.ICON_TEXT_ROW,customLabel:"label.legal.addInsurance",onClick:Ae})})}),n.jsx("div",{children:u!=null&&u.loanUid&&(u!=null&&u.stageUid)?n.jsxs(Qe,{ref:P,uniqueKey:"uid",standardDataFormatPromise:re.getInsuranceDetails,search:`loanUid=${u==null?void 0:u.loanUid}&stageUid=${u==null?void 0:u.stageUid}&isActive=${!0}`,mode:"UPDATE",paginator:!1,onUpdateCallback:()=>{console.log("test123"),X("premiumAmountInclusiveGst")},className:"table-auto-height",children:[n.jsx(g,{header:b.t("label.cam.typeOfApplicant"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6",body:Ce,footer:e}),n.jsx(g,{header:b.t("label.cam.typeOfInsurance"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Re}),n.jsx(g,{header:b.t("label.cam.vendor"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Ee}),n.jsx(g,{header:()=>n.jsx("div",{ref:ae,children:n.jsx(ge,{className:"",label:"label.cam.premiumAmount"})}),className:"  text-primary-ptext-1000 text-xs h-12 pl-6",style:{minWidth:"230px",width:"230px"},body:je,footer:p,footerClassName:" text-right"}),n.jsx(g,{header:b.t("label.cam.attachment"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6 flex justify-center min-w-40",body:Le}),n.jsx(g,{header:b.t("label.investmentInfo.table.colTitle.action"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6",style:{minWidth:"50px",width:"50px"},body:Oe})]}):null})]})}),n.jsx(ke,{position:"bottom-right",ref:f,toastText:le,variant:$e.PRIMARY}),n.jsx(Xt,{visible:m,onToggleVisibility:()=>B(s=>!s),list:[],currentSection:H}),n.jsx(zt,{ref:_,model:me,variant:"SECONDARY",buttonClassName:"!bg-transparent",className:"width-full-menubox bg-white  w-max p-1.5 rounded-md mt-0.5 border shadow-autoCompletePanel"}),n.jsx(Ye,{onHide:()=>{q(!1),oe("")},visible:k,errorMessage:ee})]})})}),xt={loanUid:""},rn=a.forwardRef((C,he)=>{const{data:U,dropDownOptions:J,getDetailsCallback:A}=C,i=Fe(),[u,$]=a.useState({...xt}),[ne,se]=a.useState(V.VIEW),[W,le]=a.useState(""),[D,w]=a.useState(!1),[M,ee]=a.useState(""),[oe,k]=a.useState(!1),q=a.useRef(null),H=Ue.useRef(null),[,G]=a.useState(!1),m=a.useRef(new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>G(e=>!e)}}));a.useEffect(()=>{U!=null&&U.loanUid&&$(e=>({...e,...U}))},[U]),a.useEffect(()=>{var e;q!=null&&q.current&&W!==""&&((e=q==null?void 0:q.current)==null||e.showFunction(),le(""))},[W,D]),a.useEffect(()=>{M&&k(!0)},[M]);const B=(e,p)=>{var c;let s={...p.rowData};p.currency?s={...s,[`${p.field}`]:Y(e.target.value)}:s={...s,[`${p.field}`]:e.target.value},(c=H.current)==null||c.reportDataChange(s)},f=e=>{var p,s;(s=m==null?void 0:m.current)==null||s.showMessageFor((p=e==null?void 0:e.target)==null?void 0:p.name)},P=()=>{var p,s;let e=!1;return e=((p=m==null?void 0:m.current)==null?void 0:p.allValid())??!1,e||(G(c=>!c),(s=m==null?void 0:m.current)==null||s.showMessages(),G(c=>!c),!1)},ie=async()=>{var p,s;if(!P())return;const e=N();try{await re.updateRepaymentHistory(e),le(ze.SAVED),w(!D),se(V.VIEW),(p=H.current)==null||p.clearAll(),(s=H.current)==null||s.search(),A==null||A()}catch(c){ee(Z(c))}},R=()=>se(V.EDIT),_=()=>{var e,p;se(V.VIEW),me(),(e=H.current)==null||e.clearAll(),(p=H.current)==null||p.search()},ae=e=>{var p;(p=H.current)==null||p.deleteRow(e),me()},me=()=>{var e;m.current=new be({validators:{...Ne()},...ve(),autoForceUpdate:{forceUpdate:()=>G(p=>!p)}}),(e=m==null?void 0:m.current)==null||e.hideMessages()},N=()=>{var x,t,l;console.log("enrich for save");let e=((x=H.current)==null?void 0:x.getAddedRecords())??[],p=((t=H.current)==null?void 0:t.getDeletedRecords())??[],s=((l=H.current)==null?void 0:l.getUpdatedRecords())??[];return e=e.map(d=>({...d,loan:{uid:i==null?void 0:i.loanUid},...Ke(d)})),p=p.map(d=>({loan:{uid:i==null?void 0:i.loanUid},...Ke(d,{delete:!0})})),s=s.map(d=>({loan:{uid:i==null?void 0:i.loanUid},...Ke(d)})),[...e,...p,...s]},ue=e=>{var p,s;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.applicantType",name:`applicantType${e==null?void 0:e.uid}`,value:(s=(p=e==null?void 0:e.stage)==null?void 0:p.applicant)==null?void 0:s.applicantType,variant:S.PRIMARY,options:Je,optionLabel:"name",optionValue:"code",disabled:!0})})},Ie=e=>{var p;return n.jsx("div",{className:"w-44 pt-4",children:n.jsx(F,{name:`customerName${e==null?void 0:e.uid}`,className:" truncate",variant:S.SECONDARY,value:`${((p=e==null?void 0:e.applicant)==null?void 0:p.fullName)??""}`,disabled:!0,hideLabel:!0})})},Ae=e=>{var p,s,c,x,t;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.applicantType",name:`source${e==null?void 0:e.uid}`,value:(s=(p=e==null?void 0:e.bank)==null?void 0:p.type)==null?void 0:s.name,variant:S.PRIMARY,options:(c=e==null?void 0:e.bank)!=null&&c.name?[`${(t=(x=e==null?void 0:e.bank)==null?void 0:x.type)==null?void 0:t.name}`]:[],disabled:!0})})},xe=e=>n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.purposeOfLoan",name:`purpose${e==null?void 0:e.uid}`,value:e==null?void 0:e.smPurpose,variant:S.PRIMARY,options:Nt,optionLabel:"name",optionValue:"value",disabled:!0})}),ye=e=>{var p;return n.jsx("div",{className:"w-44 pt-4",children:n.jsx(F,{name:`nameOfInstitute${e==null?void 0:e.uid}`,className:"truncate",variant:S.SECONDARY,value:((p=e==null?void 0:e.bank)==null?void 0:p.name)??"",disabled:!0,hideLabel:!0})})},r=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`sanctionAmount${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:Y((e==null?void 0:e.sanctionedAmount)??""),disabled:!0,hideLabel:!0})}),o=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`outstandingAmount${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:Y((e==null?void 0:e.outstandingAmount)??""),disabled:!0,hideLabel:!0})}),I=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`balanceTenor${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:e==null?void 0:e.balanceTenor,disabled:!0,hideLabel:!0})}),K=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`emi${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:Y((e==null?void 0:e.emiAmount)??""),disabled:!0,hideLabel:!0})}),X=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`pastDefault${e==null?void 0:e.uid}`,placeholder:"placeholder.cam.pastDefaults",variant:S.SECONDARY,className:"text-right",value:Y((e==null?void 0:e.pastDefaults)??""),disabled:!0,hideLabel:!0})}),y=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`sanctionTenor${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:(e==null?void 0:e.sanctionedTenor)??"",hideLabel:!0,disabled:!0})}),O=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`noOfBounces${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:(e==null?void 0:e.noOfBounces)??"",hideLabel:!0,disabled:!0})}),te=e=>n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`roi${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:e==null?void 0:e.roi,hideLabel:!0,disabled:!0})}),fe=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`emiPaid${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:Y((e==null?void 0:e.emiPaid)??""),onChange:s=>B(s,{rowData:e,field:"emiPaid",currency:!0}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`emiPaid${e==null?void 0:e.uid}`,Te(e.emiPaid),e!=null&&e.isActive?"mandatory|checkNumber|onlyPositive":"optional"),hideLabel:!0})})},Q=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.obligated",name:`obligated${e==null?void 0:e.uid}`,value:e==null?void 0:e.obligated,variant:S.PRIMARY,options:dt,optionLabel:"label",optionValue:"value",onChange:s=>B(s,{rowData:e,field:"obligated"}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`obligated${e==null?void 0:e.uid}`,e.obligated,e!=null&&e.isActive?"mandatory":"optional")})})},Ce=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`highestDpd${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:e==null?void 0:e.highestDpd,onChange:s=>B(s,{rowData:e,field:"highestDpd"}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`highestDpd${e==null?void 0:e.uid}`,Te(e.highestDpd),e!=null&&e.isActive?"mandatory|checkNumber|onlyPositive":"optional"),hideLabel:!0})})},Re=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`highestDpdMonth${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:e==null?void 0:e.highestDpdMonth,onChange:s=>B(s,{rowData:e,field:"highestDpdMonth"}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`highestDpdMonth${e==null?void 0:e.uid}`,e.highestDpdMonth,e!=null&&e.isActive?"mandatory":"optional"),hideLabel:!0})})},Ee=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`overdueAmount${e==null?void 0:e.uid}`,variant:S.SECONDARY,className:"text-right",value:Y((e==null?void 0:e.overdueAmount)??""),onChange:s=>B(s,{rowData:e,field:"overdueAmount",currency:!0}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`overdueAmount${e==null?void 0:e.uid}`,Te(e.overdueAmount),e!=null&&e.isActive?"mandatory|checkNumber|onlyPositive":"optional"),hideLabel:!0})})},je=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(F,{name:`remarks${e==null?void 0:e.uid}`,variant:S.SECONDARY,value:e==null?void 0:e.remarks,onChange:s=>B(s,{rowData:e,field:"remarks"}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`remarks${e==null?void 0:e.uid}`,e.remarks,e!=null&&e.isActive?"mandatory":"optional"),hideLabel:!0})})},Le=e=>{var p;return n.jsx("div",{className:"pt-4",children:n.jsx(de,{hideLabel:!0,placeholder:"placeholder.cam.consideredForBt",name:`smConsideredForBt${e==null?void 0:e.uid}`,value:e==null?void 0:e.smConsideredForBt,variant:S.PRIMARY,options:dt,optionLabel:"label",optionValue:"value",onChange:s=>B(s,{rowData:e,field:"smConsideredForBt"}),onBlur:f,validation:(p=m==null?void 0:m.current)==null?void 0:p.message(`smConsideredForBt${e==null?void 0:e.uid}`,e.smConsideredForBt,e!=null&&e.isActive?"mandatory":"optional")})})},Oe=e=>n.jsx("div",{className:"",children:n.jsx(Ze,{buttonType:De.DELETE,onClick:()=>ae(e),disabled:ne===V.VIEW,tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})});return n.jsxs(n.Fragment,{children:[n.jsx(we,{title:"label.cam.repaymentHistory",pageMode:ne,onSave:ie,onCancel:_,onEdit:R,children:n.jsx(Xe,{override:{read:ne===V.VIEW},children:n.jsx("div",{className:" grid grid-cols-4 gap-3  ",children:n.jsx("div",{className:"col-span-4",children:typeof ne=="string"?n.jsx(n.Fragment,{children:n.jsxs(Qe,{ref:H,uniqueKey:"uid",standardDataFormatPromise:re.getRepaymentHistoryTable,search:`&loan.uid=${i==null?void 0:i.loanUid}&isActiveCam=true`,mode:"UPDATE",className:"table-auto-height",children:[n.jsx(g,{header:b.t("label.cam.typeOfApplicant"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6",body:ue}),n.jsx(g,{header:b.t("label.cam.customerName"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6  w-50 max-w-50",body:Ie}),n.jsx(g,{header:b.t("label.cam.source(Bank/Financier)"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Ae}),n.jsx(g,{header:b.t("label.cam.purpose(home/personal)"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:xe}),n.jsx(g,{header:b.t("label.cam.nameOfInstitution"),className:" text-primary-ptext-1000 text-xs h-12 pl-6 w-50 max-w-50",body:ye}),n.jsx(g,{header:b.t("label.cam.sanctionAmount"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:r}),n.jsx(g,{header:b.t("label.cam.outstandingAmount"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:o}),n.jsx(g,{header:b.t("label.cam.balanceTenor"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:I}),n.jsx(g,{header:b.t("label.cam.emi(₹)"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:K}),n.jsx(g,{header:b.t("label.cam.pastDefaults"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:X}),n.jsx(g,{header:b.t("label.cam.sanctionTenor"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:y}),n.jsx(g,{header:b.t("label.cam.noOfBounces"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:O}),n.jsx(g,{header:b.t("label.cam.roi(%)"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:te}),n.jsx(g,{header:b.t("label.cam.emiPaid"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:fe}),n.jsx(g,{header:b.t("label.cam.obligated(y/n)"),className:" text-primary-ptext-1000 text-xs h-12 pl-6 min-w-30",body:Q}),n.jsx(g,{header:b.t("label.cam.highestDpd's"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Ce}),n.jsx(g,{header:b.t("label.cam.highestDpd'sMonth"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Re}),n.jsx(g,{header:b.t("label.cam.overdueAmount(₹)"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:Ee}),n.jsx(g,{header:b.t("label.cam.remarks/clarifications"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:je}),n.jsx(g,{header:b.t("label.cam.considerForBt(yes/no)"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Le}),n.jsx(g,{header:b.t("label.cam.action"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6 column-shadow-right min-w-12 w-12",body:Oe,alignFrozen:"right",frozen:!0})]})}):null})})})}),n.jsx(ke,{position:"bottom-right",ref:q,toastText:W,variant:$e.PRIMARY}),n.jsx(Ye,{onHide:()=>{k(!1),ee("")},visible:oe,errorMessage:M})]})}),on={dropdownOptions:{typeOfApplicant:[],typeOfInsurance:[],vender:[],chargeName:[],productIncomeScheme:[],productIncomeSchemeForIncomeDetail:[]},insuranceDetails:{...sn},schemeDetails:{...Ot},finalLoanDetails:{...Mt},balance:{...pt},loanTags:{...Pt},financierLoanNumbers:{...Ut},propertyValuation:{...Ft},incomeDetails:{...ht},summary:{...$t},repaymentHistoryTable:{...xt},repaymentHistoryComment:{...Yt},isLoading:{insuranceDetails:!0,propertyValuation:!1,finalLoanDetails:!1,schemeDetails:!1,summary:!1,repaymentHistoryComment:!1}},rs=()=>{var xe,ye;const C=Fe(),[he,U]=a.useState(!1),[J,A]=a.useState(""),[i,u]=a.useState({...on}),[$,ne]=a.useState(""),[se,W]=a.useState($e.PRIMARY);a.useState(!1);const le=a.useRef(null),D=a.useRef(null),w=a.useRef(null),M=a.useRef(null);a.useState(!1),a.useEffect(()=>{C.stageUid&&(C!=null&&C.loanUid)&&ee()},[C.loanUid,C.stageUid]),a.useEffect(()=>{J&&U(!0)},[J]);const ee=()=>{oe(),k(!1,{callbackPropertyValuationDetails:q,callbackIncomeSchemeOptions:ie,callbackInterestTypeOptions:R}),H(),G(),P(),B(),m(),f()},oe=async()=>{var r,o,I,K,X;try{const y=await Zt.getDocumentCategory(0,10,mt.DOCUMENT_CATEGORY_EXCHANGE_DOCUMENTS),O=(K=(I=(o=(r=y==null?void 0:y.data)==null?void 0:r.results)==null?void 0:o[0])==null?void 0:I.documentType)==null?void 0:K.uid,te=await Dt.getDocument(O);let fe;if(te.data.documentSections){for(const Q of te.data.documentSections)if(Q!=null&&Q.isActive){fe=(X=Q==null?void 0:Q.section)==null?void 0:X.code;break}}u(Q=>({...Q,insuranceDetails:{...Q.insuranceDetails,docTypeUid:O??"",documentSection:fe??""},isLoading:{...Q.isLoading,insuranceDetails:!1}}))}catch(y){A(Z(y)),u(O=>({...O,isLoading:{...O.isLoading,insuranceDetails:!1}}))}},k=async(r,o)=>{var I,K,X;r||u(y=>({...y,isLoading:{...y.isLoading,repaymentHistoryComment:!0,summary:!0,schemeDetails:!0,finalLoanDetails:!0,propertyValuation:!0}}));try{const y=await re.getCamStageDetails((C==null?void 0:C.stageUid)??"");u(O=>({...O,repaymentHistoryComment:{...O.repaymentHistoryComment,...kt(y==null?void 0:y.data)},summary:{...O.summary,...Bt(y==null?void 0:y.data)},schemeDetails:{...O.schemeDetails,..._t(y==null?void 0:y.data)},finalLoanDetails:{...O.finalLoanDetails,...Ht(y==null?void 0:y.data)},incomeDetails:{...O.incomeDetails,...Gt(y==null?void 0:y.data)},...o!=null&&o.getOnlyPropertyValuationTotal?{propertyValuation:{...O.propertyValuation,...Vt(y==null?void 0:y.data)}}:{},isLoading:{...O.isLoading,repaymentHistoryComment:!1,summary:!1,schemeDetails:!1,finalLoanDetails:!1}})),o!=null&&o.getOnlyPropertyValuationTotal||(I=o==null?void 0:o.callbackPropertyValuationDetails)==null||I.call(o,y==null?void 0:y.data),(K=o==null?void 0:o.callbackIncomeSchemeOptions)==null||K.call(o,y==null?void 0:y.data),(X=o==null?void 0:o.callbackInterestTypeOptions)==null||X.call(o,y==null?void 0:y.data)}catch(y){A(Z(y)),u(O=>({...O,isLoading:{...O.isLoading,repaymentHistoryComment:!1,schemeDetails:!1,finalLoanDetails:!1}}))}},q=async r=>{try{const o=await re.getValuationList((C==null?void 0:C.loanUid)??"",(C==null?void 0:C.stageUid)??"");u(I=>({...I,propertyValuation:{...I.propertyValuation,...Wt(r,o==null?void 0:o.data)},isLoading:{...I.isLoading,propertyValuation:!1}}))}catch(o){A(Z(o)),u(I=>({...I,isLoading:{...I.isLoading,propertyValuation:!1}}))}},H=async()=>{try{const r=await re.getProductIncomeSchemeOptions(`?loanUid=${C==null?void 0:C.loanUid}`);_("productIncomeScheme",r==null?void 0:r.data)}catch(r){console.log(r),A(Z(r))}},G=()=>{He.getAll(0,50,"staticMasterType.code=TRANSACTION_TYPE").then(r=>{var o;_e(r)&&_("transactionType",(o=r==null?void 0:r.data)==null?void 0:o.results)}).catch(r=>{console.log(r),A(Z(r))})},m=()=>{He.getAll(0,50,"staticMasterType.code=TYPE_OF_INSURANCE").then(r=>{var o;_e(r)&&_("typeOfInsurance",(o=r==null?void 0:r.data)==null?void 0:o.results)}).catch(r=>{console.log(r),A(Z(r))})},B=()=>{He.getAll(0,50,"staticMasterType.code=INSURANCE_VENDOR").then(r=>{var o;_e(r)&&_("vender",(o=r==null?void 0:r.data)==null?void 0:o.results)}).catch(r=>{console.log(r),A(Z(r))})},f=()=>{He.getAll(0,50,"staticMasterType.code=LOAN_TAGS").then(r=>{var o;_e(r)&&_("tags",(o=r==null?void 0:r.data)==null?void 0:o.results)}).catch(r=>{console.log(r),A(Z(r))})},P=async()=>{var r;try{const o=await wt.getCustomerDetails(0,50,`&applicantType:in=[${pe.PRIMARY},${pe.CO_APPLICANT},${pe.GUARANTOR}]&loan.uid=${C==null?void 0:C.loanUid}`);_("customerName",(r=o==null?void 0:o.data)==null?void 0:r.results)}catch(o){console.log(o),A(Z(o))}},ie=async r=>{var o,I,K,X;try{const y=await re.getProductIncomeSchemeOptions(`?bankUid=${(I=(o=r==null?void 0:r.productIncomeScheme)==null?void 0:o.bank)==null?void 0:I.uid}&lendingTypeUid=${(X=(K=r==null?void 0:r.productIncomeScheme)==null?void 0:K.lendingType)==null?void 0:X.uid}&loanUid=${C==null?void 0:C.loanUid}`);_("productIncomeSchemeForIncomeDetail",y==null?void 0:y.data)}catch(y){console.log(y),A(Z(y))}},R=async r=>{var o,I,K,X,y,O;try{const te=await re.getInterestType(`bankUid=${(I=(o=r==null?void 0:r.productIncomeScheme)==null?void 0:o.bank)==null?void 0:I.uid}&lendingTypeUid=${(X=(K=r==null?void 0:r.productIncomeScheme)==null?void 0:K.lendingType)==null?void 0:X.uid}&productUid=${(O=(y=r==null?void 0:r.productIncomeScheme)==null?void 0:y.product)==null?void 0:O.uid}`);_("interestType",te==null?void 0:te.data)}catch(te){console.log(te),A(Z(te))}},_=(r,o)=>{u(I=>({...I,dropdownOptions:{...I==null?void 0:I.dropdownOptions,[r]:o??[]}}))},ae=()=>{var r,o,I;return{typeOfApplicant:(r=i==null?void 0:i.dropdownOptions)==null?void 0:r.typeOfApplicant,typeOfInsurance:(o=i==null?void 0:i.dropdownOptions)==null?void 0:o.typeOfInsurance,vender:(I=i==null?void 0:i.dropdownOptions)==null?void 0:I.vender}},me=()=>{var r;return{productIncomeScheme:(r=i==null?void 0:i.dropdownOptions)==null?void 0:r.productIncomeScheme}},N=()=>{var r,o,I;return{interestType:(r=i==null?void 0:i.dropdownOptions)==null?void 0:r.interestType,transactionType:(o=i==null?void 0:i.dropdownOptions)==null?void 0:o.transactionType,employeeLoan:(I=i==null?void 0:i.dropdownOptions)==null?void 0:I.employeeLoan}},ue=()=>{var r;return{tags:(r=i==null?void 0:i.dropdownOptions)==null?void 0:r.tags}},Ie=()=>{var r,o;return{customerName:(r=i==null?void 0:i.dropdownOptions)==null?void 0:r.customerName,productIncomeSchemeForIncomeDetail:(o=i==null?void 0:i.dropdownOptions)==null?void 0:o.productIncomeSchemeForIncomeDetail}},Ae=()=>({typeOfApplicant:i==null?void 0:i.dropdownOptions.typeOfApplicant,customerName:i==null?void 0:i.dropdownOptions.customerName,sourceOfLoan:i==null?void 0:i.dropdownOptions.sourceOfLoan,purposeOfLoan:i==null?void 0:i.dropdownOptions.purposeOfLoan,pastDefaults:i==null?void 0:i.dropdownOptions.postDefaults});return n.jsxs("div",{className:"grid gap-5",children:[n.jsx(dn,{dropDownOptions:ae(),isLoading:i==null?void 0:i.isLoading.insuranceDetails,data:i==null?void 0:i.insuranceDetails,getDetailsCallback:()=>{k(!0)}}),n.jsx(Pe,{title:"label.cam.eligibility",children:n.jsxs(n.Fragment,{children:[n.jsx(At,{ref:w,isLoading:i==null?void 0:i.isLoading.schemeDetails,dropDownOptions:me(),data:i==null?void 0:i.schemeDetails,getDetailsCallback:r=>{var o,I;(o=D==null?void 0:D.current)==null||o.onSearch(),r!=null&&r.isProductIncomeSchemeUpdated&&((I=M==null?void 0:M.current)==null||I.onSearch()),k(!0,{callbackIncomeSchemeOptions:ie,callbackInterestTypeOptions:R})}}),n.jsx(en,{ref:D,data:i==null?void 0:i.balance}),n.jsx(St,{isLoading:i==null?void 0:i.isLoading.finalLoanDetails,dropDownOptions:N(),data:i==null?void 0:i.finalLoanDetails,getDetailsCallback:()=>{var r;(r=w==null?void 0:w.current)==null||r.refreshFeeTable(),k(!0)}}),n.jsx(Ct,{dropDownOptions:ue()}),n.jsx(Rt,{data:i==null?void 0:i.financierLoanNumbers})]})}),n.jsx(Et,{isLoading:i==null?void 0:i.isLoading.propertyValuation,data:i==null?void 0:i.propertyValuation,getDetailsCallback:r=>k(!0,{callbackPropertyValuationDetails:q,getOnlyPropertyValuationTotal:r})}),n.jsx(Pe,{title:"heading.repayment.history",children:n.jsxs(n.Fragment,{children:[n.jsx(rn,{data:i==null?void 0:i.repaymentHistoryTable,dropDownOptions:Ae(),getDetailsCallback:()=>{var r;(r=M==null?void 0:M.current)==null||r.onSearch(),k(!0)}}),n.jsx(jt,{isLoading:(xe=i==null?void 0:i.isLoading)==null?void 0:xe.repaymentHistoryComment,data:i==null?void 0:i.repaymentHistoryComment,getDetailsCallback:()=>{k(!0)}})]})}),n.jsx(Pe,{title:"heading.cam.incomeDetails",children:n.jsx(nn,{ref:M,dropDownOptions:Ie(),data:i==null?void 0:i.incomeDetails,getDetailsCallback:()=>k(!0)})}),n.jsx(Pe,{title:"label.cam.summary",children:n.jsx(Lt,{isLoading:(ye=i==null?void 0:i.isLoading)==null?void 0:ye.summary,data:i==null?void 0:i.summary})}),n.jsx(Ye,{onHide:()=>{U(!1),A("")},visible:he,errorMessage:J}),n.jsx(ke,{position:"bottom-right",ref:le,toastText:$,variant:se})]})};export{rs as default};
//# sourceMappingURL=PageLoanDetails-a571978b.js.map
