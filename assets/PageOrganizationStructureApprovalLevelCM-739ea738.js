import{w as Te,r,aF as i,aG as p,ad as Se,ae as xe,af as Re,y as je,j as a,ax as Ne,T as Ce,J as x,o as O,cL as _,aH as f,ao as I,aI as G,aJ as Q,aK as R}from"./index-e8217573.js";import{B as j}from"./ButtonBox-9e46519a.js";import{E as Oe}from"./ErrorDialog-d5eef4d7.js";import{I as H}from"./InputBox-b9e88f52.js";import{I as K}from"./InputTextArea-b90aad1d.js";import{T as X}from"./Toast-ae99ea5b.js";import{P as Ie}from"./PartnerMasterDataService-d9d86d95.js";import{S as Pe}from"./StaticMasterTypeService-480bff1a.js";import{O as P}from"./Approval-120dc31f.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./withAuth-6de36ebf.js";import"./TransitionGroup-c8afe0ce.js";const be=N=>{var z,J,W;const[o,q]=r.useState({name:"",sequence:"",reasons:"",description:"",isActive:""}),[Z,ee]=r.useState({name:"",sequence:"",reasons:"",description:"",isActive:""}),[c,b]=r.useState(i.CREATE),d=r.useRef(null),[ae,Y]=r.useState(!1),[,T]=r.useState(void 0),[ye,te]=r.useState([]),[se,y]=r.useState(!1),[S,g]=r.useState(""),[ne,L]=r.useState("bottom-right"),[M,E]=r.useState(p.PRIMARY),[D,A]=r.useState(""),[m,h]=r.useState(!1),[re,F]=r.useState(!1),[v,oe]=r.useState(""),s=r.useRef(new Se({validators:{...xe()},...Re(),autoForceUpdate:{forceUpdate:()=>T(e=>!e)}}));r.useEffect(()=>{const e=je.parse(N.location.search);e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&b(e.mode),console.log(e.mode,"hmm"),oe(e.uid),e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&b(e.mode),ie()},[]),r.useEffect(()=>{var e;d!=null&&d.current&&D!==""&&((e=d==null?void 0:d.current)==null||e.showFunction())},[D,M,m]),r.useEffect(()=>{S&&y(!0)},[S]);const ie=()=>{Ie.getAll().then(e=>{te([...e.data.results])}).catch(e=>{console.log("err")})},C=e=>{const{name:n,value:t}=e.target;q(l=>({...l,[n]:t}))},ce=()=>({name:o.name,sequence:o.sequence,reason:o.reasons,description:o.description}),le=()=>({uid:v,name:o.name,reason:o.reasons,description:o.description,sequence:o.sequence}),de=()=>{const e={uid:v,name:o.name,reason:o.reasons,description:o.description,sequence:o.sequence};let n;const t=e,l=Z;return c===i.CREATE?n={name:o.name,operationType:G.CREATE,entity:Q.APPROVAL_LEVEL,initialStateJson:"",finalStateJson:R(t),reqPayload:R(t),reasonForChange:o.reasons}:n={name:o.name,operationType:G.UPDATE,entity:Q.APPROVAL_LEVEL,initialStateJson:R(l),finalStateJson:R(t),reqPayload:R(t),reasonForChange:o.reasons??"reason"},n};r.useEffect(()=>{S&&y(!0)},[S]),r.useEffect(()=>{v&&ue()},[v]);const ue=()=>{P.findById(v).then(e=>{var n,t;console.log(e.data,"response"),q({...o,sequence:(n=e.data)==null?void 0:n.sequence,name:e.data.name,reasons:e.data.reason,description:e.data.description,isActive:e.data.isActive}),ee({sequence:(t=e.data)==null?void 0:t.sequence,name:e.data.name,reasons:e.data.reason,description:e.data.description,isActive:e.data.isActive})}).catch(e=>{console.log(e)})},w=async()=>{var n,t;let e=!1;return e=((n=s==null?void 0:s.current)==null?void 0:n.allValid())??!1,e||(T(l=>!l),(t=s==null?void 0:s.current)==null||t.showMessages(),T(l=>!l),!1)},U=e=>{var n,t;(t=s==null?void 0:s.current)==null||t.showMessageFor((n=e==null?void 0:e.target)==null?void 0:n.name)},pe=async()=>{var l,$;g("");let e=!1;if(e=await w(),!e){L("top-right"),E(p.QUATERNARY),A(f.ERROR),h(!m);return}const n=ce(),t=le();if((l=s==null?void 0:s.current)!=null&&l.allValid())if(c!==i.CREATE)try{P.update(t,v),E(p.PRIMARY),A(f.SAVED),h(!m),F(!0)}catch(u){g(I(u))}else P.save(n).then(u=>{E(p.PRIMARY),A(f.SAVED),h(!m),F(!0)}).catch(u=>{g(I(u))});else L("top-right"),E(p.QUATERNARY),A(f.ERROR),h(!m),T(u=>!u),($=s==null?void 0:s.current)==null||$.showMessages(),T(u=>!u)},me=()=>{N.navigate(_)},ve=async()=>{g("");let e=!1;if(e=await w(),!e){L("top-right"),E(p.QUATERNARY),A(f.ERROR),h(!m);return}const n=de();return Pe.approve(n).then(t=>{E(p.PRIMARY),A(f.SENT_FOR_APPROVAL),h(!m),F(!0)}).catch(t=>{g(I(t))})},ge=()=>{N.navigate(_)},Ee=()=>{b(i.EDIT)},Ae=()=>{switch(c){case i.CREATE:return"heading.organizationLevelApproval.create";case i.VIEW:return"heading.organizationLevelApproval.view";case i.EDIT:return"heading.organizationLevelApproval.edit";default:return"heading.organizationLevelApproval.create"}},he=e=>{let n=`&name=${e.target.value.toUpperCase()}`;c===i.EDIT&&(n=`&name=${e.target.value.toUpperCase()}&uid:nq=${v}`),P.getAll(0,10,`${n}`).then(t=>{t.status===200&&(t.data.results.length>0?Y(!0):Y(!1))}).catch(t=>{g(I(t))})},{name:k,description:fe,reasons:B,isActive:Le,sequence:V}=o;return a.jsx(Ne,{children:a.jsxs("div",{className:" ",children:[a.jsxs("div",{className:"flex w-full justify-between  items-center",children:[a.jsx("div",{className:" ",children:a.jsx(Ce,{label:Ae(),className:"text-primary-ptext-1000 text-h2 font-Roboto font-bold flex"})}),a.jsx("div",{className:"flex mr-5",children:c===i.CREATE||c===i.EDIT?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mr-5",children:a.jsx(j,{className:"reset-red",buttonType:x.CANCEL_OUTLINE,onClick:me})}),a.jsx("div",{className:"mr-10",children:a.jsx(j,{buttonType:x.SAVE_OUTLINE,onClickWithLoader:pe})}),a.jsx("div",{children:a.jsx(j,{className:"approve-primary",buttonType:x.SEND_FOR_APPROVAL,onClickWithLoader:ve})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mr-5",children:a.jsx(j,{buttonType:x.BACK_OUTLINE,onClick:ge})}),a.jsx("div",{className:"",children:a.jsx(j,{buttonType:x.EDIT_OUTLINE,className:"blue-primary",onClick:Ee})})]})})]}),a.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[a.jsx("div",{className:"col-span-1",children:a.jsx(H,{label:"input.organizationLevelApproval.Name",name:"name",variant:O.SECONDARY,onChange:C,value:k,onBlur:e=>{he(e),U(e)},validation:ae?"Duplicate Entry Found":(z=s==null?void 0:s.current)==null?void 0:z.message("name",k,"mandatory"),disabled:c===i.VIEW})}),a.jsx("div",{className:"col-span-1",children:a.jsx(H,{label:"input.organizationLevelApproval.sequence",name:"sequence",variant:O.SECONDARY,onChange:C,value:V,onBlur:U,validation:(J=s==null?void 0:s.current)==null?void 0:J.message("sequence",V,"mandatory"),disabled:c===i.VIEW})})]}),a.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[a.jsx("div",{className:"col-span-2",children:a.jsx(K,{label:"input.partnerUser.description",name:"description",variant:O.SECONDARY,maxCount:200,onChange:C,value:fe,disabled:c===i.VIEW})}),c!==i.VIEW&&a.jsx("div",{className:"col-span-2",children:a.jsx(K,{label:"input.partnerUser.reasons",name:"reasons",variant:O.SECONDARY,maxCount:200,onChange:C,value:B,onBlur:U,validation:(W=s==null?void 0:s.current)==null?void 0:W.message("reasons",B,"mandatory"),disabled:c===i.VIEW})}),a.jsx(X,{ref:d,position:"bottom-right",toastText:"Sent for Approval",variant:p.PRIMARY})]}),a.jsx(Oe,{onHide:()=>y(!1),visible:se,errorMessage:S}),a.jsx(X,{position:ne,ref:d,toastText:D,variant:M,onRemove:()=>{re&&N.navigate(_)}})]})})},We=Te(be);export{We as default};
//# sourceMappingURL=PageOrganizationStructureApprovalLevelCM-739ea738.js.map
