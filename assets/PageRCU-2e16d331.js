import{q as se,x as te,r as o,aG as A,S as ae,g as oe,ag as ne,dl as T,ao as j,j as e,T as le,N as re,l as S,i as O,_ as ie,J as P,ax as ce,K as de,M as me,e5 as xe,Q as ue,V as fe,e6 as ge,e7 as Ne,e8 as he,L as pe,d7 as Ae,cZ as M,b as B,aH as Te,f as je,m as Se}from"./index-e8217573.js";import{u as be}from"./LoanDetailActions-c6533c8e.js";import{B as $}from"./ButtonBox-9e46519a.js";import{E as ve}from"./ErrorDialog-d5eef4d7.js";import{T as Ee}from"./Toast-ae99ea5b.js";import{L as ye}from"./LoanService-d10912e0.js";import{c as we,M as _e,C as Ie}from"./MainMessageBody-e15b4437.js";import{A as Re}from"./AuthValidator-4e739521.js";import{S as Ce}from"./SimpleOverlayPanel-f23b2f6a.js";import{T as Le}from"./TextButton-41b4a67e.js";import{R as k}from"./RcuService-53ccbee9.js";import{A as De}from"./ACLService-e19daf7c.js";import{D as Ue}from"./Dialog-adadaf64.js";import{u as Ve}from"./useSelector-dc41929a.js";import"./kebab-menu-8835ad2e.js";import"./TransitionGroup-c8afe0ce.js";import"./Skeleton-7e12d019.js";import"./InputBox-b9e88f52.js";import"./withAuth-6de36ebf.js";import"./StageService-c1c03c89.js";import"./loader-5f2cfb31.js";const Oe=[{id:1,name:"Report",path:ge},{id:2,name:"Document Exchange",path:Ne},{id:3,name:"Deviations",path:he}],Pe={stageComplete:!1,submit:!1},ns=()=>{const a=se(),G=te(),[x,u]=o.useState({...Pe}),[f,c]=o.useState(""),[Y]=o.useState("bottom-right"),[K,d]=o.useState(!1),[g,b]=o.useState(""),[v,E]=o.useState(A.PRIMARY),[N,y]=o.useState(!1),i=o.useRef(null),h=Ve(s=>s.UserProfileReducers.profileObj),J=(h==null?void 0:h.sahayyaUserType)===ae.PARTNER_USER,[m,w]=o.useState(!1),[H,F]=o.useState(!1);o.useEffect(()=>{z()},[]),o.useEffect(()=>{console.log(m,"message ");const s=oe("VITE_MESSAGE_CONVERSATION_TIMING"),t=async()=>{try{const l=await Ie.checkNewMessageAvailability((a==null?void 0:a.stageUid)??"");F(l==null?void 0:l.data)}catch(l){console.log(l)}};t();const r=setInterval(t,s);return()=>{clearInterval(r)}},[]),o.useEffect(()=>{if(a!=null&&a.stageUid){const s=JSON.parse(ne(pe.STAGE_DETAIL));(s==null?void 0:s.status)===T.COMPLETED||(s==null?void 0:s.status)===T.CANCELLED?u(t=>({...t,stageComplete:!0,submit:!0})):(s==null?void 0:s.status)===T.IN_REVIEW?u(t=>({...t,stageComplete:!1,submit:!0})):u(t=>({...t,stageComplete:!1,submit:!1}))}},[a==null?void 0:a.stageUid]),o.useEffect(()=>{var s;i!=null&&i.current&&g!==""&&((s=i==null?void 0:i.current)==null||s.showFunction())},[g,v,N]),o.useEffect(()=>{f&&d(!0)},[f]);const z=()=>{const t=`&uid=${a.loanUid}`;ye.getAll(0,1,t).then(r=>{const l=r.data.results[0];G(be(l))}).catch(r=>{console.log(r),c(j(r))})},W=async()=>{try{const s=await k.stageComplete((a==null?void 0:a.stageUid)??"",{});if(Ae(s)&&(b("Stage completed successfully"),E(A.PRIMARY),y(!N),De.isRouteHasAccess(M))){const t=`${B}${S}${O}${M}/${a.loanUid}/`;window.location.href=t}}catch(s){console.log(s),d(!0),c(j(s))}},q=async()=>{try{const s=await k.submit((a==null?void 0:a.stageUid)??"",{});b(Te.SAVED),E(A.PRIMARY),y(!N)}catch(s){console.log(s),d(!0),c(j(s))}},_=s=>{w(!m)},X=({isActive:s})=>`tab text-sm px-2.5 py-1 min-w-fit ${s?"bg-secondary-steelBlue-900 rounded-sm text-white font-medium shadow-activeBtn ":"text-primary-500"}`,[n,Q]=o.useState({assignedTo:"",delegateTo:"",initiation:"",internalVendor:"",externalVendor:"",status:""}),p=o.useRef(null),Z=s=>{var r,l,I,R,C,L,D,U,V;const t=localStorage.getItem("stageDetail");Q({assignedTo:((l=(r=JSON.parse(t))==null?void 0:r.assignee)==null?void 0:l.name)??"NA",delegateTo:((R=(I=JSON.parse(t))==null?void 0:I.delegate)==null?void 0:R.name)??"NA",initiation:((C=JSON.parse(t))==null?void 0:C.createdAtSystemDate)??"NA",externalVendor:((L=JSON.parse(t))==null?void 0:L.partner.name)??"NA",internalVendor:((D=JSON.parse(t))==null?void 0:D.internalVendor)??"NA",status:((U=JSON.parse(t))==null?void 0:U.status)??"NA"}),p.current&&((V=p.current)==null||V.toggle(s))},ee=()=>e.jsxs("div",{className:"flex flex-col gap-4 p-5 ",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Status :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:n==null?void 0:n.status})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Assigned to :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:n.assignedTo})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Delegated to :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:n.delegateTo})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Date of Initiation :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900  font-bold ml-2",children:je(n.initiation)})]}),n.internalVendor!=="NA"?e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Internal Vendor :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900 font-bold ml-2",children:n.internalVendor!=="NA"?n.internalVendor:"NA"})]}):null,n.externalVendor!=="NA"?e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"External Vendor :"}),e.jsx("div",{className:"text-sm text-secondary-stext-900 font-bold ml-2",children:n.externalVendor!=="NA"?n.externalVendor:"NA"})]}):null]});return e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-5 ",children:[e.jsxs("div",{className:"flex items-center justify-between gap-5 w-full",children:[e.jsxs("div",{className:"flex items-center gap-5 w-11/12",children:[e.jsxs("div",{className:"border-r flex  items-center border-secondary-stext-600 px-5 gap-2 py-2 ",children:[e.jsx(le,{className:"text-primary-ptext-1000 font-bold flex-shrink-0 ",label:"heading.rcu.rcuCompletion"}),e.jsx(Le,{className:"underline text-xs  !text-black  ",label:"View Details",onClick:Z}),e.jsxs("button",{type:"button",onClick:_,className:" relative",children:[e.jsx("img",{src:we,alt:"ChatIcon",className:""})," ",H?e.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"w-3/5",children:Oe.map(s=>e.jsx(re,{className:X,to:`${S}${O}${ie}/${a.loanUid}/${a.stageUid}${s.path}`,children:s.name},s.path))})]}),e.jsxs("div",{className:"w-1/4 flex gap-4 justify-end",children:[J?e.jsx(e.Fragment,{}):e.jsx($,{buttonType:P.STAGE_COMPLETE,onClickWithLoader:W,size:"LOAN_DATA",disabled:x.stageComplete}),e.jsx($,{buttonType:P.SUBMIT,onClickWithLoader:q,size:"LOAN_DATA",disabled:x.submit})]})]}),e.jsx("div",{className:"qc-layout-body-content",children:e.jsxs(ce,{override:{read:x.stageComplete},children:[e.jsx(o.Suspense,{fallback:e.jsx(de,{}),children:e.jsx(me,{children:xe.map((s,t)=>e.jsx(ue,{path:s.path,element:e.jsx(Re,{AuthorizedComponent:s.component,urlPath:s.altPath?s.altPath:s.path})},t))})}),e.jsx(fe,{})]})}),e.jsx(ve,{onHide:()=>{d(!1),c("")},visible:K,errorMessage:f}),m?e.jsx(Ue,{visible:m,closable:!1,model:"false",onHide:()=>w(!1),className:"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162 ",children:e.jsx(_e,{params:a,handleCloseOverLay:_})}):null,e.jsx(Ce,{className:"rounded-lg shadow-lg !w-80 p-1.5 ",ref:p,content:ee()}),e.jsx(Ee,{position:Y,ref:i,toastText:g,variant:v,onRemove:()=>{const s=B+S+Se;window.location.href=s}})]})})};export{ns as default};
//# sourceMappingURL=PageRCU-2e16d331.js.map
