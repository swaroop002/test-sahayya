import{q as ye,r as a,aF as _,aG as ie,R as re,ad as Q,ae as Z,af as D,v as te,ao as G,j as t,ax as Ce,J as Te,d7 as Ee,aH as je,T as U,d$ as M,o as q,er as oe,ez as Fe}from"./index-e8217573.js";import{E as Oe}from"./ErrorDialog-d5eef4d7.js";import{S as se}from"./Section-00ef9f2b.js";import{T as Se}from"./Toast-ae99ea5b.js";import{C as K}from"./CamService-5ccef840.js";import{u as Ye,h as Be}from"./Helper-54d1e873.js";import{A as We}from"./AutoComplete-0bca608a.js";import{B as Ne}from"./ButtonBox-9e46519a.js";import{D as nt}from"./DeviationTable-bfb232d0.js";import{C as $,E as He}from"./EditableTableV2-6afcb42b.js";import{I as Ae,B as Ue}from"./IconButton-36693dd9.js";import{I as de}from"./InputTextArea-b90aad1d.js";import{S as Le}from"./SaveComponent-160c5b32.js";import{S as ce}from"./SimpleDropDown-061a3470.js";import{T as Ve}from"./TextButton-41b4a67e.js";import{S as Re}from"./StaticMasterDataService-689a6eca.js";import{P as st,O as it,i as at,a as lt}from"./PurposeOfLoan-867db4ec.js";import{I as Ie}from"./InputBox-b9e88f52.js";import{S as ze}from"./Skeleton-7e12d019.js";import{S as ot}from"./SystemDatePicker-abe08a29.js";import{R as ct}from"./ReadOnlyTable-86accb69.js";import"./Dialog-adadaf64.js";import"./TransitionGroup-c8afe0ce.js";import"./Helper-03e9d878.js";import"./DocumentUploader-e2ec1a13.js";import"./loader-5f2cfb31.js";import"./DatePicker-b1c13861.js";import"./withAuth-6de36ebf.js";import"./FileUploadCustom-5ab7fd25.js";import"./Loading-783a01c7.js";import"./MediaGallery-5884b284.js";import"./Download_Icon-51fc7f46.js";import"./index-8739acfd.js";import"./FileUploadService-1aaf11f7.js";import"./FileUploadMenuBox-f47dc693.js";import"./kebab-menu-8835ad2e.js";import"./MenuBox-defc36b0.js";import"./DocumentService-a293b5f4.js";import"./search_icon-459d6871.js";import"./virtualscroller.esm-9939945c.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./sortIcon-54357a29.js";import"./eye_icon-081bddb3.js";import"./link-0172a3d4.js";import"./RichTextEditor-a03bd2fb.js";import"./No_data-1720c54e.js";const rt={uid:"",loan:{uid:""},stage:{uid:""},deviation:{uid:"",name:""},smDeviationCategory:"",smDeviationType:oe.TYPE_OF_DEVIATION_MANUAL,actualDeviation:"",mitigation:"",isActive:!0},dt={dropdownOptions:{deviationType:[],deviationForAutomatic:[],deviationCategory:[],deviationLevel:[]},stageUid:"",tableObj:{search:""}},ut=()=>{const l=ye(),[i,j]=a.useState({...dt}),[L,P]=a.useState(_.VIEW),[E,T]=a.useState([]),[B,F]=a.useState("bottom-right"),[w,Y]=a.useState(!1),[N,O]=a.useState(""),[,W]=a.useState(!1),[m,A]=a.useState(""),[r,ne]=a.useState(!1),[f,u]=a.useState(ie.PRIMARY),h=re.useRef(null),y=a.useRef(null),g=a.useRef(new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>W(e=>!e)}}));a.useEffect(()=>{j(e=>({...e,stageUid:(l==null?void 0:l.stageUid)??""})),ue(),me(),ge()},[]),a.useEffect(()=>{i.stageUid&&j(e=>({...e,tableObj:{search:`?loanUid=${l.loanUid}&stageUid=${i.stageUid}&reEvalDeviations=false`}}))},[i.stageUid]),a.useEffect(()=>{var e;i.tableObj.search&&((e=h.current)==null||e.search())},[i.tableObj]),a.useEffect(()=>{var e;y!=null&&y.current&&m!==""&&((e=y==null?void 0:y.current)==null||e.showFunction(),A(""))},[m,r]),a.useEffect(()=>{N&&Y(!0)},[N]);const ue=()=>{Re.getAll(0,100,"staticMasterType.code=TYPE_OF_DEVIATION").then(d=>{var v;te(d)&&(console.log(d.data.results,"cam resulta"),c("deviationType",(v=d==null?void 0:d.data)==null?void 0:v.results))}).catch(d=>{console.log(d),O(G(d))})},me=()=>{K.getDeviationCategories(0,30,"").then(e=>{var o;te(e)&&c("deviationCategory",(o=e==null?void 0:e.data)==null?void 0:o.results)}).catch(e=>{console.log(e),O(G(e))})},ge=()=>{K.getDeviationLevel(0,30,"").then(e=>{var o;te(e)&&c("deviationLevel",(o=e==null?void 0:e.data)==null?void 0:o.results)}).catch(e=>{console.log(e),O(G(e))})},xe=(e,o)=>{var v;const d={...o};d.smDeviationCategory=e.target.value,(v=h.current)==null||v.reportDataChange(d)},ae=(e,o)=>{var v;const d={...o};d.maxApprovalLevel=e.target.value,(v=h.current)==null||v.reportDataChange(d)},he=(e,o)=>{var v,z,ee,H;const{value:d}=e.target;if(typeof d=="object"){let R={...o};R={...R,deviation:{...R.deviation,uid:((v=e.target.value)==null?void 0:v.uid)??"",name:((z=e.target.value)==null?void 0:z.name)??""}},(ee=h.current)==null||ee.reportDataChange(R)}else{let R={...o};R={...R,deviation:{...R.deviation,uid:"",name:e.target.value??""}},(H=h.current)==null||H.reportDataChange(R)}},le=(e,o)=>{var v;let d={...o.rowData};d={...d,[`${o.field}`]:e.target.value},(v=h.current)==null||v.reportDataChange(d)},X=e=>{var o,d;(d=g==null?void 0:g.current)==null||d.showMessageFor((o=e==null?void 0:e.target)==null?void 0:o.name)},ve=()=>{var o,d;let e=!1;return e=((o=g==null?void 0:g.current)==null?void 0:o.allValid())??!1,e||(W(v=>!v),(d=g==null?void 0:g.current)==null||d.showMessages(),W(v=>!v),!1)},pe=()=>{var e;(e=h.current)==null||e.addRow({...rt})},fe=e=>{var o;(o=h.current)==null||o.deleteRow(e),g.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>W(d=>!d)}})},s=async()=>{var o,d;if(!ve())return;const e=n();try{const v=await K.updateDeviations(e);Ee(v)&&(u(ie.PRIMARY),A(je.SAVED),ne(!r),P(_.VIEW),(o=h.current)==null||o.clearAll(),(d=h.current)==null||d.search())}catch(v){console.log(v),O(G(v))}},b=()=>P(_.EDIT),C=()=>{var e;P(_.VIEW),p(),j(o=>({...o,tableObj:{search:`?loanUid=${l.loanUid}&stageUid=${i.stageUid}&reEvalDeviations=false`}})),(e=h.current)==null||e.clearAll()},I=async()=>{var e;g.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>W(o=>!o)}});try{j(o=>({...o,tableObj:{search:`?loanUid=${l.loanUid}&stageUid=${i.stageUid}&reEvalDeviations=true`}})),(e=h.current)==null||e.clearAll()}catch(o){O(G(o))}},V=async(e,o)=>{var v,z;let d=[];try{const ee=`&type.code=${oe.TYPE_OF_DEVIATION_MANUAL}&deviationCategory.name=${o.smDeviationCategory}&name:lk=${e.query}`,H=await K.findManualDeviations(0,10,ee);te(H)&&(d=(z=(v=H==null?void 0:H.data)==null?void 0:v.results)==null?void 0:z.map(R=>({name:R==null?void 0:R.name,uid:R==null?void 0:R.uid})))}catch{u(ie.QUATERNARY),F("top-right"),A(je.ERROR),ne(!r)}d.length===0&&d.push({name:"",uid:""}),T(d)},n=()=>{var H,R,Pe;const e={loanUid:l!=null&&l.loanUid?l==null?void 0:l.loanUid:null,stageUid:i!=null&&i.stageUid?i==null?void 0:i.stageUid:null},o=x=>{var ke,Me,$e,_e;return{uid:x==null?void 0:x.uid,loan:{uid:(ke=x==null?void 0:x.loan)==null?void 0:ke.uid},stage:{uid:(Me=x==null?void 0:x.stage)==null?void 0:Me.uid},actualDeviation:x==null?void 0:x.actualDeviation,deviation:{uid:($e=x==null?void 0:x.deviation)==null?void 0:$e.uid,name:(_e=x==null?void 0:x.deviation)==null?void 0:_e.name},smDeviationType:x==null?void 0:x.smDeviationType,mitigation:x==null?void 0:x.mitigation,smDeviationCategory:x==null?void 0:x.smDeviationCategory,isActive:x==null?void 0:x.isActive}};let d=((H=h.current)==null?void 0:H.getAddedRecords())??[],v=((R=h.current)==null?void 0:R.getDeletedRecords())??[],z=((Pe=h.current)==null?void 0:Pe.getUpdatedRecords())??[];return d=d.map(x=>({...x,loan:{uid:e==null?void 0:e.loanUid},stage:{uid:e==null?void 0:e.stageUid},smDeviationCategory:x==null?void 0:x.smDeviationCategory})),v=v.map(x=>o(x)),z=z.map(x=>o(x)),[...d,...v,...z]},c=(e,o)=>{j(d=>({...d,dropdownOptions:{...d==null?void 0:d.dropdownOptions,[e]:o??[]}}))},p=()=>{var e;g.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>W(o=>!o)}}),(e=g==null?void 0:g.current)==null||e.hideMessages()},k=e=>(e==null?void 0:e.name)===void 0||(e==null?void 0:e.name)===""?t.jsx("div",{className:"flex flex-col items-center justify-center h-39 pointer-events-none cursor-default",children:t.jsx(U,{className:"text-primary-labelColor mt-2",label:"label.noDataFound"})}):t.jsx("div",{className:"flex flex-col",children:t.jsx(U,{className:"text-primary-labelColor",label:e==null?void 0:e.name})}),J=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.typeofdeviation")})}),be=e=>{var o;return t.jsx("div",{className:"h-24",children:t.jsx(ce,{placeholder:"placeholder.legal.deviationType",name:`typeOfDeviation${e==null?void 0:e.uid}`,value:e==null?void 0:e.smDeviationType,variant:q.PRIMARY,options:i.dropdownOptions.deviationType,optionLabel:"name",optionValue:"code",onBlur:X,validation:(o=g==null?void 0:g.current)==null?void 0:o.message(`typeOfDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.smDeviationType,"mandatory"),hideLabel:!0,disabled:(e==null?void 0:e.smDeviationType)===oe.TYPE_OF_DEVIATION_AUTOMATIC})})},S=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.deviationCategory")})}),Ge=e=>{var o;return t.jsx("div",{className:"h-24",children:t.jsx(ce,{name:`deviationCat${e.uid}`,options:i.dropdownOptions.deviationCategory,optionLabel:"name",optionValue:"name",value:e.smDeviationCategory??"",onChange:d=>{xe(d,e)},onBlur:X,validation:(o=g==null?void 0:g.current)==null?void 0:o.message(`deviationCat${e.uid}`,e.smDeviationCategory,"mandatory"),hideLabel:!0,disabled:(e==null?void 0:e.smDeviationType)===oe.TYPE_OF_DEVIATION_AUTOMATIC})})},qe=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.deviation")})}),Ke=e=>{var o,d,v,z,ee,H;return t.jsx("div",{className:"h-24",children:(e==null?void 0:e.smDeviationType)===oe.TYPE_OF_DEVIATION_MANUAL?t.jsx(We,{variant:q.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(o=e==null?void 0:e.deviation)==null?void 0:o.name,suggestions:E,completeMethod:R=>V(R,e),onChange:R=>he(R,e),itemTemplate:k,onBlur:X,validation:(v=g==null?void 0:g.current)==null?void 0:v.message(`deviation${e==null?void 0:e.uid}`,(d=e==null?void 0:e.deviation)==null?void 0:d.name,"mandatory"),hideLabel:!0,disabled:!e.smDeviationCategory}):t.jsx(We,{variant:q.PRIMARY,placeholder:"",name:`deviation${e==null?void 0:e.uid}`,value:(z=e==null?void 0:e.deviation)==null?void 0:z.name,onBlur:X,validation:(H=g==null?void 0:g.current)==null?void 0:H.message(`deviation${e==null?void 0:e.uid}`,(ee=e==null?void 0:e.deviation)==null?void 0:ee.name,"mandatory"),hideLabel:!0,disabled:!0})})},Xe=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.deviationlevel")})}),Je=e=>{var o;return t.jsx("div",{className:"h-24",children:t.jsx(ce,{name:`deviationLevel${e.uid}`,options:i.dropdownOptions.deviationLevel,optionLabel:"name",optionValue:"name",value:e.maxApprovalLevel??"",onChange:d=>{ae(d,e)},onBlur:X,validation:(o=g==null?void 0:g.current)==null?void 0:o.message(`deviationLevel${e.uid}`,e.maxApprovalLevel,"mandatory"),hideLabel:!0})})},Qe=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.actualDeviation")})}),Ze=e=>{var o;return t.jsx("div",{className:"h-24",children:t.jsx(de,{name:`actualDeviation${e==null?void 0:e.uid}`,className:"!h-full",variant:q.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.actualDeviation,onChange:d=>le(d,{rowData:e,field:"actualDeviation"}),onBlur:X,validation:(o=g==null?void 0:g.current)==null?void 0:o.message(`actualDeviation${e==null?void 0:e.uid}`,e==null?void 0:e.actualDeviation,"mandatory"),hideLabel:!0})})},De=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.mitigants")})}),we=e=>{var o;return t.jsx("div",{className:"h-24",children:t.jsx(de,{name:`mitigants${e==null?void 0:e.uid}`,className:"!h-full",variant:q.SECONDARY,maxCount:1e3,autoResize:!0,value:e==null?void 0:e.mitigation,onChange:d=>le(d,{rowData:e,field:"mitigation"}),onBlur:X,validation:(o=g==null?void 0:g.current)==null?void 0:o.message(`mitigants${e==null?void 0:e.uid}`,e==null?void 0:e.mitigation,"mandatory"),hideLabel:!0})})},et=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.action")})}),tt=e=>t.jsx("div",{className:"",children:t.jsx(Ae,{buttonType:Ue.DELETE,onClick:()=>fe(e),tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"},disabled:L===_.VIEW||(e==null?void 0:e.smDeviationType)===oe.TYPE_OF_DEVIATION_AUTOMATIC})});return t.jsxs("div",{className:"grid gap-5 mb-5",children:[t.jsx(Le,{className:"overflow-x-auto",title:"",pageMode:L,onEdit:b,onCancel:C,onSave:s,children:t.jsx(Ce,{override:{read:L===_.VIEW},children:t.jsxs("div",{className:"w-full flex flex-col gap-3",children:[t.jsx("div",{className:"self-end",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(Ve,{className:"text-xs text-primary-primaryBlue",label:"label.cam.recommendation.deviations.populateAutoDeviations",onClick:I,isIgnoreAccessLevel:!0}),t.jsx(Ne,{buttonType:Te.ICON_TEXT_ROW,customLabel:"Add",onClick:pe})]})}),i.stageUid?t.jsx("div",{className:"w-full",children:t.jsxs(nt,{ref:h,standardDataFormatPromise:K.getCamDeviations,search:i.tableObj.search,uniqueKey:"uid",mode:"UPDATE",isIgnoreInitialLoad:!0,children:[t.jsx($,{header:J,className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6",body:be,style:{minWidth:"170px",width:"170px"}}),t.jsx($,{header:S,className:"pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:Ge,style:{minWidth:"170px",width:"170px"}}),t.jsx($,{header:qe,className:" pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:Ke,style:{minWidth:"256px",width:"256px"}}),t.jsx($,{header:Xe,className:"pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:Je,style:{minWidth:"170px",width:"170px"}}),t.jsx($,{header:Qe,className:"!w-64 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:Ze,style:{minWidth:"256px",width:"256px"}}),t.jsx($,{header:De,className:"!w-64 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:we,style:{minWidth:"256px",width:"256px"}}),t.jsx($,{header:et,className:"px-6 py-3 text-primary-ptext-1000 text-center text-xs",style:{minWidth:"50px",width:"50px"},body:tt})]})}):null]})})}),t.jsx(Se,{position:"bottom-right",ref:y,toastText:m,variant:ie.PRIMARY}),t.jsx(Oe,{onHide:()=>{Y(!1),O("")},visible:w,errorMessage:N})]})},mt={uid:"",smRiskStrength:"",remarks:"",description:"",isActive:!0},gt={stageUid:"",tableObj:{search:""}},xt=()=>{const l=ye(),[i,j]=a.useState({...gt}),[L,P]=a.useState(_.VIEW),[,E]=a.useState(!1),[T,B]=a.useState(""),[F,w]=a.useState(!1),[Y,N]=a.useState(""),[O,W]=a.useState(!1),m=a.useRef(null),A=a.useRef(null),r=a.useRef(new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>E(s=>!s)}}));a.useEffect(()=>{j(s=>({...s,stageUid:(l==null?void 0:l.stageUid)??""}))},[]),a.useEffect(()=>{l!=null&&l.loanUid&&i.stageUid&&j(s=>({...s,tableObj:{search:`&loan.uid=${l.loanUid}&stage.uid=${i.stageUid}`}}))},[l==null?void 0:l.loanUid,i.stageUid]),a.useEffect(()=>{var s;m&&m.current&&i.tableObj.search&&((s=m.current)==null||s.search())},[i.tableObj.search]),a.useEffect(()=>{var s;A!=null&&A.current&&T!==""&&((s=A==null?void 0:A.current)==null||s.showFunction(),B(""))},[T,F]),a.useEffect(()=>{Y&&W(!0)},[Y]);const ne=(s,b)=>{var I;const C={...b};C.smRiskStrength=s.target.value,(I=m.current)==null||I.reportDataChange(C)},f=s=>{var b,C;(C=r==null?void 0:r.current)==null||C.showMessageFor((b=s==null?void 0:s.target)==null?void 0:b.name)},u=()=>{var b,C;let s=!1;return s=((b=r==null?void 0:r.current)==null?void 0:b.allValid())??!1,s||(E(I=>!I),(C=r==null?void 0:r.current)==null||C.showMessages(),E(I=>!I),!1)},h=()=>P(_.EDIT),y=()=>{var s;ge(),P(_.VIEW),(s=m==null?void 0:m.current)==null||s.search()},g=async()=>{var b;if(!u())return;const s=me();try{const C=await K.updateRiskAndStrength(s);Ee(C)&&(B(je.SAVED),w(!F),P(_.VIEW),(b=m==null?void 0:m.current)==null||b.search())}catch(C){console.log(C),N(G(C))}},ue=()=>{var s;(s=m.current)==null||s.addRow(mt)},me=()=>{const s=()=>{var I,V,n;return[...((I=m.current)==null?void 0:I.getAddedRecords())??[],...((V=m.current)==null?void 0:V.getUpdatedRecords())??[],...((n=m.current)==null?void 0:n.getDeletedRecords())??[]].map(c=>({uid:c!=null&&c.uid?c==null?void 0:c.uid:null,smRiskStrength:(c==null?void 0:c.smRiskStrength)??"",remarks:(c==null?void 0:c.remarks)??"",description:(c==null?void 0:c.description)??"",isActive:(c==null?void 0:c.isActive)??!1}))};return{loan:{uid:(l==null?void 0:l.loanUid)??null},stage:{uid:i.stageUid},riskStrengths:s()}},ge=()=>{var s;r.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>E(b=>!b)}}),(s=r==null?void 0:r.current)==null||s.hideMessages()},xe=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.riskStrength")})}),ae=s=>{var b;return t.jsx("div",{className:"h-24",children:t.jsx(ce,{name:`smRiskStrength${s.uid}`,className:"!w-30",options:[{label:"Risk",value:Fe.RISK},{label:"Strength",value:Fe.STRENGTH}],optionLabel:"label",optionValue:"value",value:s.smRiskStrength??"",onChange:C=>{ne(C,s)},onBlur:f,validation:(b=r==null?void 0:r.current)==null?void 0:b.message(`smRiskStrength${s.uid}`,s.smRiskStrength,"mandatory"),hideLabel:!0})})},he=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.desc")})}),le=s=>{var b;return t.jsx("div",{className:"h-24",children:t.jsx(de,{name:`description${s==null?void 0:s.uid}`,className:"!h-full",variant:q.SECONDARY,maxCount:200,autoResize:!0,value:s==null?void 0:s.description,onChange:C=>{var V;const I={...s};I.description=C.target.value,(V=m.current)==null||V.reportDataChange(I)},onBlur:f,validation:(b=r==null?void 0:r.current)==null?void 0:b.message(`description${s==null?void 0:s.uid}`,s==null?void 0:s.description,"mandatory"),hideLabel:!0})})},X=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.remarkMitigants")})}),ve=s=>{var b;return t.jsx("div",{className:"h-24",children:t.jsx(Ie,{name:`remarks${s==null?void 0:s.uid}`,className:"!h-full",variant:q.SECONDARY,value:s==null?void 0:s.remarks,onChange:C=>{var V;const I={...s};I.remarks=C.target.value,(V=m.current)==null||V.reportDataChange(I)},onBlur:f,validation:(b=r==null?void 0:r.current)==null?void 0:b.message(`remarks${s==null?void 0:s.uid}`,s==null?void 0:s.remarks,"mandatory"),hideLabel:!0})})},pe=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.action")})}),fe=s=>t.jsx(Ae,{className:"select-none",buttonType:Ue.DELETE,onClick:()=>{var b;(b=m.current)==null||b.deleteRow(s),r.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>E(C=>!C)}})}});return t.jsx(re.Fragment,{children:t.jsxs("div",{className:"grid gap-5 mb-5",children:[t.jsx(Le,{title:"",pageMode:L,onEdit:h,onCancel:y,onSave:g,children:t.jsx(Ce,{override:{read:L===_.VIEW},children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("div",{className:"self-end",children:t.jsx(Ne,{buttonType:Te.ICON_TEXT_ROW,customLabel:"Add",onClick:ue})}),(l==null?void 0:l.loanUid)&&i.stageUid&&t.jsx("div",{children:t.jsxs(He,{ref:m,uniqueKey:"uid",standardDataFormatPromise:K.getRiskAndStrength,search:i.tableObj.search,paginator:!0,mode:"UPDATE",className:"table-auto-height",children:[t.jsx($,{header:xe,className:"w-30 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:ae}),t.jsx($,{header:he,className:"pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:le}),t.jsx($,{header:X,className:"pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:ve}),t.jsx($,{header:pe,className:"px-6 py-3 text-primary-ptext-1000 text-center text-xs",style:{minWidth:"50px",width:"50px"},body:fe})]})})]})})}),t.jsx(Se,{position:"bottom-right",ref:A,toastText:T,variant:ie.PRIMARY}),t.jsx(Oe,{onHide:()=>{W(!1),N("")},visible:O,errorMessage:Y})]})})},ht=l=>{const{className:i,data:j,isLoading:L}=l,[P,E]=a.useState([]);return a.useEffect(()=>{E([...j])},[j]),t.jsx("div",{children:L?t.jsx(ze,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):t.jsx(Ce,{override:{read:!0},children:t.jsx("div",{className:`flex flex-col gap-3 ${i??""}`,children:t.jsx(re.Fragment,{children:P.length>0?t.jsx(t.Fragment,{children:P.map((T,B)=>t.jsxs("div",{className:" p-5 flex flex-col gap-3 border border-primary-ptext-500 rounded-xl",children:[t.jsx("div",{children:t.jsx(U,{className:"text-primary-sideBarBgColor text-sm font-bold mb-1",label:"label.cam.recommendation.recommendation",args:{count:`${B+1}`}})}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsx("div",{className:"w-61",children:t.jsx(ot,{name:"recommendationDate",label:"label.cam.recommendation.dateofrecommendation*",value:new Date(T.recommendationDate),variant:q.SECONDARY,hideErrorRow:!0})}),t.jsx("div",{className:"w-61",children:t.jsx(Ie,{className:"!h-6",name:"recommendedBy",label:"label.cam.recommendation.recommendedBy*",value:T.recommendedBy,hideErrorRow:!0})}),t.jsx("div",{className:"w-64 h-24",children:t.jsx(de,{className:"!h-full",labelClassNames:"text-xs !text-primary-gray-700",name:"recommendation",label:"label.cam.recommendation.recommendation*",value:T.recommendation,variant:q.SECONDARY,hideErrorRow:!0,autoResize:!0})})]})]},`recommendation-card-${T.uid}`))}):t.jsx("div",{className:" p-5 w-full h-56 flex items-center justify-center border border-primary-ptext-500 rounded-xl",children:t.jsx(U,{className:"text-secondary-steelBlue-500",label:"No Data"})})})})})})},vt={uid:"",sanctionCondition:"",smSanctionType:"",smCategory:"",remarks:"",isActive:!0},pt={dropdownOptions:{sanctionCategory:[],sanctionType:[]},stageUid:"",tableObj:{search:""}},ft=()=>{const l=ye(),[i,j]=a.useState({...pt}),[L,P]=a.useState(_.VIEW),[,E]=a.useState(!1),[T,B]=a.useState(""),[F,w]=a.useState(!1),[Y,N]=a.useState(""),[O,W]=a.useState(!1);re.useRef(null);const m=a.useRef(null),A=a.useRef(null),r=a.useRef(new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>E(n=>!n)}}));a.useEffect(()=>{j(n=>({...n,stageUid:(l==null?void 0:l.stageUid)??""})),ne(),f()},[]),a.useEffect(()=>{l!=null&&l.loanUid&&i.stageUid&&j(n=>({...n,tableObj:{search:`&loan.uid=${l.loanUid}&stage.uid=${i.stageUid}`}}))},[l==null?void 0:l.loanUid,i.stageUid]),a.useEffect(()=>{var n;m&&m.current&&i.tableObj.search&&((n=m.current)==null||n.search())},[i.tableObj.search]),a.useEffect(()=>{var n;A!=null&&A.current&&T!==""&&((n=A==null?void 0:A.current)==null||n.showFunction(),B(""))},[T,F]),a.useEffect(()=>{Y&&W(!0)},[Y]);const ne=async()=>{Re.getAll(0,30,"staticMasterType.code=SANCTION_CONDITION_TYPE&").then(n=>{var c;te(n)&&ae("sanctionType",(c=n==null?void 0:n.data)==null?void 0:c.results)}).catch(n=>{console.log(n),N(G(n))})},f=async()=>{Re.getAll(0,10,"staticMasterType.code=SANCTION_CONDITION_CATEGORY&").then(n=>{var c;te(n)&&ae("sanctionCategory",(c=n==null?void 0:n.data)==null?void 0:c.results)}).catch(n=>{console.log(n),N(G(n))})},u=(n,c)=>{var k;const p={...c};n.target.name.includes("smSanctionType")?p.smSanctionType=n.target.value:n.target.name.includes("smCategory")&&(p.smCategory=n.target.value),(k=m.current)==null||k.reportDataChange(p)},h=n=>{var c,p;(p=r==null?void 0:r.current)==null||p.showMessageFor((c=n==null?void 0:n.target)==null?void 0:c.name)},y=()=>{var c,p;let n=!1;return n=((c=r==null?void 0:r.current)==null?void 0:c.allValid())??!1,n||(E(k=>!k),(p=r==null?void 0:r.current)==null||p.showMessages(),E(k=>!k),!1)},g=()=>P(_.EDIT),ue=()=>{var n;he(),P(_.VIEW),(n=m==null?void 0:m.current)==null||n.search()},me=async()=>{var c;if(!y())return;const n=xe();try{const p=await K.updateSanctionConditions(n);Ee(p)&&(B(je.SAVED),w(!F),P(_.VIEW),(c=m==null?void 0:m.current)==null||c.search())}catch(p){console.log(p),N(G(p))}},ge=()=>{var n;(n=m.current)==null||n.addRow(vt)},xe=()=>{const n=()=>{var k,J,be;return[...((k=m.current)==null?void 0:k.getAddedRecords())??[],...((J=m.current)==null?void 0:J.getUpdatedRecords())??[],...((be=m.current)==null?void 0:be.getDeletedRecords())??[]].map(S=>({uid:S!=null&&S.uid?S==null?void 0:S.uid:null,sanctionCondition:(S==null?void 0:S.sanctionCondition)??"",smSanctionType:(S==null?void 0:S.smSanctionType)??"",smCategory:(S==null?void 0:S.smCategory)??"",remarks:(S==null?void 0:S.remarks)??"",isActive:(S==null?void 0:S.isActive)??!1}))};return{loan:{uid:(l==null?void 0:l.loanUid)??null},stage:{uid:i.stageUid},sanctionedConditions:n()}},ae=(n,c)=>{j(p=>({...p,dropdownOptions:{...p==null?void 0:p.dropdownOptions,[n]:c??[]}}))},he=()=>{var n;r.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>E(c=>!c)}}),(n=r==null?void 0:r.current)==null||n.hideMessages()},le=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.sancCondition")})}),X=n=>{var c;return t.jsx("div",{className:"h-24",children:t.jsx(de,{name:`sanctionCondition${n==null?void 0:n.uid}`,className:"!h-full",variant:q.SECONDARY,maxCount:200,autoResize:!0,value:n==null?void 0:n.sanctionCondition,onChange:p=>{var J;const k={...n};k.sanctionCondition=p.target.value,(J=m.current)==null||J.reportDataChange(k)},onBlur:h,validation:(c=r==null?void 0:r.current)==null?void 0:c.message(`sanctionCondition${n==null?void 0:n.uid}`,n==null?void 0:n.sanctionCondition,"mandatory"),hideLabel:!0})})},ve=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.type")})}),pe=n=>{var c;return t.jsx("div",{className:"h-24",children:t.jsx(ce,{name:`smSanctionType${n==null?void 0:n.uid}`,className:"!w-30",options:i.dropdownOptions.sanctionType,optionLabel:"name",optionValue:"code",value:(n==null?void 0:n.smSanctionType)??"",onChange:p=>{u(p,n)},onBlur:h,validation:(c=r==null?void 0:r.current)==null?void 0:c.message(`smSanctionType${n==null?void 0:n.uid}`,n==null?void 0:n.smSanctionType,"mandatory"),hideLabel:!0})})},fe=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.category")})}),s=n=>{var c;return t.jsx("div",{className:"h-24",children:t.jsx(ce,{name:`smCategory${n==null?void 0:n.uid}`,className:"!w-30",options:i.dropdownOptions.sanctionCategory,optionLabel:"name",optionValue:"code",value:(n==null?void 0:n.smCategory)??"",onChange:p=>{u(p,n)},onBlur:h,validation:(c=r==null?void 0:r.current)==null?void 0:c.message(`smCategory${n.uid}`,n==null?void 0:n.smCategory,"mandatory"),hideLabel:!0})})},b=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.remark")})}),C=n=>{var c;return t.jsx("div",{className:"h-24",children:t.jsx(Ie,{name:`remarks${n==null?void 0:n.uid}`,className:"!h-6",variant:q.SECONDARY,value:n==null?void 0:n.remarks,onChange:p=>{var J;const k={...n};k.remarks=p.target.value,(J=m.current)==null||J.reportDataChange(k)},onBlur:h,validation:(c=r==null?void 0:r.current)==null?void 0:c.message(`remarks${n==null?void 0:n.uid}`,n==null?void 0:n.remarks,"mandatory"),hideLabel:!0})})},I=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.recommendation.table.action")})}),V=n=>t.jsx("div",{className:"h-24",children:t.jsx(Ae,{className:"select-none",buttonType:Ue.DELETE,onClick:()=>{var c;(c=m.current)==null||c.deleteRow(n),r.current=new Q({validators:{...Z()},...D(),autoForceUpdate:{forceUpdate:()=>E(p=>!p)}})}})});return t.jsx(re.Fragment,{children:t.jsxs("div",{className:"grid gap-5 mb-5",children:[t.jsx(Le,{title:"",pageMode:L,onEdit:g,onCancel:ue,onSave:me,children:t.jsx(Ce,{override:{read:L===_.VIEW},children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("div",{className:"self-end",children:t.jsx(Ne,{buttonType:Te.ICON_TEXT_ROW,customLabel:"Add",onClick:ge})}),(l==null?void 0:l.loanUid)&&i.stageUid&&t.jsx("div",{children:t.jsxs(He,{ref:m,standardDataFormatPromise:K.getSanctionConditions,search:i.tableObj.search,uniqueKey:"uid",mode:"UPDATE",paginator:!0,className:"table-auto-height",children:[t.jsx($,{header:le,className:"!w-64 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:X}),t.jsx($,{header:ve,className:"!w-30 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:pe}),t.jsx($,{header:fe,className:"!w-30 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:s}),t.jsx($,{header:b,className:"!w-64 pl-6 py-3 text-primary-ptext-1000 text-left text-xs",body:C}),t.jsx($,{header:I,className:"px-6 py-3 text-primary-ptext-1000 text-center text-xs",style:{minWidth:"50px",width:"50px"},body:V})]})})]})})}),t.jsx(Se,{position:"bottom-right",ref:A,toastText:T,variant:ie.PRIMARY}),t.jsx(Oe,{onHide:()=>{W(!1),N("")},visible:O,errorMessage:Y})]})})},yt={stageUid:"",tableObj:{search:""}},bt=l=>{const{isLoading:i,data:j,getDetailsCallback:L,isLoadingOnReEvaluate:P}=l,E=ye(),[T,B]=a.useState({...yt});a.useState(_.VIEW),a.useState(!1);const F=re.useRef(null);a.useEffect(()=>{B(O=>({...O,stageUid:(E==null?void 0:E.stageUid)??""}))},[]),a.useEffect(()=>{var O;T.tableObj.search&&((O=F.current)==null||O.search())},[T.tableObj.search]);const w=async()=>{L==null||L({reEvaluate:!0})},Y=()=>t.jsx("div",{className:"flex items-center",children:t.jsx(U,{label:M.t("label.cam.systemRuleViolations")})}),N=O=>t.jsx("div",{className:"h-24",children:t.jsx(de,{name:"address",className:"!min-h-20 !max-h-40 h-25",placeholder:"",variant:q.SECONDARY,autoResize:!0,hideMaxCount:!0,value:(O==null?void 0:O.message)??"",disabled:!0})});return t.jsx("div",{className:"grid gap-5 mb-5",children:t.jsx(t.Fragment,{children:t.jsx("div",{className:"border border-secondary-concrete rounded-xl p-5",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("div",{className:"self-end",children:t.jsx("div",{className:"flex gap-3",children:t.jsx(Ve,{className:"text-xs text-primary-primaryBlue",label:"label.cam.checkSysViolations",onClick:w,isLoading:P})})}),i?t.jsx(ze,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):t.jsx("div",{children:T!=null&&T.stageUid?t.jsx(ct,{ref:F,value:j,search:T.tableObj.search,uniqueKey:"uid",mode:"UPDATE",children:t.jsx($,{header:Y,className:"text-primary-ptext-1000 text-left text-xs h-12 px-6  ",style:{minWidth:"170px",width:"170px"},body:N})}):null})]})})})})},jt={stageUid:"",loanUid:"",purposeOfLoan:{...at},overallComments:{...lt},salesRecommendation:[],systemRuleViolations:[],isLoadingPurposeOfLoan:!0,isLoadingOverallComments:!0,isLoadingSalesRecommendation:!0,isLoadingSystemRuleViolations:!0,isLoadingSystemRuleViolationsOnReEvaluate:!1},pn=()=>{const l=ye(),[i,j]=a.useState(jt),[L,P]=a.useState(""),[E,T]=a.useState(!1),[B,F]=a.useState(""),[w,Y]=a.useState(!1),N=a.useRef(null);a.useEffect(()=>{ne()},[]),a.useEffect(()=>{i.loanUid&&i.stageUid&&(O(),W(),m())},[i.loanUid,i.stageUid]),a.useEffect(()=>{var f;N!=null&&N.current&&L!==""&&((f=N==null?void 0:N.current)==null||f.showFunction(),P(""))},[L,E]),a.useEffect(()=>{B&&Y(!0)},[B]);const O=async f=>{try{const u=await K.getLoanPurposeAndComments(i.stageUid);if(te(u)){if(f)return u==null?void 0:u.data;j(h=>({...h,purposeOfLoan:{...h.purposeOfLoan,...Ye(u==null?void 0:u.data)},isLoadingPurposeOfLoan:!1,overallComments:{...h.overallComments,...Be(u==null?void 0:u.data)},isLoadingOverallComments:!1}))}}catch(u){console.log(u),j(h=>({...h,isLoadingPurposeOfLoan:!1,isLoadingOverallComments:!1})),F(G(u))}},W=async()=>{var f;try{const u=await K.getSalesRecommendation(i.loanUid);if(te(u)){const h=(f=u==null?void 0:u.data)==null?void 0:f.map(y=>{var g;return{uid:y==null?void 0:y.uid,recommendationDate:y!=null&&y.recommendationDate?new Date(y==null?void 0:y.recommendationDate):"",recommendedBy:((g=y==null?void 0:y.recommendedBy)==null?void 0:g.name)??"",recommendation:(y==null?void 0:y.recommendation)??""}});j(y=>({...y,salesRecommendation:[...h],isLoadingSalesRecommendation:!1}))}}catch(u){console.log(u),j(h=>({...h,salesRecommendation:[],isLoadingSalesRecommendation:!1})),F(G(u))}},m=async f=>{f!=null&&f.reEvaluate&&j(u=>({...u,isLoadingSystemRuleViolationsOnReEvaluate:!0}));try{const u=await K.getSystemRuleViolations(`loanUid=${l==null?void 0:l.loanUid}&stageUid=${l==null?void 0:l.stageUid}&reEvalValidations=${!!(f!=null&&f.reEvaluate)}`);te(u)&&j(h=>({...h,systemRuleViolations:u==null?void 0:u.data,isLoadingSystemRuleViolations:!1,isLoadingSystemRuleViolationsOnReEvaluate:!1}))}catch(u){console.log(u),j(h=>({...h,isLoadingSystemRuleViolations:!1,isLoadingSystemRuleViolationsOnReEvaluate:!1})),F(G(u))}},A=async()=>{const f=await O(!0);j(u=>({...u,purposeOfLoan:{...u.purposeOfLoan,...Ye(f)}}))},r=async()=>{const f=await O(!0);j(u=>({...u,overallComments:{...u.purposeOfLoan,...Be(f)}}))},ne=async()=>{j(f=>({...f,stageUid:(l==null?void 0:l.stageUid)??"",loanUid:(l==null?void 0:l.loanUid)??""}))};return t.jsxs("div",{className:"flex flex-col gap-5",children:[t.jsx(se,{title:"label.cam.recommendation.purposeOfLoan*",children:t.jsx(st,{isLoading:i.isLoadingPurposeOfLoan,data:i.purposeOfLoan,getDataOnCancel:A,payloadInfo:{loanUid:i.loanUid,stageUid:i.stageUid}})}),t.jsx(se,{title:"label.cam.recommendation.overallComments*",children:t.jsx(it,{isLoading:i.isLoadingOverallComments,data:i.overallComments,getDataOnCancel:r,payloadInfo:{loanUid:i.loanUid,stageUid:i.stageUid}})}),t.jsx(se,{title:"label.cam.recommendation.riskStrength",children:t.jsx(xt,{})}),t.jsx(se,{title:"label.cam.recommendation.deviations*",children:t.jsx(ut,{})}),t.jsx(se,{title:"label.cam.systemRuleViolations",children:t.jsx(bt,{isLoading:i==null?void 0:i.isLoadingSystemRuleViolations,isLoadingOnReEvaluate:i==null?void 0:i.isLoadingSystemRuleViolationsOnReEvaluate,data:i==null?void 0:i.systemRuleViolations,getDetailsCallback:f=>m({reEvaluate:f==null?void 0:f.reEvaluate})})}),t.jsx(se,{title:"label.cam.recommendation.sanctionConditions",children:t.jsx(ft,{})}),t.jsx(se,{title:"label.cam.recommendation.salesRecommendation",children:t.jsx(ht,{isLoading:i.isLoadingSalesRecommendation,data:i.salesRecommendation})}),t.jsx(Se,{position:"bottom-right",ref:N,toastText:L,variant:ie.PRIMARY}),t.jsx(Oe,{onHide:()=>{Y(!1),F("")},visible:w,errorMessage:B})]})};export{pn as default};
//# sourceMappingURL=PageRecommendations-f265d090.js.map
