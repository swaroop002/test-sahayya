import{w as Ye,r as o,aG as h,aF as c,ad as we,ae as Ue,af as Be,y as qe,v as Fe,j as t,ax as le,J as y,o as T,az as Le,aQ as ke,aS as _,av as $e,T as Y,aH as R,ao as f,aI as de,aJ as ue,aK as E}from"./index-e8217573.js";import{A as Je}from"./AutoComplete-0bca608a.js";import{B as A}from"./ButtonBox-9e46519a.js";import{E as Ve}from"./ErrorDialog-d5eef4d7.js";import{I as w}from"./InputBox-b9e88f52.js";import{I as me}from"./InputTextArea-b90aad1d.js";import{P as We}from"./PageTitle-b3bba3d4.js";import{S as Ge}from"./SimpleDropDown-061a3470.js";import{T as He}from"./Toast-ae99ea5b.js";import{S as g}from"./StaticMasterDataService-689a6eca.js";import{S as Ke}from"./StaticMasterTypeService-480bff1a.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./TransitionGroup-c8afe0ce.js";const Qe=x=>{var Z,ee,ae,te,se;const[n,S]=o.useState({masterType:{name:"",uid:""},displayName:"",systemCode:"",sequence:"",description:"",reasons:"",isActive:""}),[r,pe]=o.useState({}),[U,B]=o.useState(!1),[q,F]=o.useState(!1),[Te,L]=o.useState(!1),[ge,k]=o.useState("bottom-right"),[M,u]=o.useState(""),[P,C]=o.useState(""),[$,N]=o.useState(h.PRIMARY),[v,j]=o.useState(!1),[l,J]=o.useState(c.CREATE),[ve,b]=o.useState(!1),[he,V]=o.useState(!1),[I,ye]=o.useState(void 0),m=o.useRef(null),[,O]=o.useState(void 0),i=o.useRef(new we({validators:{...Ue()},...Be(),autoForceUpdate:{forceUpdate:()=>O(a=>!a)}})),[fe,Ee]=o.useState([]);o.useEffect(()=>{const a=qe.parse(x.location.search);a!=null&&a.mode&&(a==null?void 0:a.mode)!==void 0&&J(a.mode),a!=null&&a.uid&&(a==null?void 0:a.uid)!==void 0&&(ye(a.uid),console.log(a.uid),g.findById(a.uid).then(e=>{var s,d,ne,ie,oe,re,ce;Fe(e)&&(console.log(e),e.data&&(S({masterType:(s=e==null?void 0:e.data)==null?void 0:s.staticMasterType,displayName:((d=e==null?void 0:e.data)==null?void 0:d.name)??"",systemCode:((ne=e==null?void 0:e.data)==null?void 0:ne.code)??"",sequence:(ie=e==null?void 0:e.data)==null?void 0:ie.sequence,description:((oe=e==null?void 0:e.data)==null?void 0:oe.description)??"",reasons:((re=e==null?void 0:e.data)==null?void 0:re.reason)??"",isActive:(ce=e==null?void 0:e.data)!=null&&ce.isActive?"ACTIVE":"IN_ACTIVE"}),pe({...e==null?void 0:e.data})))}).catch(e=>{console.log(e)}))},[]),o.useEffect(()=>{var a;m!=null&&m.current&&P!==""&&((a=m==null?void 0:m.current)==null||a.showFunction())},[P,$,v]),o.useEffect(()=>{M&&V(!0)},[M]);const p=a=>{const{name:e,value:s}=a.target;S(d=>({...d,[e]:s}))},Ae=a=>{const{name:e,value:s}=a.target;S(typeof s=="object"?d=>({...d,[e]:s}):{...n,masterType:{name:s,uid:""}})},xe=a=>a.name===void 0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-39",children:[t.jsx("img",{src:$e,alt:"search-icon",className:" h-7 w-7"}),t.jsx(Y,{className:"text-primary-labelColor mt-2",label:"Loading..."})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsx(Y,{className:"text-primary-labelColor",label:a.name}),t.jsx(Y,{className:"text-secondary-gray-500 text-xxs",label:a.code})]}),Se=async a=>{let e=[];L(!0),await Ke.getAll(0,10,`name:lk=${a.query}&`).then(s=>{s.status===200&&(e=[...s.data.results],L(!1))}),e.length===0&&e.push({pinCode:void 0,city:void 0,state:void 0}),Ee(e)},D=a=>{var e,s;(s=i==null?void 0:i.current)==null||s.showMessageFor((e=a==null?void 0:a.target)==null?void 0:e.name)},W=async()=>{var e,s;let a=!1;return a=((e=i==null?void 0:i.current)==null?void 0:e.allValid())&&!q&&!U,a||(O(d=>!d),(s=i==null?void 0:i.current)==null||s.showMessages(),O(d=>!d),!1)},G=()=>{var e;return{staticMasterType:{uid:(e=n.masterType)==null?void 0:e.uid},name:n.displayName,code:n.systemCode,sequence:n.sequence,reason:n.reasons,description:n.description}},Ce=()=>{let a;if(l===c.CREATE){const e={name:n.displayName,code:n.systemCode,reason:n.reasons,description:n.description};a={name:n.displayName,operationType:de.UPDATE,entity:ue.STATIC_MASTER_DATA,initialStateJson:"",finalStateJson:E(e),reqPayload:E(e),reasonForChange:n.reasons}}else{const e={name:r==null?void 0:r.name,code:r.code,reason:r.reason,description:r.description,createdAt:r.createdAt,createdBy:r.createdBy,id:r.id,isActive:r.isActive,requestId:r.requestId,uid:r.uid,updatedAt:r.updatedAt,updatedBy:r.updatedBy},s={...e,name:n.displayName,code:n.systemCode,reason:n.reasons,description:n.description};a={name:n.displayName,operationType:de.UPDATE,entity:ue.STATIC_MASTER_DATA,initialStateJson:E(e),finalStateJson:E(s),reqPayload:E(s),reasonForChange:n.reasons}}return a},Ne=async()=>{u("");let a=!1;if(a=await W(),!a){k("top-right"),N(h.QUATERNARY),C(R.ERROR),j(!v);return}if(l===c.EDIT&&I!==void 0){const e=G();return g.update(I,e).then(s=>{k("bottom-right"),N(h.PRIMARY),C(R.SAVED),j(!v),b(!0)}).catch(s=>{u(f(s))})}else{const e=G();return g.save(e).then(s=>{N(h.PRIMARY),C(R.SAVED),j(!v),b(!0)}).catch(s=>{u(f(s))})}},je=a=>{let e=`name=${a.target.value.toUpperCase()}&staticMasterType.uid=${n.masterType.uid}`;l===c.EDIT&&(e=`name=${a.target.value.toUpperCase()}&uid:nq=${I}&staticMasterType.uid=${n.masterType.uid}`),g.getAll(0,1,`${e}`).then(s=>{s.status===200&&(s.data.results.length>0?B(!0):B(!1))}).catch(s=>{u(f(s))})},Ie=a=>{let e=`code=${a.target.value.toUpperCase()}&staticMasterType.uid=${n.masterType.uid}`;l===c.EDIT&&(e=`code=${a.target.value}&uid:nq=${I}&staticMasterType.uid=${n.masterType.uid}`),g.getAll(0,1,`${e}`).then(s=>{s.status===200&&(s.data.results.length>0?F(!0):F(!1))}).catch(s=>{u(f(s))})},De=()=>{x.navigate(_)},Re=async()=>{u("");let a=!1;if(a=await W(),!a)return;const e=Ce();return g.approve(e).then(s=>{N(h.PRIMARY),C(R.SENT_FOR_APPROVAL),j(!v),b(!0)}).catch(s=>{u(f(s))})},Me=()=>{x.navigate(_)},Pe=()=>{J(c.EDIT)},be=()=>{switch(l){case c.CREATE:return"heading.masterData.data.create";case c.VIEW:return"heading.masterData.data.view";case c.EDIT:return"heading.masterData.data.edit";default:return"heading.masterData.data.create"}},{masterType:H,displayName:K,systemCode:Q,description:Oe,reasons:z,sequence:X,isActive:_e}=n;return t.jsxs(le,{children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex w-full justify-between items-center",children:[t.jsx(We,{title:be()}),t.jsx("div",{className:"flex",children:l===c.CREATE||l===c.EDIT?t.jsxs("div",{className:"flex gap-10",children:[t.jsxs("div",{className:"flex gap-5",children:[t.jsx(A,{buttonType:y.CANCEL_OUTLINE,onClick:De}),t.jsx(A,{buttonType:y.SAVE_OUTLINE,onClickWithLoader:Ne})]}),t.jsx("div",{children:t.jsx(A,{buttonType:y.SEND_FOR_APPROVAL,onClickWithLoader:Re})})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mr-5",children:t.jsx(A,{buttonType:y.BACK_OUTLINE,onClick:Me})}),t.jsx("div",{className:"",children:t.jsx(A,{buttonType:y.EDIT_OUTLINE,className:"blue-primary",onClick:Pe})})]})})]}),t.jsx(le,{override:{read:c.VIEW===l},children:t.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-3",children:[t.jsx("div",{className:"col-span-1",children:t.jsx(Je,{label:"input.staticMaster.data.masterType",name:"masterType",field:"masterType",value:H.name,variant:T.PRIMARY,suggestions:fe,completeMethod:Se,onChange:Ae,onBlur:D,itemTemplate:xe,loader:Te,validation:(Z=i==null?void 0:i.current)==null?void 0:Z.message("masterType",H.uid,"autocomplete")})}),t.jsx("div",{className:"col-span-1",children:t.jsx(w,{label:"input.staticMaster.data.displayName",name:"displayName",variant:T.SECONDARY,onChange:p,value:K,onBlur:a=>{je(a),D(a)},validation:U?"Duplicate Entry Found":(ee=i==null?void 0:i.current)==null?void 0:ee.message("displayName",K,"mandatory")})}),t.jsx("div",{className:"col-span-1",children:t.jsx(w,{label:"input.staticMaster.data.systemCode",name:"systemCode",variant:T.SECONDARY,onChange:p,value:Q,onBlur:a=>{Ie(a),D(a)},validation:q?"Duplicate Entry Found":(ae=i==null?void 0:i.current)==null?void 0:ae.message("systemCode",Q,"onlyAlphaNumUnderscoreUpperScore|mandatory")})}),t.jsx("div",{className:"col-span-1",children:t.jsx(w,{label:"input.staticMaster.data.sequence",name:"sequence",variant:T.SECONDARY,onChange:p,value:X,onBlur:D,validation:(te=i==null?void 0:i.current)==null?void 0:te.message("sequence",X,"mandatory|onlyInteger")})}),l!==c.CREATE&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"col-span-1",children:t.jsx(Ge,{label:"input.masterData.staticMaster.isActive",name:"isActive",variant:Le.SECONDARY,onChange:p,value:_e,options:ke,disabled:!0})}),t.jsx("div",{className:"col-span-3"})]}),t.jsx("div",{className:"col-span-2",children:t.jsx(me,{label:"input.staticMaster.description",name:"description",variant:T.SECONDARY,maxCount:200,onChange:p,value:Oe})}),l!==c.VIEW&&t.jsx("div",{className:"col-span-2",children:t.jsx(me,{label:"input.staticMaster.reasons",name:"reasons",variant:T.SECONDARY,maxCount:200,onChange:p,value:z,validation:(se=i==null?void 0:i.current)==null?void 0:se.message("reasons",z,"mandatory")})}),t.jsx("div",{className:"",children:t.jsx(He,{position:ge,ref:m,toastText:P,variant:$,onRemove:()=>{ve&&x.navigate(_)}})})]})})]}),t.jsx(Ve,{onHide:()=>V(!1),visible:he,errorMessage:M})]})},Ta=Ye(Qe);export{Ta as default};
//# sourceMappingURL=PageStaticMasterDataCreateViewEdit-79411283.js.map
