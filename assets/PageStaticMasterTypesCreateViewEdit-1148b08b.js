import{w as Ce,r as n,aF as o,aG as N,ad as Ne,ae as Ie,af as xe,y as Re,v as Z,aO as De,aP as I,j as s,ax as ee,J as y,o as x,az as Pe,aQ as Me,d as b,aH as B,ao as V,aL as je,aI as ae,aJ as te,aK as h}from"./index-e8217573.js";import{B as A}from"./ButtonBox-9e46519a.js";import{E as Oe}from"./ErrorDialog-d5eef4d7.js";import{I as se}from"./InputBox-b9e88f52.js";import{I as ie}from"./InputTextArea-b90aad1d.js";import{P as _e}from"./PageTitle-b3bba3d4.js";import{S as we}from"./SimpleDropDown-061a3470.js";import{T as Ye}from"./Toast-ae99ea5b.js";import{A as be}from"./ApprovalRequestService-f8cdf7f8.js";import{S as T}from"./StaticMasterTypeService-480bff1a.js";import"./kebab-menu-8835ad2e.js";import"./Dialog-adadaf64.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./TransitionGroup-c8afe0ce.js";function Be(v){var K,z,Q;const[i,R]=n.useState({displayName:"",systemCode:"",description:"",reasons:"",isActive:""}),[d,k]=n.useState({}),[l,F]=n.useState(o.CREATE),[S,ne]=n.useState(void 0),[oe,re]=n.useState(void 0),[,D]=n.useState(void 0),[ce,L]=n.useState(!1),[de,U]=n.useState(!1),[le,J]=n.useState(!1),[P,M]=n.useState(""),[j,g]=n.useState(""),[W,O]=n.useState(N.PRIMARY),[C,_]=n.useState(!1),[ue,w]=n.useState(!1),E=n.useRef(null),r=n.useRef(new Ne({validators:{...Ie()},...xe(),autoForceUpdate:{forceUpdate:()=>D(e=>!e)}}));n.useEffect(()=>{const e=Re.parse(v.location.search);e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&F(e.mode),e!=null&&e.reviewMode&&(e==null?void 0:e.reviewMode)!==void 0&&re(e.reviewMode),e!=null&&e.uid&&(e==null?void 0:e.uid)!==void 0&&(ne(e.uid),(e==null?void 0:e.mode)==o.REVIEW?be.getByUid(e.uid).then(a=>{if(Z(a)&&(Object.keys(a.data).length>0||a.data.id)){let t;e.reviewMode==De.NEW?t=JSON.parse(a.data.finalStateJson):t=JSON.parse(a.data.initialStateJson),console.log(oe),console.log(t),R(c=>({...c,displayName:(t==null?void 0:t.name)??"",systemCode:(t==null?void 0:t.code)??"",description:(t==null?void 0:t.description)??"",reasons:(t==null?void 0:t.reason)??"",isActive:t!=null&&t.isActive?I.ACTIVE:I.INACTIVE})),k({...t})}}).catch(a=>{}):T.findById(e.uid).then(a=>{Z(a)&&(console.log(a),(Object.keys(a.data).length>0||a.data.id)&&(R(t=>{var c,u,m,p,X;return{...t,displayName:((c=a==null?void 0:a.data)==null?void 0:c.name)??"",systemCode:((u=a==null?void 0:a.data)==null?void 0:u.code)??"",description:((m=a==null?void 0:a.data)==null?void 0:m.description)??"",reasons:((p=a==null?void 0:a.data)==null?void 0:p.reason)??"",isActive:(X=a==null?void 0:a.data)!=null&&X.isActive?I.ACTIVE:I.INACTIVE}}),k({...a==null?void 0:a.data})))}).catch(a=>{}))},[]),n.useEffect(()=>{var e;E!=null&&E.current&&P!==""&&((e=E==null?void 0:E.current)==null||e.showFunction())},[P,W,C]),n.useEffect(()=>{j&&J(!0)},[j]);const Y=async e=>{var a,t;if(e.target.name==="displayName"){let c=`name=${e.target.value}`;l===o.EDIT&&(c=`name=${e.target.value}&uid:nq=${S}`),await T.getAll(0,10,`${c}&`).then(u=>{var m,p;(m=u.data)!=null&&m.results&&((p=u.data)==null?void 0:p.results.length)>0?L(!0):L(!1)})}if(e.target.name==="systemCode"){let c=`code=${e.target.value}`;l===o.EDIT&&(c=`code=${e.target.value}&uid:nq=${S}`),await T.getAll(0,10,`${c}&`).then(u=>{var m,p;(m=u.data)!=null&&m.results&&((p=u.data)==null?void 0:p.results.length)>0?U(!0):U(!1)})}(t=r==null?void 0:r.current)==null||t.showMessageFor((a=e==null?void 0:e.target)==null?void 0:a.name)},$=async()=>{var a,t;let e=!1;return e=((a=r==null?void 0:r.current)==null?void 0:a.allValid())??!1,e||(D(c=>!c),(t=r==null?void 0:r.current)==null||t.showMessages(),D(c=>!c),!1)},f=e=>{const{name:a,value:t}=e.target;R(c=>({...c,[a]:t}))},me=async()=>{g("");let e=!1;if(e=await $(),!!e)if(l===o.CREATE){const a=fe();return T.save(a).then(t=>{O(N.PRIMARY),M(B.SAVED),_(!C),w(!0)}).catch(t=>{g(V(t))})}else{const a=ye();return T.update(a,S).then(t=>{O(N.PRIMARY),M(B.SAVED),_(!C),w(!0)}).catch(t=>{g(V(t))})}},pe=()=>{v.navigate(b)},Ee=async()=>{g("");let e=!1;if(e=await $(),!e)return;const a=he();return T.approve(a).then(t=>{O(N.PRIMARY),M(B.SENT_FOR_APPROVAL),_(!C),w(!0)}).catch(t=>{g(V(t))})},Te=()=>{v.navigate(b)},ve=()=>{F(o.EDIT),v.navigate(`${je}?mode=${o.EDIT}&uid=${S}`)},ge=()=>{switch(l){case o.CREATE:return"heading.masterData.types.create";case o.REVIEW:return"heading.masterData.types.review";case o.VIEW:return"heading.masterData.types.view";case o.EDIT:return"heading.masterData.types.edit";default:return"heading.masterData.types.create"}},fe=()=>({name:i.displayName,code:i.systemCode,reason:i.reasons,description:i.description}),ye=()=>({...d,name:i.displayName,code:i.systemCode,reason:i.reasons,description:i.description}),he=()=>{let e;if(l===o.CREATE){const a={name:i.displayName,code:i.systemCode,reason:i.reasons,description:i.description};e={name:i.displayName,operationType:ae.CREATE,entity:te.STATIC_MASTER_TYPE,initialStateJson:"",finalStateJson:h(a),reqPayload:h(a),reasonForChange:i.reasons}}else{const a={name:d==null?void 0:d.name,code:d.code,reason:d.reason,description:d.description,createdAt:d.createdAt,createdBy:d.createdBy,id:d.id,isActive:d.isActive,requestId:d.requestId,uid:d.uid,updatedAt:d.updatedAt,updatedBy:d.updatedBy},t={...a,name:i.displayName,code:i.systemCode,reason:i.reasons,description:i.description};e={name:i.displayName,operationType:ae.UPDATE,entity:te.STATIC_MASTER_TYPE,initialStateJson:h(a),finalStateJson:h(t),reqPayload:h(t),reasonForChange:i.reasons}}return e},{displayName:q,systemCode:G,description:Ae,reasons:H,isActive:Se}=i;return console.log(i,"here"),s.jsxs(ee,{children:[s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex w-full justify-between items-center",children:[s.jsx(_e,{title:ge()}),s.jsx("div",{className:"flex ",children:l===o.CREATE||l===o.EDIT?s.jsxs("div",{className:"flex gap-10",children:[s.jsxs("div",{className:"flex gap-5",children:[s.jsx(A,{buttonType:y.CANCEL_OUTLINE,onClick:pe}),s.jsx(A,{buttonType:y.SAVE_OUTLINE,onClickWithLoader:me})]}),s.jsx("div",{children:s.jsx(A,{buttonType:y.SEND_FOR_APPROVAL,onClickWithLoader:Ee})})]}):l===o.VIEW?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mr-5",children:s.jsx(A,{buttonType:y.BACK_OUTLINE,onClick:Te})}),s.jsx("div",{className:"",children:s.jsx(A,{buttonType:y.EDIT_OUTLINE,onClick:ve})})]}):s.jsx("div",{className:"h-18"})})]}),s.jsx(ee,{override:{read:[o.VIEW,o.REVIEW].includes(l)},children:s.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[s.jsx("div",{className:"col-span-1",children:s.jsx(se,{label:"input.staticMaster.displayName",name:"displayName",variant:x.SECONDARY,value:q,onChange:f,onBlur:Y,validation:ce?"Duplicate Entry Found":(K=r==null?void 0:r.current)==null?void 0:K.message("displayName",q,"mandatory")})}),s.jsx("div",{className:"col-span-1",children:s.jsx(se,{label:"input.staticMaster.systemCode",name:"systemCode",variant:x.SECONDARY,value:G,onBlur:Y,onChange:f,validation:de?"Duplicate Entry Found":(z=r==null?void 0:r.current)==null?void 0:z.message("systemCode",G,"mandatory|alphaNumericUnderscore|capitalLetters")})}),l!==o.CREATE?s.jsx("div",{className:"col-span-1",children:s.jsx(we,{disabled:!0,label:"input.masterData.staticMaster.isActive",name:"isActive",variant:Pe.SECONDARY,value:Se,options:Me,onChange:f})}):s.jsx("div",{className:"col-span-2"}),s.jsx("div",{className:"col-span-2",children:s.jsx(ie,{label:"input.staticMaster.description",name:"description",value:Ae,variant:x.SECONDARY,onChange:f})}),l!==o.VIEW&&s.jsx("div",{className:"col-span-2",children:s.jsx(ie,{label:"input.staticMaster.reasons",name:"reasons",variant:x.SECONDARY,value:H,onChange:f,onBlur:Y,validation:(Q=r==null?void 0:r.current)==null?void 0:Q.message("reasons",H,"mandatory")})})]})})]}),s.jsx(Ye,{position:"bottom-right",ref:E,toastText:P,variant:W,onRemove:()=>{ue&&v.navigate(b)}}),s.jsx(Oe,{onHide:()=>J(!1),visible:le,errorMessage:j})]})}const Ze=Ce(Be);export{Ze as default};
//# sourceMappingURL=PageStaticMasterTypesCreateViewEdit-1148b08b.js.map
