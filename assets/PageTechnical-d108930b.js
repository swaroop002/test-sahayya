import{q as te,x as ae,r as o,aG as A,S as ne,g as oe,ag as le,dl as T,ao as j,j as e,T as re,N as ie,l as E,i as D,Z as ce,J as U,ax as de,K as me,M as xe,e9 as ue,Q as fe,V as Ne,ea as ge,eb as he,ec as pe,L as Ae,d7 as V,cZ as B,b as $,aH as Te,f as je,m as Ee}from"./index-e8217573.js";import{u as Se}from"./LoanDetailActions-c6533c8e.js";import{c as be,M as ve,C as ye}from"./MainMessageBody-e15b4437.js";import{A as Ie}from"./AuthValidator-4e739521.js";import{B as k}from"./ButtonBox-9e46519a.js";import{D as Le}from"./Dialog-adadaf64.js";import{E as Ce}from"./ErrorDialog-d5eef4d7.js";import{S as _e}from"./SimpleOverlayPanel-f23b2f6a.js";import{T as we}from"./TextButton-41b4a67e.js";import{T as Re}from"./Toast-ae99ea5b.js";import{A as Oe}from"./ACLService-e19daf7c.js";import{T as H}from"./TechnicalService-8f4efd87.js";import{L as Pe}from"./LoanService-d10912e0.js";import{u as Me}from"./useSelector-dc41929a.js";import"./Skeleton-7e12d019.js";import"./InputBox-b9e88f52.js";import"./withAuth-6de36ebf.js";import"./StageService-c1c03c89.js";import"./kebab-menu-8835ad2e.js";import"./loader-5f2cfb31.js";import"./TransitionGroup-c8afe0ce.js";const De=[{id:1,name:"Report",path:ge},{id:2,name:"Document Exchange",path:he},{id:3,name:"Deviations",path:pe}],Ue={stageComplete:!1,submit:!1},os=()=>{const n=te(),G=ae(),[x,u]=o.useState({...Ue}),[f,c]=o.useState(""),[Y]=o.useState("bottom-right"),[K,d]=o.useState(!1),[N,S]=o.useState(""),[b,v]=o.useState(A.PRIMARY),[g,y]=o.useState(!1),[m,I]=o.useState(!1),[J,z]=o.useState(!1),i=o.useRef(null),h=Me(s=>s.UserProfileReducers.profileObj),W=(h==null?void 0:h.sahayyaUserType)===ne.PARTNER_USER;o.useEffect(()=>{X()},[]),o.useEffect(()=>{console.log(m,"message ");const s=oe("VITE_MESSAGE_CONVERSATION_TIMING"),a=async()=>{try{const l=await ye.checkNewMessageAvailability((n==null?void 0:n.stageUid)??"");z(l==null?void 0:l.data)}catch(l){console.log(l)}};a();const r=setInterval(a,s);return()=>{clearInterval(r)}},[]),o.useEffect(()=>{if(n!=null&&n.stageUid){const s=JSON.parse(le(Ae.STAGE_DETAIL));(s==null?void 0:s.status)===T.COMPLETED||(s==null?void 0:s.status)===T.CANCELLED?u(a=>({...a,stageComplete:!0,submit:!0})):(s==null?void 0:s.status)===T.IN_REVIEW?u(a=>({...a,stageComplete:!1,submit:!0})):u(a=>({...a,stageComplete:!1,submit:!1}))}},[n==null?void 0:n.stageUid]),o.useEffect(()=>{var s;i!=null&&i.current&&N!==""&&((s=i==null?void 0:i.current)==null||s.showFunction())},[N,b,g]),o.useEffect(()=>{f&&d(!0)},[f]);const X=()=>{const a=`&uid=${n.loanUid}`;Pe.getAll(0,1,a).then(r=>{const l=r.data.results[0];G(Se(l))}).catch(r=>{console.log(r),c(j(r))})},Z=async()=>{try{const s=await H.stageComplete((n==null?void 0:n.stageUid)??"",{});if(V(s)&&(S("Stage completed successfully"),v(A.PRIMARY),y(!g),Oe.isRouteHasAccess(B))){const a=`${$}${E}${D}${B}/${n.loanUid}/`;window.location.href=a}}catch(s){console.log(s),d(!0),c(j(s))}},q=async()=>{try{const s=await H.submit((n==null?void 0:n.stageUid)??"",{});V(s)&&(S(Te.SAVED),v(A.PRIMARY),y(!g))}catch(s){console.log(s),d(!0),c(j(s))}},Q=({isActive:s})=>`tab text-sm px-2.5 py-1 min-w-fit ${s?"bg-secondary-steelBlue-900 rounded-sm text-white font-medium shadow-activeBtn ":"text-primary-500"}`,[t,F]=o.useState({assignedTo:"",delegateTo:"",initiation:"",internalVendor:"",externalVendor:"",status:""}),p=o.useRef(null),ee=s=>{var r,l,C,_,w,R,O,P,M;const a=localStorage.getItem("stageDetail");F({assignedTo:((l=(r=JSON.parse(a))==null?void 0:r.assignee)==null?void 0:l.name)??"NA",delegateTo:((_=(C=JSON.parse(a))==null?void 0:C.delegate)==null?void 0:_.name)??"NA",initiation:((w=JSON.parse(a))==null?void 0:w.createdAtSystemDate)??"NA",externalVendor:((R=JSON.parse(a))==null?void 0:R.partner.name)??"NA",internalVendor:((O=JSON.parse(a))==null?void 0:O.internalVendor)??"NA",status:((P=JSON.parse(a))==null?void 0:P.status)??"NA"}),p.current&&((M=p.current)==null||M.toggle(s))},L=s=>{I(!m)},se=()=>e.jsxs("div",{className:"flex flex-col gap-4 p-5 ",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Status :"}),e.jsx("div",{className:"ml-2 text-sm font-bold text-secondary-stext-900",children:t==null?void 0:t.status})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Assigned to :"}),e.jsx("div",{className:"ml-2 text-sm font-bold text-secondary-stext-900",children:t==null?void 0:t.assignedTo})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Delegated to :"}),e.jsx("div",{className:"ml-2 text-sm font-bold text-secondary-stext-900",children:t==null?void 0:t.delegateTo})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Date of Initiation :"}),e.jsx("div",{className:"ml-2 text-sm font-bold text-secondary-stext-900",children:je(t==null?void 0:t.initiation)})]}),(t==null?void 0:t.internalVendor)!=="NA"?e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"Internal Vendor :"}),e.jsx("div",{className:"ml-2 text-sm font-bold text-secondary-stext-900",children:t.internalVendor!=="NA"?t.internalVendor:"NA"})]}):null,(t==null?void 0:t.externalVendor)!=="NA"?e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("div",{className:"text-sm text-secondary-stext-900",children:"External Vendor :"}),e.jsx("div",{className:"ml-2 text-sm font-bold text-secondary-stext-900",children:t.externalVendor!=="NA"?t.externalVendor:"NA"})]}):null]});return e.jsxs("div",{className:"flex flex-col gap-5 ",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-5",children:[e.jsxs("div",{className:"flex items-center w-11/12 gap-5",children:[e.jsxs("div",{className:"flex items-center gap-2 px-5 py-2 border-r border-secondary-stext-600 ",children:[e.jsx(re,{className:"font-bold text-primary-ptext-1000",label:"heading.technical.technicalReport"}),e.jsx(we,{className:"underline text-xs  !text-black  ",label:"View Details",onClick:ee}),e.jsxs("button",{onClick:L,className:"relative ",children:[e.jsx("img",{src:be,alt:"ChatIcon",className:""})," ",J?e.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"w-3/5",children:De.map(s=>e.jsx(ie,{className:Q,to:`${E}${D}${ce}/${n.loanUid}/${n.stageUid}${s.path}`,children:s.name},s.path))})]}),e.jsxs("div",{className:"flex justify-end w-1/4 gap-4",children:[W?e.jsx(e.Fragment,{}):e.jsx(k,{buttonType:U.STAGE_COMPLETE,onClickWithLoader:Z,size:"LOAN_DATA",disabled:x.stageComplete}),e.jsx(k,{buttonType:U.SUBMIT,onClickWithLoader:q,size:"LOAN_DATA",disabled:x.submit})]})]}),e.jsx("div",{className:"technical-layout-body-content",children:e.jsxs(de,{override:{read:x.stageComplete},children:[e.jsx(o.Suspense,{fallback:e.jsx(me,{}),children:e.jsx(xe,{children:ue.map((s,a)=>e.jsx(fe,{path:s.path,element:e.jsx(Ie,{AuthorizedComponent:s.component,urlPath:s.altPath?s.altPath:s.path})},a))})}),e.jsx(Ne,{})]})}),m?e.jsx(Le,{visible:m,closable:!1,model:"false",onHide:()=>I(!1),className:"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162",children:e.jsx(ve,{params:n,handleCloseOverLay:L})}):null,e.jsx(Ce,{onHide:()=>{d(!1),c("")},visible:K,errorMessage:f}),e.jsx(_e,{className:"rounded-lg shadow-lg !w-80 p-1.5 ",ref:p,content:se()}),e.jsx(Re,{position:Y,ref:i,toastText:N,variant:b,onRemove:()=>{const s=$+E+Ee;window.location.href=s}})]})};export{os as default};
//# sourceMappingURL=PageTechnical-d108930b.js.map
