import{w as st,r as c,aF as u,aG as A,y as nt,ad as at,ae as ot,af as rt,j as s,ax as re,J as x,o as j,az as ce,T as M,cl as V,aH as y,ao as W,aA as ct,aI as ie,aJ as de,aK as I,av as it,bb as dt}from"./index-e8217573.js";import{B as E}from"./ButtonBox-9e46519a.js";import{I as ut}from"./InputBox-b9e88f52.js";import{I as ue}from"./InputTextArea-b90aad1d.js";import{P as lt}from"./PageTitle-b3bba3d4.js";import{S as J}from"./SimpleDropDown-061a3470.js";import{T as mt}from"./Toast-ae99ea5b.js";import{B as pt}from"./BusinessRuleService-e622f5ea.js";import{A as ft}from"./AutoComplete-0bca608a.js";import{C as ht}from"./CheckBox-8a0c0e77.js";import{E as gt,C as F}from"./EditableTableV2-6afcb42b.js";import{E as xt}from"./ErrorDialog-d5eef4d7.js";import{T as O}from"./TransactionApproval-6206dfb9.js";import{S as Et}from"./StaticMasterTypeService-480bff1a.js";import{P as Ct}from"./ProductConfigProductService-51cfb6b7.js";import{I as Tt}from"./IncomeSchemeService-d239ebaf.js";import{M as At}from"./MenuBox-defc36b0.js";import"./kebab-menu-8835ad2e.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./TransitionGroup-c8afe0ce.js";import"./search_icon-459d6871.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";const St=b=>{var te,se,ne;const[n,H]=c.useState({name:"",ruleApplied:"",productConfigType:"",productName:"",productScheme:"",description:"",reasons:"",attachments:[]}),q={isActive:!0,user:{uid:""}},[le,me]=c.useState({name:"",ruleApplied:"",productConfigType:"",productName:"",productScheme:"",description:"",reasons:""}),[m,$]=c.useState(u.CREATE),[,_]=c.useState(void 0),[pe,fe]=c.useState([]),[he,ge]=c.useState([]),[xe,Ee]=c.useState([]),[h,Ce]=c.useState(""),i=c.useRef(null),[U,S]=c.useState(""),[Te,G]=c.useState("bottom-right"),[K,v]=c.useState(A.PRIMARY),[D,N]=c.useState(""),[C,R]=c.useState(!1),[Ae,Y]=c.useState(!1),g=c.useRef(null),[Se,X]=c.useState(!1),[ve,w]=c.useState([]),[Ne,Re]=c.useState(void 0),[Pe,je]=c.useState(!0),L=c.useRef(null);c.useEffect(()=>{var t;const e=nt.parse(b.location.search);e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&$(e.mode),Ce(e.uid),Ke(),Xe(),Qe(),Pe&&e.mode=="CREATE"&&((t=i==null?void 0:i.current)==null||t.addRow(q),je(!1))},[]),c.useEffect(()=>{h&&Ye()},[h]),c.useEffect(()=>{console.log("object")},[n]),c.useEffect(()=>{var e;g!=null&&g.current&&D!==""&&((e=g==null?void 0:g.current)==null||e.showFunction())},[D,K,C]),c.useEffect(()=>{U&&X(!0)},[U]);const T=e=>{const{name:t,value:a}=e.target;H(r=>{let o={...r,[t]:a};return t==="productName"?o={...o,productScheme:null,productConfigType:" PRODUCT"}:t==="productScheme"&&(o={...o,productName:null,productConfigType:"PRODUCT_INCOME_SCHEME"}),o})},Q=async()=>{var t,a;let e=!1;return e=((t=d==null?void 0:d.current)==null?void 0:t.allValid())??!1,e||(_(r=>!r),(a=d==null?void 0:d.current)==null||a.showMessages(),_(r=>!r),!1)},ye=()=>{var r,o;const e=[...((r=i.current)==null?void 0:r.getAddedRecords())??[]],t={name:n.name,rule:{uid:n.ruleApplied},productConfigType:"",product:{uid:n.productName},incomeSchemeProduct:{uid:n.productScheme},reason:n.reasons,description:n.description,users:[{user:{uid:""},isActive:!1}]},a=e.map(l=>({user:{uid:l.user.uid},isActive:l.isActive}));return t!=null&&t.product.uid?t.productConfigType="PRODUCT":(o=t==null?void 0:t.incomeSchemeProduct)!=null&&o.uid?t.productConfigType="PRODUCT_INCOME_SCHEME":t.productConfigType=null,n!=null&&n.productName?t.incomeSchemeProduct=null:(n!=null&&n.productScheme||(t.incomeSchemeProduct=null),t.product=null),t.users=a,t},Ie=()=>{var r,o,l,f;const e=[...((r=i.current)==null?void 0:r.getAddedRecords())??[],...((o=i.current)==null?void 0:o.getDeletedRecords())??[],...((l=i.current)==null?void 0:l.getUpdatedRecords())??[]],t={uid:h,name:n.name,rule:{uid:n.ruleApplied},productConfigType:"",product:{uid:n.productName},incomeSchemeProduct:{uid:n.productScheme},reason:n.reasons,description:n.description,users:[{user:{uid:""},isActive:!1}]},a=e.map(p=>({user:{uid:p.user.uid},isActive:p.isActive,uid:p.uid}));return t.users=a,t!=null&&t.product.uid?t.productConfigType="PRODUCT":(f=t==null?void 0:t.incomeSchemeProduct)!=null&&f.uid?t.productConfigType="PRODUCT_INCOME_SCHEME":t.productConfigType=null,n!=null&&n.productName?t.incomeSchemeProduct=null:(n!=null&&n.productScheme||(t.incomeSchemeProduct=null),t.product=null),t},Oe=()=>{var f,p,P,ae;const e=[...((f=i.current)==null?void 0:f.getAddedRecords())??[],...((p=i.current)==null?void 0:p.getDeletedRecords())??[],...((P=i.current)==null?void 0:P.getUpdatedRecords())??[]],t={name:n.name,uid:h,rule:{uid:n.ruleApplied},productConfigType:"",product:{uid:n.productName},incomeSchemeProduct:{uid:n.productScheme},reason:n.reasons,description:n.description,users:[{user:{uid:""},isActive:!1}]},a=e.map(oe=>({user:{uid:oe.user.uid},isActive:oe.isActive}));t!=null&&t.product.uid?t.productConfigType="PRODUCT":(ae=t==null?void 0:t.incomeSchemeProduct)!=null&&ae.uid?t.productConfigType="PRODUCT_INCOME_SCHEME":t.productConfigType=null,n!=null&&n.productName?t.incomeSchemeProduct=null:(n!=null&&n.productScheme||(t.incomeSchemeProduct=null),t.product=null),t.users=a;let r;const o=t,l=le;return m===u.CREATE?r={name:n.name,operationType:ie.CREATE,entity:de.TRANSACTION_APPROVAL_RULE,initialStateJson:"",finalStateJson:I(o),reqPayload:I(o),reasonForChange:n.reasons}:r={name:n.name,uid:h,operationType:ie.UPDATE,entity:de.TRANSACTION_APPROVAL_RULE,initialStateJson:I(l),finalStateJson:I(o),reqPayload:I(o),reasonForChange:n.reasons},r},be=async()=>{S("");let e=!1;if(e=await Q(),!e){G("top-right"),v(A.QUATERNARY),N(y.ERROR),R(!C);return}if(m===u.CREATE){const t=ye();return O.save(t).then(a=>{v(A.PRIMARY),N(y.SAVED),R(!C),Y(!0)}).catch(a=>{S(W(a))})}else{const t=Ie();return O.update(h,t).then(a=>{v(A.PRIMARY),N(y.SAVED),R(!C),Y(!0)}).catch(a=>{S(W(a))})}},Le=()=>{b.navigate(V)},Me=async()=>{S("");let e=!1;if(e=await Q(),!e){G("top-right"),v(A.QUATERNARY),N(y.ERROR),R(!C);return}const t=Oe();return Et.approve(t).then(a=>{v(A.PRIMARY),N(y.SENT_FOR_APPROVAL),R(!C),Y(!0)}).catch(a=>{S(W(a))})},_e=()=>{b.navigate(V)},Ue=()=>{$(u.EDIT)},De=()=>{var e;(e=i==null?void 0:i.current)==null||e.addRow(q)},Ye=()=>{O.getProductInfo(h).then(e=>{var t,a,r,o,l,f,p,P;console.log(e.data,"response"),H({...n,name:e.data.name,ruleApplied:((a=(t=e.data)==null?void 0:t.rule)==null?void 0:a.uid)??"",productName:(r=e.data.product)==null?void 0:r.uid,productScheme:(o=e.data.incomeSchemeProduct)==null?void 0:o.uid,description:e.data.description,reasons:e.data.reason}),me({...n,name:e.data.name,ruleApplied:((f=(l=e.data)==null?void 0:l.rule)==null?void 0:f.uid)??"",productName:(p=e.data.product)==null?void 0:p.uid,productScheme:(P=e.data.incomeSchemeProduct)==null?void 0:P.uid,description:e.data.description,reasons:e.data.reason})}).catch(e=>{console.log(e)})},k=e=>{var t,a;(a=d==null?void 0:d.current)==null||a.showMessageFor((t=e==null?void 0:e.target)==null?void 0:t.name)},we=()=>{switch(m){case u.CREATE:return"heading.productConfiguration.transaction.create";case u.VIEW:return"heading.productConfiguration.transaction.view";case u.EDIT:return"heading.productConfiguration.transaction.edit";default:return"heading.productConfiguration.transaction.create"}},ke=e=>{const r=`&sahayyaUserType=EMPLOYEE_USER&name:lk=${e}`;O.getAllUsers(0,30,r).then(o=>{var f,p;const l=((p=(f=o.data)==null?void 0:f.results)==null?void 0:p.length)>0?[...o.data.results]:[];l.length===0?w([{name:dt.NO_Banks}]):w([...l])})},Be=(e,t)=>{clearTimeout(Ne),Re(setTimeout(e,t))},Ve=e=>{const t=e.query;e.query.length>=1?Be(ke(t),1200):w([])},We=e=>e.name===void 0?s.jsxs("div",{className:"flex flex-col items-center justify-center h-39",children:[s.jsx("img",{src:it,alt:"search-icon",className:" h-7 w-7"}),s.jsx(M,{className:"text-primary-labelColor mt-2",label:"Loading..."})]}):s.jsxs("div",{className:"flex flex-col",children:[s.jsx(M,{className:"text-primary-labelColor",label:e.name}),s.jsx(M,{className:"text-secondary-gray-500 text-xxs",label:e.code})]}),Je=e=>{var t;return s.jsx("div",{className:"w-40 relative  ",children:s.jsx(ft,{value:e==null?void 0:e.user.name,variant:ce.PRIMARY,suggestions:ve,completeMethod:Ve,onChange:a=>{var l;const r=a.target.value,o={...e};typeof a.target.value=="object"&&(o.user.uid=r.uid),o.user.name=r,(l=i.current)==null||l.reportDataChange(o)},itemTemplate:We,field:"name",onBlur:ze,disabled:m===u.VIEW,hideLabel:!0,name:`user-${e.uid}`,validation:(t=d==null?void 0:d.current)==null?void 0:t.message(`user-${e.uid}`,e==null?void 0:e.user.name,"autocomplete"),errorClassNames:"!m-0 !p-0 !text-xxs !h-2.5"})})},[B,Fe]=c.useState([{items:[{label:"Delete",className:""}]}]),He=(e,t)=>{var a;(a=i==null?void 0:i.current)==null||a.deleteRow(e),setTimeout(()=>{var r,o;(r=i==null?void 0:i.current)==null||r.getAddedRecords(),(o=i==null?void 0:i.current)==null||o.getDeletedRecords()},2)},qe=(e,t,a)=>{var r;console.log(B),Fe(o=>[{...o[0],items:[{...o[0].items[0],command:()=>{He(e)}}]}]),(r=L==null?void 0:L.current)==null||r.toggle(a),console.log(B)},$e=(e,t)=>s.jsx(ht,{name:"isActive",variant:ct.PRIMARY,onChange:a=>{var o;const r={...e};r.isActive=a.target.checked,(o=i.current)==null||o.reportDataChange(r)},checked:e.isActive,disabled:m===u.VIEW}),Ge=(e,t)=>s.jsx("div",{className:"w-20 flex items-center justify-center ml-2",children:s.jsx(E,{buttonType:x.MENU,onClick:a=>qe(e,t,a),className:"!rounded-none bg-transparent !hover:bg-primary-gray-300"})}),Ke=()=>{Ct.getAll().then(e=>{fe([...e.data.results])}).catch(e=>{console.log("err")})},Xe=()=>{Tt.getAll().then(e=>{ge([...e.data.results])}).catch(e=>{console.log("err")})},Qe=()=>{pt.getAll().then(e=>{Ee([...e.data.results])}).catch(e=>{console.log("err")})},d=c.useRef(new at({validators:{...ot()},...rt(),autoForceUpdate:{forceUpdate:()=>_(e=>!e)}})),ze=e=>{var t;(t=d==null?void 0:d.current)==null||t.showMessageFor(e.target.name)},{name:z,ruleApplied:Z,productName:Ze,productScheme:et,description:tt,reasons:ee}=n;return s.jsx(re,{children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex w-full justify-between  items-center",children:[s.jsx(lt,{title:we()}),s.jsx("div",{className:"flex",children:m===u.CREATE||m===u.EDIT?s.jsxs("div",{className:"flex gap-10",children:[s.jsxs("div",{className:"flex gap-5",children:[s.jsx(E,{buttonType:x.CANCEL_OUTLINE,onClick:Le}),s.jsx(E,{buttonType:x.SAVE_OUTLINE,onClickWithLoader:be})]}),s.jsx("div",{children:s.jsx(E,{className:"approve-primary",buttonType:x.SEND_FOR_APPROVAL,onClickWithLoader:Me})})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mr-5",children:s.jsx(E,{buttonType:x.BACK_OUTLINE,onClick:_e})}),s.jsx("div",{className:"",children:s.jsx(E,{buttonType:x.EDIT_OUTLINE,className:"blue-primary",onClick:Ue})})]})})]}),s.jsxs(re,{override:{read:[u.VIEW,u.REVIEW].includes(m)},children:[s.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[s.jsx("div",{className:"col-span-4  md:col-span-1",children:s.jsx(ut,{label:"input.productConfiguration.transaction.name",name:"name",variant:j.SECONDARY,onChange:T,value:z,disabled:m===u.VIEW,onBlur:k,validation:(te=d==null?void 0:d.current)==null?void 0:te.message("name",z,"mandatory|max:50")})}),s.jsx("div",{className:"col-span-4  md:col-span-1",children:s.jsx(J,{label:"input.productConfiguration.transaction.rule",name:"ruleApplied",variant:ce.SECONDARY,options:xe,onChange:T,value:Z,optionLabel:"name",optionValue:"uid",disabled:m===u.VIEW,onBlur:k,validation:(se=d==null?void 0:d.current)==null?void 0:se.message("ruleApplied",Z,"mandatory")})}),s.jsx("div",{className:""}),s.jsx("div",{className:""}),s.jsxs("div",{className:"col-span-4 md:col-span-2 flex w-full gap-2 ",children:[s.jsx("div",{className:"w-1/2",children:s.jsx(J,{label:"input.productConfiguration.transaction.product",name:"productName",variant:j.SECONDARY,options:pe,onChange:T,value:Ze,optionLabel:"name",optionValue:"uid",disabled:m===u.VIEW})}),s.jsx("div",{children:s.jsx("div",{className:"flex  justify-center items-center h-full",children:"or"})}),s.jsx("div",{className:"w-1/2",children:s.jsx(J,{label:"input.productConfiguration.transaction.productScheme",name:"productScheme",options:he,variant:j.SECONDARY,onChange:T,value:et,optionLabel:"name",optionValue:"uid",disabled:m===u.VIEW})})]}),s.jsx("div",{className:"sm:hidden md:col-span-2 md:block"}),s.jsx("div",{className:"sm:hidden"}),s.jsx("div",{className:"col-span-8 sm:col-span-4 md:col-span-2",children:s.jsx(ue,{label:"input.productConfiguration.transaction.description",name:"description",variant:j.SECONDARY,maxCount:200,onChange:T,value:tt,disabled:m===u.VIEW})}),s.jsx("div",{className:"col-span-8  sm:col-span-4 md:col-span-2",children:s.jsx(ue,{label:"input.productConfiguration.transaction.reasons",name:"reasons",variant:j.SECONDARY,maxCount:200,onChange:T,value:ee,onBlur:k,validation:(ne=d==null?void 0:d.current)==null?void 0:ne.message("reasons",ee,"mandatory"),disabled:m===u.VIEW})})]}),s.jsxs("div",{className:"mt-3 flex w-full justify-between",children:[s.jsx(M,{label:"Approvals",className:"text-primary-ptext-1000 text-base font-Roboto font-bold flex"}),s.jsx(E,{buttonType:x.ICON_TEXT_ROW,onClick:De})]}),s.jsx("div",{className:"w-full ",children:s.jsxs(gt,{uniqueKey:"uid",standardDataFormatPromise:O.getListById,ref:i,search:`&transactionApprovalRule.uid=${h}`,mode:m===u.CREATE?"CREATE":"UPDATE",children:[s.jsx(F,{className:"text-primary-ptext-1000 text-left text-xs w-1/3 pt-1 h-12 pl-6",header:"User*",body:Je}),s.jsx(F,{className:"text-primary-ptext-1000 text-left text-xs w-1/3 p-1 h-12 pl-6",header:"Active",body:$e}),s.jsx(F,{className:"text-primary-ptext-1000  text-right text-xs w-1/3 h-12 px-6",header:"Actions",style:{minWidth:"50px",width:"50px"},body:Ge})]})})]}),s.jsx("div",{className:"",children:s.jsx(mt,{position:Te,ref:g,toastText:D,variant:K,onRemove:()=>{Ae&&b.navigate(V)}})}),s.jsx(At,{className:"w-20 bg-white  font-Roboto text-xs text-primary-pText-1300 pt-2 rounded-lg mt-0.5 flex justify-center align-center shadow-autoCompletePanel",model:B,ref:L}),s.jsx(xt,{onHide:()=>X(!1),visible:Se,errorMessage:U})]})})},Gt=st(St);export{Gt as default};
//# sourceMappingURL=PageTransactionApprovalCMScreen-8222bfb5.js.map
