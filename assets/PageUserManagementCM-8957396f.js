import{w as Bt,r as l,aF as h,aG as j,ad as Ne,ae as Se,af as ye,y as kt,z as F,j as t,ax as Le,J as N,o as f,az as z,T as S,cR as Q,aH as X,ao as w,aI as Ce,aJ as be,aK as B,v as Gt,av as Me,cw as q,bb as je}from"./index-e8217573.js";import{A as Oe}from"./AutoComplete-0bca608a.js";import{B as y}from"./ButtonBox-9e46519a.js";import{E as $t,C as L}from"./EditableTableV2-6afcb42b.js";import{E as Jt}from"./ErrorDialog-d5eef4d7.js";import{I as V}from"./InputBox-b9e88f52.js";import{I as Pe}from"./InputTextArea-b90aad1d.js";import{M as qt}from"./MenuBox-defc36b0.js";import{P as Wt}from"./PageTitle-b3bba3d4.js";import{S as O}from"./SimpleDropDown-061a3470.js";import{T as Ht}from"./Toast-ae99ea5b.js";import{R as Kt}from"./RolesService-6aea899d.js";import{O as Zt}from"./Approval-120dc31f.js";import{O as zt}from"./Branch-732bec0f.js";import{O as Ie}from"./Department-d5551750.js";import{O as Qt}from"./Designation-408fa03d.js";import{O as Xt}from"./Level-2217a8ad.js";import{S as wt}from"./StaticMasterDataService-689a6eca.js";import{S as Vt}from"./StaticMasterTypeService-480bff1a.js";import"./search_icon-459d6871.js";import"./withAuth-6de36ebf.js";import"./virtualscroller.esm-9939945c.js";import"./kebab-menu-8835ad2e.js";import"./datatable.esm-f474a654.js";import"./paginator.esm-11c2c115.js";import"./Dialog-adadaf64.js";import"./TransitionGroup-c8afe0ce.js";const ea=k=>{var he,xe,Ee,Re,fe,Te;const[R,Ue]=l.useState(""),[_e,De]=l.useState(void 0),[E,ee]=l.useState(h.CREATE),[,C]=l.useState(void 0),[W,te]=l.useState([]),[Ye,G]=l.useState([]),g=l.useRef(null),[Fe,ae]=l.useState(!1),ne={name:"",lastName:"",email:"",designation:"",department:"",reportingManager:"",description:"",reason:""},[n,se]=l.useState(ne),[Be,ke]=l.useState({name:"",lastName:"",email:"",designation:{uid:""},department:{uid:""},parent:{uid:""},description:"",reason:"",uid:R,sahayyaUserType:"EMPLOYEE_USER"}),[Ge,$e]=l.useState([]),[Je,qe]=l.useState([]),[We,re]=l.useState(!1),[He,Ke]=l.useState([]),[Ze,ze]=l.useState(!0),[H,P]=l.useState(""),[oe,I]=l.useState(j.PRIMARY),[K,U]=l.useState(""),[b,_]=l.useState(!1),[Qe,$]=l.useState(!1),[Xe,we]=l.useState([]),[Ve,et]=l.useState([]),[tt,at]=l.useState([]),[nt,ie]=l.useState("bottom-right"),A=l.useRef(null),o=l.useRef(new Ne({validators:{...Se()},...ye(),autoForceUpdate:{forceUpdate:()=>C(e=>!e)}})),le={reporting:{uid:""},branch:{uid:""},orgRepLevel:{uid:""},roleId:"",deviationDepartment:{uid:""},deviationApprovalLevel:{uid:""},isActive:!0};l.useEffect(()=>{var a,r;const e=kt.parse((a=k.location)==null?void 0:a.search);Ue(e.uid),e!=null&&e.mode&&(e==null?void 0:e.mode)!==void 0&&(ee(e.mode),e.mode===h.CREATE&&Ze&&((r=g==null?void 0:g.current)==null||r.addRow(le),ze(!1))),rt(),yt(),Lt(),ot(),it(),St()},[]),l.useEffect(()=>{R&&st()},[R]),l.useEffect(()=>{console.log("first")},[E]);const st=async()=>{F.getPartnerUserByID(R).then(e=>{var a,r,s,i,d,c,v,u,m,p,x,D,Y,Ae;se({...n,uid:R,name:(a=e.data)==null?void 0:a.name,lastName:(r=e.data)==null?void 0:r.lastName,email:(s=e.data)==null?void 0:s.email,designation:(i=e.data)==null?void 0:i.designation.uid,reportingManager:((d=e.data)==null?void 0:d.parent)??"",department:e.data.designation.department.uid,sahayyaUserType:"EMPLOYEE_USER",reason:(c=e.data)==null?void 0:c.reason,description:(v=e.data)==null?void 0:v.description}),ke({...Be,uid:R,name:(u=e.data)==null?void 0:u.name,lastName:(m=e.data)==null?void 0:m.lastName,email:(p=e.data)==null?void 0:p.email,designation:(x=e.data)==null?void 0:x.designation.uid,parent:((D=e.data)==null?void 0:D.parent.uid)??null,sahayyaUserType:"EMPLOYEE_USER",reason:(Y=e.data)==null?void 0:Y.reason,description:(Ae=e.data)==null?void 0:Ae.description})}).catch(e=>{console.log(e)})};l.useEffect(()=>{H&&ae(!0)},[H]);const rt=()=>{wt.getAll(0,1e3,"isActive=true&staticMasterType.code=REPORT").then(e=>{te([...e.data.results])}).catch(e=>{console.log("err")})},ot=()=>{Ie.getAll(0,1e3).then(e=>{qe([...e.data.results]),console.log(e,"check")}).catch(e=>{console.log(e)})},it=()=>{Qt.getAll(0,1e3).then(e=>{$e([...e.data.results]),console.log(e,"check")}).catch(e=>{console.log("err")})},T=e=>{const{name:a,value:r}=e.target;se(s=>({...s,[a]:r}))},lt=()=>{k.navigate(Q)},ct=()=>{k.navigate(Q)},dt=async()=>{P("");let e=!1;if(e=await ce(),!e)return;const a=mt();return Vt.approve(a).then(r=>{I(j.PRIMARY),U(X.SENT_FOR_APPROVAL),_(!b),$(!0)}).catch(r=>{P(w(r))})},ut=()=>{ee(h.EDIT)};l.useEffect(()=>{var e;A!=null&&A.current&&K!==""&&((e=A==null?void 0:A.current)==null||e.showFunction())},[K,oe,b]);const mt=()=>{var c,v,u,m;const a=[...((c=g.current)==null?void 0:c.getAddedRecords())??[],...((v=g.current)==null?void 0:v.getDeletedRecords())??[],...((u=g.current)==null?void 0:u.getUpdatedRecords())??[]].map(p=>{var D,Y;let x;return((D=p.deviationApprovalLevel)==null?void 0:D.uid)===""&&(p.deviationApprovalLevel=null),((Y=p.deviationDepartment)==null?void 0:Y.uid)===""&&(p.deviationDepartment=null),p.branch&&p.branch.uid?(x={uid:p.branch.uid},{...p,branch:x}):p.orgRepLevel&&p.orgRepLevel.uid?(x={uid:p.orgRepLevel.uid},{...p,orgRepLevel:x}):{...p}}),r={uid:R,name:n==null?void 0:n.name,lastName:n==null?void 0:n.lastName,email:n==null?void 0:n.email,designation:{uid:n==null?void 0:n.designation},parent:{uid:(m=n==null?void 0:n.reportingManager)==null?void 0:m.uid},sahayyaUserType:"EMPLOYEE_USER",reason:n==null?void 0:n.reason,description:n==null?void 0:n.description};(n==null?void 0:n.reportingManager.uid)==""&&(r.parent=null),r.roles=a;let s;const i=r,d=ne;return E===h.CREATE?s={name:n.name,operationType:Ce.CREATE,entity:be.USER_PROFILE,initialStateJson:"",finalStateJson:B(i),reqPayload:B(i),reasonForChange:n.reason}:s={name:n.name,uid:R,operationType:Ce.UPDATE,entity:be.USER_PROFILE,initialStateJson:B(d),finalStateJson:B(i),reqPayload:B(i),reasonForChange:n.reason},s},pt=()=>{var s,i,d;const a=[...((s=g.current)==null?void 0:s.getAddedRecords())??[],...((i=g.current)==null?void 0:i.getDeletedRecords())??[],...((d=g.current)==null?void 0:d.getUpdatedRecords())??[]].map(c=>{var u,m;let v;return((u=c.deviationApprovalLevel)==null?void 0:u.uid)===""&&(c.deviationApprovalLevel=null),((m=c.deviationDepartment)==null?void 0:m.uid)===""&&(c.deviationDepartment=null),c.branch&&c.branch.uid?(v={uid:c.branch.uid},{...c,branch:v}):c.orgRepLevel&&c.orgRepLevel.uid?(v={uid:c.orgRepLevel.uid},{...c,orgRepLevel:v}):{...c}}),r={uid:R,name:n==null?void 0:n.name,lastName:n==null?void 0:n.lastName,email:n==null?void 0:n.email,designation:{uid:n==null?void 0:n.designation},parent:{uid:n==null?void 0:n.reportingManager.uid},sahayyaUserType:"EMPLOYEE_USER",reason:n==null?void 0:n.reason,description:n==null?void 0:n.description};return(n==null?void 0:n.reportingManager.uid)===void 0&&(r.parent=null),r.roles=a,r},ce=async()=>{var a,r;let e=!1;return e=((a=o==null?void 0:o.current)==null?void 0:a.allValid())??!1,e||(C(s=>!s),(r=o==null?void 0:o.current)==null||r.showMessages(),C(s=>!s),!1)},gt=async()=>{var a,r;P("");let e=!1;if(e=await ce(),!e){ie("top-right"),I(j.QUATERNARY),U(X.ERROR),_(!b);return}if((a=o==null?void 0:o.current)!=null&&a.allValid()){const s=pt();return E===h.CREATE?F.save(s).then(i=>{I(j.PRIMARY),U("Saved Successfully"),_(!b),$(!0)}).catch(i=>{P(w(i))}):F.update(R,s).then(i=>{I(j.PRIMARY),U("Saved Successfully"),_(!b),$(!0)}).catch(i=>{P(w(i)),$(!1)})}else ie("top-right"),I(j.QUATERNARY),U(X.ERROR),_(!b),C(s=>!s),(r=o==null?void 0:o.current)==null||r.showMessages(),C(s=>!s)},vt=()=>{var e;(e=g==null?void 0:g.current)==null||e.addRow(le)},M=e=>{var a,r;(r=o==null?void 0:o.current)==null||r.showMessageFor((a=e==null?void 0:e.target)==null?void 0:a.name)},Z=e=>{var a,r;(r=o==null?void 0:o.current)==null||r.showMessageFor((a=e==null?void 0:e.target)==null?void 0:a.name)},ht=async e=>{let a=[];re(!0),await F.getAllReportingManager(0,10,`&isActive=true&sahayyaUserType=EMPLOYEE_USER&name:lk=${e.query}`).then(r=>{Gt(r)&&(a=[...r.data.results],re(!1))}),Ke(a)},xt=e=>e.name===void 0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-39",children:[t.jsx("img",{src:Me,alt:"search-icon",className:" h-7 w-7"}),t.jsx(S,{className:"mt-2 text-primary-labelColor",label:"Loading..."})]}):t.jsx("div",{className:"flex flex-col",children:t.jsx(S,{className:"text-primary-labelColor",label:e.name})}),Et=e=>e.name===void 0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-39",children:[t.jsx("img",{src:Me,alt:"search-icon",className:" h-7 w-7"}),t.jsx(S,{className:"mt-2 text-primary-labelColor",label:"Loading..."})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsx(S,{className:"text-primary-labelColor",label:e.name}),t.jsx(S,{className:"text-secondary-gray-500 text-xxs",label:e.code}),t.jsx(S,{className:"text-secondary-gray-500 text-xxs",label:e.emailId})]}),Rt=()=>{switch(E){case h.CREATE:return"label.userManagement.create";case h.VIEW:return"label.userManagement.view";case h.EDIT:return"label.userManagement.edit";default:return"label.userManagement.create"}},ft=(e,a)=>{clearTimeout(_e),De(setTimeout(e,a))},Tt=(e,a)=>{var r;(r=e.current)==null||r.deleteRow(a),o.current=new Ne({validators:{...Se()},...ye(),autoForceUpdate:{forceUpdate:()=>C(s=>!s)}})},At=(e,a,r,s)=>{const i=W.find(u=>u.uid==a.reporting.uid),d=r??0,c=500,v=`isActive=true&name:lk=${e.query}&`;s=s??100,i.code===q.REPORT_ORGANIZATION_REPORTING_LEVELS?s>=d&&Xt.getAll(d,c,v).then(u=>{var p,x;const m=((x=(p=u.data)==null?void 0:p.results)==null?void 0:x.length)>0?[...u.data.results]:[];m.length===0?G([{name:je.NO_OrgReportingLevel}]):G([...m])}):s>=d&&zt.getAll(d,c,v).then(u=>{var p,x;const m=((x=(p=u.data)==null?void 0:p.results)==null?void 0:x.length)>0?[...u.data.results]:[];m.length===0?G([{name:je.NO_Branch}]):G([...m])})},Nt=(e,a)=>{e.query.length>=1?ft(()=>At(e,a),1200):te([])},St=()=>{Kt.getAll(0,1e3,"isActive=true&").then(e=>{we([...e.data.results])}).catch(e=>{console.log("err")})},yt=()=>{Ie.getAll(0,1e3,"&isActive=true").then(e=>{et([...e.data.results])}).catch(e=>{console.log("err")})},Lt=()=>{Zt.getAll(0,1e3,"&isActive=true").then(e=>{at([...e.data.results])}).catch(e=>{console.log("err")})},Ct=e=>{var a;return t.jsx(O,{name:`reporting${e.uid}`,options:W,optionLabel:"name",optionValue:"uid",value:e==null?void 0:e.reporting.uid,variant:f.SECONDARY,onChange:r=>{var d;const s={...e};s.reporting.uid=r.target.value;const i=W.find(c=>c.uid==s.reporting.uid);s.selectedReportType=i.code,i.code===q.REPORT_ORGANIZATION_REPORTING_LEVELS?(s.branch=null,s.orgRepLevel={uid:"",name:""}):(s.orgRepLevel=null,s.branch={uid:"",name:""}),(d=g.current)==null||d.reportDataChange(s)},onBlur:Z,validation:(a=o==null?void 0:o.current)==null?void 0:a.message(`reporting${e.uid}`,e.reporting.uid,"autocomplete")})},bt=e=>{var r,s,i;e.branch;const a=e.temp?e.selectedReportType===q.REPORT_ORGANIZATION_REPORTING_LEVELS?"orgRepLevel":e.selectedReportType===q.REPORT_BRANCH?"branch":"":e!=null&&e.branch?"branch":e.orgRepLevel?"orgRepLevel":"";return t.jsx(Oe,{name:`${a}-${e.uid}`,value:(r=e[a])==null?void 0:r.name,variant:z.PRIMARY,suggestions:Ye,completeMethod:d=>Nt(d,e),onChange:d=>{var v;const c={...e};typeof d.target.value=="object"?c[a]=d.target.value:(c[a]={},c[a].name=d.target.value),(v=g.current)==null||v.reportDataChange(c)},itemTemplate:Et,field:"name",onBlur:Z,validation:a?(i=o==null?void 0:o.current)==null?void 0:i.message(`${a}-${e.uid}`,(s=e[a])==null?void 0:s.uid,"autocomplete"):!1})},Mt=e=>{var a;return t.jsx(O,{name:`roleId-${e.uid}`,variant:f.SECONDARY,onChange:r=>{var i;const s={...e};s.roleId=r.target.value,(i=g.current)==null||i.reportDataChange(s)},value:e.roleId,options:Xe,optionLabel:"name",optionValue:"id",onBlur:Z,validation:(a=o==null?void 0:o.current)==null?void 0:a.message(`roleId-${e.uid}`,e.roleId,"mandatory")})},jt=e=>{var a;return t.jsx(O,{name:`deviationApprovalLevel-${e.uid}`,variant:f.SECONDARY,onChange:r=>{var i;const s={...e};s.deviationApprovalLevel.uid=r.target.value,(i=g.current)==null||i.reportDataChange(s)},value:(a=e==null?void 0:e.deviationApprovalLevel)==null?void 0:a.uid,options:tt,optionLabel:"name",optionValue:"uid"})},Ot=e=>{var a;return console.log(e),t.jsx(O,{name:`deviationDepartment-${e.uid}`,variant:f.SECONDARY,onChange:r=>{var i;const s={...e};s.deviationDepartment||(s.deviationDepartment={uid:""}),s.deviationDepartment.uid=r.target.value,(i=g.current)==null||i.reportDataChange(s)},value:((a=e==null?void 0:e.deviationDepartment)==null?void 0:a.uid)??"",options:Ve,optionLabel:"name",optionValue:"uid"})},Pt=e=>t.jsx(t.Fragment,{children:e.isActive?"Yes":"No"}),It=(e,a)=>{var v;const r={label:"Deactivate",command:()=>{var u;if(E!==h.CREATE){const m={...e};console.log(m),m.isActive=!1,(u=g.current)==null||u.reportDataChange(m)}}},s={label:"Activate",command:()=>{var u;if(E!==h.CREATE){const m={...e};console.log(m),m.isActive=!0,(u=g.current)==null||u.reportDataChange(m)}}},i={label:"Delete",command:()=>{Tt(g,e)}},d=e.isActive?r:s,c=[{items:E!==h.CREATE?[d,i]:[i]}];_t(c),(v=J==null?void 0:J.current)==null||v.toggle(a)},[Ut,_t]=l.useState([{items:[{label:"Activate",className:""},{label:"Deactivate",className:""}]}]),Dt=e=>t.jsx("div",{className:"",children:t.jsx(y,{buttonType:N.MENU,onClick:a=>{It(e,a)},className:"!rounded-none bg-transparent !hover:bg-primary-gray-300 "})}),J=l.useRef(null),{name:de,lastName:ue,designation:me,department:pe,email:ge,reportingManager:Yt,reason:ve,city:ta,description:Ft}=n;return t.jsx(Le,{children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center justify-between w-full",children:[t.jsx(Wt,{title:Rt()}),t.jsx("div",{className:"flex",children:E===h.CREATE||E===h.EDIT?t.jsxs("div",{className:"flex gap-10",children:[t.jsxs("div",{className:"flex gap-5",children:[t.jsx(y,{buttonType:N.CANCEL_OUTLINE,onClick:lt}),t.jsx(y,{buttonType:N.SAVE_OUTLINE,onClickWithLoader:gt})]}),t.jsx("div",{children:t.jsx(y,{className:"approve-primary",buttonType:N.SEND_FOR_APPROVAL,onClickWithLoader:dt})})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mr-5",children:t.jsx(y,{buttonType:N.BACK_OUTLINE,onClick:ct})}),t.jsx("div",{className:"",children:t.jsx(y,{buttonType:N.EDIT_OUTLINE,className:"blue-primary",onClick:ut})})]})})]}),t.jsxs(Le,{override:{read:[h.VIEW,h.REVIEW].includes(E)},children:[t.jsxs("div",{className:"grid grid-cols-8 gap-3",children:[t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-2",children:t.jsx(V,{label:"input.userManagement.name",name:"name",placeholder:"Enter name",variant:f.SECONDARY,onChange:T,value:de,onBlur:M,validation:(he=o==null?void 0:o.current)==null?void 0:he.message("name",de,"mandatory")})}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-2",children:t.jsx(V,{label:"input.userManagement.lastName",name:"lastName",placeholder:"Enter Last name",variant:f.SECONDARY,onChange:T,value:ue,onBlur:M,validation:(xe=o==null?void 0:o.current)==null?void 0:xe.message("lastName",ue,"mandatory")})}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-2",children:t.jsx(V,{label:"input.userManagement.email",name:"email",placeholder:"Enter email",variant:f.SECONDARY,onChange:T,value:ge,onBlur:M,validation:(Ee=o==null?void 0:o.current)==null?void 0:Ee.message("email",ge,"mandatory"),disabled:E===h.EDIT})}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-2",children:t.jsx(O,{label:"label.userManagement.designation",name:"designation",placeholder:"Select",variant:z.SECONDARY,options:Ge,onChange:T,value:me,optionLabel:"name",optionValue:"uid",onBlur:M,validation:(Re=o==null?void 0:o.current)==null?void 0:Re.message("designation",me,"mandatory")})}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-2",children:t.jsx(O,{label:"label.userManagement.department",name:"department",placeholder:"Select",variant:z.SECONDARY,options:Je,onChange:T,value:pe,optionLabel:"name",optionValue:"uid",onBlur:M,validation:(fe=o==null?void 0:o.current)==null?void 0:fe.message("department",pe,"mandatory")})}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-2",children:t.jsx(Oe,{label:"input.userManagement.reportingManager",name:"reportingManager",placeholder:"Type to search",field:"name",value:Yt,variant:f.PRIMARY,suggestions:He,completeMethod:ht,onChange:T,itemTemplate:xt,loader:We})}),t.jsx("div",{}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-4",children:t.jsx(Pe,{label:"input.productConfiguration.transaction.description",name:"description",variant:f.SECONDARY,maxCount:200,onChange:T,value:Ft})}),t.jsx("div",{className:"col-span-8 sm:col-span-8 md:col-span-4",children:t.jsx(Pe,{label:"input.productConfiguration.transaction.reasons",name:"reason",variant:f.SECONDARY,maxCount:200,onChange:T,value:ve,onBlur:M,validation:(Te=o==null?void 0:o.current)==null?void 0:Te.message("reason",ve,"mandatory")})})]}),t.jsxs("div",{className:"flex flex-col gap-3 ",children:[t.jsxs("div",{className:"flex justify-between w-full",children:[t.jsx(S,{label:"label.userManagement.roles",className:"font-bold"}),t.jsx(y,{buttonType:N.ICON_TEXT_ROW,onClick:vt})]}),t.jsxs($t,{uniqueKey:"uid",standardDataFormatPromise:F.getAllUsers,ref:g,search:`&userProfile.uid=${R}`,mode:E===h.CREATE?"CREATE":"UPDATE",children:[t.jsx(L,{className:"w-1/6 h-12 pl-6 text-xs text-left text-primary-ptext-1000",header:"Reporting*",body:Ct}),t.jsx(L,{className:"w-1/6 h-12 pl-6 text-xs text-left text-primary-ptext-1000",header:"Reporting To*",body:bt}),t.jsx(L,{className:"w-1/6 h-12 pl-6 text-xs text-left text-primary-ptext-1000",header:"Role*",body:Mt}),t.jsx(L,{className:"w-1/6 h-12 pl-6 text-xs text-left text-primary-ptext-1000",header:"Deviation Department",body:Ot}),t.jsx(L,{className:"w-1/6 h-12 pl-6 text-xs text-left text-primary-ptext-1000",header:"Deviation Approval Level",body:jt}),t.jsx(L,{className:"w-2/12 h-12 text-xs text-left text-primary-ptext-1000 pl-18",header:"IsActive",body:Pt}),t.jsx(L,{className:"w-1/6 h-12 -ml-5 text-xs text-left text-primary-ptext-1000 ",header:"Actions",body:Dt})]})]})]}),t.jsxs("div",{className:"",children:[t.jsx(Ht,{position:nt,ref:A,toastText:K,variant:oe,onRemove:()=>{Qe&&k.navigate(Q)}}),t.jsx(Jt,{onHide:()=>ae(!1),visible:Fe,errorMessage:H}),t.jsx(qt,{className:"w-20 bg-white font-Roboto text-xs text-primary-pText-1300 pt-2 rounded-lg mt-0.5 flex justify-center align-center shadow-autoCompletePanel",model:Ut,ref:J})]})]})})},Ma=Bt(ea);export{Ma as default};
//# sourceMappingURL=PageUserManagementCM-8957396f.js.map
