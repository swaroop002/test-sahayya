import{R as T,r as l,v as C,aw as Z,j as e,T as U}from"./index-e8217573.js";import{l as ee}from"./Loading-783a01c7.js";import{C as te}from"./FileUploadCustom-5ab7fd25.js";import{M as ae}from"./FileUploadMenuBox-f47dc693.js";import{F as y}from"./FileUploadService-1aaf11f7.js";const se="/assets/Upload-00f62088.svg",re="/assets/Profile_Avatar-7e513e78.svg",d={uploadStarted:!1,preview:"",uploadInProgress:!1,uploaded:!1,uploadFailed:!1},I={imageUrl:"",url:"",thumbUrl:"",fileName:"",isPrivate:!1,contentType:""},D=E=>{const{className:M,editMode:i,getUrl:S,sourceURL:f,isMandatory:$}=E,[p,n]=l.useState(d),[c,g]=l.useState(""),[x,P]=l.useState(null),[A,w]=l.useState(I),[b,h]=l.useState(""),j=l.useRef(null),v=l.useRef(null),L=[{label:"Delete",command:()=>{n({...d}),w({...I}),h(""),S(I)}}];l.useEffect(()=>{const{preview:t}=p;t&&S(A)},[p]),l.useEffect(()=>{k()},[f]),l.useEffect(()=>{v.current&&c&&v.current.toggler()},[c]),l.useEffect(()=>{x&&J(x)},[x]);const k=async()=>{if(f){const t=await _(f);h(t)}},_=async t=>{var s;const a=await y.getSignedURL(t);return C(a)?(s=a.data)==null?void 0:s.SignedUrl:""},N=t=>{y.getSignedURL(t).then(a=>{C(a)?n(s=>{var o;return{...s,preview:(o=a.data)==null?void 0:o.SignedUrl,uploadInProgress:!1,uploaded:!0}}):n(s=>({...s,uploadInProgress:!1,uploadFailed:!0}))}).catch(()=>{n(a=>({...a,uploadInProgress:!1,uploadFailed:!0}))})},B=t=>{const a=new FileReader;a.onload=()=>{var s;g(((s=a.result)==null?void 0:s.toString())||"")},a.readAsDataURL(t)},G=async(t,a="sample.jpeg")=>{const s=await(await fetch(t)).blob();P(new File([s],a,{type:s.type})),g(null)},O=()=>{g(null),n(d)},q=()=>{j.current&&(j.current.click(),n({...d}),h(""))},z=()=>{n({...d})},H=t=>{B(t.target.files[0])},J=t=>{P(null),n(r=>({...r,uploadStarted:!0,uploadInProgress:!0}));const a=new Date().getTime(),s=Math.random().toString(36).substring(2,8),o=`${a}_${s}`;y.saveFile(t,o).then(r=>{var R;Z(r)?(w({imageUrl:r.data.imageUrl,thumbUrl:r.data.thumbUrl,fileName:r.data.fileName,url:r.data.url,contentType:r.data.contentType,isPrivate:r.data.isPrivate}),N((R=r.data)==null?void 0:R.imageUrl),setInterval(()=>{var m;N((m=r.data)==null?void 0:m.imageUrl)},1800*1e3)):n(m=>({...m,uploadInProgress:!1,uploadFailed:!0}))}).catch(()=>{n(r=>({...r,uploadInProgress:!1,uploadFailed:!0}))})},K=()=>e.jsxs("div",{className:`absolute ${i?"cursor-pointer":""}`,onClick:q,children:[e.jsx("input",{ref:j,className:"w-full hidden",type:"file",accept:"image/png, image/jpeg",onChange:H,disabled:!i}),e.jsx("img",{src:se,alt:"upload"})]}),Q=()=>{if(c)return e.jsx(te,{ref:v,imageSource:c.toString(),getDataUrl:G,onCancelImageCroppingDialog:O})},u=()=>e.jsx("div",{className:"text-secondary-gray-500 text-xs",children:e.jsx(U,{label:$?"component.profilePicUpload.mandatory":"component.profilePicUpload"})}),V=()=>e.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center relative select-none",children:[e.jsx("div",{className:"w-full h-40 pt-6 pb-3 flex justify-center bg-primary-ptext-300",children:e.jsx("span",{children:e.jsx("img",{src:re,alt:"icon"})})}),K(),u()]}),F=()=>{const t=p.preview||b;return e.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center relative select-none",children:[e.jsx("div",{className:"w-40 h-40 flex relative",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-xxs ${i?"opacity-50":""}`,children:e.jsx("img",{className:"w-full h-full",src:t,alt:"profile-picture"})}),i&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(ae,{model:L,disabled:!i})})]}):e.jsx("div",{className:"w-full bg-primary-ptext-300 text-center py-2 text-xxs text-semantic-crimson-600",children:e.jsx(U,{label:"Can't load preview"})})}),u()]})},W=()=>e.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center select-none ",children:[e.jsx("div",{className:"w-40 h-40 border flex items-center justify-center text-xxs",children:e.jsx("span",{className:"w-6 h-6 pointer-events-none cursor-pointer",children:e.jsx("img",{className:"w-full h-full animate-spin",src:ee,alt:"loader"})})}),u()]}),X=()=>e.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center select-none ",children:[e.jsx("div",{className:"w-40 h-40 bg-primary-ptext-200 border flex items-center justify-center text-xxs text-semantic-crimson-600",children:e.jsx(U,{label:"Profile picture upload failed"})}),u()]}),Y=()=>{const{uploadStarted:t,uploaded:a,uploadInProgress:s,uploadFailed:o}=p;if(t){if(s)return W();if(o)return setTimeout(z,3e3),X();if(a)return F()}else return V()};return e.jsxs(T.Fragment,{children:[e.jsx("div",{className:`${M}`,children:b?F():Y()}),c&&Q()]})};D.defaultProps={isMandatory:!0};const de=T.memo(D);export{de as P};
//# sourceMappingURL=ProfilePictureUpload-60f86be0.js.map
