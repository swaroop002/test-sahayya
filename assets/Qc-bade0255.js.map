{"version":3,"file":"Qc-bade0255.js","sources":["../../src/views/transaction/PageDDE/QC/Qc.tsx"],"sourcesContent":["import { updateLoanDetail } from \"actions/LoanDetailActions\";\nimport chatIcon from \"assets/chatSvg/chatIcon.svg\";\nimport AclGuard from \"components/AclGuard/AclGuard\";\nimport ButtonBox from \"components/ButtonBox/ButtonBox\";\nimport MainMessageBody from \"components/ChatComponents/MainMessageBody\";\nimport DialogBox from \"components/Dialog/Dialog\";\nimport ErrorDialog from \"components/ErrorDialog/ErrorDialog\";\nimport Loader from \"components/Loader/Loader\";\nimport SimpleOverlayPanel from \"components/SimpleOverlayPanel/SimpleOverlayPanel\";\nimport Text from \"components/Text/Text\";\nimport TextButton from \"components/TextButton/TextButton\";\nimport ToastCustom from \"components/Toast\";\nimport { ToastPositionType } from \"primereact/toast\";\nimport { Suspense, useEffect, useRef, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { NavLink, Outlet, Route, Routes, useParams } from \"react-router-dom\";\nimport { linkAuthRoute, linkBasePath } from \"routes\";\nimport ACLService from \"services/ACLService\";\nimport ChatServices from \"services/ChatServices\";\nimport QcService from \"services/transaction/DDE/QcService\";\nimport LoanService from \"services/transaction/LoanService\";\nimport { formatDate, parseStandardAPIErrorMessageNew } from \"utils/CommonUtil\";\nimport { BUTTON_TYPE, LOAN_STAGE_STATUS, TOAST_STYLE_TYPE } from \"utils/Constant\";\nimport {\n  LINK_DDE_QC,\n  LINK_DDE_QC_CHECKLIST,\n  LINK_DDE_QC_DOCUMENTS,\n  LINK_DDE_STAGE_AND_STATUS,\n  LINK_LOAN_DETAIL,\n  LINK_LOAN_LIST,\n  qcLoginRoutes,\n} from \"../../../../transactionRoutes\";\nconst QC_MENU = [\n  {\n    id: 1,\n    name: \"Checklist\",\n    path: LINK_DDE_QC_CHECKLIST,\n  },\n  // {\n  //   id: 2,\n  //   name: \"Duplicate Stage\",\n  //   path: LINK_DDE_QC_DUPLICATE,\n  // },\n  {\n    id: 3,\n    name: \"Asset & Document Check\",\n    path: LINK_DDE_QC_DOCUMENTS,\n  },\n];\n\nconst Qc = () => {\n  const params = useParams();\n  const dispatch = useDispatch();\n  const overlayPanelRef = useRef(null);\n\n  const [showDialogAPIError, setShowDialogAPIError] = useState(false);\n  const [errorMessage, setErrorMessage] = useState<any>(\"\");\n  const [position] = useState<ToastPositionType | undefined>(\"bottom-right\");\n  const [toastMessage, setToastMessage] = useState(\"\");\n  const [toastMessageVariant, setToastMessageVariant] = useState(TOAST_STYLE_TYPE.PRIMARY);\n  const [triggerToast, setTriggerToast] = useState(false);\n  const [isPageReadOnly, setIsPageReadyOnly] = useState(false);\n  const toastMessageRef = useRef(null);\n  const [dataForViewDetails, setDataForViewDetails] = useState({\n    assignedTo: \"\",\n    delegateTo: \"\",\n    initiation: \"\",\n  });\n  const [isMessageDialogVisible, setIsMessageDialogVisible] = useState(false);\n  const [isNewMessageAvailable, setIsNewMessageAvailable] = useState(false);\n  useEffect(() => {\n    getLoanDetail();\n  }, []);\n  useEffect(() => {\n    console.log(isMessageDialogVisible, \"message \");\n\n    const callAPI = async () => {\n      try {\n        const res = await ChatServices.checkNewMessageAvailability(params?.stageUid ?? \"\");\n        setIsNewMessageAvailable(res?.data);\n      } catch (error) {\n        console.log(error);\n      }\n    };\n    callAPI();\n    const intervalId = setInterval(callAPI, 5000);\n    return () => {\n      clearInterval(intervalId);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (toastMessageRef?.current && toastMessage !== \"\") {\n      // @ts-ignore: will be fixed in future\n      toastMessageRef?.current?.showFunction();\n    }\n  }, [toastMessage, toastMessageVariant, triggerToast]);\n\n  const getLoanDetail = () => {\n    const uid = params.loanUid;\n    const search = `&uid=${uid}`;\n    LoanService.getAll(0, 1, search)\n      .then((res) => {\n        const results = res.data.results[0];\n        dispatch(updateLoanDetail(results));\n        if (\n          results?.qcStatus === LOAN_STAGE_STATUS.COMPLETED ||\n          results?.qcStatus === LOAN_STAGE_STATUS.CANCELLED\n        ) {\n          setIsPageReadyOnly(true);\n        } else {\n          setIsPageReadyOnly(false);\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n  const renderViewDetails = () => {\n    return (\n      <div className=\"flex flex-col gap-4 p-5 \">\n        <div className=\"flex flex-row justify-between items-center\">\n          <div className=\"text-sm text-secondary-stext-900\">Assigned to :</div>\n          <div className=\"text-sm text-secondary-stext-900  font-bold ml-2\">\n            {dataForViewDetails.assignedTo}\n          </div>\n        </div>\n        <div className=\"flex flex-row justify-between items-center\">\n          <div className=\"text-sm text-secondary-stext-900\">Delegated to :</div>\n          <div className=\"text-sm text-secondary-stext-900  font-bold ml-2\">\n            {dataForViewDetails.delegateTo}\n          </div>\n        </div>\n        <div className=\"flex flex-row justify-between items-center\">\n          <div className=\"text-sm text-secondary-stext-900\">Date of Initiation :</div>\n          <div className=\"text-sm text-secondary-stext-900  font-bold ml-2\">\n            {formatDate(dataForViewDetails.initiation)}\n          </div>\n        </div>\n      </div>\n    );\n  };\n  const onViewDetails = (e: any) => {\n    const viewDetailData: any = localStorage.getItem(\"stageDetail\");\n    setDataForViewDetails({\n      assignedTo: JSON.parse(viewDetailData)?.assignee?.name ?? \"NA\",\n      delegateTo: JSON.parse(viewDetailData)?.delegate?.name ?? \"NA\",\n      initiation: JSON.parse(viewDetailData)?.createdAtSystemDate ?? \"NA\",\n    });\n    if (overlayPanelRef.current) {\n      // @ts-ignore: Will fix later\n      overlayPanelRef.current?.toggle(e);\n    }\n  };\n  const onStageComplete = async () => {\n    try {\n      const res = await QcService.stageComplete(params.loanUid ?? \"\");\n      setToastMessage(\"Stage completed successfully\");\n      setToastMessageVariant(TOAST_STYLE_TYPE.PRIMARY);\n      setTriggerToast(!triggerToast);\n      setIsPageReadyOnly(true);\n      if (ACLService.isRouteHasAccess(LINK_DDE_STAGE_AND_STATUS)) {\n        const URL = `${linkBasePath}${linkAuthRoute}${LINK_LOAN_DETAIL}${LINK_DDE_STAGE_AND_STATUS}/${params.loanUid}/`;\n        window.location.href = URL;\n      }\n    } catch (error) {\n      // console.log(error);\n      setShowDialogAPIError(true);\n      setErrorMessage(parseStandardAPIErrorMessageNew(error));\n    }\n  };\n  const onToggleMessage = (e: any) => {\n    setIsMessageDialogVisible(!isMessageDialogVisible);\n  };\n  const getClassMenu = ({ isActive }: any) => {\n    console.log(\"get class menu\", isActive);\n    const className = `tab text-sm px-2.5 py-1 min-w-fit ${\n      isActive\n        ? \"bg-secondary-steelBlue-900 rounded-sm text-white font-medium shadow-activeBtn \"\n        : \"text-primary-500\"\n    }`;\n    return className;\n  };\n  return (\n    <div>\n      <div className=\"flex flex-col gap-5 \">\n        <div className=\"flex items-center justify-between gap-5 w-full\">\n          <div className=\"flex items-center gap-5 w-11/12\">\n            <div className=\"border-r flex gap-3 items-center border-secondary-stext-600 px-5 py-2 w-1/5 \">\n              <Text className=\"text-primary-ptext-1000 font-bold\" label={\"QC\"}></Text>\n              <TextButton\n                className=\"underline text-xs  !text-black  \"\n                label={\"View Details\"}\n                onClick={onViewDetails}\n              ></TextButton>\n              <button onClick={onToggleMessage} className=\" relative\">\n                <img src={chatIcon} alt=\"ChatIcon\" className=\"\" />{\" \"}\n                {isNewMessageAvailable ? (\n                  <div className=\"absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full\"></div>\n                ) : (\n                  <></>\n                )}\n              </button>\n            </div>\n\n            <div className=\"w-4/5\">\n              {/* Wrap your tabs with the ScrollableTabs component */}\n              {QC_MENU.map((menu) => (\n                <NavLink\n                  key={menu.path}\n                  className={getClassMenu}\n                  to={`${linkAuthRoute}${LINK_LOAN_DETAIL}${LINK_DDE_QC}/${params.loanUid}/${params.stageUid}${menu.path}`}\n                >\n                  {menu.name}\n                </NavLink>\n              ))}\n            </div>\n          </div>\n          <div className=\"w-1/12\">\n            <ButtonBox\n              buttonType={BUTTON_TYPE.STAGE_COMPLETE}\n              onClickWithLoader={onStageComplete}\n              disabled={isPageReadOnly}\n              size=\"LOAN_DATA\"\n            />\n          </div>\n        </div>\n        <div className=\"qc-layout-body-content\">\n            <Suspense fallback={<Loader />}>\n              <Routes>\n                {qcLoginRoutes.map((route, index) => {\n                  return <Route key={index} path={route.path} element={<route.component />} />;\n                })}\n              </Routes>\n            </Suspense>\n          <Outlet />\n        </div>\n\n        <ErrorDialog\n          onHide={() => {\n            setShowDialogAPIError(false);\n            setErrorMessage(\"\");\n          }}\n          visible={showDialogAPIError}\n          errorMessage={errorMessage}\n        />\n        <SimpleOverlayPanel\n          className=\"rounded-lg shadow-lg !w-80 p-1.5 \"\n          ref={overlayPanelRef}\n          content={renderViewDetails()}\n        />\n        {isMessageDialogVisible ? (\n          <DialogBox\n            visible={isMessageDialogVisible}\n            closable={false}\n            model={\"false\"}\n            onHide={() => setIsMessageDialogVisible(false)}\n            className=\"rounded-lg shadow-lg !w-240 bg-blend-darken !p-0 !h-162 \"\n          >\n            <MainMessageBody params={params} handleCloseOverLay={onToggleMessage} />\n          </DialogBox>\n        ) : null}\n        <ToastCustom\n          position={position}\n          ref={toastMessageRef}\n          toastText={toastMessage}\n          variant={toastMessageVariant}\n          onRemove={() => {\n            const URL = linkBasePath + linkAuthRoute + LINK_LOAN_LIST;\n            window.location.href = URL;\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Qc;\n"],"names":["QC_MENU","LINK_DDE_QC_CHECKLIST","LINK_DDE_QC_DOCUMENTS","Qc","params","useParams","dispatch","useDispatch","overlayPanelRef","useRef","showDialogAPIError","setShowDialogAPIError","useState","errorMessage","setErrorMessage","position","toastMessage","setToastMessage","toastMessageVariant","setToastMessageVariant","TOAST_STYLE_TYPE","triggerToast","setTriggerToast","isPageReadOnly","setIsPageReadyOnly","toastMessageRef","dataForViewDetails","setDataForViewDetails","isMessageDialogVisible","setIsMessageDialogVisible","isNewMessageAvailable","setIsNewMessageAvailable","useEffect","getLoanDetail","callAPI","res","ChatServices","error","intervalId","_a","search","LoanService","results","updateLoanDetail","LOAN_STAGE_STATUS","err","renderViewDetails","jsxs","jsx","formatDate","onViewDetails","e","viewDetailData","_b","_d","_c","_e","_f","onStageComplete","QcService","ACLService","LINK_DDE_STAGE_AND_STATUS","URL","linkBasePath","linkAuthRoute","LINK_LOAN_DETAIL","parseStandardAPIErrorMessageNew","onToggleMessage","getClassMenu","isActive","Text","TextButton","chatIcon","Fragment","menu","NavLink","LINK_DDE_QC","ButtonBox","BUTTON_TYPE","Suspense","Loader","Routes","qcLoginRoutes","route","index","Route","Outlet","ErrorDialog","SimpleOverlayPanel","DialogBox","MainMessageBody","ToastCustom","LINK_LOAN_LIST"],"mappings":"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"}