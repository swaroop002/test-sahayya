import{r,q as Le,aF as I,R as Me,ad as ie,ae as oe,af as ce,j as e,ax as Ye,o as G,dU as ht,ey as pt,eD as Xe,aG as Re,aH as je,ao as Ee,J as it,d$ as ae,aA as ft,T as L,aa as Nt,ev as Et,ew as lt,f as St,eE as gt,eF as Ue,eG as Ct}from"./index-e8217573.js";import{E as Pe}from"./ErrorDialog-d5eef4d7.js";import{I as D}from"./InputBox-b9e88f52.js";import{S as _e}from"./SaveComponent-160c5b32.js";import{S as ve}from"./SimpleDropDown-061a3470.js";import{S as Ke}from"./Skeleton-7e12d019.js";import{T as Fe}from"./Toast-ae99ea5b.js";import{s as le,g as ye,k as yt,l as vt,m as rt}from"./Helper-54d1e873.js";import{C as he}from"./CamService-5ccef840.js";import{B as ot}from"./ButtonBox-9e46519a.js";import{E as ct,C as se}from"./EditableTableV2-6afcb42b.js";import{I as ut,B as dt}from"./IconButton-36693dd9.js";import{R as bt}from"./RadioButton-86c37166.js";import{R as At}from"./ReadOnlyTable-86accb69.js";import{S as It}from"./Section-00ef9f2b.js";import{R as jt}from"./RichTextEditor-a03bd2fb.js";import{I as Rt}from"./InputAddon-04f948e7.js";import{T as Pt}from"./TextButton-41b4a67e.js";import{W as Ft}from"./WarningDialog-77a1cb18.js";const Ut={recommendedLoanAmount:"",insurancePremium:"",totalLoanAmount:"",roi:0,tenure:"",interestType:"",emi:"",totalDeduction:"",netDisbursal:"",transactionType:"",balanceTransfer:"",employeeLoan:"",employeeId:"",employeeName:"",isCalculating:!1},Tt="TRANSACTION_TYPE_BALANCE_TRANSFER",rn=r.forwardRef((fe,Ce)=>{var Ze,we,De,et,tt,nt,C,$e,Ve;const{data:j,dropDownOptions:b,isLoading:Y,getDetailsCallback:v}=fe,i=Le(),[t,R]=r.useState({...Ut}),[O,ee]=r.useState(void 0),[Z,X]=r.useState(I.VIEW),[J,z]=r.useState(""),[U,A]=r.useState(!1),[P,y]=r.useState(""),[h,te]=r.useState(!1),M=r.useRef(null);Me.useRef(null);const[,p]=r.useState(!1),m=r.useRef(new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>p(f=>!f)}}));r.useEffect(()=>{R(f=>({...f,...j}))},[j]),r.useEffect(()=>{var f;M!=null&&M.current&&J!==""&&((f=M==null?void 0:M.current)==null||f.showFunction(),z(""))},[J,U]),r.useEffect(()=>{P&&te(!0)},[P]);const F=async f=>{R(N=>({...N,isCalculating:!0}));try{const N=ge(f),$=await he.engine(N);R(w=>{var Ae,ke,Be,Ge;return{...w,isCalculating:!1,totalLoanAmount:le((Ae=$==null?void 0:$.data)==null?void 0:Ae.totalLoanAmount),emi:le((ke=$==null?void 0:$.data)==null?void 0:ke.emi),totalDeduction:le((Be=$==null?void 0:$.data)==null?void 0:Be.totalDeductions),netDisbursal:le((Ge=$==null?void 0:$.data)==null?void 0:Ge.netDisbursal)}})}catch(N){console.log(N),R($=>({...$,isCalculating:!1})),y(Ee(N))}},Q=(f,N)=>{R($=>{var Ae;let w={...$};return N!=null&&N.currency?w={...w,[f.target.name]:le(f.target.value)}:w={...w,[f.target.name]:f.target.value},(N==null?void 0:N.field)==="employeeLoan"&&((Ae=f==null?void 0:f.target)==null?void 0:Ae.value)===Xe.NO&&(w={...w,employeeId:"",employeeName:""}),f.target.name==="transactionType"&&f.target.value!=="TRANSACTION_TYPE_BALANCE_TRANSFER"&&(w={...w,balanceTransfer:"0"}),((N==null?void 0:N.field)==="recommendedLoanAmount"||(N==null?void 0:N.field)==="roi"||(N==null?void 0:N.field)==="tenure")&&a(()=>F(w),1200),w})},K=f=>{var N,$;($=m==null?void 0:m.current)==null||$.showMessageFor((N=f==null?void 0:f.target)==null?void 0:N.name)},be=()=>{var N,$;let f=!1;return f=((N=m==null?void 0:m.current)==null?void 0:N.allValid())??!1,f||(p(w=>!w),($=m==null?void 0:m.current)==null||$.showMessages(),p(w=>!w),!1)},Te=()=>{var f;m.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>p(N=>!N)}}),(f=m==null?void 0:m.current)==null||f.hideMessages()},W=async()=>{if(!be())return;const f=c();try{await he.updateFinalLoanDetails(f),z(je.SAVED),A(!U),X(I.VIEW),v==null||v()}catch(N){y(Ee(N))}},q=()=>X(I.EDIT),de=()=>{X(I.VIEW),Te(),v==null||v()},ge=f=>({loanUid:i==null?void 0:i.loanUid,stageUid:i==null?void 0:i.stageUid,recommendedLoanAmount:ye(f==null?void 0:f.recommendedLoanAmount),roi:ye(f==null?void 0:f.roi),tenure:ye(f==null?void 0:f.tenure)}),a=(f,N)=>{clearTimeout(O),ee(setTimeout(f,N))},c=()=>({loan:{uid:i==null?void 0:i.loanUid},stage:{uid:i==null?void 0:i.stageUid},recommendedLoanAmount:ye(t==null?void 0:t.recommendedLoanAmount),insurancePremium:ye(t==null?void 0:t.insurancePremium),totalLoanAmount:ye(t==null?void 0:t.totalLoanAmount),roi:ye(t==null?void 0:t.roi),tenure:t==null?void 0:t.tenure,smInterestType:t==null?void 0:t.interestType,emi:ye(t==null?void 0:t.emi),totalDeductions:ye(t==null?void 0:t.totalDeduction),netDisbursal:ye(t==null?void 0:t.netDisbursal),smTransactionType:t==null?void 0:t.transactionType,balanceTransferInMonths:t==null?void 0:t.balanceTransfer,smEmployeeLoan:t==null?void 0:t.employeeLoan,employeeId:t==null?void 0:t.employeeId,employeeName:t==null?void 0:t.employeeName}),g=()=>(t==null?void 0:t.employeeLoan)===Xe.YES?"mandatory":"optional",_=()=>(t==null?void 0:t.employeeLoan)===Xe.YES?"mandatory":"optional",pe=()=>(t==null?void 0:t.transactionType)===Tt?"mandatory":"optional",{recommendedLoanAmount:s,insurancePremium:u,totalLoanAmount:x,roi:S,tenure:k,interestType:ue,emi:re,totalDeduction:me,netDisbursal:We,transactionType:qe,balanceTransfer:Je,employeeLoan:Ie,employeeId:ze,employeeName:Qe}=t;return console.log("pageObj====",t),e.jsxs(e.Fragment,{children:[e.jsx(_e,{title:"label.summary.eligibility.finalLoanDetails",pageMode:Z,disabled:t==null?void 0:t.isCalculating,onSave:W,onCancel:de,onEdit:q,children:Y?e.jsx(Ke,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(Ye,{override:{read:Z===I.VIEW},children:e.jsxs("div",{className:" grid grid-cols-4 gap-3  ",children:[e.jsx("div",{className:"",children:e.jsx(D,{label:"label.cam.recommendedLoanAmt*",name:"recommendedLoanAmount",variant:G.SECONDARY,value:s??"",onChange:f=>Q(f,{currency:!0,field:"recommendedLoanAmount"}),className:"text-right",validation:(Ze=m==null?void 0:m.current)==null?void 0:Ze.message("recommendedLoanAmount",ht(s),"mandatory|checkNumber|onlyPositive"),onBlur:K})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.insurancePremium*",name:"insurancePremium",className:"text-right",variant:G.SECONDARY,value:u??"",disabled:!0})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.totalLoanAmount*",name:"totalLoanAmount",className:"text-right",variant:G.SECONDARY,value:x??"",disabled:!0})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.ROI*",name:"roi",variant:G.SECONDARY,value:S??"",className:"text-right",onChange:f=>Q(f,{currency:!0,field:"roi"}),validation:(we=m==null?void 0:m.current)==null?void 0:we.message("roi",ht(S),"mandatory|checkNumber|onlyPositive"),onBlur:K})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.tenure(Months)*",name:"tenure",className:"text-right",variant:G.SECONDARY,value:k??"",onChange:f=>Q(f,{field:"tenure"}),validation:(De=m==null?void 0:m.current)==null?void 0:De.message("tenure",k,"mandatory"),onBlur:K})}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.interestType*",placeholder:"placeholder.cam.interestType",name:"interestType",value:ue,onChange:Q,validation:(et=m==null?void 0:m.current)==null?void 0:et.message("interestType",ue,"mandatory"),onBlur:K,options:b.interestType,optionLabel:"name",optionValue:"code"})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.emi*",name:"emi",className:"text-right",variant:G.SECONDARY,value:re??"",disabled:!0})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.TotalDeductions*",name:"totalDeduction",className:"text-right",variant:G.SECONDARY,value:me??"",onChange:f=>Q(f,{currency:!0}),disabled:!0})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.netDisbursal*",name:"netDisbursal",className:"text-right",variant:G.SECONDARY,value:We??"",disabled:!0})}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.transactionType*",placeholder:"placeholder.cam.transactionType",name:"transactionType",value:qe,onChange:f=>Q(f,{field:"transactionType"}),validation:(tt=m==null?void 0:m.current)==null?void 0:tt.message("transactionType",qe,"mandatory"),onBlur:K,options:b.transactionType,optionLabel:"name",optionValue:"code"})}),e.jsx("div",{children:e.jsx(D,{label:"label.cam.balanceTransfer(Months)*",name:"balanceTransfer",className:"text-right",variant:G.SECONDARY,value:Je??"",onChange:Q,validation:(nt=m==null?void 0:m.current)==null?void 0:nt.message("balanceTransfer",Je,pe()),onBlur:K,disabled:(t==null?void 0:t.transactionType)!==Tt})}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.employeeLoan*",placeholder:"placeholder.cam.employeeLoan",name:"employeeLoan",value:Ie,onChange:f=>Q(f,{field:"employeeLoan"}),validation:(C=m==null?void 0:m.current)==null?void 0:C.message("employeeLoan",Ie,"mandatory"),onBlur:K,options:pt,optionLabel:"label",optionValue:"value"})}),e.jsx("div",{children:e.jsx(D,{label:Ie==="YES"?"label.cam.employeeID*":"label.cam.employeeID",name:"employeeId",variant:G.SECONDARY,value:ze??"",onChange:Q,validation:($e=m==null?void 0:m.current)==null?void 0:$e.message("employeeId",ze,g()),onBlur:K,disabled:(t==null?void 0:t.employeeLoan)===Xe.NO})}),e.jsx("div",{children:e.jsx(D,{label:Ie==="YES"?"label.cam.employeeName*":"label.cam.employeeName",name:"employeeName",variant:G.SECONDARY,value:Qe??"",onChange:Q,validation:(Ve=m==null?void 0:m.current)==null?void 0:Ve.message("employeeName",Qe,_()),onBlur:K,disabled:(t==null?void 0:t.employeeLoan)===Xe.NO})})]})})}),e.jsx(Fe,{position:"bottom-right",ref:M,toastText:J,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{te(!1),y("")},visible:h,errorMessage:P})]})}),Lt={loanUid:""},Mt={uid:"",loanNumber:"",remarks:""},on=r.forwardRef((fe,Ce)=>{const{data:j}=fe,b=Le(),[Y,v]=r.useState({...Lt}),[i,t]=r.useState(I.VIEW),[R,O]=r.useState(""),[ee,Z]=r.useState(!1),[X,J]=r.useState(""),[z,U]=r.useState(!1),A=r.useRef(null),P=Me.useRef(null),[,y]=r.useState(!1),h=r.useRef(new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>y(a=>!a)}}));r.useEffect(()=>{j!=null&&j.loanUid&&v(a=>({...a,...j}))},[j]),r.useEffect(()=>{var a;A!=null&&A.current&&R!==""&&((a=A==null?void 0:A.current)==null||a.showFunction(),O(""))},[R,ee]),r.useEffect(()=>{X&&U(!0)},[X]);const te=(a,c)=>{var _;let g={...c.rowData};g={...g,[`${c.field}`]:a.target.value},(_=P.current)==null||_.reportDataChange(g)},M=a=>{var c,g;(g=h==null?void 0:h.current)==null||g.showMessageFor((c=a==null?void 0:a.target)==null?void 0:c.name)},p=()=>{var c,g;let a=!1;return a=((c=h==null?void 0:h.current)==null?void 0:c.allValid())??!1,a||(y(_=>!_),(g=h==null?void 0:h.current)==null||g.showMessages(),y(_=>!_),!1)},m=async()=>{var c,g;if(!p())return;const a=W();try{await he.updateFinancierLoanNumber(a),O(je.SAVED),Z(!ee),t(I.VIEW),(c=P.current)==null||c.clearAll(),(g=P.current)==null||g.search()}catch(_){J(Ee(_))}},F=()=>t(I.EDIT),Q=()=>{var a,c;t(I.VIEW),Te(),(a=P.current)==null||a.clearAll(),(c=P.current)==null||c.search()},K=()=>{var a;(a=P.current)==null||a.addRow({...Mt})},be=a=>{var c;(c=P.current)==null||c.deleteRow(a),h.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>y(g=>!g)}})},Te=()=>{var a;h.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>y(c=>!c)}}),(a=h==null?void 0:h.current)==null||a.hideMessages()},W=()=>{var pe,s,u;const a=((pe=P.current)==null?void 0:pe.getAddedRecords())??[];let c=((s=P.current)==null?void 0:s.getDeletedRecords())??[],g=((u=P.current)==null?void 0:u.getUpdatedRecords())??[];c=c.map(x=>yt(x)),g=g.map(x=>yt(x));const _=[...a,...c,...g];return{loan:{uid:b==null?void 0:b.loanUid},stage:{uid:b==null?void 0:b.stageUid},financialLoanNumbers:_}},q=a=>{var c;return e.jsx("div",{className:"",children:e.jsx(D,{name:`loanNumber${a==null?void 0:a.uid}`,variant:G.SECONDARY,onChange:g=>te(g,{rowData:a,field:"loanNumber"}),onBlur:M,value:a==null?void 0:a.loanNumber,validation:(c=h==null?void 0:h.current)==null?void 0:c.message(`loanNumber${a==null?void 0:a.uid}`,a==null?void 0:a.loanNumber,"mandatory")})})},de=a=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(D,{name:`remarks${a==null?void 0:a.uid}`,variant:G.SECONDARY,onChange:g=>te(g,{rowData:a,field:"remarks"}),onBlur:M,value:a==null?void 0:a.remarks,validation:(c=h==null?void 0:h.current)==null?void 0:c.message(`remarks${a==null?void 0:a.uid}`,a==null?void 0:a.remarks,"mandatory")})})},ge=a=>e.jsx("div",{className:"",children:e.jsx(ut,{buttonType:dt.DELETE,onClick:()=>be(a),disabled:i===I.VIEW,tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})});return e.jsxs(e.Fragment,{children:[e.jsx(_e,{title:"label.cam.financierLoanNumbers",pageMode:i,onSave:m,onCancel:Q,onEdit:F,children:e.jsx(Ye,{override:{read:i===I.VIEW},children:e.jsx("div",{className:" grid grid-cols-4 gap-3  ",children:e.jsx("div",{className:"col-span-4",children:typeof i=="string"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex mb-3 justify-end",children:e.jsx("div",{className:" mr-3 self-center",children:e.jsx(ot,{buttonType:it.ICON_TEXT_ROW,customLabel:"label.cam.add",onClick:K})})}),e.jsxs(ct,{ref:P,uniqueKey:"uid",standardDataFormatPromise:he.getFinancierLoanNumber,search:`&stage.uid=${b==null?void 0:b.stageUid}&loan.uid=${b==null?void 0:b.loanUid}&isActive=true`,mode:"UPDATE",className:"table-auto-height",paginator:!1,children:[e.jsx(se,{header:ae.t("label.cam.financierLoanNumber"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6",body:q}),e.jsx(se,{header:ae.t("label.cam.description"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:de}),e.jsx(se,{header:ae.t("label.investmentInfo.table.colTitle.action"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6",style:{minWidth:"50px",width:"50px"},body:ge})]})]}):null})})})}),e.jsx(Fe,{position:"bottom-right",ref:A,toastText:R,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{U(!1),J("")},visible:z,errorMessage:X})]})}),cn={loanUid:""},Yt={uid:"",smTagName:"",remarks:"",isApplicable:null,isActive:!0},un=r.forwardRef((fe,Ce)=>{const{dropDownOptions:j,getDetailsCallback:b}=fe,Y=Le(),[v,i]=r.useState(I.VIEW),[t,R]=r.useState(""),[O,ee]=r.useState(!1),[Z,X]=r.useState(""),[J,z]=r.useState(!1),U=r.useRef(null),A=Me.useRef(null),[,P]=r.useState(!1),y=r.useRef(new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>P(a=>!a)}}));r.useEffect(()=>{var a;U!=null&&U.current&&t!==""&&((a=U==null?void 0:U.current)==null||a.showFunction(),R(""))},[t,O]),r.useEffect(()=>{Z&&z(!0)},[Z]);const h=(a,c)=>{var _;let g={...c.rowData};c!=null&&c.isCheckbox?g={...g,[`${c.field}`]:a.value}:g={...g,[`${c.field}`]:a.target.value},(_=A.current)==null||_.reportDataChange(g)},te=a=>{var c,g;(g=y==null?void 0:y.current)==null||g.showMessageFor((c=a==null?void 0:a.target)==null?void 0:c.name)},M=()=>{var c,g;let a=!1;return a=((c=y==null?void 0:y.current)==null?void 0:c.allValid())??!1,a||(P(_=>!_),(g=y==null?void 0:y.current)==null||g.showMessages(),P(_=>!_),!1)},p=async()=>{var c,g;if(!M())return;const a=Te();try{await he.updateLoanTags(a),R(je.SAVED),ee(!O),i(I.VIEW),(c=A.current)==null||c.clearAll(),(g=A.current)==null||g.search()}catch(_){X(Ee(_))}},m=()=>i(I.EDIT),F=()=>{var a,c;i(I.VIEW),be(),(a=A.current)==null||a.clearAll(),(c=A.current)==null||c.search()},Q=()=>{var a;(a=A.current)==null||a.addRow({...Yt})},K=a=>{var c;(c=A.current)==null||c.deleteRow(a),y.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>P(g=>!g)}})},be=()=>{var a;y.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>P(c=>!c)}}),(a=y==null?void 0:y.current)==null||a.hideMessages()},Te=()=>{var pe,s,u;console.log("enrich for save");let a=((pe=A.current)==null?void 0:pe.getAddedRecords())??[],c=((s=A.current)==null?void 0:s.getDeletedRecords())??[],g=((u=A.current)==null?void 0:u.getUpdatedRecords())??[];a=a.map(x=>({...x,smTagName:x==null?void 0:x.smTagName})),c=c.map(x=>vt(x)),g=g.map(x=>vt(x));const _=[...a,...c,...g];return{loan:{uid:Y==null?void 0:Y.loanUid},stage:{uid:Y==null?void 0:Y.stageUid},loanTags:_}},W=a=>{var c;return e.jsx("div",{className:"pt-4",children:e.jsx(ve,{hideLabel:!0,placeholder:"placeholder.cam.Tags",name:`tags${a==null?void 0:a.uid}`,value:a==null?void 0:a.smTagName,variant:G.PRIMARY,options:j.tags,optionLabel:"name",optionValue:"code",onChange:g=>h(g,{rowData:a,field:"smTagName"}),onBlur:te,validation:(c=y==null?void 0:y.current)==null?void 0:c.message(`tags${a==null?void 0:a.uid}`,a.smTagName,"mandatory")})})},q=a=>{var c;return e.jsxs("div",{className:"mt-5 ",children:[e.jsxs("div",{className:"flex flex-shrink-0 justify-center ",children:[e.jsxs("div",{className:"mr-5 flex",children:[e.jsx(bt,{hideLabel:!0,hideErrorRow:!0,variant:ft.PRIMARY,value:!0,checked:(a==null?void 0:a.isApplicable)===!0,onChange:g=>h(g,{rowData:a,field:"isApplicable",isCheckbox:!0}),disabled:v===I.VIEW}),e.jsx(L,{className:"ml-1.5 text-xs ",label:"label.dde.yes"})]}),e.jsxs("div",{className:"flex",children:[e.jsx(bt,{hideLabel:!0,hideErrorRow:!0,variant:ft.PRIMARY,value:!1,checked:(a==null?void 0:a.isApplicable)===!1,onChange:g=>h(g,{rowData:a,field:"isApplicable",isCheckbox:!0}),disabled:v===I.VIEW}),e.jsx(L,{className:"ml-1.5 text-xs ",label:"label.dde.no"})]})]}),e.jsx("div",{className:"h-4 flex ml-6 justify-center mb-1.5 ",children:e.jsx(Nt,{validation:(c=y==null?void 0:y.current)==null?void 0:c.message(`value${a==null?void 0:a.uid}`,a.isApplicable,"mandatory")})})]})},de=a=>{var c;return e.jsx("div",{className:"flex items-start mt-1",children:e.jsx(D,{name:`comment${a==null?void 0:a.uid}`,variant:G.SECONDARY,onChange:g=>h(g,{rowData:a,field:"remarks"}),onBlur:te,value:a==null?void 0:a.remarks,validation:(c=y==null?void 0:y.current)==null?void 0:c.message(`comment${a==null?void 0:a.uid}`,a==null?void 0:a.remarks,"mandatory")})})},ge=a=>e.jsx("div",{className:"",children:e.jsx(ut,{buttonType:dt.DELETE,onClick:()=>K(a),disabled:v===I.VIEW,tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})});return e.jsxs(e.Fragment,{children:[e.jsx(_e,{title:"label.cam.loanTags",pageMode:v,onSave:p,onCancel:F,onEdit:m,children:e.jsx(Ye,{override:{read:v===I.VIEW},children:e.jsx("div",{className:" grid grid-cols-4 gap-3  ",children:e.jsx("div",{className:"col-span-4",children:typeof v=="string"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex mb-3 justify-end",children:e.jsx("div",{className:" mr-3 self-center",children:e.jsx(ot,{buttonType:it.ICON_TEXT_ROW,customLabel:"label.cam.addTags",onClick:Q})})}),e.jsxs(ct,{ref:A,uniqueKey:"uid",standardDataFormatPromise:he.getLoanTags,search:`?stage.uid=${Y==null?void 0:Y.stageUid}&loan.uid=${Y==null?void 0:Y.loanUid}&isActive=${!0}`,mode:"UPDATE",className:"table-auto-height",children:[e.jsx(se,{header:ae.t("label.cam.tags"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6",body:W}),e.jsx(se,{header:ae.t("label.cam.yes/no"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:q}),e.jsx(se,{header:ae.t("label.cam.comment"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:de}),e.jsx(se,{header:ae.t("label.investmentInfo.table.colTitle.action"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6",style:{minWidth:"50px",width:"50px"},body:ge})]})]}):null})})})}),e.jsx(Fe,{position:"bottom-right",ref:U,toastText:t,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{z(!1),X("")},visible:J,errorMessage:Z})]})}),_t={collateralProperties:[],totalPropertyValuation:"",property:{uid:"",isCalculating:!1}},dn=r.forwardRef((fe,Ce)=>{const{data:j,getDetailsCallback:b,isLoading:Y}=fe,v=Le(),[i,t]=r.useState({..._t}),[R,O]=r.useState(""),[ee,Z]=r.useState(!1),[X,J]=r.useState(""),[z,U]=r.useState(!1),A=r.useRef(null),P=Me.useRef(null),[,y]=r.useState(!1),h=r.useRef([]);r.useRef(null),r.useRef(null),r.useImperativeHandle(Ce,()=>({refresh:de})),r.useEffect(()=>{var s;t(u=>({...u,collateralProperties:(j==null?void 0:j.collateralProperties)??[],totalPropertyValuation:(j==null?void 0:j.totalPropertyValuation)??""})),W(((s=j==null?void 0:j.collateralProperties)==null?void 0:s.length)??0)},[j]),r.useEffect(()=>{var s;A!=null&&A.current&&R!==""&&((s=A==null?void 0:A.current)==null||s.showFunction(),O(""))},[R,ee]),r.useEffect(()=>{X&&U(!0)},[X]);const te=async s=>{t(u=>({...u,property:{...u.property,isCalculating:!0,uid:s==null?void 0:s.uid}}));try{const u=be(s),x=await he.engine(u);t(S=>{var re,me;const k={...S,property:{...S.property,isCalculating:!1,uid:""}},ue=(re=S.collateralProperties)==null?void 0:re.findIndex(We=>We.uid===(s==null?void 0:s.uid));return k.collateralProperties[ue].propertyValuation.finalValuation=le((me=x==null?void 0:x.data)==null?void 0:me.propertyFinalValuation),k})}catch(u){console.log(u),t(x=>({...x,property:{...x.property,isCalculating:!1,uid:""}})),J(Ee(u))}},M=(s,u)=>{t(x=>{const S={...x};return S.collateralProperties[u.index].propertyValuation.smValuationOperationType=s.target.value,te(u.property),S})},p=(s,u)=>{var x,S,k;(k=(x=h==null?void 0:h.current)==null?void 0:x[u])==null||k.showMessageFor((S=s==null?void 0:s.target)==null?void 0:S.name)},m=s=>{var x,S,k,ue;let u=!1;return u=((S=(x=h==null?void 0:h.current)==null?void 0:x[s])==null?void 0:S.allValid())??!1,u||(y(re=>!re),(ue=(k=h==null?void 0:h.current)==null?void 0:k[s])==null||ue.showMessages(),y(re=>!re),!1)},F=async(s,u)=>{if(console.log("save"),!m(s))return;const x=Te(u==null?void 0:u.data);try{await he.updatePropertyValuation(x),O(je.SAVED),Z(!ee),b==null||b(!0),t(S=>{const k={...S};return k.collateralProperties[s].pageMode=I.VIEW,k})}catch(S){J(Ee(S))}},Q=s=>{t(u=>{const x={...u};return x.collateralProperties[s].pageMode=I.EDIT,x})},K=s=>{t(u=>{const x={...u};return x.collateralProperties[s].pageMode=I.VIEW,x}),b==null||b(),q(s)},be=s=>{var x;return{loanUid:v==null?void 0:v.loanUid,stageUid:v==null?void 0:v.stageUid,smPropertyValuationOperationType:(x=s==null?void 0:s.propertyValuation)==null?void 0:x.smValuationOperationType,propertyAddressUid:s==null?void 0:s.uid}},Te=s=>{var x,S;return{loan:{uid:v==null?void 0:v.loanUid},stage:{uid:v==null?void 0:v.stageUid},address:{uid:s==null?void 0:s.uid},smValuationOperationType:(x=s==null?void 0:s.propertyValuation)==null?void 0:x.smValuationOperationType,finalValuation:ye((S=s==null?void 0:s.propertyValuation)==null?void 0:S.finalValuation)}},W=s=>{var u,x;for(let S=0;S<s;S++)h.current[S]=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>y(k=>!k)}}),(x=(u=h==null?void 0:h.current)==null?void 0:u[S])==null||x.hideMessages()},q=s=>{var u,x;h.current[s]=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>y(S=>!S)}}),(x=(u=h==null?void 0:h.current)==null?void 0:u[s])==null||x.hideMessages()},de=()=>{var s;(s=P.current)==null||s.search()},ge=()=>{let s="";for(let u=0;u<i.collateralProperties.length;u++)u===i.collateralProperties.length-1?s+=` ${lt[u]}`:s+=`${lt[u]} + `;return i.collateralProperties.length>0?`( ${s} )`:""},a=(s,u)=>{var x,S,k,ue,re;return e.jsxs("div",{className:"flex ",children:[e.jsx("div",{className:"w-30 mr-3",children:e.jsx(ve,{hideLabel:!0,name:`smValuationOperationType${u}`,value:((x=s==null?void 0:s.propertyValuation)==null?void 0:x.smValuationOperationType)??"",variant:G.PRIMARY,options:Et,optionLabel:"name",optionValue:"code",onChange:me=>M(me,{index:u,property:s}),onBlur:me=>p(me,u),validation:(k=h==null?void 0:h.current)==null?void 0:k[u].message(`smValuationOperationType${u}`,(S=s.propertyValuation)==null?void 0:S.smValuationOperationType,"mandatory"),disabled:((ue=i==null?void 0:i.property)==null?void 0:ue.isCalculating)&&((re=i==null?void 0:i.property)==null?void 0:re.uid)!==(s==null?void 0:s.uid)})}),e.jsx(L,{className:" text-xs font-medium ",label:`(${lt[u]})`})]})},c=s=>{var u,x;return e.jsx(L,{className:"text-right",label:`${(u=s.propertyValuation)!=null&&u.finalValuation?"₹ "+le((x=s.propertyValuation)==null?void 0:x.finalValuation):""}`})},g=s=>{var u;return e.jsx(L,{className:"  text-primary-ptext-1000 ",label:`${((u=s==null?void 0:s.partner)==null?void 0:u.name)??""}`})},_=s=>e.jsx(L,{className:"  text-primary-ptext-1000 ",label:`${St(s==null?void 0:s.stageCompletionDate)}`}),pe=s=>{var u;return e.jsx(L,{className:"  text-primary-ptext-1000 text-right",label:`${le((u=s==null?void 0:s.technical)==null?void 0:u.govtTotalValuationOfProperty)}`})};return e.jsx(It,{title:"label.technical.propertyValuation",children:e.jsxs(e.Fragment,{children:[Y?e.jsx(Ke,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsxs(e.Fragment,{children:[i.collateralProperties.map((s,u)=>{var x,S,k,ue,re,me;return e.jsx("div",{children:e.jsx(_e,{title:"",className:"",pageMode:s.pageMode,disabled:(x=i==null?void 0:i.property)==null?void 0:x.isCalculating,onSave:()=>F(u,{data:s}),onCancel:()=>K(u),onEdit:()=>Q(u),children:e.jsx(Ye,{override:{read:s.pageMode===I.VIEW},children:e.jsxs("div",{className:"grid grid-cols-4 gap-5",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.dde.propertyAddress"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:(s==null?void 0:s.address)??""})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"heading.pincode"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs",label:((S=s==null?void 0:s.pincode)==null?void 0:S.pinCode)??""})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"input.pincode.city"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs",label:((k=s==null?void 0:s.city)==null?void 0:k.name)??""})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"input.pincode.state"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs",label:((re=(ue=s==null?void 0:s.city)==null?void 0:ue.state)==null?void 0:re.name)??""})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx(L,{className:"text-primary-ptext-1000  text-xs ",label:"label.cam.valuation"})}),e.jsxs(At,{value:s==null?void 0:s.valuationTable,className:`transaction ${(me=s==null?void 0:s.valuationTable)!=null&&me.length?"  ":" rcu-stage-document-verification"}`,ref:P,dataKey:"uid",children:[e.jsx(se,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:ae.t("label.cam.vendorName"),body:g,footer:()=>a(s,u)}),e.jsx(se,{className:"text-primary-ptext-1000 text-left text-xs  p-1 h-12 pl-6",header:ae.t("label.cam.dateOfValuation"),body:_}),e.jsx(se,{className:"text-primary-ptext-1000 text-right text-xs  p-1 h-12 pl-6 pr-5",header:ae.t("label.cam.totalValuation(₹)"),body:pe,style:{maxWidth:"168px"},footer:()=>c(s)})]})]})]})})})},u)}),(i==null?void 0:i.collateralProperties.length)>0?e.jsxs("div",{className:"bg-[#fbfbff] flex justify-between pl-7 pr-11 py-6",children:[e.jsx("div",{children:e.jsx(L,{className:" font-medium text-xs",label:"label.cam.totalValuationBeingConsidered",args:{properties:ge()}})}),e.jsx("div",{children:e.jsx(L,{className:" font-medium text-xs",label:i!=null&&i.totalPropertyValuation?"₹ "+le(i==null?void 0:i.totalPropertyValuation):""})})]}):null]}),e.jsx("div",{}),e.jsx(Fe,{position:"bottom-right",ref:A,toastText:R,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{U(!1),J("")},visible:z,errorMessage:X})]})})}),Wt={uid:"",editorText:"",errorMessage:""},mn=r.forwardRef((fe,Ce)=>{const{data:j,isLoading:b,getDetailsCallback:Y}=fe,v=Le(),[i,t]=r.useState({...Wt}),[R,O]=r.useState(I.VIEW),[ee,Z]=r.useState(""),[X,J]=r.useState(!1),[z,U]=r.useState(""),[A,P]=r.useState(!1),y=r.useRef(null),h=r.useRef(null),[,te]=r.useState(!1),M=r.useRef(new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>te(W=>!W)}}));r.useEffect(()=>{t(W=>({...W,...j}))},[j]),r.useEffect(()=>{var W;y!=null&&y.current&&ee!==""&&((W=y==null?void 0:y.current)==null||W.showFunction(),Z(""))},[ee,X]),r.useEffect(()=>{z&&P(!0)},[z]);const p=W=>{m()&&i!=null&&i.errorMessage&&t(q=>({...q,errorMessage:""}))},m=()=>{var q,de,ge,a;return console.log("editor ",h),((a=(ge=(de=(q=h==null?void 0:h.current)==null?void 0:q.editor)==null?void 0:de.plugins)==null?void 0:ge.wordcount)==null?void 0:a.body.getCharacterCount())<1?(t(c=>({...c,errorMessage:"Mandatory"})),!1):!0},F=async()=>{if(m()){const W=be();try{await he.updateRepaymentHistoryComment(W),Z(je.SAVED),J(!X),O(I.VIEW),Y==null||Y()}catch(q){U(Ee(q))}}},Q=()=>O(I.EDIT),K=()=>{O(I.VIEW),Te(),Y==null||Y()},be=()=>{var W,q;return{loan:{uid:v==null?void 0:v.loanUid},stage:{uid:v==null?void 0:v.stageUid},remarksOnRepaymentHistory:(q=(W=h.current)==null?void 0:W.editor)==null?void 0:q.getContent()}},Te=()=>{var W;M.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>te(q=>!q)}}),(W=M==null?void 0:M.current)==null||W.hideMessages()};return e.jsxs("div",{children:[e.jsx(_e,{title:"label.cam.commentsOnRepaymentHistory",pageMode:R,disabled:b,onSave:F,onCancel:K,onEdit:Q,children:b?e.jsx(Ke,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(Ye,{override:{read:R===I.VIEW},children:e.jsx("div",{className:"grid grid-cols-4 gap-3 ",children:e.jsx("div",{className:"col-span-4",children:e.jsx(jt,{ref:h,validation:{errorMessage:i.errorMessage},initialValue:i.editorText,onChange:p,height:"400x",disabled:R===I.VIEW})})})})}),e.jsx(Fe,{position:"bottom-right",ref:y,toastText:ee,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{P(!1),U("")},visible:A,errorMessage:z})]})}),st={uid:"",name:"",product:{uid:"",name:""},bank:{uid:"",name:""},incomeSchemeName:{uid:"",name:""},lendingType:{uid:"",name:""}},$t={tableSearch:"",productIncomeScheme:{...st},loadingForUpdatedProductIncomeScheme:!1,chargeNameOptions:[],row:{isCalculating:!1,uid:""},isChangeProductIncomeScheme:!1,newProductIncomeScheme:{...st}},Vt={uid:"",chargeTypeCode:"",amount:"",amountIncludingGst:"",feeConfiguration:{uid:"",fee:{name:""},configurationType:{name:"",code:""},isDefault:!1,isWaiver:!1},status:Ct.APPLICABLE,isActive:!0},xn=r.forwardRef((fe,Ce)=>{var $e,Ve,f,N,$,w,Ae,ke,Be,Ge,mt,xt;const{data:j,dropDownOptions:b,isLoading:Y,getDetailsCallback:v}=fe,i=Le(),[t,R]=r.useState({...$t}),[O,ee]=r.useState(I.VIEW),[Z,X]=r.useState(void 0),[J,z]=r.useState(""),[U,A]=r.useState(!1),[P,y]=r.useState(""),[h,te]=r.useState(!1),M=r.useRef(null),p=Me.useRef(null),[,m]=r.useState(!1),F=r.useRef(new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>m(n=>!n)}}));r.useImperativeHandle(Ce,()=>({refreshFeeTable:k})),r.useEffect(()=>{R(n=>({...n,productIncomeScheme:j==null?void 0:j.productIncomeScheme,tableSearch:`&loanUid=${i==null?void 0:i.loanUid}&reEvalDefaultFee=false&start=0&limit=10000`}))},[j]),r.useEffect(()=>{var n;M!=null&&M.current&&J!==""&&((n=M==null?void 0:M.current)==null||n.showFunction(),z(""))},[J,U]),r.useEffect(()=>{P&&te(!0)},[P]),r.useEffect(()=>{var n,l,d,o,T,E,V,B;if((l=(n=t==null?void 0:t.productIncomeScheme)==null?void 0:n.lendingType)!=null&&l.uid&&((o=(d=t==null?void 0:t.productIncomeScheme)==null?void 0:d.bank)!=null&&o.uid)&&(b!=null&&b.productIncomeScheme)&&((T=b==null?void 0:b.productIncomeScheme)==null?void 0:T.length)>0){const H=(E=b==null?void 0:b.productIncomeScheme)==null?void 0:E.find(ne=>{var xe;return ne.uid===((xe=t==null?void 0:t.productIncomeScheme)==null?void 0:xe.uid)});Q(((B=(V=H==null?void 0:H.product)==null?void 0:V.productType)==null?void 0:B.uid)??"")}},[($e=t==null?void 0:t.productIncomeScheme)==null?void 0:$e.uid,b.productIncomeScheme]);const Q=async n=>{var l,d,o,T;try{const E=await he.getChargeNameOptions(`?bankUid=${(d=(l=t==null?void 0:t.productIncomeScheme)==null?void 0:l.bank)==null?void 0:d.uid}&lendingTypeUid=${(T=(o=t==null?void 0:t.productIncomeScheme)==null?void 0:o.lendingType)==null?void 0:T.uid}&productTypeUid=${n}`);R(V=>{const B={...V};return B.chargeNameOptions=E==null?void 0:E.data,B})}catch(E){console.log(E),y(Ee(E))}},K=async n=>{var l,d,o;R(T=>({...T,row:{...T.row,isCalculating:!0,uid:n==null?void 0:n.uid}}));try{const T=We(n),E=await he.engine(T);R(ne=>({...ne,row:{...ne.row,isCalculating:!1,uid:""}}));const V=(l=p==null?void 0:p.current)==null?void 0:l.getCurrentRecords(),H={...V==null?void 0:V.find(ne=>ne.uid===(n==null?void 0:n.uid)),amountIncludingGst:le((d=E==null?void 0:E.data)==null?void 0:d.loanFeeAmountIncludingGst)};(o=p.current)==null||o.reportDataChange(H)}catch(T){console.log(T),R(E=>({...E,row:{...E.row,isCalculating:!1,uid:""}})),y(Ee(T))}},be=n=>{R(l=>({...l,[n.target.name]:n.target.value}))},Te=n=>{var d;const l=(d=b==null?void 0:b.productIncomeScheme)==null?void 0:d.find(o=>o.uid===n.target.value);R(o=>{var B,H,ne,xe,Ne,Se,He,Oe,at;let T={...o},E="productIncomeScheme";const V={...o.productIncomeScheme,name:(l==null?void 0:l.name)??"",uid:(l==null?void 0:l.uid)??"",product:{...o.productIncomeScheme.product,name:((B=l==null?void 0:l.product)==null?void 0:B.name)??"",uid:((H=l==null?void 0:l.product)==null?void 0:H.uid)??""},incomeSchemeName:{...o.productIncomeScheme.incomeSchemeName,name:((ne=l==null?void 0:l.incomeSchemeName)==null?void 0:ne.name)??"",uid:((xe=l==null?void 0:l.incomeSchemeName)==null?void 0:xe.uid)??""},bank:{...o.productIncomeScheme.bank,name:((Ne=l==null?void 0:l.bank)==null?void 0:Ne.name)??"",uid:((Se=l==null?void 0:l.bank)==null?void 0:Se.uid)??""},lendingType:{...o.productIncomeScheme.lendingType??"",name:((He=l==null?void 0:l.lendingType)==null?void 0:He.name)??"",uid:((Oe=l==null?void 0:l.lendingType)==null?void 0:Oe.uid)??""}};return(at=j==null?void 0:j.productIncomeScheme)!=null&&at.uid&&(E="newProductIncomeScheme",T.isChangeProductIncomeScheme=!0),T={...T,[`${E}`]:{...V}},T})},W=(n,l)=>{var T,E,V,B,H,ne,xe,Ne,Se,He,Oe;let d={...l.rowData};const o=(T=t==null?void 0:t.chargeNameOptions)==null?void 0:T.find(at=>at.uid===n.target.value);d={...d,feeConfiguration:{...d.feeConfiguration,uid:(o==null?void 0:o.uid)??"",configurationType:{...d.feeConfiguration.configurationType,name:((V=(E=o==null?void 0:o.fee)==null?void 0:E.configurationType)==null?void 0:V.name)??"",code:((H=(B=o==null?void 0:o.fee)==null?void 0:B.configurationType)==null?void 0:H.code)??""},isDefault:o==null?void 0:o.isDefault,isWaiver:o==null?void 0:o.isWaiver,fee:{...d.feeConfiguration.fee,name:(ne=o==null?void 0:o.fee)==null?void 0:ne.name}},amount:((Ne=(xe=o==null?void 0:o.fee)==null?void 0:xe.configurationType)==null?void 0:Ne.code)===Ue.CONFIGURATION_FIXED?o==null?void 0:o.amount:(o==null?void 0:o.amountInPercent)??"",chargeTypeCode:((He=(Se=o==null?void 0:o.fee)==null?void 0:Se.chargeType)==null?void 0:He.code)??""},Ie(()=>K(d),1200),(Oe=p.current)==null||Oe.reportDataChange(d)},q=(n,l)=>{var T,E,V,B;let d={...l.rowData},o;((V=(E=(T=l==null?void 0:l.rowData)==null?void 0:T.feeConfiguration)==null?void 0:E.configurationType)==null?void 0:V.code)===Ue.CONFIGURATION_FIXED?o=le(n.target.value):o=n.target.value,d={...d,amount:o},(B=p.current)==null||B.reportDataChange(d),Ie(()=>K(d),1200)},de=n=>{var l,d;(d=F==null?void 0:F.current)==null||d.showMessageFor((l=n==null?void 0:n.target)==null?void 0:l.name)},ge=()=>{var l,d;let n=!1;return n=((l=F==null?void 0:F.current)==null?void 0:l.allValid())??!1,n||(m(o=>!o),(d=F==null?void 0:F.current)==null||d.showMessages(),m(o=>!o),!1)},a=async()=>{var l,d;if(!ge())return;const n=qe();try{await he.updateSchemeDetails(n),z(je.SAVED),A(!U),ee(I.VIEW),v==null||v(),(l=p.current)==null||l.clearAll(),(d=p.current)==null||d.search()}catch(o){y(Ee(o))}},c=()=>ee(I.EDIT),g=()=>{var n,l;ee(I.VIEW),me(),v==null||v(),(n=p.current)==null||n.clearAll(),(l=p.current)==null||l.search()},_=()=>{var n;(n=p.current)==null||n.addRow({...Vt})},pe=async()=>{R(n=>{var l,d,o,T;return{...n,tableSearch:`&loanUid=${i==null?void 0:i.loanUid}&reEvalDefaultFee=true&bankUid=${(d=(l=t==null?void 0:t.productIncomeScheme)==null?void 0:l.bank)==null?void 0:d.uid}&lendingTypeUid=${(T=(o=t==null?void 0:t.productIncomeScheme)==null?void 0:o.lendingType)==null?void 0:T.uid}&start=0&limit=10000`}})},s=n=>{var l;(l=p.current)==null||l.deleteRow(n),F.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>m(d=>!d)}})},u=()=>{var n,l;if(me(),(n=t==null?void 0:t.tableSearch)!=null&&n.includes("reEvalDefaultFee=true")){const d=(l=p==null?void 0:p.current)==null?void 0:l.getCurrentRecords();d==null||d.forEach(o=>{o!=null&&o.uid||K(o)})}},x=()=>{R(n=>({...n,isChangeProductIncomeScheme:!1,newProductIncomeScheme:{...st}}))},S=async()=>{var l,d,o;console.log("test");const n=(l=t==null?void 0:t.newProductIncomeScheme)==null?void 0:l.uid;R(T=>({...T,isChangeProductIncomeScheme:!1,productIncomeScheme:{...T.newProductIncomeScheme},newProductIncomeScheme:{...st},loadingForUpdatedProductIncomeScheme:!0}));try{const T=Je(n);await he.updateSchemeDetails(T),R(E=>({...E,loadingForUpdatedProductIncomeScheme:!1})),z(je.SAVED),A(!U),v==null||v({isProductIncomeSchemeUpdated:!0}),(d=p.current)==null||d.clearAll(),(o=p.current)==null||o.search()}catch(T){y(Ee(T)),R(E=>({...E,loadingForUpdatedProductIncomeScheme:!1}))}},k=()=>{var n;(n=p==null?void 0:p.current)==null||n.search()},ue=()=>"Changing the Product Income Scheme will</br></br><ul><li>Clear entries in Fees Details table</li><li>Make changes in Final Loan Details Table</li><li>Clear entries in Income Details table</li><li>Make changes in Monthly Banking Analysis</li><li>Make changes in Credit and Debit Transactions</li></ul><br/>Are you sure you want to continue ?",re=n=>n===Ue.CONFIGURATION_VARIABLE?"mandatory|checkNumber|max:100,num|maxDecimal:2":"mandatory",me=()=>{var n;F.current=new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>m(l=>!l)}}),(n=F==null?void 0:F.current)==null||n.hideMessages()},We=n=>{var d;return{loanUid:i==null?void 0:i.loanUid,stageUid:i==null?void 0:i.stageUid,feeConfigurationUid:(d=n==null?void 0:n.feeConfiguration)==null?void 0:d.uid,loanFeeAmount:ye(n==null?void 0:n.amount)}},qe=()=>{var T,E,V,B;console.log("enrich for save");let n=((T=p.current)==null?void 0:T.getAddedRecords())??[],l=((E=p.current)==null?void 0:E.getDeletedRecords())??[],d=((V=p.current)==null?void 0:V.getUpdatedRecords())??[];n=n.map(H=>rt(H)),l=l.map(H=>rt(H)),d=d.map(H=>rt(H));const o=[...n,...l,...d];return{loan:{uid:i==null?void 0:i.loanUid},stage:{uid:i==null?void 0:i.stageUid},productIncomeScheme:{uid:(B=t==null?void 0:t.productIncomeScheme)==null?void 0:B.uid},loanFees:o}},Je=n=>({loan:{uid:i==null?void 0:i.loanUid},stage:{uid:i==null?void 0:i.stageUid},productIncomeScheme:{uid:n},loanFees:[]}),Ie=(n,l)=>{clearTimeout(Z),X(setTimeout(n,l))},ze=n=>{var l,d,o,T,E,V,B,H,ne,xe,Ne;return(l=n==null?void 0:n.feeConfiguration)!=null&&l.isDefault?e.jsx("div",{className:"pt-4",children:e.jsx(ve,{hideLabel:!0,placeholder:"placeholder.cam.chargeName",name:`chargeName${n==null?void 0:n.uid}`,value:(o=(d=n==null?void 0:n.feeConfiguration)==null?void 0:d.fee)==null?void 0:o.name,variant:G.PRIMARY,options:[`${(E=(T=n==null?void 0:n.feeConfiguration)==null?void 0:T.fee)==null?void 0:E.name}`],disabled:!0})}):e.jsx("div",{className:"pt-4",children:e.jsx(ve,{hideLabel:!0,placeholder:"placeholder.cam.chargeName",name:`chargeName${n==null?void 0:n.uid}`,value:(V=n==null?void 0:n.feeConfiguration)==null?void 0:V.uid,variant:G.PRIMARY,options:t==null?void 0:t.chargeNameOptions,optionLabel:"fee.name",optionValue:"uid",onChange:Se=>W(Se,{rowData:n}),onBlur:de,validation:(ne=F==null?void 0:F.current)==null?void 0:ne.message(`chargeName${n==null?void 0:n.uid}`,(H=(B=n.feeConfiguration)==null?void 0:B.fee)==null?void 0:H.name,"mandatory"),disabled:((xe=t==null?void 0:t.row)==null?void 0:xe.isCalculating)&&((Ne=t==null?void 0:t.row)==null?void 0:Ne.uid)!==n.uid})})},Qe=n=>{var l,d;return e.jsx(D,{variant:G.SECONDARY,value:(n==null?void 0:n.chargeTypeCode)!==""?(d=(l=gt)==null?void 0:l[n==null?void 0:n.chargeTypeCode])==null?void 0:d.label:"",disabled:!0})},Ze=n=>{var l,d;return e.jsx(D,{variant:G.SECONDARY,value:(d=(l=n.feeConfiguration)==null?void 0:l.configurationType)==null?void 0:d.name,disabled:!0})},we=n=>{var l;return e.jsx(D,{variant:G.SECONDARY,value:(l=n.feeConfiguration)!=null&&l.isWaiver?"Yes":"No",disabled:!0})},De=n=>{var l;return e.jsx(D,{variant:G.SECONDARY,value:(l=n.feeConfiguration)!=null&&l.isDefault?"Yes":"No",disabled:!0})},et=n=>{var l,d,o,T,E,V,B,H,ne,xe,Ne;return e.jsx("div",{className:"",children:e.jsx(Rt,{name:`amount${n==null?void 0:n.uid}`,label:"",className:"text-right",variant:G.SECONDARY,value:((d=(l=n==null?void 0:n.feeConfiguration)==null?void 0:l.configurationType)==null?void 0:d.code)===Ue.CONFIGURATION_FIXED?le(n==null?void 0:n.amount):n==null?void 0:n.amount,onBlur:de,onChange:Se=>q(Se,{rowData:n}),validation:(E=F==null?void 0:F.current)==null?void 0:E.message(`amount${n==null?void 0:n.uid}`,n==null?void 0:n.amount,re((T=(o=n==null?void 0:n.feeConfiguration)==null?void 0:o.configurationType)==null?void 0:T.code)),disabled:(n==null?void 0:n.chargeTypeCode)===gt.CHARGE_TYPE_SYSTEM_DEFINED.code||((V=t==null?void 0:t.row)==null?void 0:V.isCalculating)&&((B=t==null?void 0:t.row)==null?void 0:B.uid)!==n.uid,isSuffix:!0,addOn:((ne=(H=n==null?void 0:n.feeConfiguration)==null?void 0:H.configurationType)==null?void 0:ne.code)===Ue.CONFIGURATION_FIXED?"₹":((Ne=(xe=n==null?void 0:n.feeConfiguration)==null?void 0:xe.configurationType)==null?void 0:Ne.code)===Ue.CONFIGURATION_VARIABLE?"%":""})})},tt=n=>e.jsx(D,{variant:G.SECONDARY,className:"text-right",value:n.amountIncludingGst??"",disabled:!0}),nt=n=>{var l;return e.jsx("div",{className:"",children:e.jsx(ut,{buttonType:dt.DELETE,onClick:()=>s(n),disabled:O===I.VIEW||!((l=n==null?void 0:n.feeConfiguration)!=null&&l.isWaiver),tooltipOptions:{position:"left",className:"text-xs font-Roboto bg-black text-white !p-1 rounded-md ",showDelay:"1000,",hideDelay:"300"}})})},{productIncomeScheme:C}=t;return e.jsxs(e.Fragment,{children:[e.jsx(_e,{title:"label.cam.schemeDetails",pageMode:O,disabled:(Ve=t==null?void 0:t.row)==null?void 0:Ve.isCalculating,onSave:a,onCancel:g,onEdit:c,children:Y||t!=null&&t.loadingForUpdatedProductIncomeScheme?e.jsx(Ke,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsx(Ye,{override:{read:O===I.VIEW},children:e.jsxs("div",{className:" grid grid-cols-4 gap-3  ",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(ve,{label:"label.cam.productIncomeScheme*",placeholder:"placeholder.cam.productIncomeScheme*",name:"productIncomeScheme",value:C==null?void 0:C.uid,onChange:Te,validation:(f=F==null?void 0:F.current)==null?void 0:f.message("productIncomeScheme",C==null?void 0:C.uid,"mandatory"),onBlur:de,options:b.productIncomeScheme,optionLabel:"name",optionValue:"uid"})}),e.jsx("div",{className:"col-span-2"}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.Product*",placeholder:"",name:"product",value:(N=C==null?void 0:C.product)==null?void 0:N.name,options:($=C==null?void 0:C.product)!=null&&$.name?[C.product.name]:[],disabled:!0})}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.incomeScheme*",placeholder:"",name:"product",value:(w=C==null?void 0:C.incomeSchemeName)==null?void 0:w.name,options:(Ae=C==null?void 0:C.incomeSchemeName)!=null&&Ae.name?[C.incomeSchemeName.name]:[],disabled:!0})}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.bankOrFinancierName*",placeholder:"",name:"bank",value:(ke=C==null?void 0:C.bank)==null?void 0:ke.name,onChange:be,options:(Be=C==null?void 0:C.bank)!=null&&Be.name?[C.bank.name]:[],disabled:!0})}),e.jsx("div",{children:e.jsx(ve,{label:"label.cam.lendingType*",placeholder:"",name:"product",value:(Ge=C==null?void 0:C.lendingType)==null?void 0:Ge.name,options:(mt=C==null?void 0:C.lendingType)!=null&&mt.name?[C.lendingType.name]:[],disabled:!0})}),e.jsx("div",{className:"col-span-4",children:typeof O=="string"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx("div",{children:e.jsx(L,{className:"text-primary-ptext-900 font-medium text-sm ",label:"label.cam.feeDetails"})}),e.jsxs("div",{className:"flex ",children:[e.jsx("div",{className:" mr-3 self-center",children:e.jsx(Pt,{label:"label.cam.populateDefaultFees",className:"text-primary-copyTextColor text-sm cursor-pointer",onClick:pe,disabled:!((xt=t==null?void 0:t.productIncomeScheme)!=null&&xt.uid)})}),e.jsx("div",{className:" mr-3 self-center",children:e.jsx(ot,{buttonType:it.ICON_TEXT_ROW,customLabel:"label.cam.addFee",onClick:_})})]})]}),t!=null&&t.tableSearch?e.jsxs(ct,{ref:p,uniqueKey:"uid",standardDataFormatPromise:he.getFeeList,search:t==null?void 0:t.tableSearch,mode:"UPDATE",onUpdateCallback:u,variant:"secondary",paginator:!1,className:"table-auto-height",children:[e.jsx(se,{header:ae.t("label.cam.chargeName"),className:"text-primary-ptext-1000 text-left text-xs h-12 pl-6 min-w-49",body:ze}),e.jsx(se,{header:ae.t("label.cam.chargeType"),className:" text-primary-ptext-1000 text-xs h-12 pl-6 min-w-50",body:Qe}),e.jsx(se,{header:ae.t("label.cam.configuration"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:Ze}),e.jsx(se,{header:ae.t("label.cam.waiver"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:we}),e.jsx(se,{header:ae.t("label.cam.default"),className:" text-primary-ptext-1000 text-xs h-12 pl-6",body:De}),e.jsx(se,{header:ae.t("label.cam.amount/percentage"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:et}),e.jsx(se,{header:ae.t("label.cam.amountIncludingGst(₹)"),className:"table-header-right text-primary-ptext-1000 text-xs h-12 pl-6",body:tt}),e.jsx(se,{header:ae.t("label.investmentInfo.table.colTitle.action"),className:"text-primary-ptext-1000 text-right text-xs h-12 px-6",style:{minWidth:"50px",width:"50px"},body:nt})]}):null]}):null})]})})}),e.jsx(Ft,{visible:t.isChangeProductIncomeScheme,className:"  !w-100 !px-14",title:"Change Product Income Scheme ?",warningMessage:ue(),htmlMessage:!0,onCancel:x,onConfirm:S,onHide:()=>{}}),e.jsx(Fe,{position:"bottom-right",ref:M,toastText:J,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{te(!1),y("")},visible:h,errorMessage:P})]})}),kt={uid:"",totalAppraisedNetMonthlyIncome:0,maxEmi:0,emiFactor:0,eligibility:0,emi:0,actualLtv:0},hn=r.forwardRef((fe,Ce)=>{const{data:j,isLoading:b,getDetailsCallback:Y}=fe,[v,i]=r.useState({...kt});r.useState(I.VIEW);const[t,R]=r.useState(""),[O,ee]=r.useState(!1),[Z,X]=r.useState(""),[J,z]=r.useState(!1),U=r.useRef(null);Me.useRef(null);const[,A]=r.useState(!1);r.useRef(new ie({validators:{...oe()},...ce(),autoForceUpdate:{forceUpdate:()=>A(m=>!m)}})),r.useEffect(()=>{i(m=>({...m,...j}))},[j]),r.useEffect(()=>{var m;U!=null&&U.current&&t!==""&&((m=U==null?void 0:U.current)==null||m.showFunction(),R(""))},[t,O]),r.useEffect(()=>{Z&&z(!0)},[Z]);const{totalAppraisedNetMonthlyIncome:P,actualLtv:y,eligibility:h,emi:te,emiFactor:M,maxEmi:p}=v;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border border-primary-ptext-500 rounded-xl p-5 flex flex-col gap-3 ",children:b?e.jsx(Ke,{height:"19.375rem",width:"100%",borderRadius:"8px",animation:"wave"}):e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.cam.totalAppraisedNetMonthlyIncome"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:le(P)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.cam.totalMaxEmi"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:le(p)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.cam.emiFactor"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:le(M)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.cam.eligibility"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:le(h)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.cam.emi"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:le(te)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(L,{className:"text-primary-gray-600 text-xs",label:"label.cam.actualLtv"}),e.jsx(L,{className:"text-primary-ptext-1000 text-xs ",label:le(y)})]})]})}),e.jsx(Fe,{position:"bottom-right",ref:U,toastText:t,variant:Re.PRIMARY}),e.jsx(Pe,{onHide:()=>{z(!1),X("")},visible:J,errorMessage:Z})]})});export{rn as F,un as L,dn as P,mn as R,hn as S,Lt as a,_t as b,kt as c,Wt as d,$t as e,Ut as f,xn as g,on as h,cn as i};
//# sourceMappingURL=Summary-8a53bc7e.js.map
